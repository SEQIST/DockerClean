/*!
*  filename: ej2-gantt.umd.min.js
*  version : 29.1.40
*  Copyright Syncfusion Inc. 2001 - 2024. All rights reserved.
*  Use of this code is subject to the terms of our license.
*  A copy of the current license can be obtained at any time by e-mailing
*  licensing@syncfusion.com. Any infringement will be prosecuted under
*  applicable laws. 
*/
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@syncfusion/ej2-base"),require("@syncfusion/ej2-popups"),require("@syncfusion/ej2-data"),require("@syncfusion/ej2-grids"),require("@syncfusion/ej2-treegrid"),require("@syncfusion/ej2-dropdowns"),require("@syncfusion/ej2-svg-base"),require("@syncfusion/ej2-layouts"),require("@syncfusion/ej2-navigations"),require("@syncfusion/ej2-richtexteditor"),require("@syncfusion/ej2-inputs"),require("@syncfusion/ej2-buttons"),require("@syncfusion/ej2-calendars"),require("@syncfusion/ej2-pdf-export")):"function"==typeof define&&define.amd?define(["exports","@syncfusion/ej2-base","@syncfusion/ej2-popups","@syncfusion/ej2-data","@syncfusion/ej2-grids","@syncfusion/ej2-treegrid","@syncfusion/ej2-dropdowns","@syncfusion/ej2-svg-base","@syncfusion/ej2-layouts","@syncfusion/ej2-navigations","@syncfusion/ej2-richtexteditor","@syncfusion/ej2-inputs","@syncfusion/ej2-buttons","@syncfusion/ej2-calendars","@syncfusion/ej2-pdf-export"],t):t((e=e||self).ej={},e.ej2Base,e.ej2Popups,e.ej2Data,e.ej2Grids,e.ej2Treegrid,e.ej2Dropdowns,e.ej2SvgBase,e.ej2Layouts,e.ej2Navigations,e.ej2Richtexteditor,e.ej2Inputs,e.ej2Buttons,e.ej2Calendars,e.ej2PdfExport)}(this,function(k,oe,U,y,b,T,F,N,L,V,h,B,A,W,le){"use strict";function P(e,t,i){for(var n=e;n&&(i?n.id!==t:!n.classList.contains(t));)n=n.parentElement;return n}function H(e){return oe.isNullOrUndefined(e.startDate)&&oe.isNullOrUndefined(e.endDate)&&oe.isNullOrUndefined(e.duration)?null:!(oe.isNullOrUndefined(e.startDate)||oe.isNullOrUndefined(e.endDate)||oe.isNullOrUndefined(e.duration))}function j(e){return!(!e.dataSource||e.dataSource instanceof y.DataManager||!("result"in e.dataSource))}function G(e){for(var t={},i=0,n=Object.keys(e);i<n.length;i++){var a=n[i];t[e[a]]=a}return t}function z(e){return!oe.isNullOrUndefined(e)&&"object"==typeof e&&0===Object.keys(e).length}function q(e){var t=e.getFullYear(),i=e.getMonth(),n=e.getDate(),a=e.getHours(),r=e.getMinutes(),s=e.getSeconds(),e=e.getMilliseconds();return Date.UTC(t,i,n,a,r,s,e)}function _(e){return e instanceof y.DataManager&&((e=e.adaptor)instanceof y.ODataAdaptor||e instanceof y.ODataV4Adaptor||e instanceof y.WebApiAdaptor||e instanceof y.WebMethodAdaptor||e instanceof y.CacheAdaptor||e instanceof y.RemoteSaveAdaptor||e instanceof y.UrlAdaptor)}function X(e,t,i,n){if(i)for(var a=void 0,r=0;r<e.length;r++)a=s=t?e[parseInt(r.toString(),10)].taskData:oe.extend({},e[parseInt(r.toString(),10)].taskData,{},!0);else for(a=[],r=0;r<e.length;r++){!oe.isNullOrUndefined(n)&&n.timezone&&Z(e[r],n);var s=t?e[parseInt(r.toString(),10)].taskData:oe.extend({},e[parseInt(r.toString(),10)].taskData,{},!0);a.push(s)}return a}function Z(e,t){return e&&!oe.isNullOrUndefined(e.ganttProperties)&&(e.taskData[t.taskFields.startDate]=t.dateValidationModule.remove(e.ganttProperties.startDate,t.timezone),null!==t.taskFields.endDate&&(e.taskData[t.taskFields.endDate]=t.dateValidationModule.remove(e.ganttProperties.endDate,t.timezone)),t.taskFields.baselineEndDate||t.taskFields.baselineStartDate)&&(e.taskData[t.taskFields.baselineStartDate]=t.dateValidationModule.remove(e.ganttProperties.baselineStartDate,t.timezone),e.taskData[t.taskFields.baselineEndDate]=t.dateValidationModule.remove(e.ganttProperties.baselineEndDate,t.timezone)),null}function Y(e,t){for(var i,n=0;n<t.length;n++)i=new RegExp("\\{"+n+"\\}","gm"),e=e.replace(i,t[n].toString());return e}function K(e,t,i,n){for(var a=-1,r=0;r<i.length;r++)if(oe.getValue(t,i[r])===oe.getValue(t,e)&&oe.isNullOrUndefined(n)||!oe.isNullOrUndefined(n)&&oe.getValue(t,i[r])===oe.getValue(t,e)&&oe.getValue(n,i[r])===oe.getValue(n,e)){a=r;break}return a}function de(e){return 76*e/92}function he(e){return 92*e/76}var Q=0;function J(){return Q++}e.prototype.isValidateNonWorkDays=function(e){return!oe.isNullOrUndefined(e)&&e.isAutoSchedule&&(!this.parent.includeWeekend||0<this.parent.totalHolidayDates.length)||oe.isNullOrUndefined(e)&&(!this.parent.includeWeekend||0<this.parent.totalHolidayDates.length)},e.prototype.checkStartDate=function(e,t,i,n){if(oe.isNullOrUndefined(e))return null;var a=new Date(e.getTime()),r=this.parent.getCurrentDayStartTime(a),s=this.parent.getCurrentDayEndTime(a),o=new Date(e.getTime()),l=this.getSecondsInDecimal(o);if(i=oe.isNullOrUndefined(i)?!oe.isNullOrUndefined(t)&&t.isMilestone:i,l<r&&(!i||n))this.setTime(r,o);else if(l<r&&i)this.setTime(r,o);else if(l===s&&(!t||!i)||s<l)o.setDate(o.getDate()+1),r=this.parent.getCurrentDayStartTime(o),this.setTime(r,o);else if(r<l&&l<s){var d=this.parent.workingTimeRanges;0<this.parent.weekWorkingTime.length&&(d=this.parent.getWorkingRange(o));for(var h=0;h<d.length;h++){var p=d[h];if(l>=p.to&&d[h+1]&&l<d[h+1].from){(l!==p.to||t&&i)&&l===p.to||this.setTime(d[h+1].from,o);break}}}if(this.parent.autoCalculateDateScheduling&&!(this.parent.isLoad&&this.parent.treeGrid.loadChildOnDemand&&this.parent.taskFields.hasChildMapping))do{var u=new Date(o.getTime()),c=this.parent.totalHolidayDates.length;if(this.isValidateNonWorkDays(t)){r=this.parent.getCurrentDayStartTime(u),t&&(s=this.parent.getCurrentDayEndTime(t.endDate?t.isAutoSchedule?t.endDate:t.autoEndDate:u));var g,f=!i||n?r:s;this.parent.includeWeekend||(g=new Date(o.getTime()),o=this.getNextWorkingDay(o),f=this.parent.getCurrentDayStartTime(o),g.getTime()===o.getTime())||i||this.setTime(f,o);for(var m=0;m<c;m++){var y=this.getDateFromFormat(new Date(this.parent.totalHolidayDates[m])),D=new Date(y.getTime());y.setHours(0,0,0,0),D.setHours(23,59,59,59),o.getTime()>=y.getTime()&&o.getTime()<D.getTime()&&(o.setDate(o.getDate()+1),f=this.parent.getCurrentDayStartTime(o),this.setTime(f,o))}}}while(u.getTime()!==o.getTime());return new Date(o.getTime())},e.prototype.checkEndDate=function(e,t,i){if(oe.isNullOrUndefined(e))return null;d=0<this.parent.weekWorkingTime.length?(s=e,(!this.parent.includeWeekend&&t&&t.isAutoSchedule||this.parent.editModule&&this.parent.editModule.taskbarEditModule&&this.parent.editModule.taskbarEditModule.taskBarEditRecord&&!this.parent.editModule.taskbarEditModule.taskBarEditRecord.ganttProperties.isAutoSchedule)&&(s=this.getNextWorkingDay(e)),n=this.parent.getStartTime(s),this.parent.getEndTime(s)):(n=this.parent.defaultStartTime,this.parent.defaultEndTime);var n,a=new Date(e.getTime()),r=this.getSecondsInDecimal(a);if(d<r)this.setTime(d,a);else if(r<=n&&!i){var s=this.parent.taskFields;this.parent.editModule&&this.parent.editModule.editedRecord&&!this.parent.editModule.editedRecord[s.startDate]&&this.parent.editModule.editedRecord[s.endDate]?a.setDate(a.getDate()):a.setDate(a.getDate()-1),d=this.parent.getCurrentDayEndTime(a),this.setTime(d,a)}else if(n<r&&r<d)for(var o=0;o<this.parent.workingTimeRanges.length;o++)if(r>this.parent.workingTimeRanges[o].to&&this.parent.workingTimeRanges[o+1]&&r<=this.parent.workingTimeRanges[o+1].from){this.setTime(this.parent.workingTimeRanges[o].to,a);break}if(!this.parent.autoCalculateDateScheduling||this.parent.isLoad&&this.parent.treeGrid.loadChildOnDemand&&this.parent.taskFields.hasChildMapping)oe.isNullOrUndefined(a)||86400===this.parent.defaultEndTime||(d=this.parent.getCurrentDayEndTime(e),this.setTime(d,a));else do{var l,d,h=new Date(a.getTime()),p=this.parent.totalHolidayDates.length;if(this.isValidateNonWorkDays(t)){this.parent.includeWeekend||(l=new Date(a.getTime()),a=this.getPreviousWorkingDay(a),d=this.parent.getCurrentDayEndTime(a),l.getTime()!==a.getTime()&&this.setTime(d,a));for(var u=0;u<p;u++){var c=this.getDateFromFormat(new Date(this.parent.totalHolidayDates[u])),g=new Date(c.getTime()),f=new Date(a.getTime());f.setMinutes(a.getMilliseconds()-2),c.setHours(0,0,0,0),g.setHours(23,59,59,59),(a.getTime()>=c.getTime()&&a.getTime()<g.getTime()||f.getTime()>=c.getTime()&&f.getTime()<g.getTime())&&(a.setDate(a.getDate()-1),d=this.parent.getCurrentDayEndTime(a),a.getTime()===c.getTime()&&86400===d&&0===this.getSecondsInDecimal(a)||this.setTime(d,a))}}}while(h.getTime()!==a.getTime());return new Date(a.getTime())},e.prototype.checkBaselineStartDate=function(e,t){if(oe.isNullOrUndefined(e))return null;var i=this.parent.getCurrentDayStartTime(e),t=this.parent.getCurrentDayEndTime(t&&t.endDate?t.isAutoSchedule?t.endDate:t.autoEndDate:e),n=new Date(e.getTime()),a=this.getSecondsInDecimal(n);if(a<i)this.setTime(i,n);else if(t<a)n.setDate(n.getDate()+1),i=0<this.parent.weekWorkingTime.length?this.parent.getStartTime(n):this.parent.defaultStartTime,this.setTime(i,n);else if(i<a&&a<t)for(var r=0;r<this.parent.workingTimeRanges.length;r++)if(a>this.parent.workingTimeRanges[r].to&&this.parent.workingTimeRanges[r+1]&&a<this.parent.workingTimeRanges[r+1].from){this.setTime(this.parent.workingTimeRanges[r+1].from,n);break}return n},e.prototype.checkBaselineEndDate=function(e,t){if(oe.isNullOrUndefined(e))return null;var i=this.parent.getCurrentDayEndTime(e),n=this.parent.getCurrentDayStartTime(t&&t.startDate?t.isAutoSchedule?t.startDate:t.autoStartDate:e),a=new Date(e.getTime()),r=this.getSecondsInDecimal(a);if(i<r)this.setTime(i,a);else if(r<n&&!oe.isNullOrUndefined(t)&&!t.isMilestone)a.setDate(a.getDate()-1),i=this.parent.getCurrentDayEndTime(a),this.setTime(i,a);else if(n<r&&r<i)for(var s=0;s<this.parent.workingTimeRanges.length;s++)if(r>this.parent.workingTimeRanges[s].to&&this.parent.workingTimeRanges[s+1]&&r<=this.parent.workingTimeRanges[s+1].from){this.setTime(this.parent.workingTimeRanges[s].to,a);break}return t&&t.baselineStartDate&&a&&t.baselineStartDate.getTime()>a.getTime()&&a.setDate(a.getDate()+1),a},e.prototype.calculateStartDate=function(e){var t=e.ganttProperties,i=null;oe.isNullOrUndefined(t.endDate)||oe.isNullOrUndefined(t.duration)||(i=this.getStartDate(t.endDate,t.duration,t.durationUnit,t)),this.parent.setRecordValue("startDate",i,t,!0),this.parent.taskFields.startDate&&this.parent.dataOperation.updateMappingData(e,"startDate")},e.prototype.calculateEndDate=function(e){var t,i,n=e.ganttProperties,a=null;oe.isNullOrUndefined(n.startDate)?(a=e[this.parent.taskFields.endDate],oe.isNullOrUndefined(a)||(i=this.parent.getCurrentDayEndTime(a),this.setTime(i,a))):(!oe.isNullOrUndefined(n.endDate)&&oe.isNullOrUndefined(n.duration)&&(1===this.compareDates(n.startDate,n.endDate)&&(this.parent.setRecordValue("startDate",new Date(n.endDate.getTime()),n,!0),t=this.parent.getCurrentDayStartTime(n.isAutoSchedule?n.autoStartDate:n.startDate),i=this.parent.getCurrentDayEndTime(n.isAutoSchedule?n.autoEndDate:n.endDate),this.setTime(t,n.startDate)),this.calculateDuration(e)),oe.isNullOrUndefined(n.duration)||(i=!oe.isNullOrUndefined(n.segments)&&1<n.segments.length?this.totalDuration(n.segments):n.duration,a=this.getEndDate(n.startDate,i,n.durationUnit,n,!1))),this.parent.setRecordValue("endDate",a,n,!0),this.parent.taskFields.endDate&&this.parent.dataOperation.updateMappingData(e,"endDate")},e.prototype.totalDuration=function(e){for(var t=0,i=0;i<e.length;i++)t+=e[i].duration+e[i].offsetDuration;return t},e.prototype.calculateDuration=function(e){var t=e.ganttProperties,i=!oe.isNullOrUndefined(t.segments)&&0<t.segments.length&&!oe.isNullOrUndefined(this.parent.editModule.taskbarEditModule)?this.parent.editModule.taskbarEditModule.sumOfDuration(t.segments):oe.isNullOrUndefined(this.parent.taskFields.milestone)||oe.isNullOrUndefined(t.startDate)||oe.isNullOrUndefined(t.endDate)||t.startDate.getTime()!==t.endDate.getTime()||!1!==e.taskData[this.parent.taskFields.milestone]?this.getDuration(t.startDate,t.endDate,t.durationUnit,t.isAutoSchedule,t.isMilestone):1,t=(this.parent.setRecordValue("duration",i,t,!0),this.parent.columnByField[this.parent.columnMapping.duration]);oe.isNullOrUndefined(this.parent.editModule)||oe.isNullOrUndefined(this.parent.editModule.cellEditModule)||this.parent.editModule.cellEditModule.isCellEdit||oe.isNullOrUndefined(t)||(oe.isNullOrUndefined(t.edit)||oe.isNullOrUndefined(t.edit.read)||(t=this.parent.editModule.dialogModule.dialog,oe.isNullOrUndefined(t))||(t=t.querySelector("#"+this.parent.element.id+"Duration").ej2_instances[0],oe.isNullOrUndefined(t))||t.value===i.toString()||(t.value=i.toString(),t.dataBind()),this.parent.taskFields.duration&&(this.parent.dataOperation.updateMappingData(e,"duration"),this.parent.taskFields.durationUnit)&&this.parent.dataOperation.updateMappingData(e,"durationUnit"))},e.prototype.getNonworkingTime=function(e,t,i,n){n=!!oe.isNullOrUndefined(n)||n;var a=this.parent.includeWeekend||!this.parent.autoCalculateDateScheduling||this.parent.isLoad&&this.parent.treeGrid.loadChildOnDemand&&this.parent.taskFields.hasChildMapping||!i?0:this.getWeekendCount(e,t),n=this.getNumberOfSeconds(e,t,n),r=!i||!this.parent.autoCalculateDateScheduling||this.parent.isLoad&&this.parent.treeGrid.loadChildOnDemand&&this.parent.taskFields.hasChildMapping?0:this.getHolidaysCount(e,t),n=(n-86400*a-86400*r)/86400,s=this.getNonWorkingSecondsOnDate(e,t,i);return(0<this.parent.weekWorkingTime.length?this.nonWorkingSeconds(e,t,i,n):n*(86400-this.parent.secondsPerDay))+86400*a+86400*r+s},e.prototype.nonWorkingSeconds=function(e,t,i,n,a){var r=e.getTime()>t.getTime()?new Date(t.getTime()):new Date(e.getTime()),s=e.getTime()>t.getTime()?new Date(e.getTime()):new Date(t.getTime()),o=0,l=0;if(a?(e=this.parent.getCurrentDayStartTime(r),t=this.parent.getCurrentDayEndTime(r),r.getHours()<t/3600&&r.getHours()>=e/3600||r.setDate(r.getDate()+1)):(r.setDate(r.getDate()+1),r.setHours(0,0,0,0),s.setHours(0,0,0,0)),!(0<n||oe.isNullOrUndefined(n)))return 0;for(;a&&r.getTime()<=s.getTime()||!a&&r.getTime()<s.getTime();){if(i){if(this.isOnHolidayOrWeekEnd(r,!0))for(;r.setDate(r.getDate()+1),this.isOnHolidayOrWeekEnd(r,!0););this.parent.includeWeekend||this.getNextWorkingDay(r)}if(r.getTime()<=s.getTime()){l++;var d=this.parent.getSecondsPerDay(r);if(o+=a?d:86400-d,r.setDate(r.getDate()+1),i){if(this.isOnHolidayOrWeekEnd(r,!0))for(;r.setDate(r.getDate()+1),this.isOnHolidayOrWeekEnd(r,!0););this.parent.includeWeekend||this.getNextWorkingDay(r)}}}return a&&(0<o?o/=l:o=this.parent.secondsPerDay),o},e.prototype.getDuration=function(e,t,i,n,a,r){if(oe.isNullOrUndefined(e)||oe.isNullOrUndefined(t))return null;r=!!oe.isNullOrUndefined(r)||r;var s=0,r=this.getTimeDifference(e,t,r)/1e3-this.getNonworkingTime(e,t,n,r),n=0<this.parent.weekWorkingTime.length?this.nonWorkingSeconds(e,t,n,void 0,!0):this.parent.secondsPerDay,s=a&&this.parent.getFormatedDate(e)===this.parent.getFormatedDate(t)?0:i&&"day"!==i?"minute"===i?r/60:r/3600:r/n;return parseFloat(s.toString())},e.prototype.getDurationAsSeconds=function(e,t,i){i=0<this.parent.weekWorkingTime.length?this.parent.getSecondsPerDay(i):this.parent.secondsPerDay;return t&&"day"!==t.toLocaleLowerCase()?"hour"===t.toLocaleLowerCase()?3600*e:60*e:i*e},e.prototype.getEndDate=function(e,t,i,n,a){for(var r=new Date(e.getTime()),s=new Date(e.getTime()),o=new Date(e.getTime()),l=0<this.parent.weekWorkingTime.length&&(!i||"day"===i.toLocaleLowerCase())?this.calculateSecondDuration(t,o,l,e,!0):this.getDurationAsSeconds(t,i,e);0<l;)s.setSeconds(s.getSeconds()+l),0<(l-=l-this.getNonworkingTime(r,s,n.isAutoSchedule,!0))&&(s=this.checkStartDate(s,n,a)),r=new Date(s.getTime());return s},e.prototype.getStartDate=function(e,t,i,n,a){for(var r=new Date(e.getTime()),s=new Date(e.getTime()),e=new Date(r.getTime()),o=0<this.parent.weekWorkingTime.length?this.calculateSecondDuration(t,e,o,r,!1):this.getDurationAsSeconds(t,i,r);0<o;)s.setSeconds(s.getSeconds()-o),0<(o-=o-this.getNonworkingTime(s,r,n.isAutoSchedule,!0))&&(r=this.checkEndDate(s,n)),r=new Date(s.getTime());return a&&n.isMilestone&&(s.setDate(s.getDate()-1),e=this.parent.getCurrentDayEndTime(n.endDate?n.isAutoSchedule?n.endDate:n.autoEndDate:s),this.parent.dateValidationModule.setTime(e,s),s=this.parent.dateValidationModule.checkStartDate(s,n,!0)),s},e.prototype.calculateSecondDuration=function(e,t,i,n,a){if(e<1)i=this.parent.getSecondsPerDay(t)*e;else{i=0;var r=e,s=this.parent.getCurrentDayStartTime(t),o=this.parent.getCurrentDayEndTime(t);for(t.getHours()<o/3600&&t.getHours()>s/3600||!this.fromSegments||(a?t.setDate(t.getDate()+1):t.setDate(t.getDate()-1));0<r;){if(this.isOnHolidayOrWeekEnd(t,!0))for(;a?t.setDate(t.getDate()+1):t.setDate(t.getDate()-1),this.isOnHolidayOrWeekEnd(t,!0););this.parent.includeWeekend||(t=a?this.getNextWorkingDay(t):this.getPreviousWorkingDay(t));var l,d=this.parent.getSecondsPerDay(t),h=0;this.getSecondsInDecimal(n)===this.parent.getStartTime(n)||Number.isInteger(r)||(l=e.toString().split("."),d*=h=parseFloat("."+l[1]),r-=h),r<1&&(d*=r),i+=d,a?t.setDate(t.getDate()+1):t.setDate(t.getDate()-1),h||r--}}return i},e.prototype.getProjectStartDate=function(e,t){if(!oe.isNullOrUndefined(this.parent.cloneProjectStartDate))return"string"==typeof this.parent.cloneProjectStartDate&&(this.parent.cloneProjectStartDate=this.getDateFromFormat(this.parent.cloneProjectStartDate)),s=this.checkStartDate(this.parent.cloneProjectStartDate),this.parent.cloneProjectStartDate=s,new Date(s.getTime());if(oe.isNullOrUndefined(this.parent.projectStartDate)){if(oe.isNullOrUndefined(t))return null;var i=this.parent.flatData,n=void 0;0<i.length?n=i[0].ganttProperties.startDate:(n=new Date).setHours(0,0,0,0);for(var a=1;a<i.length;a++){var r=i[a].ganttProperties.startDate;oe.isNullOrUndefined(r)||-1!==this.compareDates(r,n)||(n=r)}this.parent.cloneProjectStartDate=this.checkStartDate(n,e)}else{var s=this.getDateFromFormat(this.parent.projectStartDate);this.parent.cloneProjectStartDate=this.checkStartDate(s)}return new Date(this.parent.cloneProjectStartDate.getTime())},e.prototype.getValidStartDate=function(e,t){var i=null,n=t?e.autoStartDate:e.startDate,t=t?e.autoEndDate:e.endDate,a=!e.isAutoSchedule&&e.autoDuration?e.autoDuration:e.duration;if(oe.isNullOrUndefined(n))if(oe.isNullOrUndefined(t)){if(!oe.isNullOrUndefined(a)){a=this.parent.getTaskByUniqueID(e.uniqueID);if(this.parent.allowUnscheduledTasks&&a&&a.parentItem&&oe.isNullOrUndefined(n)&&oe.isNullOrUndefined(t)){for(var r=this.parent.getParentTask(a.parentItem);r&&!r.ganttProperties.startDate;)r=this.parent.getParentTask(r.parentItem);i=r&&r.ganttProperties.startDate?r.ganttProperties.startDate:this.parent.cloneProjectStartDate}else i=this.getProjectStartDate(e)}}else{i=new Date(t.getTime()),a=this.parent.getCurrentDayStartTime(i);this.setTime(a,i)}else i=new Date(n.getTime());return i},e.prototype.getValidEndDate=function(e,t){var i,n=null,a=t?e.autoStartDate:e.startDate,r=t?e.autoEndDate:e.endDate,t=t?e.autoDuration:e.duration;return oe.isNullOrUndefined(r)?oe.isNullOrUndefined(a)?oe.isNullOrUndefined(t)||(i=this.getValidStartDate(e))&&(n=this.getEndDate(i,t,e.durationUnit,e,!1)):e.isMilestone?n=this.checkStartDate(a):(n=new Date(a.getTime()),i=this.parent.getCurrentDayEndTime(r||n),this.setTime(i,n)):n=new Date(r.getTime()),n},e.prototype.getWorkingTime=function(e,t,i,n,a,r,s,o){var l;return oe.isNullOrUndefined(t.from)||oe.isNullOrUndefined(t.to)||(i.setHours(0,0,0,0),l=new Date(i.getTime()),i.setTime(i.getTime()+36e5*t.from),i=new Date(i.getTime()),24===t.to?l.setTime(l.getTime()+864e5):l.setTime(l.getTime()+36e5*t.to),l=(t=new Date(l.getTime())).getTime()-i.getTime(),i=this.getSecondsInDecimal(i),0===(t=this.getSecondsInDecimal(t))&&(t=86400),n+=l/1e3,0===a&&(this.parent.defaultStartTime=i,0<this.parent.weekWorkingTime.length)&&this.assignStartTime(e,i),a!==this[e.toLowerCase()+"TimeRangeLength"]-1&&""!==e||(this.parent.defaultEndTime=t,0<this.parent.weekWorkingTime.length&&this.assignEndTime(e,t)),0<a?""===e?(r.push(r[r.length-1]+i-s[a-1].to),s[a-1].to<i&&o.push({from:s[a-1].to,to:i,isWorking:!1,interval:i-s[a-1].to})):(this.parent[e.toLowerCase()+"NonWorkingHours"].push(this.parent[e.toLowerCase()+"NonWorkingHours"][this.parent[e.toLowerCase()+"NonWorkingHours"].length-1]+i-this.parent[e.toLowerCase()+"NonWorkingTimeRanges"][a-1].to),this.parent[e.toLowerCase()+"WorkingTimeRanges"][a-1].to<i&&this.parent[e.toLowerCase()+"NonWorkingTimeRanges"].push({from:this.parent[e.toLowerCase()+"WorkingTimeRanges"][a-1].to,to:i,isWorking:!1,interval:i-this.parent[e.toLowerCase()+"WorkingTimeRanges"][a-1].to})):(""===e?(r.push(0),o):(this.parent[e.toLowerCase()+"NonWorkingHours"].push(0),this.parent[e.toLowerCase()+"NonWorkingTimeRanges"])).push({from:0,to:i,isWorking:!1,interval:i}),(""===e?(s.push({from:i,to:t}),o):(this.parent[e.toLowerCase()+"WorkingTimeRanges"].push({from:i,to:t}),this.parent[e.toLowerCase()+"NonWorkingTimeRanges"])).push({from:i,to:t,isWorking:!0,interval:t-i})),n},e.prototype.assignStartTime=function(e,t){switch(e){case"Monday":this.parent.mondayDefaultStartTime=t;break;case"Tuesday":this.parent.tuesdayDefaultStartTime=t;break;case"Wednesday":this.parent.wednesdayDefaultStartTime=t;break;case"Thursday":this.parent.thursdayDefaultStartTime=t;break;case"Friday":this.parent.fridayDefaultStartTime=t;break;case"Saturday":this.parent.saturdayDefaultStartTime=t;break;case"Sunday":this.parent.sundayDefaultStartTime=t}},e.prototype.assignEndTime=function(e,t){switch(e){case"Monday":this.parent.mondayDefaultEndTime=t;break;case"Tuesday":this.parent.tuesdayDefaultEndTime=t;break;case"Wednesday":this.parent.wednesdayDefaultEndTime=t;break;case"Thursday":this.parent.thursdayDefaultEndTime=t;break;case"Friday":this.parent.fridayDefaultEndTime=t;break;case"Saturday":this.parent.saturdayDefaultEndTime=t;break;case"Sunday":this.parent.sundayDefaultEndTime=t}},e.prototype.calculateWeekWorkTime=function(e,t,i,n,a,r,s){for(var o=0,l=0;l<t.length;l++){var d=t[l];o+=this.getWorkingTime(e,d,i,n,l,a,r,s)}return this.parent[e.toLowerCase()+"DefaultStartTime"]/3600!=24&&this.parent[e.toLowerCase()+"NonWorkingTimeRanges"].push({from:this.parent[e.toLowerCase()+"DefaultEndTime"],to:86400,isWorking:!1,interval:86400-this.parent[e.toLowerCase()+"DefaultEndTime"]}),o},e.prototype.getSecondsPerDay=function(){for(var e=0,t=new Date("10/11/2018"),i=(this.parent.nonWorkingHours=[],this.parent.nonWorkingHours),n=(this.parent.workingTimeRanges=[],this.parent.workingTimeRanges=[],this.parent.workingTimeRanges),a=(this.parent.nonWorkingTimeRanges=[],this.parent.nonWorkingTimeRanges),r=0,s=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];r<s.length;r++)this[(m=s[r]).toLowerCase()+"TimeRangeLength"]=this.parent.dayWorkingTime.length;if(0<this.parent.weekWorkingTime.length){for(var o=0;o<this.parent.weekWorkingTime.length;o++)this[this.parent.weekWorkingTime[o].dayOfWeek.toLowerCase()+"TimeRangeLength"]=this.parent.weekWorkingTime[o].timeRange.length;for(var l=this.parent.weekWorkingTime,d=this.parent.dayWorkingTime,h=0,p=l;h<p.length;h++){var u,c=p[h];c.timeRange&&0<c.timeRange.length&&(u=this.calculateWeekWorkTime(c.dayOfWeek,c.timeRange,t,e,i,n,a),this.parent[c.dayOfWeek.toLowerCase()+"Seconds"]=u)}for(var g=0,f=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];g<f.length;g++){var m=f[g],y=this.parent[m.toLowerCase()+"DefaultStartTime"];oe.isNullOrUndefined(y)&&(y=this.calculateWeekWorkTime(m,d,t,e,i,n,a),this.parent[m.toLowerCase()+"Seconds"]=y)}}for(var D=this.parent.dayWorkingTime,k=D.length,w=0,b=0;b<k;b++){var T=D[b];w+=this.getWorkingTime("",T,t,e,b,i,n,a)}return this.parent.defaultEndTime/3600!=24&&a.push({from:this.parent.defaultEndTime,to:86400,isWorking:!1,interval:86400-this.parent.defaultEndTime}),e=w},e.prototype.getDurationValue=function(e,t){var i,n=null,a=null;return"string"==typeof e?(i=e.match(/(\d*\.*\d+|.+$)/g))&&i.length<=2&&(a=parseFloat(i[0].toString().trim()),i=i[1]?i[1].toString().trim().toLowerCase():null,-1!==oe.getValue("minute",this.parent.durationUnitEditText).indexOf(i)?n="minute":-1!==oe.getValue("hour",this.parent.durationUnitEditText).indexOf(i)?n="hour":-1!==oe.getValue("day",this.parent.durationUnitEditText).indexOf(i)&&(n="day")):(a=e,n=null),{duration:a,durationUnit:n}},e.prototype.getNextWorkingDay=function(e){var t=e.getDay();return-1!==this.parent.nonWorkingDayIndex.indexOf(t)?(e.setDate(e.getDate()+1),this.getNextWorkingDay(e)):e},e.prototype.getWeekendCount=function(e,t){var i=0,n=new Date(e.getTime()),a=new Date(t.getTime());for(n.setHours(0,0,0,0),n.setDate(n.getDate()+1),a.setHours(0,0,0,0);n.getTime()<a.getTime();)-1!==this.parent.nonWorkingDayIndex.indexOf(n.getDay())&&(i+=1),n.setDate(n.getDate()+1);return i},e.prototype.getNumberOfSeconds=function(e,t,i){var e=new Date(e.getTime()),t=new Date(t.getTime()),n=0;return e.setDate(e.getDate()+1),e.setHours(0,0,0,0),t.setHours(0,0,0,0),n=(n=e.getTime()<t.getTime()?this.getTimeDifference(e,t,i)/1e3:n)%86400!=0?n-n%86400+86400:n},e.prototype.getHolidaysCount=function(e,t){var i=0,n=this.parent.totalHolidayDates,a=new Date(e.getTime()),r=new Date(t.getTime());if(a.setDate(a.getDate()+1),a.setHours(0,0,0,0),r.setHours(0,0,0,0),a.getTime()<r.getTime())for(var s=0;s<n.length;s++){var o=this.getDateFromFormat(new Date(n[s]));a.getTime()<=o.getTime()&&r.getTime()>o.getTime()&&(!this.parent.includeWeekend&&-1===this.parent.nonWorkingDayIndex.indexOf(o.getDay())||this.parent.includeWeekend)&&(i+=1)}return i},e.prototype.getHolidayDates=function(){for(var e=this.parent.holidays,t=[],i=0;i<e.length;i++){var n=this.getDateFromFormat(e[i].from),a=this.getDateFromFormat(e[i].to);if(!oe.isNullOrUndefined(n)||!oe.isNullOrUndefined(a))if(oe.isNullOrUndefined(n)||oe.isNullOrUndefined(a)){var r=n||a;r.setHours(0,0,0,0),-1===t.indexOf(r.getTime())&&t.push(r.getTime())}else for(;n<=a;)n.setHours(0,0,0,0),-1===t.indexOf(n.getTime())&&t.push(n.getTime()),n.setDate(n.getDate()+1)}return t},e.prototype.isOnHolidayOrWeekEnd=function(e,t){if(t=oe.isNullOrUndefined(t)?this.parent.includeWeekend:t,!(t=this.parent.autoCalculateDateScheduling||this.parent.isLoad&&this.parent.treeGrid.loadChildOnDemand&&this.parent.taskFields.hasChildMapping?t:!0)&&-1!==this.parent.nonWorkingDayIndex.indexOf(e.getDay()))return!0;for(var i=this.parent.totalHolidayDates,n=0;n<i.length;n++){var a=this.getDateFromFormat(new Date(i[n])),r=new Date(a.getTime());if(a.setHours(0,0,0,0),r.setHours(23,59,59,59),e.getTime()>=a.getTime()&&e.getTime()<r.getTime())return!0}return!1},e.prototype.getNonWorkingSecondsOnDate=function(e,t,i){var n=this.getSecondsInDecimal(e),a=this.getSecondsInDecimal(t),r=-1,s=-1,o=0,l=!(!i||!this.parent.autoCalculateDateScheduling||this.parent.isLoad&&this.parent.treeGrid.loadChildOnDemand&&this.parent.taskFields.hasChildMapping)&&this.isOnHolidayOrWeekEnd(e,null),i=!(!i||!this.parent.autoCalculateDateScheduling||this.parent.isLoad&&this.parent.treeGrid.loadChildOnDemand&&this.parent.taskFields.hasChildMapping)&&this.isOnHolidayOrWeekEnd(t,null);if(0<this.parent.weekWorkingTime.length){for(var d=this.parent.getNonWorkingRange(e),h=0;h<d.length;h++)n>=(u=d[h]).from&&n<=u.to&&(r=h);for(var p=this.parent.getNonWorkingRange(t),h=0;h<p.length;h++)a>=(u=p[h]).from&&a<=u.to&&(s=h)}else{d=this.parent.nonWorkingTimeRanges,p=this.parent.nonWorkingTimeRanges;for(var u,h=0;h<d.length;h++)n>=(u=d[h]).from&&n<=u.to&&(r=h),a>=u.from&&a<=u.to&&(s=h)}if(e.getDate()!==t.getDate()||e.getMonth()!==t.getMonth()||e.getFullYear()!==t.getFullYear()){if(l)o+=86400-n;else for(h=r;h<d.length;h++)oe.isNullOrUndefined(d[h])||d[h].isWorking||(o+=h===r?d[h].to-n:d[h].interval);if(i)o+=a;else for(h=0;h<=s;h++)p[h].isWorking||(o+=h===s?a-p[h].from:p[h].interval)}else if(r!==s)if(i)o+=a-n;else for(h=r;h<=s;h++)oe.isNullOrUndefined(d[h])||d[h].isWorking||(o+=h===r?d[h].to-n:h===s?a-d[h].from:d[h].interval);else i?o+=a-n:d[r].isWorking||(o=a-n);return o},e.prototype.getPreviousWorkingDay=function(e){var t=e.getDay(),i=0===t?6:t-1,n=this.parent.getCurrentDayEndTime(e);return(-1!==this.parent.nonWorkingDayIndex.indexOf(t)||-1!==this.parent.nonWorkingDayIndex.indexOf(i)&&86400===n&&0===this.getSecondsInDecimal(e))&&(e.setDate(e.getDate()-1),-1!==this.parent.nonWorkingDayIndex.indexOf(e.getDay()))?this.getPreviousWorkingDay(e):e},e.prototype.getNonWorkingDayIndex=function(){for(var e=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],t=e.length,i=(0===this.parent.workWeek.length&&(this.parent.workWeek=["Monday","Tuesday","Wednesday","Thursday","Friday"]),this.parent.workWeek.slice()),n=i.length,a=0;a<n;a++)i[a]=i[a].toLowerCase();this.parent.nonWorkingDayIndex=[];for(a=0;a<t;a++)-1===i.indexOf(e[a])&&this.parent.nonWorkingDayIndex.push(a)},e.prototype.setTime=function(e,t){var i=e/3600,n=(e-3600*(i=parseInt(i,10)))/60,n=parseInt(n,10);t.setHours(i,n,e-3600*i-60*n)},e.prototype.getTimeDifference=function(e,t,i){e=new Date(e.getTime()),t=new Date(t.getTime());return i&&this.updateDateWithTimeZone(e,t),t.getTime()-e.getTime()},e.prototype.updateDateWithTimeZone=function(e,t){var i,n,a,r,s=e.getTimezoneOffset(),o=t.getTimezoneOffset();s!==o&&((a=new Date((new Date).getFullYear(),0,1).getTimezoneOffset())!==s?(n=e,i=s):a!==o&&(n=t,i=o),a<0?(r=a-i,n.setTime(n.getTime()+60*r*1e3)):0<=a&&(r=i-a,n.setTime(n.getTime()-60*r*1e3)))},e.prototype.getSecondsInDecimal=function(e){return 60*e.getHours()*60+60*e.getMinutes()+e.getSeconds()+e.getMilliseconds()/1e3},e.prototype.offset=function(e,t){var i=e.getTimezoneOffset();try{var n=new Date(e.toLocaleString("en-US",{timeZone:t}));return isNaN(n.getTime())?0:(e.getTime()-n.getTime())/6e4+i}catch(e){return 0}},e.prototype.remove=function(e,t){return e=oe.isNullOrUndefined(e)?e:this.reverse(e,t,e.getTimezoneOffset())},e.prototype.reverse=function(e,t,i){"string"==typeof t&&(t=this.offset(e,t)),"string"==typeof i&&(i=this.offset(e,i));var n=e.getTimezoneOffset(),t=(e=new Date(e.getTime()+6e4*(t-i))).getTimezoneOffset();return new Date(e.getTime()+6e4*(t-n))},e.prototype.convert=function(e,t){var i=e.getTimezoneOffset(),t=this.offset(e,t),n=("string"==typeof i&&(i=this.offset(e,i)),"string"==typeof t&&(t=this.offset(e,t)),e.getTimezoneOffset()),i=(e=new Date(e.getTime()+6e4*(i-t))).getTimezoneOffset();return new Date(e.getTime()+6e4*(i-n))},e.prototype.getDateFromFormat=function(e,t){var i;return oe.isNullOrUndefined(e)?null:(e=e instanceof Date?new Date(e.getTime()):(i=this.parent.globalize.parseDate(e,{format:this.parent.getDateFormat(),type:"dateTime"}),oe.isNullOrUndefined(i)&&!isNaN(new Date(e).getTime())?new Date(e):i),!oe.isNullOrUndefined(this.parent.timezone)&&t?this.convert(e,this.parent.timezone):e)},e.prototype.compareDates=function(e,t){return oe.isNullOrUndefined(e)||oe.isNullOrUndefined(t)?!oe.isNullOrUndefined(e)&&oe.isNullOrUndefined(t)?1:oe.isNullOrUndefined(e)&&!oe.isNullOrUndefined(t)?-1:null:e.getTime()>t.getTime()?1:e.getTime()<t.getTime()?-1:0},e.prototype.getDurationString=function(e,t){var i="";return oe.isNullOrUndefined(e)||(i+=parseFloat(e.toFixed(2))+" ",oe.isNullOrUndefined(t))||(e=1!==e,"day"===t?i+=e?this.parent.localeObj.getConstant("days"):this.parent.localeObj.getConstant("day"):"hour"===t?i+=e?this.parent.localeObj.getConstant("hours"):this.parent.localeObj.getConstant("hour"):"minute"===t&&(i+=e?this.parent.localeObj.getConstant("minutes"):this.parent.localeObj.getConstant("minute"))),i},e.prototype.getWorkString=function(e,t){var i="";return oe.isNullOrUndefined(e)||(i+=parseFloat(e).toFixed(2)+" ",oe.isNullOrUndefined(t))||(e=1!==e,"day"===t?i+=e?this.parent.localeObj.getConstant("days"):this.parent.localeObj.getConstant("day"):"hour"===t?i+=e?this.parent.localeObj.getConstant("hours"):this.parent.localeObj.getConstant("hour"):"minute"===t&&(i+=e?this.parent.localeObj.getConstant("minutes"):this.parent.localeObj.getConstant("minute"))),i},e.prototype.calculateProjectDatesForValidatedTasks=function(e){var t,i=this,n="string"==typeof this.parent.projectStartDate?new Date(this.parent.projectStartDate):this.parent.projectStartDate,a="string"==typeof this.parent.projectEndDate?new Date(this.parent.projectEndDate):this.parent.projectEndDate,r=null,s=null,o=oe.getValue("dataOperation.dataArray",this.parent);n&&a||!o||0!==o.length?0<o.length&&(t=o.slice().sort(function(e,t){return new Date(e[i.parent.taskFields.startDate]).getTime()-new Date(t[i.parent.taskFields.startDate]).getTime()}),o=o.slice().sort(function(e,t){return new Date(t[i.parent.taskFields.endDate]).getTime()-new Date(e[i.parent.taskFields.endDate]).getTime()}),r=t[0][this.parent.taskFields.startDate],s=o[o.length-1][this.parent.taskFields.endDate]):(r=this.getDateFromFormat(new Date),s=this.getDateFromFormat(new Date(r.getTime()))),this.parent.cloneProjectStartDate=n?new Date(n.getTime()):"string"==typeof r?new Date(r):r,this.parent.cloneProjectEndDate=a?new Date(a.getTime()):"string"==typeof s?new Date(s):s},e.prototype.calculateProjectDates=function(e){var t,i,n,a,r,s,o,l,d,h=this;this.parent.isLoad&&this.parent.enablePersistence&&this.parent.cloneProjectStartDate&&this.parent.cloneProjectEndDate?(this.parent.cloneProjectStartDate=this.getDateFromFormat(this.parent.cloneProjectStartDate),this.parent.cloneProjectEndDate=this.getDateFromFormat(this.parent.cloneProjectEndDate)):(t="string"==typeof this.parent.projectStartDate?new Date(this.parent.projectStartDate):this.parent.projectStartDate,i="string"==typeof this.parent.projectEndDate?new Date(this.parent.projectEndDate):this.parent.projectEndDate,t=this.parent.timelineModule.isZooming&&this.parent.cloneProjectStartDate?this.getDateFromFormat(this.parent.cloneProjectStartDate):this.getDateFromFormat(t),i=this.parent.timelineModule.isZooming&&this.parent.cloneProjectEndDate?this.getDateFromFormat(this.parent.cloneProjectEndDate):this.getDateFromFormat(i),a=n=null,r=this.parent.flatData,s=this.parent.currentViewData,o=[],l=function(e){oe.isNullOrUndefined(e)||o.push(e)},d=function(e){0<e.length&&(e.sort(function(e,t){return e.getTime()-t.getTime()}),n=new Date(e[0].getTime()),a=1<e.length?new Date(e[e.length-1].getTime()):null)},(!t||!i)&&0<r.length||e||this.parent.timelineModule.isZoomToFit?((0<s.length&&this.parent.timelineModule.isZoomToFit&&this.parent.treeGrid.filterModule&&0<this.parent.treeGrid.filterModule.filteredResult.length?s:r).forEach(function(e){o=[];var t,e=e.ganttProperties,i=oe.isNullOrUndefined(e.startDate)&&oe.isNullOrUndefined(e.endDate)?t=null:(t=h.getValidStartDate(e),h.getValidEndDate(e));l(n),l(a),l(t),l(i),h.parent.renderBaseline&&!h.parent.timelineModule.isZoomToFit&&(l(e.baselineStartDate),l(e.baselineEndDate)),e.indicators&&0<e.indicators.length&&!h.parent.timelineModule.isZoomToFit&&e.indicators.forEach(function(e){l(h.getDateFromFormat(e.date))}),d(o)}),o=[],l(n),l(a),0<this.parent.eventMarkers.length&&!this.parent.timelineModule.isZoomToFit&&this.parent.eventMarkers.forEach(function(e,t){l(h.getDateFromFormat(e.day))}),0<this.parent.totalHolidayDates.length&&!this.parent.timelineModule.isZoomToFit&&this.parent.totalHolidayDates.forEach(function(e,t){l(new Date(e))}),d(o),n&&a||(n?n=oe.isNullOrUndefined(n)?this.getDateFromFormat(new Date):n:(n=oe.isNullOrUndefined(n)?this.getDateFromFormat(new Date):n).setHours(0,0,0,0),(a=this.getDateFromFormat(new Date(n.getTime()))).setDate(a.getDate()+20))):t&&i||0!==r.length||(n=this.getDateFromFormat(new Date),a=this.getDateFromFormat(new Date(n.getTime()))),e?(oe.setValue("minStartDate",n,e),oe.setValue("maxEndDate",a,e)):(this.prevProjectStartDate=this.parent.cloneProjectStartDate,this.parent.cloneProjectStartDate=n&&(this.parent.timelineModule.isZoomToFit||oe.isNullOrUndefined(t))?n:new Date(t.getTime()),this.parent.cloneProjectEndDate=a&&(this.parent.timelineModule.isZoomToFit||oe.isNullOrUndefined(i))?a:new Date(i.getTime())),this.parent.isProjectDateUpdated=!0)},e.prototype.splitTasksDuration=function(e){var t=0,i=e[0].startDate,e=e[e.length-1].endDate;return"Hour"===this.parent.timelineModule.bottomTier?t+=Math.ceil(this.getTimeDifference(i,e)/36e5):"Minutes"===this.parent.timelineModule.bottomTier?t+=Math.ceil(this.getTimeDifference(i,e)/6e4):t+=Math.ceil(this.getTimeDifference(i,e)/864e5),t};var $=e;function e(e){this.fromSegments=!1,this.mondayTimeRangeLength=0,this.tuesdayTimeRangeLength=0,this.wednesdayTimeRangeLength=0,this.thursdayTimeRangeLength=0,this.fridayTimeRangeLength=0,this.saturdayTimeRangeLength=0,this.sundayTimeRangeLength=0,this.parent=e}ee=function(e,t){return(ee=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])}))(e,t)};(function(e,t){function i(){this.constructor=e}ee(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)})(t,te=$),t.prototype.addEventListener=function(){this.parent.on("beforeDataManipulate",this.checkDataBinding.bind(this))},t.prototype.checkDataBinding=function(e){var t,i=this;e&&(this.parent.flatData=[],this.parent.currentViewData=[],this.parent.updatedRecords=[],this.dataArray=[],this.taskIds=[],this.parent.ids=[],this.recordIndex=0,this.hierarchyData=[],this.parent.predecessorsCollection=[],this.parent.treeGrid.parentData=[],this.parent.taskIds=[]),oe.isNullOrUndefined(this.parent.dataSource)?(this.parent.dataSource=[],this.parent.processTimeline(),this.parent.renderGantt(e)):this.parent.dataSource instanceof y.DataManager?this.initDataSource(e):(this.parent.dataSource instanceof Object&&j(this.parent)?(t=oe.getValue("result",this.parent.dataSource),this.dataArray=t):this.dataArray=this.parent.dataSource,this.processTimeline(),this.cloneDataSource(),this.parent.renderGantt(e),this.parent.flatData.map(function(e){i.parent.chartRowsModule.updateSegment(e.ganttProperties.segments,e.ganttProperties.taskId)})),this.parent.flatData.map(function(e){i.parent.chartRowsModule.updateSegment(e.ganttProperties.segments,e.ganttProperties.taskId)})},t.prototype.processTimeline=function(){this.parent.processTimeline(),this.parent.enableValidation||(this.parent.dataOperation.calculateProjectDatesForValidatedTasks(),this.parent.timelineModule.validateTimelineProp())},t.prototype.initDataSource=function(t){var i=this,e=this.parent.query instanceof y.Query?this.parent.query:new y.Query,n=(e.requiresCount(),this.parent.dataSource);this.parent.loadChildOnDemand&&this.parent.taskFields.hasChildMapping?(this.processTimeline(),this.parent.renderGantt(t)):n.executeQuery(e).then(function(e){i.dataArray=e.result,i.processTimeline(),i.parent.loadChildOnDemand&&(!i.parent.loadChildOnDemand||i.parent.taskFields.hasChildMapping)||i.cloneDataSource(),i.parent.renderGantt(t)}).catch(function(e){i.parent.processTimeline(),i.parent.renderGantt(t),i.parent.trigger("actionFailure",{error:e})})},t.prototype.constructDataSource=function(e){for(var t,i=new y.DataManager(e).executeLocal((new y.Query).group(this.parent.taskFields.parentID)),n=[],a=0;a<i.length;a++){var r=i[a];!oe.isNullOrUndefined(r.key)&&-1<(t=this.taskIds.indexOf(r.key.toString()))&&!oe.isNullOrUndefined(r.key)?e[t][this.parent.taskFields.child]=r.items:-1!==t&&n.push.apply(n,r.items)}this.hierarchyData=this.dataReorder(e,n)},t.prototype.cloneDataSource=function(){var e,t,i,n=this.parent.taskFields.id,a=this.parent.taskFields.parentID,r=[];if(oe.isNullOrUndefined(n)||oe.isNullOrUndefined(a))r=this.dataArray;else{var s=[],a=void 0;this.parent.loadChildOnDemand&&this.parent.taskFields.hasChildMapping&&!this.parent.enableVirtualization&&(a=JSON.parse(JSON.stringify(this.dataArray)));for(var o=0;o<this.dataArray.length;o++){var l=this.dataArray[o];l.parentItem&&delete l.parentItem,s.push(oe.extend({},{},l,!0)),oe.isNullOrUndefined(l[n])||this.taskIds.push(l[n].toString())}this.parent.taskFields.child||this.parent.setProperties({taskFields:{child:"Children"}},!0),oe.isNullOrUndefined(a)?this.constructDataSource(s):(this.constructDataSource(this.dataArray),this.dataArray=a),r=this.hierarchyData}this.parent.taskFields.segmentId&&(this.segmentCollection=new y.DataManager(this.parent.segmentData).executeLocal((new y.Query).group(this.parent.taskFields.segmentId)),this.parent.taskFields.segments||(this.parent.taskFields.segments="Segments")),"ProjectView"!==this.parent.viewType&&(a=oe.extend([],[],this.parent.resources,!0),this.constructResourceViewDataSource(a,r,e=[]),0<e.length&&(i=this.parent.resourceFields.name||"resourceName",(t={})[this.parent.resourceFields.id]=0,t[i]=this.parent.localeObj.getConstant("unassignedTask"),t[this.parent.taskFields.child]=e,a.push(t)),r=a),this.prepareDataSource(r)},t.prototype.constructResourceViewDataSource=function(s,o,l){for(var d=this,e=0;e<o.length;e++)!function(e){var n=o[e],a=null!==d.parent.taskFields.child?d.parent.taskFields.child:d.parent.taskFields.child="Children",e=n&&n[d.parent.taskFields.resourceInfo],r=d.parent.resourceFields.id;if(n[a]&&0!==n[a].length||!e||!e.length)(!n[a]||n[a]&&0===n[a].length)&&l.push(n);else if("string"==typeof e){d.isResourceString=!0;for(var t=e,i=0;i<s.length;i++)if(s[i][d.parent.resourceFields.name].toString()===t.toString()){s[i][a]?s[i][a].push(n):s[i][a]=[n];break}}else e.forEach(function(e){for(var t="object"==typeof e?e[r]:e,i=0;i<s.length;i++)if(s[i][r].toString()===t.toString()){s[i][a]?s[i][a].push(n):s[i][a]=[n];break}});n[d.parent.taskFields.child]&&n[d.parent.taskFields.child].length&&d.constructResourceViewDataSource(s,n[d.parent.taskFields.child],l)}(e)},t.prototype.prepareDataSource=function(e){this.prepareRecordCollection(e,0),this.parent.initialLoadData=oe.extend({},{},this.parent.flatData,!0),(!this.parent.autoCalculateDateScheduling||this.parent.isLoad&&this.parent.treeGrid.loadChildOnDemand&&this.parent.taskFields.hasChildMapping)&&(this.parent.dataMap=this.parent.flatData.reduce(function(e,t){return e.set(t.uniqueID,t),e},new Map)),"ResourceView"===this.parent.viewType&&this.calculateSharedTaskUniqueIds(),this.parent.taskFields.dependency&&this.parent.predecessorModule&&this.parent.predecessorModule.ensurePredecessorCollection()},t.prototype.calculateSharedTaskUniqueIds=function(){for(var r=this,e=0;e<this.parent.getTaskIds().length;e++)!function(e){var t=[];if(t[0]=r.parent.getTaskIds()[e][0],t[1]=r.parent.getTaskIds()[e].slice(1),"R"!==t[0]){var i=[],n=[];r.parent.flatData.filter(function(e){e.ganttProperties.taskId.toString()===t[1]&&0!==e.level&&(n.push(e.ganttProperties.rowUniqueID),i.push(e))});for(var a=0;a<i.length;a++)i[a].ganttProperties.sharedTaskUniqueIds=n}}(e)},t.prototype.prepareRecordCollection=function(s,o,l){for(var d=this,e=s.length,h=this,t=0;t<e;t++)!function(e){var t,i,n,a=s[e],e=(oe.isNullOrUndefined(h.parent.taskFields.segmentId)||0<(e=h.segmentCollection.filter(function(e){return e.key===a[d.parent.taskFields.id]})).length&&(a[h.parent.taskFields.segments]=e[0].items),h.parent.taskFields.hasChildMapping&&a.parentUniqueID&&(l=h.parent.getTaskByUniqueID(a.parentUniqueID)),h.createRecord(a,o,l,!0)),r=(h.parent.enableValidation&&h.parent.autoCalculateDateScheduling&&!(h.parent.isLoad&&h.parent.treeGrid.loadChildOnDemand&&h.parent.taskFields.hasChildMapping)||h.updateTaskLeftWidth(e),e.index=h.recordIndex++,h.parent.ids[e.index]=e.ganttProperties.rowUniqueID,h.parent.flatData.push(e),h.parent.setTaskIds(e),a[h.parent.taskFields.child]||a.taskData&&a.taskData[h.parent.taskFields.child]);"ResourceView"===h.parent.viewType&&oe.isNullOrUndefined(r)&&oe.isNullOrUndefined(e.parentItem)&&0===e.level&&(i=e.ganttProperties,h.parent.setRecordValue(i.isAutoSchedule?"startDate":"autoStartDate",null,(t=e).ganttProperties,!0),h.parent.setRecordValue(i.isAutoSchedule?"endDate":"autoEndDate",null,t.ganttProperties,!0),i=t.ganttProperties,h.parent.setRecordValue("isMilestone",!1,i,!0),i.isAutoSchedule&&h.calculateDuration(t),h.updateWorkWithDuration(t),n=i.work,h.parent.setRecordValue("work",n,i,!0),h.parent.setRecordValue("taskType","FixedDuration",i,!0),oe.isNullOrUndefined(h.parent.taskFields.type)||h.updateMappingData(t,"type"),h.parent.setRecordValue("progress",Math.floor(0),i,!0),h.parent.setRecordValue("totalProgress",0,i,!0),h.parent.setRecordValue("totalDuration",0,i,!0),i.isAutoSchedule||(h.parent.setRecordValue("autoDuration",h.calculateAutoDuration(i),i,!0),h.updateAutoWidthLeft(t)),h.parent.allowParentDependency||h.resetDependency(t),h.updateWidthLeft(t),h.updateTaskData(t)),h.parent.taskFields.hasChildMapping&&(l=null),!oe.isNullOrUndefined(r)&&0<r.length&&h.prepareRecordCollection(r,e.level+1,e)}(t)},t.prototype.addCustomFieldValue=function(e,t){var i=this.parent.ganttColumns,n=i.length;if(n)for(var a=0;a<n;a++)void 0===t[i[a].field]&&this.parent.setRecordValue(i[a].field,e[i[a].field],t)},t.prototype.getGanttUid=function(e){return e+this.uid++},t.prototype.createRecord=function(e,t,i,n){var a,r,s=this.parent.taskFields,o=this.parent.resourceFields,l=e[s.progress],d=null,h=null,p=e[s.notes],u=(l=100<(l=l&&parseFloat(l.toString())?parseFloat(l.toString()):0)?100:l,e[s.dependency]),c=this.getDateFromFormat(e[s.baselineStartDate],!0),g=this.getDateFromFormat(e[s.baselineEndDate],!0),f=(this.parent.loadChildOnDemand&&s.hasChildMapping&&!this.parent.enableVirtualization?(a=e,r=JSON.parse(JSON.stringify(e))):a={},{}),m="Auto"===this.parent.taskMode||"Manual"!==this.parent.taskMode&&!0!==e[s.manual],d=(this.parent.setRecordValue("ganttProperties",f,a),e.ganttProperties&&e.ganttProperties.predecessor&&0<e.ganttProperties.predecessor.length&&this.parent.undoRedoModule&&this.parent.undoRedoModule.isUndoRedoPerformed&&this.parent.setRecordValue("predecessor",e.ganttProperties.predecessor,f,!0),oe.isNullOrUndefined(e[s.id])?oe.isNullOrUndefined(e[o.id])||(d=e[o.id],h=oe.isNullOrUndefined(e[o.name])&&"Unassigned Task"===e.resourceName?e.resourceName:e[o.name],this.addTaskData(a,e,!1)):(d=e[s.id],h=e[s.name],!!(this.parent.loadChildOnDemand&&s.hasChildMapping&&e.taskData)?a.taskData=e.taskData:e.taskData&&e.ganttProperties?this.addTaskData(a,e.taskData,n):this.addTaskData(a,e,n)),this.parent.setRecordValue("taskId",d,f,!0),this.parent.setRecordValue("taskName",h,f,!0),this.parent&&s.parentID&&this.parent.setRecordValue("parentId",e[s.parentID],f,!0),this.addCustomFieldValue(e,a),this.parent.setRecordValue("isAutoSchedule",m,f,!0),!this.parent.undoRedoModule||this.parent.undoRedoModule&&!this.parent.undoRedoModule.isUndoRedoPerformed?this.parent.setRecordValue("resourceInfo",this.setResourceInfo(e),f,!0):e.ganttProperties&&this.parent.setRecordValue("resourceInfo",e.ganttProperties.resourceInfo,f,!0),this.parent.setRecordValue("isMilestone",!1,f,!0),this.parent.setRecordValue("indicators",e[s.indicators],f,!0),this.updateResourceName(a),!oe.isNullOrUndefined(e[s.child])&&0<e[s.child].length||e.taskData&&e.taskData[s.child]&&0<e.taskData[s.child].length?(this.parent.setRecordValue("hasChildRecords",!0,a),this.parent.setRecordValue("isMilestone",!1,f,!0),this.parent.allowParentDependency||this.resetDependency(a)):this.parent.loadChildOnDemand&&s.hasChildMapping&&a.taskData[s.hasChildMapping]?this.parent.setRecordValue("hasChildRecords",!0,a):this.parent.setRecordValue("hasChildRecords",!1,a),this.calculateScheduledValues(a,e,n),this.parent.setRecordValue("baselineStartDate",this.checkBaselineStartDate(c,f),f,!0),o=0<this.parent.weekWorkingTime.length&&g?this.parent.getEndTime(g):this.parent.defaultEndTime,g&&0===g.getHours()&&86400!==o&&this.setTime(o,g),(f.baselineStartDate&&g&&f.baselineStartDate.getTime()>g.getTime()||!oe.isNullOrUndefined(f.baselineStartDate)&&!oe.isNullOrUndefined(f.startDate)&&f.baselineStartDate.getTime()===f.startDate.getTime()&&!oe.isNullOrUndefined(g)&&!oe.isNullOrUndefined(f.endDate)&&g.toLocaleDateString()===f.endDate.toLocaleDateString()&&f.isMilestone)&&(g=f.baselineStartDate),this.parent.setRecordValue("baselineEndDate",this.checkBaselineEndDate(g,f),f,!0),this.parent.setRecordValue("progress",l,f,!0),this.parent.setRecordValue("totalProgress",l,f,!0),e.ganttProperties&&e.ganttProperties.predecessorsName&&this.parent.undoRedoModule&&this.parent.undoRedoModule.isUndoRedoPerformed?this.parent.setRecordValue("predecessorsName",e.ganttProperties.predecessorsName,f,!0):this.parent.setRecordValue("predecessorsName",u,f,!0),this.parent.setRecordValue("notes",p,f,!0),this.parent.setRecordValue("cssClass",e[s.cssClass],f,!0),this.parent.setRecordValue("parentItem",this.getCloneParent(i),a),this.parent.loadChildOnDemand&&s.hasChildMapping&&0<this.parent.currentViewData.length&&this.parent.setRecordValue("parentItem",a.parentItem,this.parent.currentViewData[this.taskIds.indexOf(e[s.id].toString())]),a.parentItem?a.parentItem.uniqueID:null);return this.parent.setRecordValue("parentUniqueID",d,a),"ResourceView"!==this.parent.viewType||oe.isNullOrUndefined(s.parentID)||oe.isNullOrUndefined(a.parentItem)||this.parent.setRecordValue("parentId",a.parentItem.taskId,f,!0),this.parent.setRecordValue("level",t,a),e.ganttProperties&&this.parent.undoRedoModule&&this.parent.undoRedoModule.isUndoRedoPerformed||this.parent.loadChildOnDemand&&s.hasChildMapping&&e.uniqueID?this.parent.setRecordValue("uniqueID",e.uniqueID,a):this.parent.setRecordValue("uniqueID",this.getGanttUid(this.parent.element.id+"_data_"),a),this.parent.setRecordValue("uniqueID",a.uniqueID,f,!0),this.parent.setRecordValue("childRecords",[],a),this.parent.dataSource instanceof Object&&j(this.parent)&&!oe.isNullOrUndefined(s.child)&&this.parent.setRecordValue(s.child,[],a),a.hasChildRecords&&(this.parent.setRecordValue("autoStartDate",a.ganttProperties.startDate,f),this.parent.setRecordValue("autoEndDate",a.ganttProperties.endDate,f),this.parent.setRecordValue("autoDuration",a.ganttProperties.duration,f)),this.parent.setRecordValue("expanded",!a.hasChildRecords||!this.parent.collapseAllParentTasks,a),oe.isNullOrUndefined(r)?this.updateExpandStateMappingValue(a,e):this.updateExpandStateMappingValue(a,r),n||(this.parent.setRecordValue("width",this.calculateWidth(a),f,!0),this.parent.setRecordValue("left",this.calculateLeft(f,a),f,!0),this.parent.setRecordValue("progressWidth",this.getProgressWidth(f.width,l),f,!0),f.baselineEndDate&&f.baselineStartDate&&(this.parent.setRecordValue("baselineLeft",this.calculateBaselineLeft(f),f,!0),this.parent.setRecordValue("baselineWidth",this.calculateBaselineWidth(f),f,!0))),oe.isNullOrUndefined(s.work)&&this.updateWorkWithDuration(a),oe.isNullOrUndefined(s.manual)||this.parent.dataOperation.updateMappingData(a,"manual"),this.updateTaskData(a),u&&this.parent.predecessorsCollection.push(a),oe.isNullOrUndefined(i)||(i.childRecords.push(a),this.parent.dataSource instanceof Object&&j(this.parent)&&!oe.isNullOrUndefined(this.parent.taskFields.child)&&i[this.parent.taskFields.child].push(a.taskData)),"ProjectView"===this.parent.viewType?this.parent.setRecordValue("rowUniqueID",f.taskId.toString(),f,!0):(h=a.uniqueID.replace(this.parent.element.id+"_data_",""),this.parent.setRecordValue("rowUniqueID",h,a),this.parent.setRecordValue("rowUniqueID",h,f,!0),this.parent.setRecordValue("sharedTaskUniqueIds",[],f,!0)),this.parent.allowUnscheduledTasks&&a.ganttProperties.startDate&&(a.ganttProperties.endDate||a.ganttProperties.duration)&&(this.parent.setRecordValue("segments",this.setSegmentsInfo(a,!0),f,!0),this.parent.dataOperation.updateMappingData(a,"segments"),n||this.updateWidthLeft(a)),this.parent.chartRowsModule.updateSegment(a.ganttProperties.segments,a.ganttProperties.taskId),a},t.prototype.sortSegmentsData=function(e,t,i){var n=this;return t?e.sort(function(e,t){var i=n.parent.taskFields.startDate;return n.getDateFromFormat(e[i]).getTime()-n.getDateFromFormat(t[i]).getTime()}):e.sort(function(e,t){return e.startDate.getTime()-t.startDate.getTime()}),e},t.prototype.setSegmentsInfo=function(e,t){var i,n=this,a=this.parent.taskFields,r=[],s=0,o=0,l=[this.parent.taskFields.duration,this.parent.taskFields.endDate,this.parent.taskFields.startDate,this.parent.taskFields.id],d=[];if(!oe.isNullOrUndefined(this.parent.taskFields.segments)&&(i=t?e.taskData[this.parent.taskFields.segments]:e.ganttProperties.segments,t||e.taskData[this.parent.taskFields.segments]&&0<e.taskData[this.parent.taskFields.segments].length&&e.taskData[this.parent.taskFields.segments].forEach(function(e){var t,i={};for(t in e)-1!==l.indexOf(t)?(t,e[t]):i[t]=e[t];n.customSegmentProperties.push(i)}),!oe.isNullOrUndefined(i))&&1<i.length){this.sortSegmentsData(i,t,e.ganttProperties);for(var h=0;h<i.length;h++){var p=i[h],u=t?p[a.startDate]:p.startDate,c=t?p[a.endDate]:p.endDate,g=t?p[a.duration]:p.duration,u=this.getDateFromFormat(u);if(u=this.checkStartDate(u,e.ganttProperties,!1),oe.isNullOrUndefined(g)){if((c=this.getDateFromFormat(c))&&(oe.isNullOrUndefined(g)||""===String(g))&&(f=void 0,f=0<this.parent.weekWorkingTime.length?this.parent.getEndTime(c):this.parent.defaultEndTime,0===c.getHours())&&86400!==f&&this.setTime(f,c),c=this.checkEndDate(c,e.ganttProperties,!1),g=this.getDuration(u,c,e.ganttProperties.durationUnit,e.ganttProperties.isAutoSchedule,e.ganttProperties.isMilestone),a.duration){if((o=e.ganttProperties.duration-s-1)<=0)continue;g=h===i.length-1||0<o&&o<g?o:g,c=this.getEndDate(u,g,e.ganttProperties.durationUnit,e.ganttProperties,!1)}else if(!a.duration&&a.endDate&&c&&(c=!oe.isNullOrUndefined(e.ganttProperties.endDate)&&c.getTime()>=e.ganttProperties.endDate.getTime()&&h===i.length-1?e.ganttProperties.endDate:c,g=this.getDuration(u,c,e.ganttProperties.durationUnit,e.ganttProperties.isAutoSchedule,e.ganttProperties.isMilestone),0<r.length)&&c.getTime()<u.getTime()&&c.getTime()<=e.ganttProperties.endDate.getTime()){r[h-1].duration=this.getDuration(r[h-1].startDate,e.ganttProperties.endDate,e.ganttProperties.durationUnit,e.ganttProperties.isAutoSchedule,e.ganttProperties.isMilestone);continue}}else if(c=this.getEndDate(u,g,e.ganttProperties.durationUnit,e.ganttProperties,!1),a.duration){if((o=e.ganttProperties.duration-s)<=0)continue;g=h===i.length-1||0<o&&o<g?o:g,c=this.getEndDate(u,g,e.ganttProperties.durationUnit,e.ganttProperties,!1)}else if(!a.duration&&a.endDate&&c&&(c=!oe.isNullOrUndefined(e.ganttProperties.endDate)&&c.getTime()>=e.ganttProperties.endDate.getTime()&&h===i.length-1?e.ganttProperties.endDate:c,g=this.getDuration(u,c,e.ganttProperties.durationUnit,e.ganttProperties.isAutoSchedule,e.ganttProperties.isMilestone),0<r.length)&&c.getTime()<u.getTime()&&c.getTime()<=e.ganttProperties.endDate.getTime()){r[h-1].duration=this.getDuration(r[h-1].startDate,e.ganttProperties.endDate,e.ganttProperties.durationUnit,e.ganttProperties.isAutoSchedule,e.ganttProperties.isMilestone);continue}if(p={},!u||!c||!u||oe.isNullOrUndefined(g))break;if(s+=Number(g),p.startDate=u,p.endDate=c,p.duration=Number(g),p.width=0,p.left=0,p.segmentIndex=h,r.push(p),oe.isNullOrUndefined(r[h-1]))p.offsetDuration=0;else{u=void 0,u=oe.isNullOrUndefined(this.parent.timelineSettings.bottomTier)?e.ganttProperties.durationUnit:"Minutes"===this.parent.timelineSettings.bottomTier.unit?"minute":"Hour"===this.parent.timelineSettings.bottomTier.unit?"hour":e.ganttProperties.durationUnit,c=this.getDuration(r[h-1].endDate,r[h].startDate,u,e.ganttProperties.isAutoSchedule,e.ganttProperties.isMilestone);if((p.offsetDuration=c)<1){if(0===this.parent.weekWorkingTime.length)p.startDate=this.getEndDate(r[h-1].endDate,1,e.ganttProperties.durationUnit,e.ganttProperties,!1);else{g=new Date(r[h-1].endDate.getTime());if(p.startDate=new Date(g.setHours(g.getHours()+24)),this.isOnHolidayOrWeekEnd(p.startDate,!0))for(;p.startDate.setDate(p.startDate.getDate()+1),this.isOnHolidayOrWeekEnd(p.startDate,!0););this.parent.includeWeekend||(p.startDate=this.getNextWorkingDay(p.startDate));var f=this.parent.getEndTime(r[h-1].endDate);this.getSecondsInDecimal(r[h-1].endDate)===f&&this.setTime(this.parent.getEndTime(p.startDate),p.startDate)}p.startDate=this.checkStartDate(p.startDate,e.ganttProperties,!1),p.endDate=this.getEndDate(p.startDate,p.duration,e.ganttProperties.durationUnit,e.ganttProperties,!1),p.endDate=(!a.duration&&a.endDate&&p.endDate>e.ganttProperties.endDate?e.ganttProperties:p).endDate,p.offsetDuration=1}}u=e[this.parent.taskFields.segments]||i;d.push(this.setSegmentTaskData(p,u[h]))}this.parent.setRecordValue("duration",s,e.ganttProperties,!0),oe.isNullOrUndefined(r[r.length-1])||this.parent.setRecordValue("endDate",r[r.length-1].endDate,e.ganttProperties,!0),oe.isNullOrUndefined(a.endDate)||oe.isNullOrUndefined(r[r.length-1])||this.parent.setRecordValue(this.parent.taskFields.endDate,r[r.length-1].endDate,e,!0),!t&&d&&0<d.length&&d.forEach(function(e,t){e=Object.assign({},e,n.customSegmentProperties[t]);d[t]=e}),this.parent.setRecordValue("taskData."+this.parent.taskFields.segments,d,e)}return 1<r.length?(this.parent.setRecordValue("segments",r,e.ganttProperties,!0),this.parent.setRecordValue(this.parent.taskFields.segments,e.taskData[this.parent.taskFields.segments],e,!0)):r=null,r},t.prototype.setSegmentTaskData=function(e,t){var i=this.parent.taskFields,t=oe.extend({},{},t,!0);return oe.isNullOrUndefined(i.startDate)||(t[this.parent.taskFields.startDate]=e.startDate),oe.isNullOrUndefined(i.endDate)||(t[this.parent.taskFields.endDate]=e.endDate),oe.isNullOrUndefined(i.duration)||(t[this.parent.taskFields.duration]=Number(e.duration)),t},t.prototype.fetchResources=function(e){return this.parent.editModule&&this.parent.editModule.dialogModule&&(this.parent.editModule.dialogModule.isFromAddDialog||this.parent.editModule.dialogModule.isFromEditDialog)?this.parent.editModule.dialogModule.ganttResources:e.ganttProperties.resourceInfo},t.prototype.updateWorkWithDuration=function(e){if(this.parent.triggeredColumnName!==this.parent.taskFields.work||0===e.ganttProperties.duration||!oe.isNullOrUndefined(e.ganttProperties.resourceInfo)&&0===e.ganttProperties.resourceInfo.length){var t,i=this.fetchResources(e),n=0;if(!oe.isNullOrUndefined(i)&&0<i.length&&!e.hasChildRecords){for(var a,r=i.length,s=void 0,o=(0<this.parent.weekWorkingTime.length?this.parent.getSecondsPerDay(e.ganttProperties.startDate||e.ganttProperties.endDate):this.parent.secondsPerDay)/3600,l=this.getDurationInDay(e.ganttProperties.duration,e.ganttProperties.durationUnit),s=0;s<r;s++)n+=(t=0<(a=i[s][this.parent.resourceFields.unit])?o*a/100:0)*l;"minute"===e.ganttProperties.workUnit&&(n*=60),"day"===e.ganttProperties.workUnit&&(n/=o),n%1!=0&&(n=parseFloat(n.toFixed(2)))}else!e.hasChildRecords&&!oe.isNullOrUndefined(e.ganttProperties.work)&&!oe.isNullOrUndefined(e.ganttProperties.duration)&&0<e.ganttProperties.duration&&(n=e.ganttProperties.work);if(e.childRecords&&0<e.childRecords.length&&this.parent.isOnEdit){for(var d=0,h=0;h<e.childRecords.length;h++)d+=e.childRecords[h].ganttProperties.work;n+=d}"FixedUnit"===e.ganttProperties.taskType&&0===t&&(this.parent.setRecordValue("duration",n=0,e.ganttProperties,!0),oe.isNullOrUndefined(this.parent.taskFields.duration)||this.parent.setRecordValue(this.parent.taskFields.duration,0,e,!0)),this.parent.setRecordValue("work",n,e.ganttProperties,!0),oe.isNullOrUndefined(this.parent.taskFields.work)||this.parent.isLoad||this.parent.dataOperation.updateMappingData(e,"work")}},t.prototype.getCloneParent=function(e){var t;return oe.isNullOrUndefined(e)?null:((t={}).uniqueID=e.uniqueID,t.expanded=e.expanded,t.level=e.level,t.index=e.index,t.taskId=e.ganttProperties.rowUniqueID,t)},t.prototype.reUpdateResources=function(){if(0<this.parent.flatData.length)for(var e,t,i,n=0;n<this.parent.flatData.length;n++)e=this.parent.flatData[n].taskData,t=this.parent.flatData[n].ganttProperties,i=this.parent.flatData[n],this.parent.setRecordValue("resourceInfo",this.setResourceInfo(e),t,!0),this.updateResourceName(i)},t.prototype.addTaskData=function(e,t,i){var n,a=this,r=this.parent.taskFields,s=this.parent.dataSource;i&&(r.parentID||s instanceof y.DataManager&&s.dataSource.json&&s.dataSource.offline)&&r.parentID?(i=t[r.id],s=this.taskIds.indexOf(i.toString()),n=-1<s?this.dataArray[s]:{},oe.isNullOrUndefined(this.parent.taskFields.segmentId)||0<(r=this.segmentCollection.filter(function(e){return e.key===n[a.parent.taskFields.id]})).length&&(n[this.parent.taskFields.segments]=r[0].items),this.parent.setRecordValue("taskData",n,e)):this.parent.setRecordValue("taskData",t,e)},t.prototype.updateExpandStateMappingValue=function(e,t){var i,n=this.parent.taskFields.expandState,a=t[n];n&&e.hasChildRecords&&(oe.isNullOrUndefined(a)?oe.isNullOrUndefined(a)&&!this.parent.collapseAllParentTasks?i=!0:oe.isNullOrUndefined(a)&&this.parent.collapseAllParentTasks&&(i=!1):(i="true"===a.toString(),this.parent.loadChildOnDemand&&this.parent.taskFields.hasChildMapping&&!this.parent.enableVirtualization&&t.expanded&&(i=!0)),this.parent.setRecordValue("taskData."+n,i,e),this.parent.setRecordValue(n,i,e),this.parent.setRecordValue("expanded",i,e))},t.prototype.setValidatedDates=function(e,t){var i=e.ganttProperties,n=this.parent.taskFields,a=t[n.duration],r=this.getDateFromFormat(t[n.startDate],!0),t=this.getDateFromFormat(t[n.endDate],!0),a=oe.isNullOrUndefined(a)||""===a?null:a;this.parent.setRecordValue("startDate",new Date(r.getTime()),i,!0),oe.isNullOrUndefined(a)||""===a?this.calculateDuration(e):this.updateDurationValue(a,i),this.parent.setRecordValue("endDate",new Date(t.getTime()),i,!0)},t.prototype.calculateScheduledValues=function(e,t,i){var n,a=this.parent.taskFields,r=e.ganttProperties,s=t[a.duration],s=oe.isNullOrUndefined(s)||""===s?null:s,o=r.startDate&&r.endDate?(n=this.getDateFromFormat(r.startDate,!0),this.getDateFromFormat(r.endDate,!0)):(n=this.getDateFromFormat(t[a.startDate],!0),this.getDateFromFormat(t[a.endDate],!0)),l=a.segments?t[a.segments]||e.taskData[a.segments]:null,d=!!a.milestone&&!!t[a.milestone],h=t[a.durationUnit]||"",h=(this.parent.setRecordValue("durationUnit",this.validateDurationUnitMapping(h),r,!0),oe.isNullOrUndefined(t[a.work])?0:parseFloat(t[a.work])),p=(this.parent.setRecordValue("workUnit",this.validateWorkUnitMapping(this.parent.workUnit),r,!0),t[a.type]||""),p=this.validateTaskTypeMapping(p);if(this.parent.setRecordValue("taskType",p,r,!0),t[this.parent.resourceFields.name]===this.parent.localeObj.getConstant("unassignedTask")&&this.parent.setRecordValue("taskType","FixedDuration",r,!0),i&&!this.parent.enableValidation&&n&&o)this.setValidatedDates(e,t);else if(o||n||!oe.isNullOrUndefined(s)&&""!==s)n?this.calculateDateFromStartDate(n,o,s,e,i):o?this.calculateDateFromEndDate(o,s,e):oe.isNullOrUndefined(s)||""===s||(this.updateDurationValue(s,r),n=this.parent.allowUnscheduledTasks?null:this.getProjectStartDate(r,i),this.parent.setRecordValue("startDate",n,r,!0),this.parent.allowUnscheduledTasks?this.parent.setRecordValue("endDate",null,r,!0):this.calculateEndDate(e));else{if(this.parent.allowUnscheduledTasks)return;this.parent.setRecordValue("duration",1,r,!0),this.parent.setRecordValue("startDate",this.getProjectStartDate(r,i),r,!0),this.calculateEndDate(e)}if((!this.parent.autoCalculateDateScheduling||this.parent.isLoad&&this.parent.treeGrid.loadChildOnDemand&&this.parent.taskFields.hasChildMapping)&&(oe.isNullOrUndefined(e.ganttProperties.startDate)||oe.isNullOrUndefined(this.parent.taskFields.startDate)||(e[this.parent.taskFields.startDate]=e.ganttProperties.startDate,e.taskData[this.parent.taskFields.startDate]=e.ganttProperties.startDate),oe.isNullOrUndefined(e.ganttProperties.endDate)||oe.isNullOrUndefined(this.parent.taskFields.endDate)||(e[this.parent.taskFields.endDate]=e.ganttProperties.endDate,e.taskData[this.parent.taskFields.endDate]=e.ganttProperties.endDate)),oe.isNullOrUndefined(a.work))a.type&&r.taskType&&this.parent.dataOperation.updateMappingData(e,"type");else{o=this.parent.taskFields.durationUnit&&t[a.durationUnit]?t[a.durationUnit]:this.parent.durationUnit;if(this.parent.setRecordValue("durationUnit",o,r,!0),isNaN(h)||oe.isNullOrUndefined(h))this.parent.setRecordValue("work",0,r,!0),this.parent.setRecordValue("duration",0,r,!0),this.parent.setRecordValue("isMilestone",!0,r,!0),oe.isNullOrUndefined(this.parent.taskFields)||oe.isNullOrUndefined(this.parent.taskFields.milestone)||this.parent.setRecordValue(this.parent.taskFields.milestone,!0,e,!0),this.parent.setRecordValue("endDate",r.startDate,r,!0);else{switch(this.parent.setRecordValue("work",h,r,!0),p){case"FixedDuration":(oe.isNullOrUndefined(e[this.parent.taskFields.resourceInfo])||oe.isNullOrUndefined(e.ganttProperties.resourceInfo)||0===e.ganttProperties.resourceInfo.length)&&0!==r.duration||this.updateWorkWithDuration(e);break;case"FixedWork":(oe.isNullOrUndefined(e[this.parent.taskFields.resourceInfo])||oe.isNullOrUndefined(e.ganttProperties.resourceInfo)||0===e.ganttProperties.resourceInfo.length)&&0!==r.work||this.updateDurationWithWork(e);break;case"FixedUnit":e.hasChildRecords||this.updateDurationWithWork(e)}oe.isNullOrUndefined(a.type)||this.parent.dataOperation.updateMappingData(e,"type"),0===r.duration?(this.parent.setRecordValue("isMilestone",!0,r,!0),oe.isNullOrUndefined(this.parent.taskFields)||oe.isNullOrUndefined(this.parent.taskFields.milestone)||this.parent.setRecordValue(this.parent.taskFields.milestone,!0,e,!0),this.parent.setRecordValue("endDate",r.startDate,r,!0)):oe.isNullOrUndefined(r.startDate)||oe.isNullOrUndefined(r.duration)||(this.parent.setRecordValue("isMilestone",!1,r,!0),oe.isNullOrUndefined(this.parent.taskFields)||oe.isNullOrUndefined(this.parent.taskFields.milestone)||this.parent.setRecordValue(this.parent.taskFields.milestone,!1,e,!0),this.calculateEndDate(e))}this.parent.dataOperation.updateMappingData(e,"work")}oe.isNullOrUndefined(l)||this.parent.setRecordValue("segments",this.setSegmentsInfo(e,!0),r,!0),0===r.duration&&(this.parent.setRecordValue("isMilestone",!0,r,!0),oe.isNullOrUndefined(this.parent.taskFields)||oe.isNullOrUndefined(this.parent.taskFields.milestone)||this.parent.setRecordValue(this.parent.taskFields.milestone,!0,e,!0),this.parent.setRecordValue("endDate",r.startDate,r,!0)),!oe.isNullOrUndefined(d)&&d&&(this.parent.setRecordValue("duration",0,r,!0),this.parent.setRecordValue("isMilestone",!0,r,!0),oe.isNullOrUndefined(this.parent.taskFields)||oe.isNullOrUndefined(this.parent.taskFields.milestone)||this.parent.setRecordValue(this.parent.taskFields.milestone,!0,e,!0),this.parent.setRecordValue("endDate",r.startDate,r,!0))},t.prototype.updateDurationWithWork=function(e){var t=e.ganttProperties,i=this.fetchResources(e);if(!oe.isNullOrUndefined(i)&&0<i.length){for(var n,a=oe.isNullOrUndefined(i)?0:i.length,r=0,s=(0<this.parent.weekWorkingTime.length?this.parent.getSecondsPerDay(e.ganttProperties.startDate||e.ganttProperties.endDate):this.parent.secondsPerDay)/3600,o=0,l=void 0,l=0;l<a;l++)r+=0<(n=i[l][this.parent.resourceFields.unit])?s*n/100:"FixedUnit"!==e.ganttProperties.taskType&&"FixedWork"!==t.taskType&&0!==t.duration?s:0;var d=this.getWorkInHour(t.work,t.workUnit);0<a&&0<r&&(o+=d/r),"FixedUnit"===t.taskType&&0===r&&(this.parent.setRecordValue("work",0,t,!0),this.parent.setRecordValue(this.parent.taskFields.work,0,e,!0)),"minute"===t.durationUnit&&(o=o*s*60),"hour"===t.durationUnit&&(o*=s),o%1!=0&&(o=parseFloat(o.toFixed(2))),oe.isNullOrUndefined(t.duration)||this.parent.setRecordValue("duration",o,t,!0),this.parent.dataOperation.updateMappingData(e,"duration"),this.parent.editModule&&this.parent.editModule.dialogModule&&this.parent.editModule.dialogModule.isFromEditDialog&&(this.isDurationValueUpdated=!0)}},t.prototype.updateUnitWithWork=function(e){var t=e.ganttProperties,i=this.fetchResources(e),n=oe.isNullOrUndefined(i)?0:i.length,a=0<this.parent.weekWorkingTime.length?this.parent.getSecondsPerDay(e.ganttProperties.startDate||e.ganttProperties.endDate):this.parent.secondsPerDay,a=a/3600;if(0!==n){var r=this.getDurationInDay(e.ganttProperties.duration,e.ganttProperties.durationUnit),s=this.getWorkInHour(t.work,t.workUnit),s=0<r?s/(r*a)*100:0,o=0==s?0:0<s?s/n:100;o%1!=0&&(o=parseFloat(o.toFixed(2)));for(var l=0;l<n;l++)i[l][this.parent.resourceFields.unit]=o,this.parent.isLoad||oe.isNullOrUndefined(this.parent.editModule)||oe.isNullOrUndefined(this.parent.editModule.dialogModule)||this.parent.editModule.dialogModule.isEdit||oe.isNullOrUndefined(this.parent.editModule.cellEditModule)||this.parent.editModule.cellEditModule.isCellEdit||t.resourceInfo&&(t.resourceInfo[l][this.parent.resourceFields.unit]=o),this.parent.editModule&&this.parent.editModule.dialogModule&&!oe.isNullOrUndefined(this.parent.editModule.dialogModule.ganttResources[l])&&(this.parent.editModule.dialogModule.ganttResources[l][this.parent.resourceFields.unit]=o);this.updateResourceName(e)}},t.prototype.calculateDateFromEndDate=function(e,t,i){var n=i.ganttProperties,a=0<this.parent.weekWorkingTime.length?this.parent.getEndTime(e):this.parent.defaultEndTime,a=(0===e.getHours()&&86400!==a&&this.setTime(a,e),0===parseInt(t,10)||null);this.parent.setRecordValue("endDate",this.checkEndDate(e,i.ganttProperties,a),n,!0),oe.isNullOrUndefined(t)||""===t?this.parent.allowUnscheduledTasks?(this.parent.setRecordValue("startDate",null,n,!0),this.parent.setRecordValue("duration",null,n,!0)):(this.parent.setRecordValue("duration",1,n,!0),this.parent.setRecordValue("startDate",this.getStartDate(n.endDate,n.duration,n.durationUnit,n),n,!0)):oe.isNullOrUndefined(t)||""===t||(this.updateDurationValue(t,n),this.parent.setRecordValue("startDate",this.getStartDate(n.endDate,n.duration,n.durationUnit,n),n,!0))},t.prototype.calculateDateFromStartDate=function(e,t,i,n,a){var r=n.ganttProperties,s=!!(0===parseInt(i,10)||e&&t&&new Date(e.getTime())===new Date(t.getTime()))||null;this.parent.setRecordValue("startDate",this.checkStartDate(e,r,s,a),r,!0),this.parent.isTreeGridRendered&&n&&this.updateTaskData(n),t||!oe.isNullOrUndefined(i)&&""!==i?oe.isNullOrUndefined(i)||t?t&&(oe.isNullOrUndefined(i)||""===i)?(e=void 0,e=0<this.parent.weekWorkingTime.length?this.parent.getEndTime(t):this.parent.defaultEndTime,0===t.getHours()&&86400!==e&&this.setTime(e,t),this.parent.setRecordValue("endDate",this.checkEndDate(t,n.ganttProperties),r,!0),1===this.compareDates(r.startDate,r.endDate)?(this.parent.setRecordValue("endDate",r.startDate,r,!0),this.parent.setRecordValue("isMilestone",!0,r,!0),this.parent.setRecordValue("duration",0,r,!0)):this.calculateDuration(n)):(this.updateDurationValue(i,r),!this.parent.autoCalculateDateScheduling||this.parent.isLoad&&this.parent.treeGrid.loadChildOnDemand&&this.parent.taskFields.hasChildMapping?this.parent.setRecordValue("endDate",t,r,!0):this.calculateEndDate(n)):(this.updateDurationValue(i,r),this.calculateEndDate(n)):this.parent.allowUnscheduledTasks?(this.parent.setRecordValue("endDate",null,r,!0),this.parent.setRecordValue("duration",null,r,!0)):(this.parent.setRecordValue("duration",1,r,!0),this.calculateEndDate(n))},t.prototype.getProgressWidth=function(e,t){return e*t/100},t.prototype.calculateWidth=function(e,t){var i=e.ganttProperties,n=t?i.autoStartDate:i.startDate,a=t?i.autoEndDate:i.endDate;return oe.isNullOrUndefined(n)&&oe.isNullOrUndefined(a)&&(n=this.getValidStartDate(i,t),a=this.getValidEndDate(i,t)),oe.isNullOrUndefined(n)||oe.isNullOrUndefined(a)?3:!i.isMilestone||e.hasChildRecords&&!i.isAutoSchedule?this.getTaskWidth(n,a,i):0},t.prototype.getTaskbarHeight=function(){var e=this.parent.rowHeight,t=this.parent.taskbarHeight;return t<e?t:e},t.prototype.calculateLeft=function(e,t,i){var n=null,a=-300,r=i?e.autoStartDate:e.startDate,s=i?e.autoEndDate:e.endDate,i=i?e.autoDuration:e.duration,o=e.isMilestone;return(r=t&&this.parent.allowUnscheduledTasks&&oe.isNullOrUndefined(r)&&oe.isNullOrUndefined(s)&&!oe.isNullOrUndefined(i)&&!t.hasChildRecords&&t.parentItem&&("Manual"===this.parent.taskMode||"Custom"===this.parent.taskMode&&t[this.parent.taskFields.manual])&&(i=this.parent.getParentTask(t.parentItem)).ganttProperties.startDate?i.ganttProperties.startDate:r)?n=new Date(r.getTime()):s?(n=new Date(s.getTime()),o=!oe.isNullOrUndefined(r)||!this.parent.allowUnscheduledTasks):n=this.getValidStartDate(e),a=oe.isNullOrUndefined(n)?a:this.getTaskLeft(n,o)},t.prototype.calculateAutoLeft=function(e){return this.getTaskLeft(e.autoStartDate,e.isMilestone)},t.prototype.calculateAutoDuration=function(e){return this.getDuration(e.autoStartDate,e.autoEndDate,e.durationUnit,!1,e.isMilestone)},t.prototype.calculateAutoWidth=function(e){return this.getTaskWidth(e.autoStartDate,e.autoEndDate)},t.prototype.calculateBaselineLeft=function(e){var t=this.getDateFromFormat(e.baselineStartDate),i=this.getDateFromFormat(e.baselineEndDate);return t&&i?this.getTaskLeft(t,e.isMilestone):0},t.prototype.calculateBaselineWidth=function(e){var t=this.getDateFromFormat(e.baselineStartDate),e=this.getDateFromFormat(e.baselineEndDate);return t&&e&&t.getTime()!==e.getTime()?(this.isBaseline=!0,this.getTaskWidth(t,e)):0},t.prototype.getTaskWidth=function(e,t,i){var n=new Date(e.getTime()),a=new Date(t.getTime()),r=("None"!==this.parent.timelineModule.customTimelineSettings.bottomTier.unit?this.parent.timelineModule.customTimelineSettings.bottomTier:this.parent.timelineModule.customTimelineSettings.topTier).unit,s=(this.parent.timelineModule.customTimelineSettings,!1),o=new Date(e.getTime()),l=0;if(oe.isNullOrUndefined(i)||"hour"!==i.durationUnit||(o=new Date(o.getTime()+60*i.duration*60*1e3)),(!oe.isNullOrUndefined(i)&&"minute"===i.durationUnit||!oe.isNullOrUndefined(i)&&"day"===i.durationUnit&&i.duration<1)&&(o=new Date(o.getTime()+60*i.duration*1e3)),this.isBaseline&&"Day"===r){var d=this.getDuration(n,a,"day",!0,!1);if(this.isBaseline=!1,0<d&&d<1)return d*this.parent.perDayWidth}if(0<this.parent.weekWorkingTime.length)for(var h=new Date(e.getTime()),p=e.getDate();p<=t.getDate();p++){var u=h.getDay(),c=void 0,g=this.parent.weekWorkingTime;switch(u){case 0:c="Sunday";break;case 1:c="Monday";break;case 2:c="Tuesday";break;case 3:c="Wednesday";break;case 4:c="Thursday";break;case 5:c="Friday";break;case 6:c="Saturday";break;default:c=""}for(var f=!0,m=0;m<g.length;m++)if(g[m][c]&&0<g[m][c].length)for(var f=!1,y=0;y<g[m][c].length;y++)l=l+g[m][c][y].to-g[m][c][y].from;if(f)for(var D=0;D<this.parent.dayWorkingTime.length;D++)l=l+this.parent.dayWorkingTime[D].to-this.parent.dayWorkingTime[D].from;h=new Date(h.setDate(h.getDate()+1)),this.parent.includeWeekend||(h=this.parent.dataOperation.getNextWorkingDay(h))}else for(m=0;m<this.parent.dayWorkingTime.length;m++)l=l+this.parent.dayWorkingTime[m].to-this.parent.dayWorkingTime[m].from;var k,w,b,T,d=o.getTime()-n.getTime();return!oe.isNullOrUndefined(i)&&"minute"===i.durationUnit&&i.duration<60*l||!oe.isNullOrUndefined(i)&&"day"===i.durationUnit&&!oe.isNullOrUndefined(i.duration)&&/^\d+\.\d+$/.test(i.duration.toString())?("Day"===r?(w=0<this.parent.weekWorkingTime.length?(k=this.parent.getStartTime(n),this.parent.getEndTime(a)):(k=this.parent.defaultStartTime,this.parent.defaultEndTime),(Math.floor(d/36e5%24)>=l||0==d)&&(s=!0),this.getSecondsInDecimal(n)===k&&s&&n.setHours(0,0,0,0),this.getSecondsInDecimal(a)===w&&s&&a.setHours(24),this.getSecondsInDecimal(a)===k&&a.setHours(0,0,0,0)):s=!0,n.getTime()===a.getTime()?this.parent.perDayWidth:s?!(this.parent.taskFields.duration&&"day"===i.durationUnit&&/^\d+\.\d+$/.test(i.duration.toString())&&"Day"===this.parent.timelineModule.bottomTier&&oe.isNullOrUndefined(i.segments))||(e=this.parent.holidays&&0<this.parent.holidays.length?this.getHolidaysCount(n,a):0,o=this.parent.includeWeekend?0:this.getWeekendCount(n,a),this.hasDSTTransition(n.getFullYear()))?this.getTimeDifference(n,a,!0)/864e5*this.parent.perDayWidth:this.parent.timelineSettings.showWeekend?(e+o+i.duration)*this.parent.perDayWidth:(e+i.duration)*this.parent.perDayWidth:(d=!1,s=n,o=a,e=i.duration,b=l,s=new Date(s),o=new Date(o),d=!(isNaN(s.getTime())||isNaN(o.getTime())||e<=0||b<=0)&&(s=new Date(s),e=e*b,T=Math.floor(e/b),e=e%b,s.setDate(s.getDate()+T),s.setHours(s.getHours()+e),s.getTime()!==o.getTime())&&1<Math.abs((s.getTime()-o.getTime())/864e5),"day"===i.durationUnit&&i.duration<1&&!d?i.duration*this.parent.perDayWidth:this.hasDSTTransition(n.getFullYear())||-180===n.getTimezoneOffset()?this.getTimeDifference(n,a,!0)/864e5*this.parent.perDayWidth:this.getTimeDifference(n,a)/(36e5*l)*this.parent.perDayWidth)):("Day"===r&&(w=0<this.parent.weekWorkingTime.length?(k=this.parent.getStartTime(n),this.parent.getEndTime(a)):(k=this.parent.defaultStartTime,this.parent.defaultEndTime),this.getSecondsInDecimal(n)===k&&n.setHours(0,0,0,0),this.getSecondsInDecimal(a)===w&&(a.setHours(24),a.setHours(0,0,0,0)),this.getSecondsInDecimal(a)===k)&&a.setHours(0,0,0,0),n.getTime()===a.getTime()?this.parent.perDayWidth:this.hasDSTTransition(n.getFullYear())?(q(a)-q(n))/6e4*(this.parent.perDayWidth/24)/60:(b=this.getTimeDifference(n,a)/864e5,this.parent.timelineSettings.showWeekend?b*this.parent.perDayWidth:(T=new Date(n.getTime()),(b-this.parent.timelineModule.calculateNonWorkingDaysBetweenDates(T,a))*this.parent.perDayWidth)))},t.prototype.getDSTTransitions=function(e,t){function i(e,t){var i=new Date(Date.UTC(e,t+1,0));return new Date(Date.UTC(e,t,i.getUTCDate()-i.getUTCDay()))}function n(e,t){var t=new Intl.DateTimeFormat("en-US",{timeZone:t,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).format(e).match(/\d+/g).map(Number),e=t[0],i=t[1],n=t[2],a=t[3],r=t[4],t=t[5];return new Date(n,e-1,i,a,r,t)}var a=i(e,2),e=i(e,9);return{dstStart:n(a,t),dstEnd:n(e,t)}},t.prototype.hasDSTTransition=function(e){for(var t=0,i=11,n=new Date(e,t,1).getTimezoneOffset();t<=i;){var a=Math.floor((t+i)/2),r=new Date(e,a,1).getTimezoneOffset();if(r!==n)return!0;n<r?i=a-1:t=a+1}return!1},t.prototype.getTaskLeft=function(e,t,i){var n,a,r=!1,s=new Date(e.getTime()),o=("Day"===("None"!==this.parent.timelineModule.customTimelineSettings.bottomTier.unit?this.parent.timelineModule.customTimelineSettings.bottomTier:this.parent.timelineModule.customTimelineSettings.topTier).unit&&(a=o=void 0,a=0<this.parent.weekWorkingTime.length?(o=this.parent.getStartTime(s),this.parent.getEndTime(s)):(o=this.parent.defaultStartTime,this.parent.defaultEndTime),this.getSecondsInDecimal(s)===o?s.setHours(0,0,0,0):t&&this.getSecondsInDecimal(s)===a?(s.setHours(24),r=!0):this.getSecondsInDecimal(s)===a&&this.parent.allowUnscheduledTasks&&(s.setHours(22),r=!0)),this.parent.enableTimelineVirtualization&&(this.parent.isLoad||i)&&!this.parent.timelineModule.performedTimeSpanAction&&(n=this.parent.enableTimelineVirtualization&&0!==this.parent.ganttChartModule.scrollObject.element.scrollLeft?this.parent.ganttChartModule.scrollObject.getTimelineLeft():null),oe.isNullOrUndefined(n)?new Date(this.parent.timelineModule.timelineStartDate):new Date(this.parent.timelineModule.dateByLeftValue(n).toString()));return o?(t=void 0,this.hasDSTTransition(e.getFullYear()),this.hasDSTTransition(s.getFullYear())?this.parent.timelineSettings.showWeekend?(q(s)-q(o))/6e4*(this.parent.perDayWidth/24)/60:this.calculateLeftValue(o,s):(a=void 0,"Day"!==this.parent.timelineModule.bottomTier||this.getSecondsInDecimal(s)===this.parent.defaultStartTime||0===this.getSecondsInDecimal(s)||r||this.parent.isFromEventMarker?t=this.parent.timelineSettings.showWeekend?(s.getTime()-o.getTime())/864e5*this.parent.perDayWidth:this.calculateLeftValue(o,s):(i=new Date(e.getTime()),n=new Date(i.setHours(0,0,0,0)),a=this.getDuration(n,e,"day",!0,!1)*this.parent.perDayWidth,s.setHours(0,0,0,0),t=this.parent.timelineSettings.showWeekend?(s.getTime()-o.getTime())/864e5*this.parent.perDayWidth:this.calculateLeftValue(o,s),this.getSecondsInDecimal(e)!==this.parent.defaultStartTime&&"Day"===this.parent.timelineModule.bottomTier&&(t+=a)),t)):0},t.prototype.calculateLeftValue=function(e,t){var i=new Date(this.parent.timelineModule.timelineStartDate.getTime()),i=this.parent.timelineModule.calculateNonWorkingDaysBetweenDates(i,t),t=this.hasDSTTransition(t.getFullYear())?q(t)-q(e):t.getTime()-e.getTime();return(t-24*i*60*60*1e3)/864e5*this.parent.perDayWidth},t.prototype.getSplitTaskWidth=function(e,t,i){var n,e=new Date(e.getTime()),t=new Date(this.getEndDate(e,t,i.ganttProperties.durationUnit,i.ganttProperties,!1).getTime());return"Day"===("None"!==this.parent.timelineModule.bottomTier?this.parent.timelineModule.bottomTier:this.parent.timelineModule.topTier)&&(n=i=void 0,n=0<this.parent.weekWorkingTime.length?(i=this.parent.getStartTime(e),this.parent.getEndTime(t)):(i=this.parent.defaultStartTime,this.parent.defaultEndTime),this.getSecondsInDecimal(e)===i&&e.setHours(0,0,0,0),this.getSecondsInDecimal(t)===n&&t.setHours(24),this.getSecondsInDecimal(t)===i)&&t.setHours(0,0,0,0),this.parent.timelineSettings.showWeekend?this.getTimeDifference(e,t)/864e5*this.parent.perDayWidth:(n=new Date(e.getTime()),i=this.parent.timelineModule.calculateNonWorkingDaysBetweenDates(n,t),(t.getTime()-e.getTime()-24*i*60*60*1e3)/864e5*this.parent.perDayWidth)},t.prototype.getSplitTaskLeft=function(e,t){var i,n,a,r,e=new Date(e.getTime());return"Day"===("None"!==this.parent.timelineModule.bottomTier?this.parent.timelineModule.bottomTier:this.parent.timelineModule.topTier)&&(i=r=void 0,i=0<this.parent.weekWorkingTime.length?(r=this.parent.getStartTime(e),this.parent.getStartTime(t)):r=this.parent.defaultStartTime,this.getSecondsInDecimal(e)===r&&e.setHours(0,0,0,0),this.getSecondsInDecimal(t)===i)&&t.setHours(0,0,0,0),t?(i=r=0,this.parent.timelineSettings.showWeekend||(n=new Date(t.getTime()),a=new Date(e.getTime()),0<(r=this.parent.timelineModule.calculateNonWorkingDaysBetweenDates(n,a))&&(i=864e5*r)),(e.getTime()-t.getTime()-i)/864e5*this.parent.perDayWidth):0},t.prototype.updateMappingData=function(e,t){var i=this.parent.columnMapping,n=e.ganttProperties;if((!oe.isNullOrUndefined(i[t])||"taskType"===t||"segments"===t)&&"predecessorName"!==t)if("resourceInfo"===t){var a=n.resourceInfo,r=this.parent.resourceFields,s=[],o=[];if(!oe.isNullOrUndefined(a))for(var l=0;l<a.length;l++){s.push(a[l][r.id]);var d=a[l][r.name],h=a[l][r.unit];100!==h&&(d+="["+h+"%]"),d&&o.push(d)}this.parent.setRecordValue("resourceNames",o.join(","),n,!0),this.isResourceString&&e.taskData[this.parent.taskFields.resourceInfo]&&e.taskData[this.parent.taskFields.resourceInfo][0]&&(e.taskData[this.parent.taskFields.resourceInfo]=e.taskData[this.parent.taskFields.resourceInfo][0][r.name]),this.updateTaskDataResource(e),this.parent.setRecordValue(i[t],o.join(","),e)}else"startDate"===t||"endDate"===t?this.setRecordDate(e,n[t],i[t]):"duration"===t?this.setRecordDuration(e,i[t]):"work"===t?(this.parent.setRecordValue("taskData."+i[t],n.work,e),this.parent.setRecordValue(i[t],n[t],e)):"type"===t?(this.parent.setRecordValue("taskData."+i[t],n.taskType,e),this.parent.setRecordValue(i[t],n.taskType,e)):"manual"===t?(this.parent.setRecordValue("taskData."+i[t],!n.isAutoSchedule,e),this.parent.setRecordValue(i[t],!n.isAutoSchedule,e)):"segments"===t?this.parent.setRecordValue("taskData."+this.parent.taskFields.segments,this.segmentTaskData(e),e):(this.parent.setRecordValue("taskData."+i[t],n[t],e),this.parent.setRecordValue(i[t],n[t],e))},t.prototype.segmentTaskData=function(e){var i=this,t=e.ganttProperties.segments,n=this.parent.taskFields;if(oe.isNullOrUndefined(t))return null;for(var a=oe.extend([],[],e.taskData[n.segments],!0),r=0;r<t.length;r++)(this.parent.isEdit||this.parent.editModule&&this.parent.editModule.dialogModule&&oe.getValue("isEdit",this.parent.editModule.dialogModule)||this.parent.contextMenuModule&&oe.getValue("isEdit",this.parent.contextMenuModule))&&(a[r]={}),oe.isNullOrUndefined(n.startDate)||(a[r][this.parent.taskFields.startDate]=t[r].startDate),oe.isNullOrUndefined(n.endDate)||(a[r][this.parent.taskFields.endDate]=t[r].endDate),oe.isNullOrUndefined(n.duration)||(a[r][this.parent.taskFields.duration]=Number(t[r].duration));return 0<this.customSegmentProperties.length&&a&&0<a.length&&a.forEach(function(e,t){e=Object.assign({},e,i.customSegmentProperties[t]);a[t]=e}),a},t.prototype.updateTaskDataResource=function(e){var i=e.ganttProperties.resourceInfo,n=e.taskData[this.parent.taskFields.resourceInfo],a=this.parent.resourceFields;if(oe.isNullOrUndefined(n))e.taskData[this.parent.taskFields.resourceInfo]=i;else if(i&&i.length){for(var t=0;t<i.length;t++){var r=!1;if("string"==typeof n){if(n===i[t][a.name]){n=i[t][a.name],r=!0;break}}else for(var s=0;s<n.length;s++)if("number"==typeof n[s]||"string"==typeof n[s]){if(parseInt(n[s],10)===parseInt(i[t][a.id],10)){n[s]=i[t],r=!0;break}}else if(n[s][a.id]===i[t][a.id]&&"number"!=typeof n[s]){n[s]=oe.extend({},n[s],i[t],!0),r=!0;break}r||("string"==typeof n?n=i[t][a.name]:n.push(i[t]))}var o=[];if(!oe.isNullOrUndefined(n))if("string"!=typeof n){for(var l=0;l<n.length;l++)!function(t){i.filter(function(e){e[a.id]===n[t][a.id]&&-1===o.indexOf(n[t])&&o.push(n[t])})}(l);this.parent.setRecordValue("taskData."+this.parent.taskFields.resourceInfo,o,e)}else this.parent.setRecordValue("taskData."+this.parent.taskFields.resourceInfo,n,e)}else this.parent.setRecordValue("taskData."+this.parent.taskFields.resourceInfo,[],e)},t.prototype.setRecordDate=function(e,t,i){var n="string"==typeof t?new Date(t):t;oe.isNullOrUndefined(t)||(t=new Date(n.getTime())),this.parent.setRecordValue(i,t,e),oe.isNullOrUndefined(t)||(t=new Date(n.getTime())),this.parent.isLoad||this.parent.isDynamicData||this.parent.setRecordValue("taskData."+i,t,e),this.parent.isDynamicData=!1},t.prototype.getDurationInDay=function(e,t){return"day"===t?e:"hour"===t?e/(this.parent.secondsPerDay/3600):e/(this.parent.secondsPerDay/60)},t.prototype.setRecordDuration=function(e,t){var i,n=e.ganttProperties.duration,a=e.ganttProperties.durationUnit;oe.isNullOrUndefined(n)?(this.parent.setRecordValue(t,n,e),this.parent.setRecordValue("taskData."+t,n,e)):(this.parent.setRecordValue(t,e.ganttProperties.duration,e),i=oe.getValue(t,e.taskData),isNaN(i)&&oe.isNullOrUndefined(this.parent.taskFields.durationUnit)&&!oe.isNullOrUndefined(i)?this.parent.setRecordValue("taskData."+t,this.getDurationString(n,a),e):"string"==typeof i?this.parent.setRecordValue("taskData."+t,n.toString(),e):this.parent.setRecordValue("taskData."+t,n,e)),this.parent.taskFields.durationUnit&&(e.taskData[this.parent.taskFields.durationUnit]=e.ganttProperties.durationUnit)},t.prototype.setDataSource=function(e){for(var t,i=[],n=(t=Array.isArray(e)?e:t).length,a=0;a<n;a++){var r=e[a];i.push(r),oe.isNullOrUndefined(e[a][this.parent.taskFields.child])||this.setDataSource(e[a][this.parent.taskFields.child])}return i},t.prototype.setStartDate=function(t){var i=this;(oe.isNullOrUndefined(this.parent.taskFields.parentID)||oe.isNullOrUndefined(this.parent.taskFields.id)?this.parent.dataSource:this.setDataSource(this.parent.dataSource)).map(function(e){t.ganttProperties.taskId===e[i.parent.taskFields.id]&&(oe.isNullOrUndefined(i.parent.taskFields.startDate)||(t[i.parent.taskFields.startDate]=e[i.parent.taskFields.startDate]),oe.isNullOrUndefined(i.parent.taskFields.endDate)||(t[i.parent.taskFields.endDate]=e[i.parent.taskFields.endDate]))})},t.prototype.getWorkInHour=function(e,t){return"day"===t?e*(this.parent.secondsPerDay/3600):"minute"===t?e/60:e},t.prototype.updateTaskData=function(e){var t,i=this.parent.taskFields,n=e.ganttProperties;oe.isNullOrUndefined(e.taskData)||(t=e.taskData,i.id&&(this.parent.setRecordValue("taskData."+i.id,n.taskId,e),this.parent.setRecordValue(i.id,n.taskId,e)),i.name&&(this.parent.isLoad||this.parent.setRecordValue("taskData."+i.name,n.taskName,e),this.parent.setRecordValue(i.name,n.taskName,e)),i.startDate&&this.setRecordDate(e,n.startDate,i.startDate),i.endDate&&this.setRecordDate(e,n.endDate,i.endDate),i.duration&&(oe.isNullOrUndefined(i.milestone)||!oe.isNullOrUndefined(i.milestone)&&!e.taskData[i.milestone])&&this.setRecordDuration(e,i.duration),i.durationUnit&&(t[i.durationUnit]=n.durationUnit),i.progress&&(this.parent.isLoad||this.parent.setRecordValue("taskData."+i.progress,n.progress,e),this.parent.setRecordValue(i.progress,n.progress,e)),i.baselineStartDate&&this.setRecordDate(e,n.baselineStartDate,i.baselineStartDate),i.baselineEndDate&&this.setRecordDate(e,n.baselineEndDate,i.baselineEndDate),i.notes&&(this.parent.isLoad||this.parent.setRecordValue("taskData."+i.notes,n.notes,e),this.parent.setRecordValue(i.notes,n.notes,e)),i.cssClass&&(this.parent.isLoad||this.parent.setRecordValue("taskData."+i.cssClass,n.cssClass,e),this.parent.setRecordValue(i.cssClass,n.cssClass,e)),i.indicators&&(this.parent.isLoad||this.parent.setRecordValue("taskData."+i.indicators,n.indicators,e),this.parent.setRecordValue(i.indicators,n.indicators,e)),i.parentID&&(t="ProjectView"===this.parent.viewType?n.parentId:t[i.parentID],this.parent.setRecordValue("taskData."+i.parentID,t,e),this.parent.setRecordValue(i.parentID,n.parentId,e)),i.work&&(this.parent.isLoad||this.parent.setRecordValue("taskData."+i.work,n.work,e),this.parent.setRecordValue(i.work,n.work,e)),i.type&&(this.parent.setRecordValue("taskData."+i.type,n.taskType,e),this.parent.setRecordValue(i.type,n.taskType,e)))},t.prototype.setResourceInfo=function(e){var t=this;if(oe.isNullOrUndefined(e[this.parent.taskFields.resourceInfo]))return i;var i=(!this.parent.isLoad&&e.taskData&&this.parent.taskFields.resourceInfo in e.taskData?e.taskData:e)[this.parent.taskFields.resourceInfo],n=oe.isNullOrUndefined(this.parent.editModule)||oe.isNullOrUndefined(this.parent.editModule.dialogModule)||!this.parent.editModule.dialogModule.isAddNewResource?this.parent.resources:this.parent.editModule.dialogModule.ganttResources,a=this.parent.resourceFields.id,r=this.parent.resourceFields.unit,s=this.parent.resourceFields.group,o=[];if("string"==typeof i&&""!==i){var l=[],d=e[this.parent.taskFields.resourceInfo].split(",");d&&(n.forEach(function(e){d.includes(e[t.parent.resourceFields.name])&&l.push(e)}),e=oe.extend({},l[0]),o.push(e),oe.isNullOrUndefined(r)||oe.isNullOrUndefined(i[r])||(e[r]=i[r]),oe.isNullOrUndefined(s)||oe.isNullOrUndefined(i[s])||(e[s]=i[s]))}else for(var h=0;h<i.length;h++)!function(t){var e=n.filter(function(e){return"object"==typeof i[t]&&i[t][a]===e[a]||i[t]===e[a]}),e=oe.extend({},e[0]);o.push(e),oe.isNullOrUndefined(r)||oe.isNullOrUndefined(i[t][r])||(e[r]=i[t][r]),oe.isNullOrUndefined(s)||oe.isNullOrUndefined(i[t][s])||(e[s]=i[t][s])}(h);return this.updateResourceUnit(o),o},t.prototype.updateResourceUnit=function(e){var t=this.parent.resourceFields.unit;if(!oe.isNullOrUndefined(t))for(var i=e.length,n=void 0,n=0;n<i;n++)oe.isNullOrUndefined(e[n][t])&&(e[n][t]=100)},t.prototype.updateResourceName=function(e){var t=e.ganttProperties.resourceInfo,i=[],n=this.parent.taskFields;if(t&&0<t.length){var a=t.length;if("string"==typeof e.taskData[this.parent.taskFields.resourceInfo]){var r=s=e.taskData[this.parent.taskFields.resourceInfo];this.parent.setRecordValue("resourceNames",r,e.ganttProperties,!0),this.parent.setRecordValue(this.parent.taskFields.resourceInfo,r,e,!0)}else{var s=oe.extend([],[],e.taskData[this.parent.taskFields.resourceInfo],!0);this.parent.setRecordValue("taskData."+this.parent.taskFields.resourceInfo,[],e);for(var o=0;o<a;o++){var l=t[o],d=l[this.parent.resourceFields.name],h=l[this.parent.resourceFields.unit];100!==h&&(d+="["+h+"%]"),oe.isNullOrUndefined(d)||i.push(d),e.taskData&&(h=n.resourceInfo,s[o]&&(s[parseInt(o.toString(),10)],1)?e.taskData[h].push(s[o]):e.taskData[h].push(l[this.parent.resourceFields.id]))}this.parent.setRecordValue("resourceNames",i.join(","),e.ganttProperties,!0),this.parent.setRecordValue(this.parent.taskFields.resourceInfo,i.join(","),e,!0)}this.updateTaskDataResource(e)}},t.prototype.dataReorder=function(e,t){for(var i=[];0<e.length&&0<t.length;){var n=t.indexOf(e[0]);-1===n?e.shift():(i.push(e.shift()),t.splice(n,1))}return i},t.prototype.validateDurationUnitMapping=function(e){return e="minute"===e||"minutes"===e||"m"===e||"min"===e?"minute":"hour"===e||"hours"===e||"h"===e||"hr"===e?"hour":"day"===e||"days"===e||"d"===e?"day":this.parent.durationUnit.toLocaleLowerCase()},t.prototype.validateTaskTypeMapping=function(e){return e="FixedDuration"===e?"FixedDuration":"FixedUnit"===e?"FixedUnit":"FixedWork"===e?"FixedWork":this.parent.taskType},t.prototype.validateWorkUnitMapping=function(e){return e="minute"===e?"minute":"hour"===e?"hour":"day"===e?"day":this.parent.workUnit.toLocaleLowerCase()},t.prototype.updateDurationValue=function(e,t){e=this.getDurationValue(e);isNaN(oe.getValue("duration",e))||this.parent.setRecordValue("duration",oe.getValue("duration",e),t,!0),oe.isNullOrUndefined(oe.getValue("durationUnit",e))||this.parent.setRecordValue("durationUnit",oe.getValue("durationUnit",e),t,!0)},t.prototype.reUpdateGanttData=function(){if(0<this.parent.flatData.length){var e,t;this.parent.secondsPerDay=this.getSecondsPerDay();for(var i=0;i<this.parent.flatData.length;i++)e=this.parent.flatData[i].taskData,t=this.parent.flatData[i],oe.isNullOrUndefined(this.parent.taskFields.duration)||this.setRecordDuration(t,this.parent.taskFields.duration),this.parent.isLoad&&this.setStartDate(t),this.calculateScheduledValues(t,e,!1);this.updateGanttData()}},t.prototype._isInStartDateRange=function(e,t,i){var n=!1;return n=e.getTime()>=t.getTime()&&e.getTime()<i.getTime()?!0:n},t.prototype._isInEndDateRange=function(e,t,i){var n=!1;return n=e.getTime()>t.getTime()&&e.getTime()<=i.getTime()?!0:n},t.prototype.updateOverlappingValues=function(e){var t,o=this,l=e.childRecords,i=[];if(l.length<=1)e.ganttProperties.workTimelineRanges=[];else{l=this.setSortedChildTasks(e),this.updateOverlappingIndex(l);for(var n=this,a=1;a<l.length;a++)!function(r){var e=((t=l[r]).ganttProperties.segments||[{startDate:t.ganttProperties.startDate,endDate:t.ganttProperties.endDate}]).map(function(e){var t=e.startDate,e=e.endDate;return{startDate:new Date(t),endDate:new Date(e)}}),s=[];e.forEach(function(e){for(var n=new Date(e.startDate.getTime()),a=new Date(e.endDate.getTime()),t=0;t<r;t++){var i=l[t];(i.ganttProperties.segments||[{startDate:i.ganttProperties.startDate,endDate:i.ganttProperties.endDate}]).map(function(e){var t=e.startDate,e=e.endDate;return{startDate:new Date(t),endDate:new Date(e)}}).forEach(function(e){var t=e.startDate,e=e.endDate,i={};n&&a&&e&&(o._isInStartDateRange(n,t,e)||o._isInEndDateRange(a,t,e)||t.getTime()>=n.getTime()&&e.getTime()<=a.getTime())&&(t.getTime()>n.getTime()&&t.getTime()<a.getTime()&&e.getTime()>n.getTime()&&e.getTime()>=a.getTime()||n.getTime()===t.getTime()&&a.getTime()<=e.getTime()?(i.from=t,i.to=a):n.getTime()===t.getTime()&&a.getTime()>e.getTime()?(i.from=t,i.to=e):n.getTime()>t.getTime()&&a.getTime()>=e.getTime()?(i.from=n,i.to=e):n.getTime()>t.getTime()&&a.getTime()<e.getTime()?(i.from=n,i.to=a):t.getTime()>=n.getTime()&&e.getTime()<=a.getTime()&&(i.from=t,i.to=e),i.from)&&i.to&&s.push(i)})}}),i.push.apply(i,n.mergeRangeCollections(s))}(a);this.parent.setRecordValue("workTimelineRanges",this.mergeRangeCollections(i,!0),e.ganttProperties,!0),this.calculateRangeLeftWidth(e.ganttProperties.workTimelineRanges)}},t.prototype.updateOverlappingIndex=function(e){for(var t=0;t<e.length;t++)e[t].ganttProperties.eOverlapIndex=t},t.prototype.calculateRangeLeftWidth=function(e){for(var t=0;t<e.length;t++)e[t].left=this.getTaskLeft(e[t].from,!1),e[t].width=this.getTaskWidth(e[t].from,e[t].to)},t.prototype.mergeRangeCollections=function(e,t){for(var i,n,a,r,s=[],o={},l=new y.DataManager(e).executeLocal((new y.Query).sortBy(this.parent.taskFields.startDate,"Ascending")),d=0;d<l.length;d++)0===s.length&&0===d?s.push(l[d]):(i=(o=s[s.length-1]).from,n=o.to,a=(r=l[d]).from,r=r.to,i.getTime()===a.getTime()&&n.getTime()>=r.getTime()||i.getTime()<a.getTime()&&n.getTime()>=r.getTime()||(i.getTime()<=a.getTime()&&n.getTime()>=a.getTime()&&n.getTime()<r.getTime()||n.getTime()<a.getTime()&&this.checkStartDate(n).getTime()===a.getTime()?o.to=r:n.getTime()<a.getTime()&&this.checkStartDate(n).getTime()!==a.getTime()&&s.push(l[d])));return s=t?this.splitRangeCollection(s):s},t.prototype.setSortedChildTasks=function(e){return new y.DataManager(e.childRecords).executeLocal((new y.Query).sortBy(this.parent.taskFields.startDate,"Ascending"))},t.prototype.splitRangeCollection=function(e,t,i){var n=!this.parent.timelineModule.isSingleTier||"None"!==this.parent.timelineModule.bottomTier?this.parent.timelineModule.bottomTier:this.parent.timelineModule.topTier;return"Week"===n||"Month"===n||"Year"===n?e:"Day"===n||0===this.parent.workingTimeRanges[0].from&&86400===this.parent.workingTimeRanges[0].to?this.getRangeWithWeek(e,t,i):this.getRangeWithDay(e,t,i)},t.prototype.getRangeWithDay=function(e,t,i){for(var n=[],a=0;a<e.length;a++)n.push.apply(n,this.splitRangeForDayMode(e[parseInt(a.toString(),10)],t,i));return n},t.prototype.splitRangeForDayMode=function(e,t,i){var n=t||"from",a=i||"to",r=new Date(e[n]),s=new Date(e[a]),o=[],l={};if(r.getTime()<s.getTime())do{for(var d,h=new Date(r.getTime()),p=new Date(r.getTime()),u=this.parent.dataOperation.getSecondsInDecimal(r),c=-1,g=0;g<this.parent.workingTimeRanges.length;g++){var f=this.parent.workingTimeRanges[g];if(u>=f.from&&u<=f.to){c=g;break}}-1!==c&&(d=Math.round(this.parent.workingTimeRanges[c].to-u),p.setSeconds(p.getSeconds()+d))}while(p.getTime()<s.getTime()?(l={},e.task&&(l.task=oe.extend([],e.task)),l[n]=h,l[a]=p):(l={},e.task&&(l.task=oe.extend([],e.task)),l[n]=h,l[a]=s),l.isSplit=!0,o.push(l),(r=this.checkStartDate(p)).getTime()<s.getTime());else o.push(e);return o},t.prototype.getRangeWithWeek=function(e,t,i){for(var n=[],a=0;a<e.length;a++)n.push.apply(n,this.splitRangeForWeekMode(e[a],t,i));return n},t.prototype.splitRangeForWeekMode=function(e,t,i){var n,a,r,s,o=t||"from",l=i||"to",d=new Date(e[o]),h=new Date(e[o]),p=new Date(e[l]),u=!1,c=[],g={};if(h.setDate(h.getDate()+1),h.getTime()<p.getTime()){do{}while(this.parent.dataOperation.isOnHolidayOrWeekEnd(h,null)?(a=void(n=new Date(h.getTime())).setDate(h.getDate()-1),a=0<this.parent.weekWorkingTime.length?this.parent.getEndTime(n):this.parent.defaultEndTime,this.setTime(a,n),(g={})[o]=d,g.isSplit=!0,g[l]=new Date(n),e.task&&(g.task=oe.extend([],e.task,!0)),a=!this.parent.dataOperation.isOnHolidayOrWeekEnd(d,null),r=!this.parent.dataOperation.isOnHolidayOrWeekEnd(n,null),s=d.getTime()!==n.getTime(),a&&r&&s&&c.push(g),n.setDate(n.getDate()+1),d=this.checkStartDate(n),h=new Date(d.getTime()),u=!0):h.setDate(h.getDate()+1),h.getTime()<p.getTime());u?d.getTime()!==p.getTime()&&(g={},e.task&&(g.task=oe.extend([],e.task,!0)),g[o]=d,g[l]=p,g.isSplit=!0,c.push(g)):c.push(e)}else c.push(e);return c},t.prototype.updateGanttData=function(){this.systemTimeZone=Intl.DateTimeFormat().resolvedOptions().timeZone;var e=this.parent.flatData;if(e.length){for(var t=new Map,i=0,n=e;i<n.length;i++){var a=n[i];t.set(a.uniqueID,a)}for(var r=0,s=e.length;r<s;r++)this.updateTaskLeftWidth(e[r],t)}},t.prototype.shouldProcessUpdateWidth=function(){return!this.parent.autoCalculateDateScheduling||this.parent.isLoad&&this.parent.treeGrid.loadChildOnDemand&&Boolean(this.parent.taskFields.hasChildMapping)},t.prototype.updateTaskLeftWidth=function(e,t){void 0===t&&(t=null);var i=e.ganttProperties,i=(e.hasChildRecords&&!this.shouldProcessUpdateWidth()||this.updateWidthLeft(e),this.parent.setRecordValue("baselineLeft",this.calculateBaselineLeft(i),i,!0),this.parent.setRecordValue("baselineWidth",this.calculateBaselineWidth(i),i,!0),e.parentItem?null!=t?t.get(e.parentItem.uniqueID):this.parent.getParentTask(e.parentItem):null),t=i&&i.childRecords.slice(-1)[0]===e;i&&(t&&!e.hasChildRecords&&this.parent.enableValidation?((!this.parent.autoCalculateDateScheduling||this.parent.isLoad&&this.parent.treeGrid.loadChildOnDemand&&this.parent.taskFields.hasChildMapping)&&"ResourceView"!==this.parent.viewType||this.updateParentItems(i),this.shouldProcessUpdateWidth()&&this.updateWidthLeft(i)):i&&!this.parent.enableValidation&&this.updateWidthLeft(i))},t.prototype.reUpdateGanttDataPosition=function(){for(var e=this.parent.pdfExportModule&&this.parent.pdfExportModule.isPdfExport&&this.parent.pdfExportModule.helper.exportProps&&this.parent.pdfExportModule.helper.exportProps.fitToWidthSettings&&this.parent.pdfExportModule.helper.exportProps.fitToWidthSettings.isFitToWidth?this.parent.pdfExportModule.helper.beforeSinglePageExport.cloneFlatData:this.parent.flatData,t=e.length,i=0;i<t;i++){var n=e[i],a=n.ganttProperties;this.updateWidthLeft(n),"Auto"!==this.parent.taskMode&&n.hasChildRecords&&this.updateAutoWidthLeft(n),this.parent.setRecordValue("baselineLeft",this.calculateBaselineLeft(a),a,!0),this.parent.setRecordValue("baselineWidth",this.calculateBaselineWidth(a),a,!0),this.parent.dataOperation.updateTaskData(n)}},t.prototype.updateWidthLeft=function(e){var t=e.ganttProperties,i=0,n=0;if(!oe.isNullOrUndefined(t.segments)&&0<t.segments.length){for(var a=t.segments,r=0;r<a.length;r++){var s,o=a[r];0!==r||oe.isNullOrUndefined(t.startDate)||oe.isNullOrUndefined(o.startDate)||oe.isNullOrUndefined(o.startDate.getTime())||o.startDate.getTime()===t.startDate.getTime()||(o.startDate=t.startDate,s=this.parent.dataOperation.getEndDate(o.startDate,o.duration,t.durationUnit,t,!1),o.endDate=this.parent.dataOperation.checkEndDate(s,t,!1),this.parent.chartRowsModule.incrementSegments(a,0,e)),o.width=this.getSplitTaskWidth(o.startDate,o.duration,e),i+=o.width,o.showProgress=!1,o.progressWidth=-1,0!==r&&(s=new Date(t.startDate.getTime()),o.left=this.getSplitTaskLeft(o.startDate,s))}for(var l=this.parent.dataOperation.getProgressWidth(i,t.progress),d=!0,r=0;r<a.length;r++)d&&(l<=a[r].width?(a[r].progressWidth=l,d=!(a[r].showProgress=!0)):(a[r].progressWidth=a[r].width,l-=a[r].progressWidth),a[r].showProgress)&&(n=n+a[r].left+a[r].progressWidth);this.parent.setRecordValue("segments",t.segments,t,!0),this.parent.dataOperation.updateMappingData(e,"segments")}this.parent.setRecordValue("width",this.parent.dataOperation.calculateWidth(e),t,!0),this.parent.setRecordValue("left",this.parent.dataOperation.calculateLeft(t,e),t,!0),!oe.isNullOrUndefined(t.segments)&&0<t.segments.length?this.parent.setRecordValue("progressWidth",n,t,!0):this.parent.setRecordValue("progressWidth",this.parent.dataOperation.getProgressWidth(t.isAutoSchedule||!e.hasChildRecords?t.width:t.autoWidth,t.progress),t,!0)},t.prototype.updateAutoWidthLeft=function(e){var t=e.ganttProperties;this.parent.setRecordValue("autoWidth",this.calculateWidth(e,!0),t,!0),this.parent.setRecordValue("autoLeft",this.calculateLeft(t,e,!0),t,!0),this.parent.setRecordValue("progressWidth",this.parent.dataOperation.getProgressWidth(t.isAutoSchedule||!e.hasChildRecords?t.width:t.autoWidth,t.progress),t,!0)},t.prototype.getParentProgress=function(e){var t=0,i={},n=0<this.parent.weekWorkingTime.length?this.parent.getSecondsPerDay(e.ganttProperties.startDate||e.ganttProperties.endDate):this.parent.secondsPerDay;switch(e.ganttProperties.durationUnit){case"hour":t=e.ganttProperties.duration/(n/3600);break;case"minute":t=e.ganttProperties.duration/(n/60);break;default:t=e.ganttProperties.duration}return e.hasChildRecords?(oe.setValue("totalProgress",e.ganttProperties.totalProgress,i),oe.setValue("totalDuration",e.ganttProperties.totalDuration||0,i)):(oe.setValue("totalProgress",e.ganttProperties.progress*t,i),oe.setValue("totalDuration",t,i)),i},t.prototype.resetDependency=function(e){var t,i=this.parent.taskFields.dependency;oe.isNullOrUndefined(i)||(t=e.ganttProperties,this.parent.setRecordValue("predecessor",[],t,!0),this.parent.setRecordValue("predecessorsName",null,t,!0),this.parent.setRecordValue("taskData."+i,null,e),this.parent.setRecordValue(i,null,e))},t.prototype.isUnscheduledTask=function(e,t){for(var i=0,n=null,a=0,r=["startDate","endDate","duration"];a<r.length;a++){var s=r[a];e&&e[s]&&(i++,n=s)}return 1===i||0===i&&!oe.isNullOrUndefined(t)&&t.hasChildRecords?[!0,n]:[!1,null]},t.prototype.isFromManual=function(e){return!!(this.parent.allowUnscheduledTasks&&this.parent.editModule&&this.parent.oldRecords&&0<this.parent.oldRecords.length&&oe.isNullOrUndefined(e.ganttProperties.startDate)&&oe.isNullOrUndefined(e.ganttProperties.endDate)&&!oe.isNullOrUndefined(e.ganttProperties.duration)&&!e.hasChildRecords&&e.parentItem&&("Manual"===this.parent.taskMode||"Custom"===this.parent.taskMode&&e[this.parent.taskFields.manual]))},t.prototype.updateParentItems=function(e,t){var o=this,l=(l=t?e:this.parent.getParentTask(e))||e,d=!1,h=oe.isNullOrUndefined(l)?null:l.ganttProperties,t=this.isUnscheduledTask(h,l),p=t[0];t[1];if(this.parent.autoCalculateDateScheduling&&!(this.parent.isLoad&&this.parent.treeGrid.loadChildOnDemand&&this.parent.taskFields.hasChildMapping)||"ResourceView"===this.parent.viewType){if(l&&l.childRecords&&0<l.childRecords.length){for(var u,i,n,a,e=h.isAutoSchedule?h.startDate:h.autoStartDate,t=h.isAutoSchedule?h.endDate:h.autoEndDate,c=l.childRecords,g=c.length,f=0,m=null,y=null,D=0,k=0,w=0,r=0,s=0,b=(c.some(function(e){var e=o.isUnscheduledTask(e.ganttProperties),t=e[0],e=e[1];return t&&"duration"===e?++s:t||++r,0<r&&0<s}),0<r&&0<s||void 0),T=this,v=0;v<g;v++)!function(t){if(u=T.parent.loadChildOnDemand&&T.parent.taskFields.hasChildMapping?T.parent.currentViewData.filter(function(e){return e.ganttProperties.taskId===c[t][o.parent.taskFields.id]})[0]:c[t],T.parent.isOnDelete&&u.isDelete)return 1===g&&"ProjectView"===T.parent.viewType&&(d=!0);var e=void 0,i=void 0,n=T.isUnscheduledTask(u.ganttProperties),a=n[0],n=n[1],r=void 0,s=(r=T.isFromManual(u)&&(s=T.parent.oldRecords.filter(function(e){return e.ganttProperties.uniqueID===u.ganttProperties.uniqueID})[0])?T.parent.getParentTask(s.parentItem):r)||u,r=r?r.ganttProperties:h,e=a&&"startDate"!==n&&"endDate"!==n&&!p?h.startDate:T.getValidStartDate(s.ganttProperties),n=(!l.hasChildRecords||r.isAutoSchedule||oe.isNullOrUndefined(s.ganttProperties.autoStartDate)||(e=s.ganttProperties.autoStartDate),i=a&&"startDate"!==n&&"endDate"!==n&&!p?T.getEndDate(h.startDate,s.ganttProperties.duration,s.ganttProperties.durationUnit,s.ganttProperties,!1):T.getValidEndDate(s.ganttProperties),!l.hasChildRecords||r.isAutoSchedule||oe.isNullOrUndefined(s.ganttProperties.autoEndDate)||(i=s.ganttProperties.autoEndDate),a&&"startDate"!==n&&"endDate"!==n&&(r=T.getDateFromFormat(i),s=T.getDateFromFormat(e),y<r&&(y=r),s<m)&&(m=s),b&&!a||oe.isNullOrUndefined(b)),s=(oe.isNullOrUndefined(m)&&n&&(m=T.getDateFromFormat(e)),oe.isNullOrUndefined(y)&&n&&(y=T.getDateFromFormat(i)),!oe.isNullOrUndefined(i)&&y&&1===T.compareDates(i,y)&&(y=T.getDateFromFormat(i)),!oe.isNullOrUndefined(e)&&m&&-1===T.compareDates(e,m)&&(m=T.getDateFromFormat(e)),!u.ganttProperties.isMilestone&&H(u.ganttProperties)?(r=T.getParentProgress(u),k+=oe.getValue("totalProgress",r),f+=oe.getValue("totalDuration",r),u[T.parent.taskFields.duration]<1&&(f=Number(f.toFixed(4)))):D++,u.ganttProperties.work);"string"==typeof s?(a=parseFloat(s),isNaN(a)||(w+=a)):"number"==typeof s&&(w+=s)}(v);d||(i=0<(a=this.parent.isOnDelete&&u.isDelete?g-D-1:g-D)&&0<f?Number((k/f).toFixed(2)):0,n=l.ganttProperties,a=!(0!=a||!m||!y||m.getTime()!==y.getTime()),0!==this.compareDates(e,m)&&(this.parent.setRecordValue(h.isAutoSchedule?"startDate":"autoStartDate",m,l.ganttProperties,!0),oe.isNullOrUndefined(h.autoDuration)?0===h.duration:0===h.autoDuration)&&l.isManual&&a&&l.hasChildRecords&&l.ganttProperties.isAutoSchedule&&"TaskbarEditing"!==this.parent.editModule.taskbarEditModule.taskbarEditedArgs.action&&this.parent.setRecordValue("startDate",m,l.ganttProperties,!0),0!==this.compareDates(t,y)&&(this.parent.setRecordValue(h.isAutoSchedule?"endDate":"autoEndDate",y,l.ganttProperties,!0),oe.isNullOrUndefined(h.autoDuration)?0===h.duration:0===h.autoDuration)&&l.isManual&&a&&l.hasChildRecords&&l.ganttProperties.isAutoSchedule&&"TaskbarEditing"!==this.parent.editModule.taskbarEditModule.taskbarEditedArgs.action&&this.parent.setRecordValue("endDate",y,l.ganttProperties,!0),this.parent.setRecordValue("isMilestone",a,n,!0),oe.isNullOrUndefined(this.parent.taskFields.milestone)||(this.updateMappingData(l,"milestone"),this.parent.setRecordValue(this.parent.taskFields.milestone,a,l,!0),this.parent.setRecordValue("taskData."+this.parent.taskFields.milestone,a,l,!0)),n.isAutoSchedule&&(this.isFromManual(u)?(1===l.childRecords.length&&(l.ganttProperties.duration=u.ganttProperties.duration),this.calculateEndDate(l)):this.calculateDuration(l)),this.updateWorkWithDuration(l),e=n.work,e=this.parent.isOnEdit?e:e+w,this.parent.setRecordValue("work",e,n,!0),this.parent.setRecordValue("taskType","FixedDuration",n,!0),oe.isNullOrUndefined(this.parent.taskFields.type)||this.updateMappingData(l,"type"),this.parent.setRecordValue("progress",Math.floor(i),n,!0),this.parent.setRecordValue("totalProgress",k,n,!0),this.parent.setRecordValue("totalDuration",f,n,!0),this.parent.setRecordValue("autoDuration",n.duration,n,!0),n.isAutoSchedule||(this.parent.setRecordValue("autoDuration",this.calculateAutoDuration(n),n,!0),this.updateAutoWidthLeft(l)),this.parent.allowParentDependency||this.resetDependency(l),this.updateWidthLeft(l),this.updateTaskData(l))}}else this.parent.setRecordValue("endDate",l.taskData[this.parent.taskFields.endDate],l.ganttProperties,!0);d&&1===l.childRecords.length&&0===l.ganttProperties.duration&&(this.parent.setRecordValue("isMilestone",!0,l.ganttProperties,!0),this.updateWidthLeft(l),this.updateTaskData(l));t=oe.isNullOrUndefined(l)?null:this.parent.getParentTask(l.parentItem);!t||(!this.parent.autoCalculateDateScheduling||this.parent.isLoad&&this.parent.treeGrid.loadChildOnDemand&&this.parent.taskFields.hasChildMapping)&&"ResourceView"!==this.parent.viewType||this.updateParentItems(t),d=!1};var ee,te,ie=t;function t(e){e=te.call(this,e)||this;return e.customSegmentProperties=[],e.isBaseline=!1,e.isDurationValueUpdated=!1,e.uid=0,e.recordIndex=0,e.taskIds=[],e.hierarchyData=[],e.addEventListener(),e}var ne="e-gantt",ae="e-gantt-single-timeline",re="e-chart-root-container",se="e-chart-rows-container",pe="e-device",ue="e-grid",ce="e-timeline-header-container",ge="e-timeline-header-table-container",fe="e-timeline-header-table-body",me="e-left-label-container",ye="e-left-label-inner-div",De="e-right-label-container",ke="e-right-label-inner-div",S="e-taskbar-main-container",we="e-task-label",be="e-gantt-child-taskbar-inner-div",Te="e-gantt-child-progressbar-inner-div",ve="e-gantt-child-critical-taskbar-inner-div",Pe="e-gantt-child-critical-progressbar-inner-div",Se="e-critical-milestone",Ce="e-baseline-bar",Re="e-baseline-gantt-milestone-container",Me="e-chart-row-cell",xe="e-chart-row",Oe="e-taskbar-left-resizer",Ie="e-taskbar-right-resizer",Ee="e-child-progress-resizer",Ue="e-progressbar-handler",Fe="e-progressbar-handler-element",Ne="e-progressbar-handler-after",Le="e-icon",Ve="e-gantt-milestone",Be="e-gantt-child-taskbar",Ae="e-gantt-child-progressbar",We="e-manualparent-main-container",He="e-gantt-manualparenttaskbar",je="e-gantt-manualparent-milestone",Ge="e-gantt-child-manualtaskbar",ze="e-gantt-manualparenttaskbar-right",qe="e-gantt-parent-taskbar",_e="e-gantt-parent-progressbar",Xe="e-gantt-unscheduled-task",Ze="e-left-resize-gripper",Ye="e-right-resize-gripper",Ke="e-progress-resize-gripper",l="e-label",Qe="e-template-padding",Je="e-gantt-unscheduled-taskbar-left",$e="e-gantt-unscheduled-taskbar-right",et="e-connector-line-container",tt="e-connector-line",it="e-critical-line",nt="e-critical-line-arrow",at="e-connector-line-arrow",rt="e-connector-line-z-index",st="e-connectorpoint-left",ot="e-connectorpoint-right",lt="e-connectorpoint-left-hover",dt="e-connectorpoint-right-hover",ht="e-right-connectorpoint-outer-div",pt="e-connectorpoint-allow-block",ut="e-gantt-tooltip",p=".e-content",ct=".e-gridform",gt="e-edit",ft="e-active-parent-task",mt="e-active-child-task",yt="e-active-connected-task",Dt="e-predecessor-touch-mode",kt="e-rangecontainer",wt="e-rg-rangdiv",bt=(i.prototype.addEventListeners=function(){this.parent.on("grid-scroll",this.gridScrollHandler,this),oe.EventHandler.add(this.element,"scroll",this.onScroll,this),this.parent.treeGrid.grid.on("showGanttShimmer",this.updateShimmer,this),this.parent.treeGrid.grid.on("removeGanttShimmer",this.removeShimmer,this),this.parent.treeGrid.grid.on("virtualTransform",this.transformChange,this)},i.prototype.removeEventListeners=function(){oe.EventHandler.remove(this.element,"scroll",this.onScroll),this.parent.off("grid-scroll",this.gridScrollHandler),this.parent.treeGrid.grid.off("showGanttShimmer",this.updateShimmer),this.parent.treeGrid.grid.off("removeGanttShimmer",this.removeShimmer),this.parent.treeGrid.grid.off("virtualTransform",this.transformChange)},i.prototype.gridScrollHandler=function(e){this.element.scrollTop=oe.getValue("top",e),this.isFromTreeGrid=!0},i.prototype.updateContent=function(){var e=this.parent.element,e=Math.round(this.element.scrollLeft/e.offsetWidth);(this.previousCount!==e||this.parent.timelineModule.performedTimeSpanAction||this.parent.timelineModule.isZoomingAction)&&(this.parent.timelineModule.isZoomingAction=!1,this.deleteTableElements(),this.parent.timelineModule.createTimelineSeries(),"Vertical"!==this.parent.gridLines&&"Both"!==this.parent.gridLines||this.parent.renderChartVerticalLines(),this.parent.dayMarkersModule&&this.parent.dayMarkersModule.eventMarkerRender.renderEventMarkers(),this.parent.timelineModule.performedTimeSpanAction=!1,this.parent.dayMarkersModule&&(this.parent.dayMarkersModule.nonworkingDayRender.renderWeekends(),this.parent.dayMarkersModule.nonworkingDayRender.renderHolidays()),this.updateChartElementStyles(),this.previousCount=e,this.isSetScrollLeft)&&(this.parent.ganttChartModule.chartTimelineContainer.scrollLeft=this.element.scrollLeft)},i.prototype.getTimelineLeft=function(){var e,t=this.parent.element,i=this.parent.timelineModule.wholeTimelineWidth>3*t.offsetWidth?this.parent.timelineModule.wholeTimelineWidth-3*t.offsetWidth:0;return(e=i<=(e=this.element.scrollLeft===(this.parent.enableRtl?-i:i)?this.element.scrollLeft:(e=this.parent.enableRtl?-this.element.scrollLeft:this.element.scrollLeft)>t.offsetWidth?e-t.offsetWidth:0)?i:e)<=t.offsetWidth&&this.isBackwardScrolled&&(e=0),e=this.parent.timelineModule.isZoomToFit||this.parent.timelineModule.isZooming?0:e},i.prototype.deleteTableElements=function(){for(var e=this.parent.element.getElementsByClassName("e-timeline-header-table-container");e[0].remove(),0<e.length;);this.parent.element.querySelector("#ganttContainerline-container")&&(this.parent.element.querySelector("#ganttContainerline-container").innerHTML=""),this.parent.element.querySelector(".e-nonworking-day-container")&&(this.parent.element.querySelector(".e-nonworking-day-container").outerHTML=null)},i.prototype.updateChartElementStyles=function(){var e,t,i=this.getTimelineLeft();this.parent.enableTimelineVirtualization&&(e=this.parent.connectorLineModule.dependencyViewContainer,t=this.parent.chartRowsModule.taskTable,this.parent.enableRtl?(e.style.left=i+"px",t.style.right=-i+"px"):(e.style.left=-i+"px",t.style.left=-i+"px"),t.style.width=this.parent.timelineModule.wholeTimelineWidth+"px")},i.prototype.updateTopPosition=function(){var e,t,i,n=this.parent.treeGrid.element.querySelector(".e-content").scrollTop;n=this.parent.virtualScrollModule&&this.parent.enableVirtualization?n-this.parent.virtualScrollModule.getTopPosition():n,oe.isNullOrUndefined(this.parent.dayMarkersModule)||(e=oe.getValue("nonworkingDayRender.holidayContainer",this.parent.dayMarkersModule),t=oe.getValue("nonworkingDayRender.weekendContainer",this.parent.dayMarkersModule),i=oe.getValue("eventMarkerRender.eventMarkersContainer",this.parent.dayMarkersModule),e&&(e.style.top=oe.formatUnit(n)),t&&(t.style.top=oe.formatUnit(n)),i&&(i.style.top=oe.formatUnit(n))),this.parent.chartVerticalLineContainer&&(this.parent.chartVerticalLineContainer.style.top=oe.formatUnit(n))},i.prototype.removeShimmer=function(){var i=this.parent;setTimeout(function(){if(i.hideMaskRow(),!i.allowTaskbarOverlap&&i.showOverAllocation){for(var e=0;e<i.currentViewData.length;e++){var t=i.chartRowsModule.ganttChartTableBody.childNodes[e];"none"!==t.style.display&&i.currentViewData[e].hasChildRecords&&!i.currentViewData[e].expanded&&(i.ganttChartModule.isExpandAll||i.ganttChartModule.isCollapseAll?i.treeGrid.getRowByIndex(e).style.height=t.style.height:i.treeGrid.getRows()[e].style.height=t.style.height)}i.contentHeight=(i.enableRtl?i.element.getElementsByClassName("e-content")[2]:i.element.getElementsByClassName("e-content")[0]).children[0].offsetHeight,i.element.getElementsByClassName("e-chart-rows-container")[0].style.height=i.contentHeight+"px"}},0)},i.prototype.transformChange=function(){this.parent.ganttChartModule.virtualRender.adjustTable(),this.parent.ganttChartModule.scrollObject.updateTopPosition()},i.prototype.updateShimmer=function(){var e=this.parent;setTimeout(function(){e.showMaskRow()},0)},i.prototype.updateSpinner=function(){var e=this.parent;this.parent.showSpinner(),window.clearTimeout(this.isScrolling),this.isScrolling=setTimeout(function(){e.hideSpinner()},200)},i.prototype.onScroll=function(){var e=this,t={};this.element.scrollTop!==this.previousScroll.top&&(this.isFromTreeGrid?this.isFromTreeGrid=!1:this.parent.notify("chartScroll",{top:this.element.scrollTop}),t.previousScrollTop=this.previousScroll.top,this.previousScroll.top=this.element.scrollTop,t.scrollTop=this.element.scrollTop,t.scrollDirection="Vertical",t.action="VerticalScroll",this.updateTopPosition()),this.element.scrollLeft!==this.previousScroll.left&&(this.isBackwardScrolled=this.element.scrollLeft<this.previousScroll.left&&!this.parent.enableRtl,this.parent.ganttChartModule.chartTimelineContainer.scrollLeft=this.element.scrollLeft,t.previousScrollLeft=this.previousScroll.left,this.previousScroll.left=this.element.scrollLeft,t.scrollLeft=this.element.scrollLeft,t.scrollDirection="Horizontal",t.action="HorizontalScroll",this.parent.enableTimelineVirtualization&&this.parent.timelineModule.wholeTimelineWidth>3*this.parent.element.offsetWidth?(this.isSetScrollLeft=!0,this.parent.timelineModule.totalTimelineWidth>3*this.parent.element.offsetWidth&&this.updateContent(),this.parent.ganttChartModule.updateWidthAndHeight(),this.parent.element.getElementsByClassName("e-weekend-container")[0]&&(this.parent.element.getElementsByClassName("e-weekend-container")[0].style.height="100%"),this.parent.element.getElementsByClassName("e-holiday-container")[0]&&(this.parent.element.getElementsByClassName("e-holiday-container")[0].style.height="100%")):this.parent.enableTimelineVirtualization&&this.parent.timelineModule.wholeTimelineWidth<3*this.parent.element.offsetWidth&&this.parent.connectorLineModule.svgObject.setAttribute("width","100%")),this.parent.timelineModule.performedTimeSpanAction=!1,oe.isNullOrUndefined(t.scrollDirection)||!0!==this.parent.enableVirtualization&&!0!==this.parent.enableTimelineVirtualization||!this.parent.isToolBarClick&&!oe.isNullOrUndefined(this.parent.isToolBarClick)||(this.parent.isVirtualScroll=!0,(this.parent.showIndicator||oe.isNullOrUndefined(this.parent.showIndicator))&&(!this.parent.enableVirtualMaskRow&&this.parent.enableVirtualization&&"Spinner"===this.parent.loadingIndicator.indicatorType?this.updateSpinner():this.parent.enableTimelineVirtualization&&!this.parent.isRowSelected&&1e3<Math.abs(this.element.scrollLeft-t.previousScrollLeft)&&(this.parent.enableVirtualMaskRow||"Spinner"!==this.parent.loadingIndicator.indicatorType?(this.parent.showMaskRow(),setTimeout(function(){e.removeShimmer()},0)):this.updateSpinner()),this.parent.isRowSelected=!1)),this.isSetScrollLeft=!1,this.parent.isToolBarClick=!0,t.requestType="scroll",this.parent.trigger("actionComplete",t)},i.prototype.setHeight=function(e){this.element.style.height=oe.formatUnit(e)},i.prototype.setWidth=function(e){this.element.style.width=oe.formatUnit(e)},i.prototype.setScrollTop=function(e){this.element.scrollTop=e,this.parent.treeGrid.element.querySelector(".e-content").scrollTop=e},i.prototype.setScrollLeft=function(e,t){e=-1===t&&this.parent.enableRtl?-e:e,this.isSetScrollLeft=!0,this.element.scrollLeft=e,this.parent.ganttChartModule.chartTimelineContainer.scrollLeft=this.element.scrollLeft,this.parent.enableTimelineVirtualization||(this.previousScroll.left=this.element.scrollLeft)},i.prototype.destroy=function(){this.removeEventListeners()},i);function i(e){this.previousCount=-1,this.isSetScrollLeft=!1,this.previousScroll={top:0,left:0},this.parent=e,this.element=this.parent.ganttChartModule.scrollElement,this.addEventListeners()}vt.prototype.renderWrapper=function(){this.wrapper=oe.createElement("div",{className:"e-virtualtable",styles:"position: absolute; transform: translate(0px, 0px);"}),this.parent.ganttChartModule.scrollElement.appendChild(this.wrapper),this.virtualTrack=oe.createElement("div",{className:"e-virtualtrack",styles:"position: relative; pointer-events: none; width: 100%;"}),this.parent.ganttChartModule.scrollElement.appendChild(this.virtualTrack),this.wrapper.appendChild(this.parent.ganttChartModule.chartBodyContent)},vt.prototype.appendChildElements=function(e){this.wrapper.appendChild(e)},vt.prototype.adjustTable=function(){var e,t,i,n=this.parent.treeGrid.getContent().querySelector(".e-content").querySelector(".e-virtualtable");this.parent.enableTimelineVirtualization?(i=document.getElementsByClassName("e-virtualtable")[1].style.transform,e=this.parent.treeGrid.element.getElementsByClassName("e-virtualtable")[0].style.transform,t=void 0,t=(""!==i?i:this.parent.ganttChartModule.scrollElement.getElementsByClassName("e-virtualtable")[0].style.transform).match(/translate.*\((.+)\)/)[1].split(", ")[0],i=e.match(/translate.*\((.+)\)/)[1].split(", ")[1],this.parent.ganttChartModule.virtualRender.wrapper.style.transform="translate("+t+", "+i+")"):this.parent.ganttChartModule.virtualRender.wrapper.style.transform=n.style.transform};var Tt=vt;function vt(e){this.parent=e}n.prototype.addEventListener=function(){this.parent.on("renderPanels",this.renderChartContainer,this),this.parent.on("recordsUpdated",this.renderChartElements,this),this.parent.on("dataReady",this.renderInitialContents,this),this.parent.on("tree-grid-created",this.renderChartContents,this),this.parent.on("destroy",this.destroy,this)},n.prototype.renderChartContents=function(){this.parent.notify("refreshDayMarkers",{}),this.wireEvents()},n.prototype.renderChartContainer=function(){this.chartElement=oe.createElement("div",{id:this.parent.element.id+"GanttChart",className:"e-gantt-chart"}),this.parent.chartPane.appendChild(this.chartElement),this.renderTimelineContainer(),this.renderBodyContainers()},n.prototype.renderInitialContents=function(){this.parent.timelineModule.createTimelineSeries()},n.prototype.renderOverAllocationContainer=function(){for(var e=0;e<this.parent.flatData.length;e++){var t=this.parent.flatData[e];0<t.childRecords.length&&this.parent.dataOperation.updateOverlappingValues(t)}var i=this.parent.element.querySelector("."+kt);i&&(i.innerHTML=""),0===this.parent.treeGrid.grid.filterSettings.columns.length&&this.renderRangeContainer(this.parent.currentViewData)},n.prototype.renderChartElements=function(){if(this.parent.isFromOnPropertyChange)this.rangeViewContainer.innerHTML="",this.parent.updateProjectDates(this.parent.cloneProjectStartDate,this.parent.cloneProjectEndDate,this.parent.isTimelineRoundOff),this.parent.isFromOnPropertyChange=!1;else{this.parent.chartRowsModule.renderChartRows(),this.parent.predecessorModule&&this.parent.taskFields.dependency&&(this.parent.connectorLineIds=[],this.parent.updatedConnectorLineCollection=[],this.parent.predecessorModule.createConnectorLinesCollection()),this.parent.connectorLineModule.renderConnectorLines(this.parent.updatedConnectorLineCollection);for(var e,t=0;t<this.parent.chartRowsModule.ganttChartTableBody.children.length;t++)this.parent.chartRowsModule.ganttChartTableBody.children[t].children[0].children[1].children[4]?(this.parent.chartRowsModule.ganttChartTableBody.children[t].children[0].children[1].children[1].setAttribute("tabindex","-1"),this.parent.chartRowsModule.ganttChartTableBody.children[t].children[0].children[1].children[2].setAttribute("tabindex","-1"),this.parent.chartRowsModule.ganttChartTableBody.children[t].children[0].children[1].children[4].setAttribute("tabindex","-1")):"ProjectView"===this.parent.viewType?(e=this.parent.chartRowsModule.ganttChartTableBody.children[parseInt(t.toString(),10)].children[0].children[1].children[1],oe.isNullOrUndefined(e)||this.parent.chartRowsModule.ganttChartTableBody.children[t].children[0].children[1].children[1].setAttribute("tabindex","-1")):this.parent.chartRowsModule.ganttChartTableBody.children[parseInt(t.toString(),10)].children[0].children[1].children[0]&&this.parent.chartRowsModule.ganttChartTableBody.children[t].children[0].children[1].children[0].setAttribute("tabindex","-1");var i=this.parent.criticalPathModule;this.parent.enableCriticalPath&&i&&i.criticalPathCollection&&this.parent.criticalPathModule.criticalConnectorLine(i.criticalPathCollection,i.detailPredecessorCollection,this.parent.enableCriticalPath,i.predecessorCollectionTaskIds),this.parent.showOverAllocation&&this.renderOverAllocationContainer()}this.updateWidthAndHeight(),this.parent.isLoad&&this.parent.notify("selectRowByIndex",{}),this.parent.timelineModule.isZoomToFit&&this.parent.timelineModule.processZoomToFit()},n.prototype.renderRangeContainer=function(e){var t,i,n,a=e.length;if(0===this.parent.treeGrid.grid.filterSettings.columns.length)for(t=0;t<a;t++)(n=(i=e[t]).ganttProperties.workTimelineRanges)&&this.renderRange(n,i)},n.prototype.getTopValue=function(e){var t,i=this.parent.getExpandedRecords(this.parent.currentViewData),n=i.indexOf(e);return e.parentItem&&-1===n&&(t=this.parent.getRecordByID(e.parentItem.taskId),n=i.indexOf(t)),e.expanded?(n+1)*this.parent.rowHeight:n*this.parent.rowHeight},n.prototype.getHierarchyChildRecords=function(e){for(var t=[],i=0,n=e;i<n.length;i++){var a=n[i];a.childRecords&&0<a.childRecords.length&&(t.push(a),this.collectHierarchyChildren(a.childRecords,t))}return t},n.prototype.collectHierarchyChildren=function(e,t){for(var i=0,n=e;i<n.length;i++){var a=n[i];a.childRecords&&0<a.childRecords.length&&(t.push(a),this.collectHierarchyChildren(a.childRecords,t))}},n.prototype.getRangeHeight=function(e){var t,i=Math.floor(this.parent.rowHeight-this.parent.chartRowsModule.taskBarHeight);return!e.expanded&&e.hasChildRecords?this.calculateCollapsedRowHeight(i):(t=this.calculateHierarchyChildLength(e),this.calculateExpandedRowHeight(e.childRecords.length,t,i))},n.prototype.calculateCollapsedRowHeight=function(e){return this.parent.rowHeight-e},n.prototype.calculateHierarchyChildLength=function(e){if(!e.childRecords||0===e.childRecords.length)return 0;for(var t=0,i=0,n=this.getHierarchyChildRecords(e.childRecords);i<n.length;i++){var a=n[i];0!==a.childRecords.length&&a.expanded&&(t+=a.childRecords.length)}return t},n.prototype.calculateExpandedRowHeight=function(e,t,i){return(e+t)*this.parent.rowHeight-i},n.prototype.renderRange=function(e,t){var i=0,n=this.parent.currentViewData.indexOf(t),a=(i=!this.parent.allowTaskbarOverlap&&this.parent.enableMultiTaskbar?(o=t.parentItem?this.parent.getParentTask(t.parentItem):null,t.parentItem&&o&&!o.expanded&&t.hasChildRecords&&!t.expanded?this.parent.getRowByIndex(this.parent.getRootParent(t,0).index).offsetTop:(a=this.parent.getRowByIndex(n).offsetTop,t.expanded?a+this.parent.rowHeight:a)):this.getTopValue(t),this.rangeViewContainer.querySelector(".rangeContainer"+t.ganttProperties.rowUniqueID)),r=(a&&a.remove(),oe.createElement("div",{className:"rangeContainer"+t.ganttProperties.rowUniqueID,styles:"top:"+i+"px; position: absolute;"}));if((0!==t.level||t.expanded||!oe.isNullOrUndefined(t.parentItem)||this.parent.enableMultiTaskbar)&&(!(0<t.level&&t.expanded)||this.parent.getRecordByID(t.parentItem.taskId).expanded)){for(var s=0;s<e.length;s++){var o,l=void 0,d=this.parent.chartRowsModule.ganttChartTableBody.childNodes,d=(l=this.parent.allowTaskbarOverlap||t.expanded||!this.parent.enableMultiTaskbar?this.getRangeHeight(t):(n=(o=this.parent.getRootParent(t,0)).expanded?n:this.parent.currentViewData.indexOf(o),parseInt(d[n].style.height,10)-(this.parent.rowHeight-this.parent.chartRowsModule.taskBarHeight)),oe.createElement("div",{className:wt+" e-leftarc",styles:(this.parent.enableRtl?"right:":"left:")+(this.parent.enableRtl?e[s].left+e[s].width-5:e[s].left)+"px;\n                top: "+Math.floor((this.parent.rowHeight-this.parent.chartRowsModule.taskBarHeight)/2)+"px;\n                height: "+(l+1)+"px; border-right: 0px;\n                z-index: "+("ProjectView"===this.parent.viewType?1<t.childRecords.length?t.childRecords.length+1:t.childRecords.length:6)})),l=oe.createElement("div",{className:wt+" e-rightarc",styles:(this.parent.enableRtl?"right:":"left:")+(this.parent.enableRtl?e[s].left:e[s].left+e[s].width-5)+"px;\n                top: "+Math.floor((this.parent.rowHeight-this.parent.chartRowsModule.taskBarHeight)/2)+"px; height: "+(l+1)+"px;\n                border-left: 0px;\n                z-index: "+("ProjectView"===this.parent.viewType?1<t.childRecords.length?t.childRecords.length+1:t.childRecords.length:6)});r.appendChild(d),r.appendChild(l),this.rangeViewContainer.appendChild(r)}this.parent.ganttChartModule.chartBodyContent.appendChild(this.rangeViewContainer)}},n.prototype.renderTimelineContainer=function(){this.chartTimelineContainer=oe.createElement("div",{className:ce}),this.parent.enableRtl&&(this.chartTimelineContainer.style.borderLeftWidth="1px",this.chartTimelineContainer.style.borderRightWidth="0px"),this.chartTimelineContainer.setAttribute("role","presentation"),this.chartElement.appendChild(this.chartTimelineContainer)},n.prototype.renderBodyContainers=function(){this.chartBodyContainer=oe.createElement("div",{className:re}),this.chartElement.appendChild(this.chartBodyContainer),this.scrollElement=oe.createElement("div",{className:"e-chart-scroll-container e-content",styles:"position:relative;"}),this.chartBodyContainer.appendChild(this.scrollElement),this.chartBodyContent=oe.createElement("div",{className:se,styles:"position:relative; overflow:hidden "}),this.parent.virtualScrollModule&&this.parent.enableVirtualization||this.parent.enableTimelineVirtualization?this.parent.ganttChartModule.virtualRender.renderWrapper():this.scrollElement.appendChild(this.chartBodyContent),this.scrollObject=new bt(this.parent);var e=0;oe.isNullOrUndefined(this.parent.toolbarModule)||oe.isNullOrUndefined(this.parent.toolbarModule.element)||(e=this.parent.toolbarModule.element.offsetHeight),this.scrollObject.setHeight(this.parent.ganttHeight-this.chartTimelineContainer.offsetHeight-e)},n.prototype.updateWidthAndHeight=function(){var e=0===this.parent.contentHeight?1<this.parent.flatData.length?36:0:this.parent.contentHeight,t=this.parent.element.getElementsByClassName("e-chart-scroll-container e-content")[0];e>=t.offsetHeight||"auto"===this.parent.height||t.offsetHeight-e<36?this.chartBodyContent.style.height=oe.formatUnit(e):(e=this.parent.element.getElementsByClassName("e-chart-rows-container")[0].offsetHeight,t.offsetHeight>=e?this.chartBodyContent.style.height=t.offsetHeight-17+"px":this.chartBodyContent.style.height=t.offsetHeight+"px"),this.parent.timelineModule.isZoomToFit&&this.parent.enableTimelineVirtualization?this.chartBodyContent.style.width=this.parent.enableTimelineVirtualization&&this.parent.timelineModule.totalTimelineWidth>3*this.parent.element.offsetWidth?oe.formatUnit(3*this.parent.element.offsetWidth):oe.formatUnit(this.parent.timelineModule.totalTimelineWidth-this.parent.timelineModule.clientWidthDifference):this.chartBodyContent.style.width=this.parent.enableTimelineVirtualization&&this.parent.timelineModule.totalTimelineWidth>3*this.parent.element.offsetWidth?oe.formatUnit(3*this.parent.element.offsetWidth):oe.formatUnit(this.parent.timelineModule.totalTimelineWidth),this.parent.timelineModule.isZoomedToFit&&this.parent.enableVirtualization&&(e=Math.abs(this.parent.timelineModule.totalTimelineWidth-this.parent.element.getElementsByClassName("e-chart-scroll-container e-content")[0].clientWidth),this.parent.ganttChartModule.chartBodyContent.style.width=oe.formatUnit(this.parent.timelineModule.totalTimelineWidth-e)),this.setVirtualHeight(),this.parent.notify("updateHeight",{}),this.parent.updateGridLineContainerHeight(),this.updateLastRowBottomWidth()},n.prototype.setVirtualHeight=function(){var e,t,i,n;this.parent.virtualScrollModule&&this.parent.enableVirtualization&&(oe.getValue("virtualTrack",this.parent.ganttChartModule.virtualRender).style.height=this.parent.treeGrid.element.getElementsByClassName("e-virtualtrack")[0].style.height,e=oe.getValue("wrapper",this.parent.ganttChartModule.virtualRender),t=this.parent.treeGrid.element.getElementsByClassName("e-virtualtable")[0].style.transform,n=document.getElementsByClassName("e-virtualtable")[1].style.transform,this.parent.enableTimelineVirtualization?(i=void 0,"translate(0px)"===t&&navigator.userAgent.includes("Firefox")&&(t="translate(0px, 0px)"),i=(""!==n?n:this.parent.ganttChartModule.scrollElement.getElementsByClassName("e-virtualtable")[0].style.transform).match(/translate.*\((.+)\)/)[1].split(", ")[0],n=t.match(/translate.*\((.+)\)/)[1].split(", ")[1],e.style.transform="translate("+i+", "+n+")"):e.style.transform=t)},n.prototype.updateLastRowBottomWidth=function(){var e,t;0<this.parent.currentViewData.length&&"auto"!==this.parent.height&&(e=(e=this.parent.virtualScrollModule&&this.parent.enableVirtualization?this.parent.currentViewData:this.parent.expandedRecords)[e.length-1],e=this.parent.currentViewData.indexOf(e),e=this.parent.getRowByIndex(e),(t=this.parent.chartRowsModule.ganttChartTableBody).querySelectorAll(".e-chart-row-cell.e-chart-row-border.e-lastrow")&&oe.removeClass(t.querySelectorAll(".e-chart-row-cell.e-chart-row-border.e-lastrow"),"e-lastrow"),this.chartBodyContent.clientHeight<this.chartBodyContainer.clientHeight)&&e&&(oe.addClass(e.querySelectorAll("td"),"e-lastrow"),(t=0===this.parent.contentHeight?1<this.parent.flatData.length?36:0:this.parent.contentHeight)>=(e=this.parent.element.getElementsByClassName("e-chart-scroll-container e-content")[0]).offsetHeight||e.offsetHeight-t<36?this.chartBodyContent.style.height=oe.formatUnit(t):(t=this.parent.element.getElementsByClassName("e-chart-rows-container")[0].offsetHeight,e.offsetHeight>=t?this.chartBodyContent.style.height=e.offsetHeight-17+"px":this.chartBodyContent.style.height=e.offsetHeight+"px"))},n.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off("renderPanels",this.renderChartContainer),this.parent.off("recordsUpdated",this.renderChartElements),this.parent.off("dataReady",this.renderInitialContents),this.parent.off("tree-grid-created",this.renderChartContents),this.parent.off("destroy",this.destroy))},n.prototype.ganttChartMouseDown=function(e){var t,i=!1;"touchstart"===e.type&&e instanceof TouchEvent&&e.touches&&2===e.touches.length&&(this.initPinchDistance=this.calculatePinchDistance(e.touches[0],e.touches[1]),this.isPinching=!0),this.parent.allowTaskbarDragAndDrop&&this.parent.editModule&&this.parent.editSettings.allowTaskbarEditing&&!this.isPinching&&("ChildDrag"!==(t=this.parent.editModule.taskbarEditModule.getTaskBarAction(e))&&"ParentDrag"!==t&&"MilestoneDrag"!==t&&"ManualParentDrag"!==t||(t={cancel:i,data:this.getRecordByTaskBar(e.target),target:e.target,chartRow:oe.closest(e.target,"tr")},this.parent.trigger("rowDragStartHelper",t),i=t.cancel)),i||this.isPinching||(3!==e.which&&this.parent.editSettings.allowTaskbarEditing&&(this.parent.notify("chartMouseDown",e),this.parent.element.tabIndex=0),t=!1,(t=this.parent.editSettings.allowTaskbarEditing&&(this.parent.element.querySelector(".e-left-resize-gripper")||this.parent.element.querySelector(".e-left-connectorpoint-outer-div"))?!0:t)&&2!==e.button)||this.parent.editSettings.allowEditing&&0<this.parent.treeGrid.element.getElementsByClassName("e-editedbatchcell").length&&this.parent.treeGrid.endEdit()},n.prototype.calculatePinchDistance=function(e,t){var i=t.clientX-e.clientX,t=t.clientY-e.clientY;return Math.sqrt(i*i+t*t)},n.prototype.ganttChartMouseClick=function(e){this.parent.autoFocusTasks&&this.scrollToTarget(e),this.parent.notify("chartMouseClick",e)},n.prototype.ganttChartMouseUp=function(e){var t,i;"touchend"===e.type&&(this.initPinchDistance=null,this.isPinching=!1,t=this.parent.ganttChartModule.chartBodyContainer.querySelector(".e-taskbar-resize-div"),oe.isNullOrUndefined(t)||t.remove(),t=this.parent.ganttChartModule.chartBodyContainer.querySelector(".e-clone-taskbar")||this.parent.chartPane.querySelector(".e-clone-taskbar"),oe.isNullOrUndefined(t)||t.parentElement.parentElement.remove(),t=this.parent.ganttChartModule.chartBodyContainer.querySelector(".e-gantt-false-line"),oe.isNullOrUndefined(t)||this.parent.editModule.taskbarEditModule.removeFalseLine(!0)),this.parent.editSettings.allowTaskbarEditing&&this.parent.notify("chartMouseUp",e),this.parent.editSettings.allowEditing||(t=!1,t=!!(this.parent.editSettings.allowTaskbarEditing&&oe.getValue("editModule.taskbarEditModule.isMouseDragged",this.parent)&&oe.getValue("editModule.taskbarEditModule.taskBarEditAction",this.parent))||t)||(t=e.target,i=e.target.classList.contains(S)||oe.closest(e.target,"."+S),!oe.closest(t,".e-gantt-parent-taskbar")||this.parent.editSettings.allowEditing||this.parent.isAdaptive?!i&&this.parent.autoFocusTasks&&this.scrollToTarget(e):this.chartExpandCollapseRequest(e))},n.prototype.scrollToTarget=function(e){var t=oe.closest(e.target,"tr");t&&this.parent.element.contains(t)&&(this.parent.element.querySelectorAll(".e-chart-rows-container")[0].contains(e.target)||this.parent.element.querySelectorAll(".e-gridcontent")[0].contains(e.target))&&0<this.parent.currentViewData.length&&(t=oe.getValue("rowIndex",oe.closest(e.target,"tr")),e=this.parent.currentViewData[t].ganttProperties.startDate,t=this.parent.currentViewData[t].ganttProperties.left,oe.isNullOrUndefined(e)||(e=this.parent.enableTimelineVirtualization?{}:this.parent.dataOperation.getTaskLeft(e,!1),this.parent.autoFocusTasks&&(this.parent.enableTimelineVirtualization?this.updateScrollLeft(t):this.updateScrollLeft(e))))},n.prototype.updateScrollLeft=function(e){e=this.scrollElement.scrollWidth<=(e=0<e?e:0)?this.scrollElement.scrollWidth:e,(this.scrollElement.offsetWidth+this.parent.ganttChartModule.scrollElement.scrollLeft<e||this.scrollElement.scrollLeft>e)&&this.scrollObject.setScrollLeft(e-50,this.parent.enableRtl?-1:0)},n.prototype.mouseUp=function(e){"touchend"===e.type&&(this.initPinchDistance=null,this.isPinching=!1),oe.isNullOrUndefined(this.parent.editModule)||oe.isNullOrUndefined(this.parent.editModule.taskbarEditModule)||this.parent.editModule.taskbarEditModule.removeFalseLine(!1);var t=this.parent.element.querySelector(".e-taskbar-resize-div");oe.isNullOrUndefined(t)||t.remove(),this.parent.allowTaskbarDragAndDrop&&this.parent.editModule&&this.parent.editModule.taskbarEditModule&&(this.parent.editModule.taskbarEditModule.previousLeftValue=0),this.parent.allowRowDragAndDrop&&(t=this.parent.element.querySelector(".e-ganttdrag"))&&t.remove(),this.isGanttElement||this.parent.notify("chartMouseUp",e),this.isGanttElement=!1},n.prototype.documentMouseUp=function(e){var t,i,n;"touchend"===e.type&&(this.initPinchDistance=null,this.isPinching=!1,this.previousPinchDistance=0),this.isGanttElement=!0,(e.target.classList.contains("e-treegridexpand")||e.target.classList.contains("e-treegridcollapse"))&&!0===oe.getValue("isEditCollapse",this.parent.treeGrid)&&oe.setValue("isEditCollapse",!1,this.parent.treeGrid),this.parent.allowRowDragAndDrop&&(t=this.parent.element.querySelector(".e-ganttdrag"))&&t.remove(),this.parent.isDestroyed||3===e.which||(t=this.parent.ganttChartModule.chartBodyContainer.querySelector(".e-taskbar-resize-div"),oe.isNullOrUndefined(t)||t.remove(),t=this.parent.element.getElementsByClassName("e-clone-taskbar")[0],oe.isNullOrUndefined(t)||t.parentElement.parentElement.remove(),t=!1,this.parent.editSettings.allowTaskbarEditing&&oe.getValue("editModule.taskbarEditModule.isMouseDragged",this.parent)&&oe.getValue("editModule.taskbarEditModule.taskBarEditAction",this.parent)&&(t=!0),this.parent.notify("chartMouseUp",e),this.parent.showActiveElement&&(this.parent.showIndicator=!0,oe.isNullOrUndefined(this.parent.loadingIndicator)||"Shimmer"!==this.parent.loadingIndicator.indicatorType?this.parent.hideSpinner():this.parent.hideMaskRow(),this.focusedElement)&&!e.target.classList.contains("e-split-bar")&&(this.focusedElement.tabIndex=0===this.focusedElement.tabIndex?-1:this.focusedElement.tabIndex,oe.removeClass([this.focusedElement],"e-active-container")),t||(i=e.target,n=e.target.classList.contains(S)||oe.closest(e.target,"."+S),oe.closest(i,".e-gantt-parent-taskbar")&&!this.parent.editSettings.allowEditing?this.chartExpandCollapseRequest(e):!n&&this.parent.autoFocusTasks&&this.scrollToTarget(e)),this.parent.editModule&&this.parent.editModule.taskbarEditModule&&this.parent.editModule.taskbarEditModule.removeFalseLine(!0),!oe.isNullOrUndefined(this.parent.onTaskbarClick)&&!t&&(i=e.target,n=oe.closest(i,".e-gantt-parent-taskbar,.e-gantt-child-taskbar,.e-gantt-milestone"))&&this.onTaskbarClick(e,i,n))},n.prototype.onTaskbarClick=function(e,t,i){var n,a=oe.closest(t,"tr"),a=(oe.isNullOrUndefined(a)||(n=oe.getValue("rowIndex",a)),this.getRecordByTarget(e));this.parent.trigger("onTaskbarClick",{data:a,taskbarElement:i,rowIndex:n,target:t})},n.prototype.ganttChartLeave=function(e){this.parent.editSettings.allowTaskbarEditing&&this.parent.notify("chartMouseLeave",e)},n.prototype.ganttChartMove=function(e){var t;if("touchmove"===e.type&&!0===this.isPinching&&e instanceof TouchEvent&&e.touches&&2===e.touches.length&&(t=this.calculatePinchDistance(e.touches[0],e.touches[1]),15<Math.abs(this.previousPinchDistance-t))&&(t>this.previousPinchDistance?this.parent.timelineModule.processZooming(!0):t<this.previousPinchDistance&&this.parent.timelineModule.processZooming(!1),this.previousPinchDistance=t),this.parent.editSettings.allowTaskbarEditing&&!1===this.isPinching){if(0<this.parent.element.getElementsByClassName("e-clone-taskbar").length&&!this.parent.enableRtl)if(("touchmove"===e.type||"touchstart"===e.type||"touchend"===e.type?e.changedTouches[0]:e).pageX<=this.parent.getOffsetRect(this.parent.ganttChartModule.chartElement).left)return;this.parent.notify("chartMouseMove",e),!oe.isNullOrUndefined(this.parent.taskFields.dependency)&&this.parent.connectorLineEditModule&&this.parent.connectorLineEditModule.updateConnectorLineEditElement(e)}},n.prototype.contextClick=function(e){this.parent.allowFiltering&&this.parent.filterModule&&this.parent.filterModule.closeFilterOnContextClick(e.srcElement),this.parent.allowTaskbarDragAndDrop&&(e=this.parent.chartPane.querySelector(".e-clone-taskbar"),oe.isNullOrUndefined(e)||e.parentElement.parentElement.remove())},n.prototype.mouseMoveHandler=function(e){if(!oe.isNullOrUndefined(this.parent.onMouseMove)&&(this.parent.flatData.length||e.target.classList.contains("e-header-cell-label")||e.target.classList.contains("e-headercell"))){var t=e.target,i={originalEvent:e},n=oe.closest(t,".e-chart-row-cell,.e-connector-line-container,.e-event-markers,.e-header-cell-label,.e-rowcell,.e-headercell,.e-indicator-span");if(n){var a,r=void 0,s=oe.closest(t,".e-rowcell,.e-chart-row-cell"),o=oe.closest(t,".e-rowcell,.e-headercell");if(s&&(r=this.parent.ganttChartModule.getRecordByTarget(e),i.data=r),o&&(s=oe.getValue("cellIndex",o),i.column=this.parent.treeGrid.columns[s]),oe.closest(t,".e-indicator-span")){var l=0,d=r.ganttProperties.indicators;if(1<d.length)for(l=0;l<d.length&&d[l].name!==n.innerText.trim();l++);i.indicator=d[l]}oe.closest(t,".e-connector-line-container")&&((a={}).target=n,i.predecessor=this.parent.tooltipModule.getPredecessorTooltipData(a)),oe.closest(t,".e-event-markers")&&((a={}).target=n,i.eventMarkers=this.parent.tooltipModule.getMarkerTooltipData(a)),t.classList.contains("e-header-cell-label")&&(i.date=new Date(t.dataset.content))}this.parent.trigger("onMouseMove",i)}},n.prototype.doubleClickHandler=function(e){var t=e.target,i=oe.closest(t,"tr"),n=oe.getValue("rowIndex",i),a=this.parent.ganttChartModule.getRecordByTarget(e),e=(this.parent.editSettings.allowEditing&&0<this.parent.treeGrid.element.getElementsByClassName("e-editedbatchcell").length&&this.parent.treeGrid.endEdit(),this.parent.notify("chartDblClick",e),{row:i,rowData:a,rowIndex:n,target:t});this.recordDoubleClick(e)},n.prototype.recordDoubleClick=function(e){this.parent.trigger("recordDoubleClick",e)},n.prototype.getRecordByTarget=function(e){var t,i=oe.closest(e.target,"div."+S);return oe.isNullOrUndefined(i)?(i=oe.closest(e.target,"tr"))&&(e=oe.getValue("rowIndex",oe.closest(e.target,"tr")),t=this.parent.currentViewData[e]):(e=i.getAttribute("rowUniqueId"),t=this.parent.getRecordByID(e)),t},n.prototype.getChartRows=function(){return null!==document.getElementById(this.parent.element.id+"GanttTaskTableBody")?document.getElementById(this.parent.element.id+"GanttTaskTableBody").querySelectorAll(".e-chart-row"):null},n.prototype.chartExpandCollapseRequest=function(e){var t,i,n;this.parent.enableMultiTaskbar||(i=e.target,t=oe.closest(i,".e-gantt-parent-taskbar"),e=this.getRecordByTarget(e),i=oe.closest(i,"tr"),n=oe.getValue("rowIndex",i),e={data:e,gridRow:this.parent.treeGrid.getRows()[n],chartRow:i,cancel:!1},this.isExpandCollapseFromChart=!0,t.classList.contains("e-row-expand")?this.collapseGanttRow(e):t.classList.contains("e-row-collapse")&&this.expandGanttRow(e))},n.prototype.reRenderConnectorLines=function(){this.parent.connectorLineModule.dependencyViewContainer.innerHTML="",this.parent.connectorLineIds=[],this.parent.updatedConnectorLineCollection=[],this.parent.predecessorModule.createConnectorLinesCollection(),this.parent.connectorLineModule.renderConnectorLines(this.parent.updatedConnectorLineCollection);var e=this.parent.criticalPathModule;this.parent.enableCriticalPath&&e&&e.criticalPathCollection&&e.criticalConnectorLine(e.criticalPathCollection,e.detailPredecessorCollection,!0,e.predecessorCollectionTaskIds)},n.prototype.collapseGanttRow=function(e){var t=this;this.parent.trigger("collapsing",e,function(e){t.isExpandCollapseFromChart&&!oe.getValue("cancel",e)&&t.collapsedGanttRow(e),t.isExpandCollapseFromChart=!1})},n.prototype.collapsedGanttRow=function(t){var i,e,n=this,a=this.parent.loadChildOnDemand&&this.parent.taskFields.hasChildMapping?this.parent.currentViewData.filter(function(e){return e.ganttProperties[n.parent.taskFields.id]===t.data[n.parent.taskFields.id]})[0]:oe.getValue("data",t);oe.isNullOrUndefined(t.gridRow)&&this.parent.enableVirtualization||oe.isNullOrUndefined(t.chartRow)?a&&(a.expanded=!1):(this.isExpandCollapseFromChart?(this.expandCollapseChartRows("collapse",oe.getValue("chartRow",t),a,null),i=this.parent.taskFields.id,this.parent.loadChildOnDemand&&this.parent.taskFields.hasChildMapping?(e=this.parent.treeGrid.getCurrentViewRecords().filter(function(e){return e[i]===t.data[i]})[0],this.parent.treeGrid.collapseRow(oe.getValue("gridRow",t),e)):this.parent.treeGrid.collapseRow(oe.getValue("gridRow",t),a),this.isExpandCollapseFromChart=!1):this.expandCollapseChartRows("collapse",oe.getValue("chartRow",t),a,null),"ResourceView"!==this.parent.viewType&&"ProjectView"!==this.parent.viewType||this.renderMultiTaskbar(a),this.parent.enableVirtualization||this.parent.updateContentHeight(),this.updateWidthAndHeight(),this.reRenderConnectorLines(),oe.getValue("chartRow",t).setAttribute("aria-expanded","false"))},n.prototype.expandGanttRow=function(e){var t=this;this.parent.trigger("expanding",e,function(e){t.isExpandCollapseFromChart&&!oe.getValue("cancel",e)&&t.expandedGanttRow(e),t.isExpandCollapseFromChart=!1})},n.prototype.expandedGanttRow=function(t){var i,e,n=this,a=this.parent.loadChildOnDemand&&this.parent.taskFields.hasChildMapping?this.parent.currentViewData.filter(function(e){return e.ganttProperties.taskId===t.data[n.parent.taskFields.id]})[0]:oe.getValue("data",t);oe.isNullOrUndefined(t.gridRow)&&this.parent.enableVirtualization||oe.isNullOrUndefined(t.chartRow)?a&&(a.expanded=!0):(this.isExpandCollapseFromChart?(this.expandCollapseChartRows("expand",oe.getValue("chartRow",t),a,null),i=this.parent.taskFields.id,this.parent.loadChildOnDemand&&this.parent.taskFields.hasChildMapping?(e=this.parent.treeGrid.getCurrentViewRecords().filter(function(e){return e[i]===t.data[i]})[0],this.parent.treeGrid.expandRow(oe.getValue("gridRow",t),e)):this.parent.treeGrid.expandRow(oe.getValue("gridRow",t),a),this.isExpandCollapseFromChart=!1):(this.parent.isExpandCollapseLevelMethod||this.expandCollapseChartRows("expand",oe.getValue("chartRow",t),a,null),this.parent.isExpandCollapseLevelMethod=!1),"ResourceView"!==this.parent.viewType&&"ProjectView"!==this.parent.viewType||this.renderMultiTaskbar(a),this.parent.enableVirtualization||this.parent.updateContentHeight(),this.updateWidthAndHeight(),this.reRenderConnectorLines(),oe.getValue("chartRow",t).setAttribute("aria-expanded","true"))},n.prototype.renderMultiTaskbar=function(e){this.parent.enableMultiTaskbar?this.parent.chartRowsModule.refreshRecords([e],!0):this.parent.showOverAllocation&&this.parent.ganttChartModule.renderRangeContainer(this.parent.currentViewData)},n.prototype.expandCollapseChartRows=function(e,t,i,n){var a;if("expand"===e){a="table-row",n||(i.expanded=!0);for(var r=t.querySelectorAll(".e-row-collapse"),s=0;s<r.length;s++)oe.addClass([r[s]],"e-row-expand"),oe.removeClass([r[s]],"e-row-collapse")}else if("collapse"===e){a="none",n||(i.expanded=!1);for(r=t.querySelectorAll(".e-row-expand"),s=0;s<r.length;s++)oe.addClass([r[s]],"e-row-collapse"),oe.removeClass([r[s]],"e-row-expand")}if(!this.parent.enableVirtualization){for(var o=i.childRecords,l=this.getChartRows(),d=[],h=0;h<l.length;h++)l[h].classList.contains("gridrowtaskId"+i.ganttProperties.rowUniqueID+"level"+(i.level+1))&&d.push(l[h]);for(h=0;h<d.length;h++)d[h].style.display=a,o[h].childRecords&&o[h].childRecords.length&&("collapse"===e||o[h].expanded||this.isExpandAll)&&this.expandCollapseChartRows(e,d[h],o[h],!0)}},n.prototype.expandCollapseAll=function(e){"expand"===e?(this.isExpandAll=!0,this.parent.treeGrid.expandAll()):(this.isCollapseAll=!0,this.parent.treeGrid.collapseAll(),this.isCollapseAll&&!this.parent.allowTaskbarOverlap&&(e=(this.parent.enableRtl?this.parent.element.getElementsByClassName("e-content")[2]:this.parent.element.getElementsByClassName("e-content")[0]).children[0].offsetHeight,this.parent.contentHeight=e,document.getElementsByClassName("e-chart-rows-container")[0].style.height=this.parent.contentHeight+"px")),this.isExpandAll=!1,this.isCollapseAll=!1},n.prototype.expandAtLevel=function(e){this.parent.treeGrid.expandAtLevel(e)},n.prototype.collapseAtLevel=function(e){this.parent.enableVirtualization&&(this.parent.isExpandCollapseLevelMethod=!0),this.parent.treeGrid.collapseAtLevel(e)},n.prototype.wireEvents=function(){var t,i=this,e=oe.Browser.isPointer,n=oe.Browser.touchStartEvent,a=oe.Browser.touchEndEvent,r=oe.Browser.touchMoveEvent,e=e?"pointerleave":"mouseleave";oe.EventHandler.add(this.parent.chartPane,n,this.ganttChartMouseDown,this),oe.EventHandler.add(this.parent.chartPane,e,this.ganttChartLeave,this),oe.EventHandler.add(this.parent.chartPane,r,this.ganttChartMove,this),oe.EventHandler.add(this.parent.chartPane,"wheel",this.onWheelZoom,this),this.parent.isAdaptive&&(oe.EventHandler.add(this.parent.chartRowsModule.ganttChartTableBody,"pointerdown",function(e){t?(clearTimeout(t),t=null,i.doubleClickHandler(e)):t=setTimeout(function(){t=null},200)},this),oe.EventHandler.add(this.parent.chartPane,b.click,this.ganttChartMouseClick,this),oe.EventHandler.add(this.parent.chartPane,a,this.ganttChartMouseUp,this)),this.parent.isAdaptive||(oe.EventHandler.add(this.parent.chartRowsModule.ganttChartTableBody,"dblclick",this.doubleClickHandler,this),oe.EventHandler.add(this.parent.element,a,this.documentMouseUp,this),oe.EventHandler.add(document,a,this.mouseUp,this)),oe.EventHandler.add(this.parent.element,"mousemove",this.mouseMoveHandler,this),oe.EventHandler.add(document.body,"contextmenu",this.contextClick,this),oe.EventHandler.add(document,"mouseup",this.contextClick,this)},n.prototype.unWireEvents=function(){var e=oe.Browser.isPointer,t=oe.Browser.touchStartEvent,i=oe.Browser.touchEndEvent,n=oe.Browser.touchMoveEvent,e=e?"pointerleave":"mouseleave";oe.isNullOrUndefined(this.parent.chartRowsModule.ganttChartTableBody)||oe.EventHandler.remove(this.parent.chartRowsModule.ganttChartTableBody,t,this.ganttChartMouseDown),oe.isNullOrUndefined(this.parent.chartPane)||(oe.EventHandler.remove(this.parent.chartPane,e,this.ganttChartLeave),oe.EventHandler.remove(this.parent.chartPane,n,this.ganttChartMove),oe.EventHandler.remove(this.parent.chartPane,"wheel",this.onWheelZoom),oe.EventHandler.remove(this.parent.chartPane,t,this.ganttChartMouseDown)),this.parent.isAdaptive&&!oe.isNullOrUndefined(this.parent.chartPane)&&(oe.EventHandler.remove(this.parent.chartPane,b.click,this.ganttChartMouseClick),oe.EventHandler.remove(this.parent.chartPane,i,this.ganttChartMouseUp)),this.parent.isAdaptive||(oe.isNullOrUndefined(this.parent.element)||oe.EventHandler.remove(this.parent.element,i,this.documentMouseUp),oe.isNullOrUndefined(document))||oe.EventHandler.remove(document,i,this.mouseUp),oe.isNullOrUndefined(this.parent.element)||oe.EventHandler.remove(this.parent.element,"mousemove",this.mouseMoveHandler),oe.isNullOrUndefined(document)||(oe.EventHandler.remove(document,"mouseup",this.contextClick),oe.isNullOrUndefined(document.body))||oe.EventHandler.remove(document.body,"contextmenu",this.contextClick),oe.isNullOrUndefined(this.parent.chartRowsModule.ganttChartTableBody)||oe.EventHandler.remove(this.parent.chartRowsModule.ganttChartTableBody,"dblclick",this.doubleClickHandler)},n.prototype.onWheelZoom=function(t){var i,n;t.ctrlKey&&(t.preventDefault(),i=t.deltaY<0,n=!1,Math.abs(t.deltaY)<75&&(n=!0),this.debounceTimeout&&(this.debounceTimeoutNext+20>this.debounceTimeout&&clearTimeout(this.debounceTimeout),this.debounceTimeoutNext+20<=this.debounceTimeout||!this.debounceTimeoutNext)&&(this.debounceTimeoutNext=this.debounceTimeout),this.debounceTimeout=setTimeout(function(){var e=Math.abs(t.deltaY);(n?.5<e&&e<15:5<e&&e<=200)&&this.parent.timelineModule.processZooming(i)}.bind(this),100))},n.prototype.getRecordByTaskBar=function(e){e=(this.parent.enableVirtualization&&this.parent.enableMultiTaskbar?this.parent.flatData:this.parent.currentViewData)[this.getIndexByTaskBar(e)];return e},n.prototype.updateElement=function(e,t,i,n,a){if(this.parent.ganttColumns[parseInt(e.getAttribute("aria-colindex"),10)-1].field===this.parent.taskFields.progress){for(var r=a.index;a.hasChildRecords&&(e=this.getNextElement(e,i,n)),t=this.parent.ganttColumns[parseInt(e.getAttribute("aria-colindex"),10)-1],r=this.parent.treeGrid.getRows().indexOf(e.parentElement),!t.allowEditing;);this.parent.treeGrid.saveCell(),this.parent.treeGrid.editCell(r,this.parent.ganttColumns[parseInt(e.getAttribute("aria-colindex"),10)-1].field)}return e},n.prototype.onTabAction=function(e){this.parent.treeGrid.grid.enableHeaderFocus=this.parent.enableHeaderFocus;var t=document.getElementsByClassName("e-toolbar-item"),i=this.parent.editModule&&this.parent.editModule.cellEditModule&&this.parent.editModule.cellEditModule.isCellEdit;if(this.parent.showActiveElement||i){var n=i?e.target.closest(".e-rowcell"):e.target,a=((n=0<this.parent.element.querySelectorAll(".e-focused").length?this.parent.element.querySelectorAll(".e-focused")[0]:n)&&!(n.classList.contains("e-toolbar-item")||n.classList.contains("e-input")||n.classList.contains("e-btn"))&&(this.currentToolbarIndex=-1),(n.closest(".e-rowcell")||n.closest(".e-chart-row"))&&this.parent.focusModule.setActiveElement(n),this.focusedRowIndex=n.closest(".e-rowcell")?n.parentElement.rowIndex:n.closest(".e-chart-row")?n.closest(".e-chart-row").rowIndex:-1,"tab"===e.action),r=this.getNextElement(n,a,i);if(r&&("noNextRow"===r||r.classList.contains("e-rowdragheader"))&&("noNextRow"===r&&0<this.parent.treeGrid.element.getElementsByClassName("e-editedbatchcell").length&&this.parent.treeGrid.saveCell(),r=null),r&&n.classList.contains("e-headercell")){var s=parseInt(r.getAttribute("aria-colindex"),10)-1;if("shiftTab"===e.action){for(;-1!==s&&!this.parent.treeGrid.columns[s].visible;)s-=1;if(-1!==s)s=this.parent.allowRowDragAndDrop?s+1:s,r=document.getElementsByClassName("e-columnheader")[0].childNodes[s];else for(var o=document.getElementsByClassName("e-toolbar-item").length-1;0<o;o--)if(!document.getElementsByClassName("e-toolbar-item")[o].classList.contains("e-hidden")){r=document.getElementsByClassName("e-toolbar-item")[o],this.currentToolbarIndex=o;break}}else{for(;!this.parent.treeGrid.columns[s].visible;)s+=1;s=this.parent.allowRowDragAndDrop?s+1:s,r=document.getElementsByClassName("e-columnheader")[0].childNodes[s]}}if(!(r=!r&&n.classList.contains("e-headercell")&&"tab"===e.action?document.getElementsByClassName("e-timeline-header-container")[0]:r)&&(n.classList.contains("e-headercell")||n.classList.contains("e-toolbar-item")||n.classList.contains("e-treegrid")||n.classList.contains("e-input")||n.classList.contains("e-btn"))&&this.parent.toolbarModule&&0<this.parent.toolbar.length){var l=-1!==this.currentToolbarIndex?"tab"===e.action?this.currentToolbarIndex+1:this.currentToolbarIndex-1:"shiftTab"===e.action?t.length-1:1,d=!1;if(-1!==l&&("shiftTab"===e.action||"tab"===e.action&&l<t.length))for(;t[l].classList.contains("e-hidden")?"tab"===e.action?l++:l--:((r=t[l]).setAttribute("tabindex","-1"),r.querySelector(".e-btn")===n&&("tab"===e.action?l++:l--,r=t[l]),r.querySelector(".e-btn")&&r.querySelector(".e-btn").setAttribute("tabindex","0"),d=!0,this.currentToolbarIndex=l),!d;);}if("tab"===e.action&&!r&&this.currentToolbarIndex===t.length-1&&(n.classList.contains("e-toolbar-item")||n.classList.contains("e-input")||n.classList.contains("e-btn")))for(o=0;o<this.parent.treeGrid.columns.length;o++)if(this.parent.treeGrid.columns[o].visible){r=document.getElementsByClassName("e-columnheader")[0].childNodes[o];break}if("shiftTab"!==e.action||r||n.classList.contains("e-headercell")||(r=document.getElementsByClassName("e-timeline-header-container")[0]),"shiftTab"===e.action&&n.classList.contains("e-timeline-header-container"))for(o=this.parent.treeGrid.columns.length;0<o;o--)if(this.parent.treeGrid.columns[o-1].visible){r=document.getElementsByClassName("e-columnheader")[0].childNodes[o-1];break}if(this.tempNextElement=r,oe.isNullOrUndefined(r)||oe.isNullOrUndefined(r.cellIndex)||(this.parent.allowRowDragAndDrop?(this.childrenIndex=r.cellIndex,this.nextElementIndex=r.cellIndex-1):(this.childrenIndex=r.cellIndex,this.nextElementIndex=r.cellIndex),-1===this.nextElementIndex||this.parent.ganttColumns[this.nextElementIndex].allowEditing||this.parent.ganttColumns[this.nextElementIndex].field===this.parent.taskFields.id?this.isEditableElement=!1:this.isEditableElement=!0),"noNextRow"===r)this.manageFocus(n,"remove",!0);else if("string"!=typeof r)if(n.closest(".e-chart-row-cell")&&r.closest(".e-rowcell")&&(this.preventScrollIntoView=!0),(n.classList.contains("e-rowcell")||n.closest(".e-chart-row-cell")||n.classList.contains("e-headercell")||n.closest(".e-segmented-taskbar")||n.classList.contains("e-timeline-header-container"))&&e.preventDefault(),a&&n.classList.contains("e-rowdragdrop"))this.parent.treeGrid.grid.notify("key-pressed",e);else{if(n.classList.contains("e-rowcell")&&r&&r.classList.contains("e-rowcell")||n.classList.contains("e-headercell"))if(a){if(this.parent.editSettings.allowNextRowEdit){var h=this.parent.currentViewData[this.focusedRowIndex],p=this.parent.ganttColumns[parseInt(r.getAttribute("aria-colindex"),10)-1].field;h.hasChildRecords?p===this.parent.taskFields.endDate||p===this.parent.taskFields.duration||p===this.parent.taskFields.dependency||p===this.parent.taskFields.progress||p===this.parent.taskFields.work||p===this.parent.taskFields.type||"taskType"===p?(this.parent.treeGrid.grid.endEdit(),this.parent.treeGrid.grid.notify("key-pressed",e)):p===this.parent.taskFields.name||p===this.parent.taskFields.startDate?this.parent.treeGrid.grid.notify("key-pressed",e):(this.parent.treeGrid.grid.notify("key-pressed",e),i&&this.parent.treeGrid.editCell(this.focusedRowIndex,p)):this.parent.treeGrid.grid.notify("key-pressed",e)}else if(!r||!r.classList.contains("e-headercell")&&!r.classList.contains("e-timeline-header-container")){n.classList.contains("e-headercell")&&this.manageFocus(n,"remove",!1);var u=r;if(!(g=this.parent.currentViewData[n.parentElement.rowIndex]).hasChildRecords||this.parent.ganttColumns[parseInt(u.getAttribute("aria-colindex"),10)-1].field!==this.parent.taskFields.progress&&this.parent.ganttColumns[parseInt(u.getAttribute("aria-colindex"),10)-1].allowEditing||this.parent.ganttColumns[parseInt(u.getAttribute("aria-colindex"),10)-1].field===this.parent.taskFields.id||!n.classList.contains("e-editedbatchcell"))r&&!n.classList.contains("e-editedbatchcell")||this.parent.treeGrid.grid.notify("key-pressed",e);else{var c=void 0;for(u=this.updateElement(u,c,a,i,g);!this.parent.ganttColumns[parseInt(u.getAttribute("aria-colindex"),10)-1].allowEditing;)u=this.getNextElement(u,a,i);u=this.updateElement(u,c,a,i,g)}}}else if(r&&!r.classList.contains("e-headercell")&&r.classList.contains("e-rowcell")&&!r.classList.contains("e-toolbar-item")){var g,u=r;if(!(g=this.parent.currentViewData[n.parentElement.rowIndex]).hasChildRecords||this.parent.ganttColumns[parseInt(u.getAttribute("aria-colindex"),10)-1].field!==this.parent.taskFields.progress&&this.parent.ganttColumns[parseInt(u.getAttribute("aria-colindex"),10)-1].allowEditing||this.parent.ganttColumns[parseInt(u.getAttribute("aria-colindex"),10)-1].field===this.parent.taskFields.id||!n.classList.contains("e-editedbatchcell"))if(parseInt(u.parentElement.getAttribute("aria-rowindex"),10)-1!=0&&parseInt(u.getAttribute("aria-colindex"),10)-1==0&&this.parent.ganttColumns[parseInt(u.getAttribute("aria-colindex"),10)-1].field===this.parent.taskFields.id&&n.classList.contains("e-editedbatchcell")){var p=n.parentElement.rowIndex,p=this.getNextRowElement(p,a,!0);if(u=this.getChildElement(p,a),!(h=this.parent.flatData[parseInt(p.getAttribute("aria-rowindex"),10)-1]).hasChildRecords||this.parent.ganttColumns[parseInt(u.getAttribute("aria-colindex"),10)-1].allowEditing&&this.parent.ganttColumns[parseInt(u.getAttribute("aria-colindex"),10)-1].field!==this.parent.taskFields.progress)this.parent.treeGrid.grid.notify("key-pressed",e);else{c=void 0;for(u=this.updateElement(u,c,a,i,h);!this.parent.ganttColumns[parseInt(u.getAttribute("aria-colindex"),10)-1].allowEditing;)u=this.getNextElement(u,a,i);u=this.updateElement(u,c,a,i,h)}}else this.parent.treeGrid.grid.notify("key-pressed",e);else{var c=void 0;for(u=this.updateElement(u,c,a,i,g);!this.parent.ganttColumns[parseInt(u.getAttribute("aria-colindex"),10)-1].allowEditing;)u=this.getNextElement(u,a,i);u=this.updateElement(u,c,a,i,g)}}0<this.parent.element.querySelectorAll(".e-focused").length&&this.manageFocus(this.parent.element.querySelectorAll(".e-focused")[0],"remove",!1),this.parent.editModule&&this.parent.editModule.cellEditModule&&!oe.isNullOrUndefined(this.parent.editModule.cellEditModule.editedColumn)||r&&(n.classList.contains("e-rowcell")?this.manageFocus(n,"remove",!1):this.manageFocus(n,"remove",!0),r.classList.contains("e-rowcell")&&n.nextElementSibling&&!n.classList.contains("e-timeline-header-container")||n.classList.contains("e-right-label-container")?(n.classList.contains("e-rowcell")||(this.parent.treeGrid.grid.notify("key-pressed",e),(p=oe.getValue("focusModule",this.parent.treeGrid.grid)).currentInfo.element=r,p.currentInfo.elementToFocus=r,p.content.matrix.current=[r.parentElement.rowIndex,r.cellIndex]),this.manageFocus(r,"add",!1)):r&&(r.classList.contains("e-toolbar-item")||r.classList.contains("e-headercell")||r.classList.contains("e-rowcell"))?(this.manageFocus(n,"remove",!1),r.classList.contains("e-toolbar-item")||this.manageFocus(r,"add",!1),n.classList.contains("e-treegrid")&&e.preventDefault()):this.manageFocus(r,"add",!0),this.parent.focusModule.setActiveElement(r))}}},n.prototype.getNextElement=function(e,t,i){if(e.classList.contains("e-timeline-header-container")&&t)return r=this.getNextRowElement(-1,t,!0),this.getChildElement(r,t);var n=t?e.nextElementSibling:e.previousElementSibling;if(e.parentElement.classList.contains("e-taskbar-main-container")){if(this.parent.labelSettings.rightLabel&&t)return e.parentElement.nextElementSibling;if(!t&&this.parent.labelSettings.leftLabel)return e.parentElement.previousElementSibling}for(;n&&n.parentElement.classList.contains("e-row");){if(!n.matches(".e-hide")&&!n.matches(".e-rowdragdrop"))return n;n=t?n.nextElementSibling:n.previousElementSibling}if(oe.isNullOrUndefined(n)||!n.classList.contains("e-taskbar-main-container")&&!n.classList.contains("e-right-connectorpoint-outer-div")||(a=this.parent.currentViewData[this.focusedRowIndex],!oe.isNullOrUndefined(a.ganttProperties.segments)&&0<a.ganttProperties.segments.length&&(n=n.classList.contains("e-right-connectorpoint-outer-div")?n.parentElement.nextElementSibling:n.getElementsByClassName("e-gantt-child-taskbar-inner-div")[0])),this.validateNextElement(n))return n;var a=-1,r=null;if(e.classList.contains("e-rowcell")&&i&&this.parent.editSettings.allowNextRowEdit)return a=e.parentElement.rowIndex,r=this.getNextRowElement(a,t,!0),this.getChildElement(r,t);if(e.classList.contains("e-rowcell"))if(a=e.parentElement.rowIndex,t){if(r=this.parent.getRowByIndex(a),0<this.parent.treeGrid.element.getElementsByClassName("e-editedbatchcell").length)return r=this.getNextRowElement(a,t,!0),this.getChildElement(r,t);if(this.validateNextElement(r,"e-left-label-container"))return r.getElementsByClassName("e-left-label-container")[0];if(this.validateNextElement(r,"e-taskbar-main-container"))return r.getElementsByClassName("e-taskbar-main-container")[0];if(this.validateNextElement(r,"e-right-label-container"))return r.getElementsByClassName("e-right-label-container")[0]}else{if(r=this.getNextRowElement(a,t,!1),this.validateNextElement(r,"e-right-label-container"))return r.getElementsByClassName("e-right-label-container")[0];if(this.validateNextElement(r,"e-taskbar-main-container"))return r.getElementsByClassName("e-taskbar-main-container")[0];if(this.validateNextElement(r,"e-left-label-container"))return r.getElementsByClassName("e-left-label-container")[0]}else if(e.parentElement.classList.contains("e-chart-row-cell")||e.parentElement.parentElement.classList.contains("e-chart-row-cell"))return a=oe.closest(e,".e-chart-row").rowIndex,r=t?(!t&&this.parent.virtualScrollModule&&this.parent.enableVirtualization&&(i=this.parent.currentViewData[a],a=this.parent.flatData.indexOf(i)),this.getNextRowElement(a,t,!0)):this.parent.treeGrid.getRows()[a],this.getChildElement(r,t);return n=e,null},n.prototype.getNextRowElement=function(e,t,i){var n=this.parent.getExpandedRecords(this.parent.currentViewData),e=this.parent.currentViewData[e],e=n.indexOf(e),t=t?n[e+1]:n[e-1],n=this.parent.currentViewData.indexOf(t);return t?i?this.parent.treeGrid.getRows()[n]:this.parent.getRowByIndex(n):null},n.prototype.validateNextElement=function(e,t){return!((!e||!e.classList.contains("e-rowcell"))&&(e&&t?!(t=e.getElementsByClassName(t)[0])||!t.hasChildNodes():!e||oe.isNullOrUndefined(e)||!e.hasChildNodes()))},n.prototype.getChildElement=function(e,t){var i;if(!e)return"noNextRow";for(i=t?e.children[0]:e.children[e.children.length-1];i;){if(!i.matches(".e-hide")&&!i.matches(".e-rowdragdrop"))return i;i=t?i.nextElementSibling:i.previousElementSibling}return i},n.prototype.manageFocus=function(e,t,i,n){var a;i?(i=null,e.classList.contains("e-left-label-container")||e.classList.contains("e-right-label-container")?i=e.getElementsByTagName("span")[0]:(e.classList.contains("e-taskbar-main-container")||e.classList.contains("e-gantt-child-taskbar-inner-div"))&&(a=oe.closest(e,".e-chart-row").rowIndex,a=(a=this.parent.currentViewData[a]).hasChildRecords?a.ganttProperties.isAutoSchedule?"e-gantt-parent-taskbar":"e-manualparent-main-container":a.ganttProperties.isMilestone?"e-gantt-milestone":!oe.isNullOrUndefined(a.ganttProperties.segments)&&0<a.ganttProperties.segments.length?"e-segmented-taskbar":"e-gantt-child-taskbar",i=e.getElementsByClassName(a)[0],oe.isNullOrUndefined(i))&&(i=e),(e.classList.contains("e-right-label-temp-container")||e.classList.contains("e-left-label-temp-container")||e.classList.contains("e-indicator-span")||e.classList.contains("e-timeline-header-container"))&&("add"===t?(e.setAttribute("tabIndex","0"),oe.addClass([e],"e-active-container"),e.focus()):"downArrow"!==n&&"upArrow"!==n&&(oe.removeClass([e],"e-active-container"),e.setAttribute("tabIndex","-1"),e.blur())),"add"!==t||oe.isNullOrUndefined(i)?oe.isNullOrUndefined(i)||"downArrow"===n||"upArrow"===n||(oe.removeClass([i],"e-active-container"),e.setAttribute("tabIndex","-1"),e.blur()):(e.setAttribute("tabIndex","0"),oe.addClass([i],"e-active-container"),e.focus(),this.focusedElement=i)):"add"===t?(e.setAttribute("tabIndex","0"),oe.addClass([e],["e-focused","e-focus"]),this.preventScrollIntoView||e.scrollIntoView({block:"nearest",inline:"nearest"}),this.preventScrollIntoView=!1,e.focus()):(e.setAttribute("tabIndex","-1"),oe.removeClass([e],["e-focused","e-focus"]),e.blur())},n.prototype.getIndexByTaskBar=function(e){var t=e.classList.contains(S)?e:oe.closest(e,"div."+S);return oe.isNullOrUndefined(t)?(t=oe.closest(e,"tr."+xe),[].slice.call(this.parent.chartRowsModule.ganttChartTableBody.childNodes).indexOf(t)):(e=t.getAttribute("rowUniqueId"),t=this.parent.getRecordByID(e),this.parent.enableVirtualization&&this.parent.enableMultiTaskbar?this.parent.flatData.indexOf(t):this.parent.pdfExportModule&&this.parent.pdfExportModule.helper.exportProps&&this.parent.pdfExportModule.helper.exportProps.fitToWidthSettings&&this.parent.pdfExportModule.helper.exportProps.fitToWidthSettings.isFitToWidth&&this.parent.pdfExportModule.isPdfExport?this.parent.ids.indexOf(t.ganttProperties.taskId.toString()):this.parent.currentViewData.indexOf(t))},n.prototype.destroy=function(){this.removeEventListener(),this.unWireEvents(),this.chartElement=null,this.rangeViewContainer=null,this.chartBodyContent=null,this.scrollElement=null,this.chartTimelineContainer=null,this.chartBodyContainer=null,oe.isNullOrUndefined(this.scrollObject)||(this.scrollObject.destroy(),this.scrollObject=null)};var Pt=n;function n(e){this.isExpandCollapseFromChart=!1,this.isExpandAll=!1,this.isCollapseAll=!1,this.debounceTimeoutNext=0,this.debounceTimeout=0,this.isGanttElement=!1,this.previousPinchDistance=0,this.currentToolbarIndex=-1,this.isPinching=!1,this.preventScrollIntoView=!1,this.parent=e,this.chartTimelineContainer=null,this.rangeViewContainer=oe.createElement("div",{className:kt}),this.rangeViewContainer.setAttribute("role","button"),this.rangeViewContainer.setAttribute("aria-label","RangeContainer"),this.virtualRender=new Tt(this.parent),this.addEventListener()}var St=function(){return(St=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var a in t=arguments[i])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},Ct=(a.prototype.initProperties=function(){this.timelineStartDate=null,this.timelineEndDate=null,this.totalTimelineWidth=0,this.customTimelineSettings=null,this.parent.isTimelineRoundOff=!this.isZoomToFit&&!!oe.isNullOrUndefined(this.parent.projectStartDate),this.parent.enablePersistence&&this.parent.isLoad&&(this.parent.timelineSettings=this.parent.currentZoomingLevel)},a.prototype.validateTimelineProp=function(){this.roundOffDays(),this.processTimelineProperty(),this.timelineWidthCalculation()},a.prototype.refreshTimeline=function(){this.initProperties(),this.processTimelineUnit(),this.parent.dataOperation.calculateProjectDates(),this.parent.isFromOnPropertyChange||this.parent.updateProjectDates(this.parent.cloneProjectStartDate,this.parent.cloneProjectEndDate,this.parent.isTimelineRoundOff);var e=this.parent.element.getElementsByClassName("e-timeline-header-container")[0].offsetHeight;this.parent.element.getElementsByClassName("e-gridcontent")[0].style.height="calc(100% - "+e+"px)",this.parent.element.getElementsByClassName("e-chart-scroll-container e-content")[0].style.height="calc(100% - "+e+"px)"},a.prototype.refreshTimelineByTimeSpan=function(){this.validateTimelineProp(),(!this.parent.pdfExportModule||this.parent.pdfExportModule&&!this.parent.pdfExportModule.isPdfExport||this.parent.pdfExportModule&&this.parent.pdfExportModule.isPdfExport&&this.parent.pdfExportModule.helper.exportProps&&!this.parent.pdfExportModule.helper.exportProps.fitToWidthSettings.isFitToWidth)&&(this.parent.ganttChartModule.chartTimelineContainer.innerHTML=""),this.createTimelineSeries()},a.prototype.updateChartByNewTimeline=function(){this.parent.chartRowsModule.refreshChartByTimeline();var e=this.parent.element.getElementsByClassName("e-chart-scroll-container e-content")[0].scrollLeft;this.parent.element.getElementsByClassName("e-timeline-header-container")[0].scrollLeft=e,this.parent.notify("refreshDayMarkers",{})},a.prototype.processZooming=function(e){this.parent.isReact&&this.parent.clearTemplate(["TaskbarTemplate","ParentTaskbarTemplate","MilestoneTemplate","TaskLabelTemplate","RightLabelTemplate","LeftLabelTemplate"]),this.isZoomToFit=this.isZoomedToFit=!1,this.updateUndoRedo(e),this.parent.isProjectDateUpdated||this.parent.dateValidationModule.calculateProjectDates(),this.parent.zoomingProjectStartDate&&(this.parent.cloneProjectStartDate=this.parent.zoomingProjectStartDate,this.parent.cloneProjectEndDate=this.parent.zoomingProjectEndDate),this.parent.zoomingProjectStartDate=this.parent.zoomingProjectEndDate=null;var t=this.checkCurrentZoomingLevel(),i=(this.isZoomIn=e,this.isZooming=!0,this.getZoomLevel(t,e)),i=(this.updateToolbar(i,e),this.parent.zoomingLevels.findIndex(function(e){return e.level===i})),t={requestType:e?"beforeZoomIn":"beforeZoomOut",timeline:this.parent.zoomingLevels[i],cancel:!1};this.parent.trigger("actionBegin",t),t.cancel||(oe.isNullOrUndefined(this.parent.loadingIndicator)||"Shimmer"!==this.parent.loadingIndicator.indicatorType?this.parent.showSpinner():this.parent.showMaskRow(),this.changeTimelineSettings(t.timeline)),this.isZooming=!1},a.prototype.updateUndoRedo=function(e){var e=e?"ZoomIn":"ZoomOut";this.parent.undoRedoModule&&this.parent.isUndoRedoItemPresent(e)&&(this.parent.undoRedoModule.redoEnabled&&this.parent.undoRedoModule.disableRedo(),this.parent.undoRedoModule.createUndoCollection(),e={action:e,previousZoomingLevel:oe.extend({},{},this.parent.currentZoomingLevel,!0)},this.parent.undoRedoModule.getUndoCollection[this.parent.undoRedoModule.getUndoCollection.length-1]=e)},a.prototype.getZoomLevel=function(e,t){var i=e+(t?1:-1);return this.parent.zoomingLevels.find(function(e){return e.level===i})?i:e},a.prototype.updateToolbar=function(e,t){this.parent.toolbarModule&&(t?(e===this.parent.zoomingLevels[this.parent.zoomingLevels.length-1].level&&this.parent.toolbarModule.enableItems([this.parent.controlId+"_zoomin"],!1),this.parent.toolbarModule.enableItems([this.parent.controlId+"_zoomout"],!0)):(e===this.parent.zoomingLevels[0].level&&this.parent.toolbarModule.enableItems([this.parent.controlId+"_zoomout"],!1),this.parent.toolbarModule.enableItems([this.parent.controlId+"_zoomin"],!0)))},a.prototype.changeTimelineSettings=function(i){var n=this,a=(this.isZoomToFit?this.isSingleTier="None"===this.customTimelineSettings.topTier.unit||"None"===this.customTimelineSettings.bottomTier.unit:this.isZoomIn||(this.isSingleTier="None"===i.topTier.unit||"None"===i.bottomTier.unit),this.isSingleTier?"None"===this.customTimelineSettings.topTier.unit?"topTier":"bottomTier":null),e=(Object.keys(this.customTimelineSettings).forEach(function(e){var t;e!==a?n.customTimelineSettings[e]="object"!=typeof i[e]||oe.isNullOrUndefined(i[e])?i[e]:St({},i[e]):"None"!==i[t="bottomTier"].unit&&(n.customTimelineSettings["topTier"===e?"bottomTier":"topTier"]=St({},i[t]))}),this.parent.isTimelineRoundOff=!this.isZoomToFit&&!!oe.isNullOrUndefined(this.parent.projectStartDate),this.processTimelineUnit(),this.parent.updateProjectDates(this.parent.cloneProjectStartDate,this.parent.cloneProjectEndDate,this.parent.isTimelineRoundOff),this.parent.criticalPathModule),e=(this.parent.enableCriticalPath&&e&&e.criticalPathCollection&&e.criticalConnectorLine(e.criticalPathCollection,e.detailPredecessorCollection,!0,e.predecessorCollectionTaskIds),(this.isZooming||this.isZoomToFit)&&(e={requestType:this.isZoomIn?"AfterZoomIn":this.isZoomToFit?"AfterZoomToProject":"AfterZoomOut",timeline:this.parent.currentZoomingLevel},this.parent.trigger("actionComplete",e),oe.isNullOrUndefined(this.parent.loadingIndicator)||"Shimmer"!==this.parent.loadingIndicator.indicatorType?this.parent.hideSpinner():this.parent.hideMaskRow()),"None"===this.topTier?"bottomTier":"topTier");this.parent.enableTimelineVirtualization&&(!this.parent.pdfExportModule||this.parent.pdfExportModule&&!this.parent.pdfExportModule.isPdfExport)&&(this.wholeTimelineWidth=this.calculateWidthBetweenTwoDate(e,this.parent.timelineModule.timelineStartDate,this.parent.timelineModule.timelineEndDate),this.wholeTimelineWidth<=this.totalTimelineWidth&&(this.wholeTimelineWidth=this.totalTimelineWidth),this.isZoomToFit?(this.clientWidthDifference=Math.abs(this.wholeTimelineWidth-this.parent.element.getElementsByClassName("e-chart-scroll-container e-content")[0].clientWidth)+1,this.parent.element.querySelectorAll(".e-chart-scroll-container")[0].querySelector(".e-virtualtrack").style.width=this.wholeTimelineWidth-this.clientWidthDifference+"px",oe.isNullOrUndefined(this.parent.element.querySelectorAll(".e-timeline-header-container")[0].querySelector(".e-virtualtrack"))||(this.parent.element.querySelectorAll(".e-timeline-header-container")[0].querySelector(".e-virtualtrack").style.width=this.wholeTimelineWidth-this.clientWidthDifference+"px")):(this.parent.element.querySelectorAll(".e-chart-scroll-container")[0].querySelector(".e-virtualtrack").style.width=this.wholeTimelineWidth+"px",oe.isNullOrUndefined(this.parent.element.querySelectorAll(".e-timeline-header-container")[0].querySelector(".e-virtualtrack"))||(this.parent.element.querySelectorAll(".e-timeline-header-container")[0].querySelector(".e-virtualtrack").style.width=this.wholeTimelineWidth+"px")),this.parent.ganttChartModule.updateWidthAndHeight())},a.prototype.processZoomToFit=function(){this.parent.isReact&&this.parent.clearTemplate(["TaskbarTemplate","ParentTaskbarTemplate","MilestoneTemplate","TaskLabelTemplate","RightLabelTemplate","LeftLabelTemplate"]),this.isZoomToFit=!0,this.isZooming=!1,this.isZoomedToFit=!0;var e={},e=(this.parent.undoRedoModule&&!this.parent.undoRedoModule.isUndoRedoPerformed&&this.parent.isUndoRedoItemPresent("ZoomToFit")&&(this.parent.undoRedoModule.redoEnabled&&this.parent.undoRedoModule.disableRedo(),this.parent.undoRedoModule.createUndoCollection(),e.action="ZoomToFit",e.previousTimelineStartDate=oe.extend([],[],[this.parent.cloneProjectStartDate],!0)[0],e.previousTimelineEndDate=oe.extend([],[],[this.parent.cloneProjectEndDate],!0)[0],e.previousZoomingLevel=oe.extend({},{},this.parent.currentZoomingLevel,!0),this.parent.undoRedoModule.getUndoCollection[this.parent.undoRedoModule.getUndoCollection.length-1]=e),this.parent.zoomingProjectStartDate||(this.parent.zoomingProjectStartDate=this.parent.cloneProjectStartDate,this.parent.zoomingProjectEndDate=this.parent.cloneProjectEndDate),this.parent.zoomingProjectStartDate>this.parent.cloneProjectStartDate&&(this.parent.cloneProjectStartDate=new Date(this.parent.allowUnscheduledTasks?this.parent.zoomingProjectStartDate:this.parent.cloneProjectStartDate)),this.parent.dataOperation.calculateProjectDates(),0);this.parent.timelineSettings.showWeekend||(e=this.calculateNonWorkingDaysBetweenDates(this.parent.cloneProjectStartDate,this.parent.cloneProjectEndDate));var t,i,n,a=(this.parent.cloneProjectEndDate.getTime()-this.parent.cloneProjectStartDate.getTime())/864e5,r=this.parent.ganttChartModule.chartElement.offsetWidth,s=r/(a-=e),o=this.parent.zoomingLevels.slice().sort(function(e,t){return e.perDayWidth||t.perDayWidth?e.perDayWidth<t.perDayWidth?1:-1:0});if(0!=s){for(var l=0;l<o.length;l++){if(i=o[l],l===o.length-1){t=o[l];break}if(n=o[l+1],s>=i.perDayWidth){t=o[l];break}if(s<i.perDayWidth&&s>n.perDayWidth){t=o[l+1];break}}var e=oe.extend({},{},t,!0),a=(this.roundOffDateToZoom(this.parent.cloneProjectStartDate,!0,s,e.bottomTier.unit,t),this.roundOffDateToZoom(this.parent.cloneProjectEndDate,!1,s,e.bottomTier.unit,t),this.calculateNumberOfTimelineCells(e)),d=this.parent.ganttChartModule.scrollElement.offsetHeight-17,h=this.parent.ganttChartModule.chartBodyContent.offsetHeight,r=(e.timelineUnitSize=Math.abs(r-(h<=d?0:17))/a,{requestType:"beforeZoomToProject",timeline:e});this.parent.toolbarModule&&this.parent.toolbarModule.enableItems([this.parent.controlId+"_zoomin",this.parent.controlId+"_zoomout"],!0),this.parent.trigger("actionBegin",r),r.cancel||(oe.isNullOrUndefined(this.parent.loadingIndicator)||"Shimmer"!==this.parent.loadingIndicator.indicatorType?this.parent.showSpinner():this.parent.showMaskRow(),this.changeTimelineSettings(e),this.parent.isTimelineRoundOff=!!oe.isNullOrUndefined(this.parent.projectStartDate)),this.isZoomToFit=!1}},a.prototype.bottomTierCellWidthCalc=function(e,t,i){switch(e){case"Minutes":a=6e4*t.bottomTier.count;break;case"Hour":a=36e5*t.bottomTier.count;break;case"Week":a=6048e5*t.bottomTier.count;break;case"Day":a=864e5*t.bottomTier.count;break;case"Month":var n=new Date(i.getFullYear(),i.getMonth()+1,0).getDate(),a=t.bottomTier.count*(86400*n*1e3);break;case"Year":n=i.getFullYear()%400==0||i.getFullYear()%100!=0&&i.getFullYear()%4==0?366:365;a=t.bottomTier.count*(86400*n*1e3)}return a},a.prototype.roundOffDateToZoom=function(e,t,i,n,a){n=this.bottomTierCellWidthCalc(n,a,e);t?e.setTime(e.getTime()-n):e.setTime(e.getTime()+n)},a.prototype.calculateNumberOfTimelineCells=function(e){var t=new Date(this.parent.cloneProjectStartDate.getTime()),i=new Date(this.parent.cloneProjectEndDate.getTime()),n=(this.parent.dateValidationModule.updateDateWithTimeZone(t,i),0),t=(this.parent.timelineSettings.showWeekend||(n=this.calculateNonWorkingDaysBetweenDates(this.parent.cloneProjectStartDate,this.parent.cloneProjectEndDate)),i=Math.abs((i.getTime()-t.getTime())/864e5),i-=n,e.bottomTier.count),n=e.bottomTier.unit;return"Day"===n?i/t:"Week"===n?i/t/7:"Month"===n?i/t/28:"Year"===n?i/t/336:"Hour"===n?24/t*i:1440/t*i},a.prototype.processTimelineUnit=function(){var e=["Year","Month","Week","Day","Hour","Minutes"];this.customTimelineSettings=this.customTimelineSettings||this.extendFunction(this.parent.timelineSettings,["timelineViewMode","timelineUnitSize","weekStartDay","weekendBackground"],{topTier:["unit","format","count","formatter"],bottomTier:["unit","format","count","formatter"]}),-1===e.indexOf(this.customTimelineSettings.topTier.unit)&&-1===e.indexOf(this.customTimelineSettings.bottomTier.unit)?(this.customTimelineSettings.topTier.unit=-1!==e.indexOf(this.customTimelineSettings.timelineViewMode)?this.customTimelineSettings.timelineViewMode:"Week",this.customTimelineSettings.bottomTier.unit=5!==e.indexOf(this.customTimelineSettings.topTier.unit)?e[e.indexOf(this.customTimelineSettings.topTier.unit)+1]:"None"):-1!==e.indexOf(this.customTimelineSettings.topTier.unit)&&-1!==e.indexOf(this.customTimelineSettings.bottomTier.unit)&&e.indexOf(this.customTimelineSettings.topTier.unit)>e.indexOf(this.customTimelineSettings.bottomTier.unit)?this.customTimelineSettings.bottomTier.unit=this.customTimelineSettings.topTier.unit:(this.customTimelineSettings.topTier.unit=-1===e.indexOf(this.customTimelineSettings.topTier.unit)?"None":this.customTimelineSettings.topTier.unit,this.customTimelineSettings.bottomTier.unit=-1===e.indexOf(this.customTimelineSettings.bottomTier.unit)?"None":this.customTimelineSettings.bottomTier.unit),this.topTier=this.customTimelineSettings.topTier.unit,this.bottomTier=this.customTimelineSettings.bottomTier.unit,this.previousIsSingleTier=this.isSingleTier,this.isSingleTier="None"===this.topTier||"None"===this.bottomTier},a.prototype.processTimelineProperty=function(){this.customTimelineSettings.topTier.count="None"===this.topTier?1:this.validateCount(this.customTimelineSettings.topTier.unit,this.customTimelineSettings.topTier.count,"topTier"),this.customTimelineSettings.bottomTier.count="None"===this.customTimelineSettings.bottomTier.unit?1:this.validateCount(this.customTimelineSettings.bottomTier.unit,this.customTimelineSettings.bottomTier.count,"bottomTier"),this.customTimelineSettings.bottomTier.format=this.validateFormat(this.customTimelineSettings.bottomTier.unit,this.customTimelineSettings.bottomTier.format),this.customTimelineSettings.topTier.format=this.validateFormat(this.topTier,this.customTimelineSettings.topTier.format),this.customTimelineSettings.weekStartDay=0<=this.customTimelineSettings.weekStartDay&&this.customTimelineSettings.weekStartDay<=6?this.customTimelineSettings.weekStartDay:0,this.parent.pdfExportModule&&this.parent.pdfExportModule.helper.exportProps&&this.parent.pdfExportModule.isPdfExport&&this.parent.pdfExportModule.helper.exportProps.fitToWidthSettings.isFitToWidth||this.checkCurrentZoomingLevel()},a.prototype.calculateZoomingLevelsPerDayWidth=function(){for(var e=this.parent.zoomingLevels,t=0;t<e.length;t++){var i=this.getPerDayWidth(e[t].timelineUnitSize,e[t].bottomTier.count,e[t].bottomTier.unit);e[t].perDayWidth=i}},a.prototype.checkCurrentZoomingLevel=function(){var e=("None"!==this.customTimelineSettings.bottomTier.unit?this.customTimelineSettings.bottomTier:this.customTimelineSettings.topTier).count,t=("None"!==this.customTimelineSettings.bottomTier.unit?this.customTimelineSettings.bottomTier:this.customTimelineSettings.topTier).unit,i="None"!==this.customTimelineSettings.bottomTier.unit?"bottomTier":"topTier",t=this.getCurrentZoomingLevel(t,e,i);return this.parent.toolbarModule&&(t===this.parent.zoomingLevels[this.parent.zoomingLevels.length-1].level?this.parent.toolbarModule.enableItems([this.parent.controlId+"_zoomin"],!1):t===this.parent.zoomingLevels[0].level&&this.parent.toolbarModule.enableItems([this.parent.controlId+"_zoomout"],!1)),this.parent.currentZoomingLevel=this.parent.zoomingLevels[t],t},a.prototype.getCurrentZoomingLevel=function(t,e,i){this.parent.zoomingLevels.length||(this.parent.zoomingLevels=this.parent.getZoomingLevels());for(var n,a,r,s,o,l,d=this.parent.zoomingLevels.filter(function(e){return"bottomTier"===i?e.bottomTier.unit===t:e.topTier.unit===t}),h=(0===d.length&&(l=this.getClosestUnit(t,"",!1),d=this.parent.zoomingLevels.filter(function(e){return"bottomTier"===i?e.bottomTier.unit===l:e.topTier.unit===l})),d.sort(function(e,t){return"bottomTier"===i?e.bottomTier.count&&t.bottomTier.count?e.bottomTier.count<t.bottomTier.count?1:-1:0:e.topTier.count&&t.topTier.count?e.topTier.count<t.topTier.count?1:-1:0})),p=0;p<h.length;p++){if(o=h[p],p===h.length-1){n=h[p].level;break}if(s=h[p+1],e>=o[""+i].count){a=h[p],n=1<(r=h.filter(function(e){return"bottomTier"===i?e.bottomTier.count===a.bottomTier.count:e.topTier.count===a.topTier.count})).length?this.checkCollectionsWidth(r):r[0].level;break}if(e<o[""+i].count&&e>s[""+i].count){a=h[p+1],n=1<(r=h.filter(function(e){return"bottomTier"===i?e.bottomTier.count===a.bottomTier.count:e.topTier.count===a.topTier.count})).length?this.checkCollectionsWidth(r):r[0].level;break}}return n},a.prototype.getClosestUnit=function(t,e,i){var n=["Year","Month","Week","Day","Hour","Minutes"],a=n.indexOf(t);return 0===a&&(i=!0),t=this.isZoomIn||i?n[a+1]:n[a-1],0===this.parent.zoomingLevels.filter(function(e){return e.bottomTier.unit===t}).length?("Year"===t&&(i=!0),e=t,this.getClosestUnit(t,e,i)):t},a.prototype.checkCollectionsWidth=function(e){for(var t,i,n,a=this.customTimelineSettings.timelineUnitSize,r=e.sort(function(e,t){return e.timelineUnitSize<t.timelineUnitSize?1:-1}),s=0;s<r.length;s++){if(n=r[s],s===r.length-1){t=r[s].level;break}if(i=r[s+1],a>=n.timelineUnitSize){t=r[s].level;break}if(a<n.timelineUnitSize&&a>i.timelineUnitSize){t=r[s+1].level;break}}return t},a.prototype.updateTimelineHeaderHeight=function(){var e;this.parent.timelineModule.isSingleTier?this.parent.element.classList.add(ae):this.parent.element.classList.remove(ae),this.previousIsSingleTier!==this.isSingleTier&&(e=0,oe.isNullOrUndefined(this.parent.toolbarModule)||oe.isNullOrUndefined(this.parent.toolbarModule.element)||(e=this.parent.toolbarModule.element.offsetHeight),this.parent.ganttChartModule.scrollObject.setHeight(this.parent.ganttHeight-this.parent.ganttChartModule.chartTimelineContainer.offsetHeight-e),this.parent.treeGrid.height=this.parent.ganttHeight-e-this.parent.ganttChartModule.chartTimelineContainer.offsetHeight)},a.prototype.dateByLeftValue=function(e,t,i){var n=new Date(this.parent.timelineModule.timelineStartDate.toString()),a=864e5/this.parent.perDayWidth,e=(this.parent.timelineSettings.showWeekend?n.setTime(n.getTime()+e*a):n=this.calculateDateExcludingNonWorkingDays(e,n),t&&!oe.isNullOrUndefined(i.predecessorsName)&&""!==i.predecessorsName&&(n.setDate(n.getDate()-1),a=this.parent.getCurrentDayEndTime(i.isAutoSchedule?i.autoEndDate:i.endDate),this.parent.dateValidationModule.setTime(a,n),n=this.parent.dateValidationModule.checkStartDate(n,i,!0)),"None"!==this.parent.timelineModule.bottomTier?this.parent.timelineModule.topTier:this.parent.timelineModule.bottomTier);return"Hour"!==e&&"Minutes"!==e&&(this.parent.isInDst(new Date(this.parent.timelineModule.timelineStartDate.toString()))&&!this.parent.isInDst(n)?n.setTime(n.getTime()+36e5):!this.parent.isInDst(new Date(this.parent.timelineModule.timelineStartDate.toString()))&&this.parent.isInDst(n)&&n.setTime(n.getTime()-36e5)),n},a.prototype.calculateDateExcludingNonWorkingDays=function(e,t){for(var i=864e5/this.parent.perDayWidth,n=this.parent.nonWorkingDayIndex,e=Math.floor(e*i/864e5),i=7-n.length,a=Math.floor(e/i),r=e%i,s=new Date(t),o=(s.setDate(s.getDate()+7*a),0);o<r;)s.setDate(s.getDate()+1),-1===n.indexOf(s.getDay())&&o++;return s},a.prototype.createTimelineSeries=function(){var e,t,i,n,a,r=this.isSingleTier?1:2,s="None"===this.topTier?"bottomTier":"topTier";if(this.topTierCollection=[],this.bottomTierCollection=[],!0===this.restrictRender&&(this.updateTimelineHeaderHeight(),this.wholeTimelineWidth=this.calculateWidthBetweenTwoDate(s,this.parent.timelineModule.timelineStartDate,this.parent.timelineModule.timelineEndDate)),this.parent.enableTimelineVirtualization&&this.wholeTimelineWidth>3*this.parent.element.offsetWidth){for(var o=0;o<r;o++){(i=oe.createElement("table",{className:ge,styles:"display: block;"})).setAttribute("role","none");var l=oe.createElement("thead",{className:fe,styles:"display:block; border-collapse:collapse"}),d=this.createTimelineTemplate(s),h=oe.createElement("tr");Array.from(d.childNodes).forEach(function(e){h.appendChild(e)}),e=oe.createElement("td"),t=oe.createElement("div",{styles:"width: 20px"}),n=oe.createElement("div",{className:"e-virtualtable"}),a=oe.createElement("div",{className:"e-virtualtrack"}),e.appendChild(t),h.appendChild(e),n.appendChild(h),l.appendChild(n),l.appendChild(a),i.appendChild(l),this.parent.ganttChartModule.chartTimelineContainer.appendChild(i),h=null,this.restrictRender=!(s="bottomTier")}"auto"!==this.parent.height&&!this.parent.timelineModule.isSingleTier||(p=this.parent.element.getElementsByClassName("e-timeline-header-container")[0].offsetHeight,this.parent.element.getElementsByClassName("e-chart-scroll-container e-content")[0].style.height="calc(100% - "+p+"px)",oe.isNullOrUndefined(this.parent.element.getElementsByClassName("e-gridcontent")[0]))||(this.parent.treeGrid.element.getElementsByClassName("e-gridcontent")[0].style.height="calc(100% - "+p+"px)"),this.timelineVirtualizationStyles()}else{for(var p,o=0;o<r;o++){(i=oe.createElement("table",{className:ge,styles:"display: block;"})).setAttribute("role","none"),l=oe.createElement("thead",{className:fe,styles:"display:block; border-collapse:collapse"});d=this.createTimelineTemplate(s);h=oe.createElement("tr"),Array.from(d.childNodes).forEach(function(e){h.appendChild(e)}),e=oe.createElement("td"),t=oe.createElement("div",{styles:"width: 20px"}),e.appendChild(t),h.appendChild(e),l.appendChild(h),i.appendChild(l),this.parent.ganttChartModule.chartTimelineContainer.appendChild(i),s="bottomTier",h=null}this.wholeTimelineWidth=this.totalTimelineWidth,"auto"!==this.parent.height&&!this.parent.timelineModule.isSingleTier||(p=this.parent.element.getElementsByClassName("e-timeline-header-container")[0].offsetHeight,this.parent.element.getElementsByClassName("e-chart-scroll-container e-content")[0].style.height="calc(100% - "+p+"px)",oe.isNullOrUndefined(this.parent.element.getElementsByClassName("e-gridcontent")[0]))||(this.parent.treeGrid.element.getElementsByClassName("e-gridcontent")[0].style.height="calc(100% - "+p+"px)")}},a.prototype.timelineVirtualizationStyles=function(){var e,t,i=0,n=this.wholeTimelineWidth;this.parent.enableTimelineVirtualization&&(i=this.parent.enableTimelineVirtualization&&!oe.isNullOrUndefined(this.parent.ganttChartModule.scrollObject.element.scrollLeft)&&0!==this.parent.ganttChartModule.scrollObject.element.scrollLeft?this.parent.ganttChartModule.scrollObject.getTimelineLeft():0,this.parent.enableRtl&&(i=-i),this.parent.element.querySelectorAll(".e-chart-scroll-container")[0].querySelector(".e-virtualtable").style.transform="translate("+i+"px, 0px)",(e=this.parent.element.querySelectorAll(".e-chart-scroll-container")[0].querySelector(".e-virtualtrack")).style.position="relative",e.style.width=n+"px",this.parent.ganttChartModule.scrollObject.isSetScrollLeft&&(e=this.parent.element.querySelectorAll(".e-timeline-header-table-container")[0].querySelector(".e-virtualtable"),t=void 0,oe.isNullOrUndefined(this.parent.element.querySelectorAll(".e-timeline-header-table-container")[1])||(t=this.parent.element.querySelectorAll(".e-timeline-header-table-container")[1].querySelector(".e-virtualtable")),e.style.transform="translate("+i+"px, 0px)",oe.isNullOrUndefined(t)||(t.style.transform="translate("+i+"px, 0px)")),e=this.parent.element.querySelectorAll(".e-timeline-header-table-container")[0].querySelector(".e-virtualtrack"),t=void 0,oe.isNullOrUndefined(this.parent.element.querySelectorAll(".e-timeline-header-table-container")[1])||(t=this.parent.element.querySelectorAll(".e-timeline-header-table-container")[1].querySelector(".e-virtualtrack")),oe.isNullOrUndefined(t)||(t.style.position="relative",t.style.width=n+"px"),e.style.position="relative",e.style.width=n+"px",this.parent.connectorLineModule.svgObject.style.width=n+"px",this.parent.element.querySelector("."+ce).style.width="calc(100% - 17px)",this.parent.timelineModule.isZooming||this.parent.timelineModule.isZoomToFit)&&(this.parent.ganttChartModule.scrollElement.scrollLeft=0,this.isZoomingAction=!0,this.parent.ganttChartModule.scrollObject.updateChartElementStyles())},a.prototype.validateCount=function(e,t,i){var n,a=!oe.isNullOrUndefined(t)&&0<parseInt(t.toString(),10)?parseInt(t.toString(),10):1,r=Math.abs(this.timelineRoundOffEndDate.getTime()-this.timelineStartDate.getTime());switch(e){case"Year":a=a<=(n=Math.round(r/864e5/336))?a:0<n?n:1,"None"!==this.topTier&&"bottomTier"===i&&(a=this.validateBottomTierCount(e,a));break;case"Month":a=a<=(n=Math.round(r/864e5/28))?a:0<n?n+1:1,"None"!==this.topTier&&"bottomTier"===i&&(a=this.validateBottomTierCount(e,a));break;case"Week":a=a<=(n=Math.round(r/864e5/7))?a:0<n?n:1,"None"!==this.topTier&&"bottomTier"===i&&(a=this.validateBottomTierCount(e,a));break;case"Day":a=a<=(n=Math.round(r/864e5))?a:0<n?n:1,"None"!==this.topTier&&"bottomTier"===i&&(a=this.validateBottomTierCount(e,a));break;case"Hour":a=a<=(n=Math.round(r/36e5))?a:0<n?n:1,"None"!==this.topTier&&"bottomTier"===i&&(a=this.validateBottomTierCount(e,a));break;case"Minutes":a=a<=(n=Math.round(r/6e4))?a:0<n?n:1,"None"!==this.topTier&&"bottomTier"===i&&(a=this.validateBottomTierCount(e,a))}return t!==a&&this.isZooming&&this.parent.toolbarModule&&("bottomTier"===i||this.isSingleTier)&&(this.isZoomIn?this.parent.toolbarModule.enableItems([this.parent.controlId+"_zoomin"],!1):this.parent.toolbarModule.enableItems([this.parent.controlId+"_zoomout"],!1)),a},a.prototype.validateBottomTierCount=function(e,t){var i;switch(e){case"Year":i=t<=this.customTimelineSettings.topTier.count?t:this.customTimelineSettings.topTier.count;break;case"Month":i="Year"===this.topTier?t<=12*this.customTimelineSettings.topTier.count?t:12*this.customTimelineSettings.topTier.count:t<=this.customTimelineSettings.topTier.count?t:this.customTimelineSettings.topTier.count;break;case"Week":i="Year"===this.topTier?t<=48*this.customTimelineSettings.topTier.count?t:48*this.customTimelineSettings.topTier.count:"Month"===this.topTier?t<=4*this.customTimelineSettings.topTier.count?t:4*this.customTimelineSettings.topTier.count:t<=this.customTimelineSettings.topTier.count?t:this.customTimelineSettings.topTier.count;break;case"Day":i="Year"===this.topTier?t<=336*this.customTimelineSettings.topTier.count?t:336*this.customTimelineSettings.topTier.count:"Month"===this.topTier?t<=28*this.customTimelineSettings.topTier.count?t:28*this.customTimelineSettings.topTier.count:"Week"===this.topTier?t<=7*this.customTimelineSettings.topTier.count?t:7*this.customTimelineSettings.topTier.count:t<=this.customTimelineSettings.topTier.count?t:this.customTimelineSettings.topTier.count;break;case"Hour":i="Year"===this.topTier?t<=8064*this.customTimelineSettings.topTier.count?t:8064*this.customTimelineSettings.topTier.count:"Month"===this.topTier?t<=672*this.customTimelineSettings.topTier.count?t:672*this.customTimelineSettings.topTier.count:"Week"===this.topTier?t<=7*this.customTimelineSettings.topTier.count*24?t:7*this.customTimelineSettings.topTier.count*24:"Day"===this.topTier?t<=24*this.customTimelineSettings.topTier.count?t:24*this.customTimelineSettings.topTier.count:t<=this.customTimelineSettings.topTier.count?t:this.customTimelineSettings.topTier.count;break;case"Minutes":i="Year"===this.topTier?t<=483840*this.customTimelineSettings.topTier.count?t:483840*this.customTimelineSettings.topTier.count:"Month"===this.topTier?t<=40320*this.customTimelineSettings.topTier.count?t:40320*this.customTimelineSettings.topTier.count:"Week"===this.topTier?t<=7*this.customTimelineSettings.topTier.count*24*60?t:7*this.customTimelineSettings.topTier.count*24*60:"Day"===this.topTier?t<=24*this.customTimelineSettings.topTier.count*60?t:24*this.customTimelineSettings.topTier.count*60:"Hour"===this.topTier?t<=60*this.customTimelineSettings.topTier.count?t:60*this.customTimelineSettings.topTier.count:t<=this.customTimelineSettings.topTier.count?t:this.customTimelineSettings.topTier.count}return i},a.prototype.validateFormat=function(e,t){var i;switch(e){case"Week":i=t||"MMM dd, yyyy";break;case"Day":case"None":i=t||"";break;case"Hour":i=t||"H";break;case"Month":i=t||"MMM yyyy";break;case"Year":i=t||"yyyy";break;case"Minutes":i=t||"m"}return i},a.prototype.extendFunction=function(t,e,i){for(var n=this,a={},r=0;r<e.length;r++)a[e[r]]=t[e[r]];return i&&Object.keys(i).forEach(function(e){a[e]=n.extendFunction(t[e],i[e],null)}),a},a.prototype.formatDateHeader=function(e,t,i){var n,t=new Date(t.getTime());return""===e?(n=this.parent.globalize.formatDate(t,{format:"E"}),"zh"===this.parent.locale?n=n.slice(1):"ar"!==this.parent.locale&&(n=n.slice(0,1))):(n=this.parent.globalize.formatDate(t,{format:e}),i&&(n=this.updateHourInFormat(e,n,i.getHours()).updatedFormat)),n},a.prototype.isDateAffectedByDST=function(e){for(var t=new Date(e),i=t.getTimezoneOffset(),n=1;n<=3;n++)if(new Date(t.getTime()-60*n*60*1e3).getTimezoneOffset()!==i)return!0;return!1},a.prototype.calculateIteration=function(e,t,i,n){var a,r;return e.setHours(t.getHours()),this.isFirstLoop&&this.parent.isInDst(t)&&this.isDateAffectedByDST(t)&&(e.setHours(e.getHours()-1),this.increaseIteration=!0),this.isFirstLoop=!1,e.setMinutes(t.getMinutes()),e.setSeconds(t.getSeconds()),e.setMilliseconds(t.getMilliseconds()),"Hour"===i?(r=t.getHours(),a=Math.ceil((24-r)/n)):"Minutes"===i&&(r=t.getHours(),i=t.getMinutes(),a=Math.ceil((1440-(60*r+i))/n)),this.increaseIteration&&(a+=1,this.increaseIteration=!1),{iterations:a,dummystartDate:e}},a.prototype.updateHourInFormat=function(e,t,i){var n,a=e.match(/(h{1,2})/)||e.match(/(H{1,2})/);return!a||(a=a[0],e=e.split(/[\s,:]+/),n=t.split(/[\s,:]+/),-1===(e=e.findIndex(function(e){return e.includes("h")||e.includes("H")})))||e>=n.length?{hasHour:!1,updatedFormat:t}:(i=function(e,t){for(var i=String(e);i.length<t;)i="0"+i;return i}(i,a.length),n[e]=i,{hasHour:!0,hourIndex:e,updatedFormat:n.join(" ")})},a.prototype.customFormat=function(e,t,i,n,a){return(a="string"==typeof a?oe.getValue(a,window):a)(e,t,i,n)},a.prototype.createTimelineTemplate=function(e){var t,i,n=!1,a=this.parent,r=oe.createElement("th"),s=("topTier"===e?a.timelineModule.customTimelineSettings.topTier:a.timelineModule.customTimelineSettings.bottomTier).unit,o=("topTier"===e?a.timelineModule.customTimelineSettings.topTier:a.timelineModule.customTimelineSettings.bottomTier).count,l=a.timelineModule.customTimelineSettings.topTier,d=a.timelineModule.customTimelineSettings.bottomTier,a=this.parent.enableTimelineVirtualization&&0!==this.parent.ganttChartModule.scrollObject.element.scrollLeft?this.parent.ganttChartModule.scrollObject.getTimelineLeft():null,h=this.parent.enableTimelineVirtualization&&!oe.isNullOrUndefined(a)?new Date(this.dateByLeftValue(a).toString()):new Date(this.parent.timelineModule.timelineStartDate.toString()),p=new Date(this.timelineRoundOffEndDate.toString()),u=[],c=new Set,g=0,f=3*this.parent.element.offsetWidth,m=this.parent.dataOperation.hasDSTTransition(h.getFullYear()),y=new Date(2e3,0,1,0,0,0,0),D=!1;this.isFirstLoop=!0;do{if(!this.parent.timelineSettings.showWeekend&&this.isNonWorkingDayHeader(s,e,h))t=Math.abs(this.getIncrement(h,o,s,n,!0)),i=h.getTime()+t,h.setTime(i);else{var k={};k.startDate=new Date(h.getTime());if("Month"!==s&&"Hour"!==s||"bottomTier"!==e||1===o||0!==u.length||(n=!0),("Hour"===s||"Minutes"===s&&60===o||"Hour"===l.unit&&"Minutes"===d.unit)&&m){var w=this.calculateIteration(y,h,s,o),b=w.iterations;y.setTime(w.dummystartDate.getTime());for(var T=0;T<b;T++){(k={}).startDate=new Date(h.getTime()),h.getHours()!==y.getHours()&&(this.applyDstHour=!0);var v=this.getHeaterTemplateString(new Date(h.toString()),s,e,!1,o,k,n,y),P=new Date(h.toString()),S=P.getTime(),S=(c.has(S)||(c.add(S),u.push(P)),this.getIncrement(h,o,s,n,!0)),P=S,C=("Minutes"!==s&&"Hour"!==s||(this.dstIncreaseHour&&(this.fromDummyDate=!0,P=this.getIncrement(y,o,s,n,!0),this.dstIncreaseHour=!1,this.fromDummyDate=!1),y.setTime(y.getTime()+P),this.inconsistenceDstApplied?(h.setTime(h.getTime()+S-18e5),this.inconsistenceDstApplied=!1):h.setTime(h.getTime()+S)),n=!1,T===b-1&&0!==h.getHours()&&h.setHours(0),23===h.getHours()&&h.getHours()!==y.getHours()&&h.setHours(h.getHours()-1),p<=h&&(v=this.getHeaterTemplateString(u[u.length-1],s,e,!0,o,k),D=!0),r.appendChild(v),"topTier"===e?this.topTierCollection:this.bottomTierCollection);if(k.endDate=new Date(h.getTime()),(this.parent.pdfExportModule&&this.parent.pdfExportModule.isPdfExport&&this.parent.enableTimelineVirtualization?"topTier"===e?this.pdfExportTopTierCollection:this.pdfExportBottomTierCollection:C).push(k),g+=k.width,this.weekendEndDate=k.endDate>=p?p:k.endDate,D){D=!1;break}}this.applyDstHour=!1,"Hour"===s?Math.floor(b*o/24):"Minutes"===s&&Math.floor(b*o/1440),y=new Date(2e3,0,1,0,0,0,0)}else{if(v=this.getHeaterTemplateString(new Date(h.toString()),s,e,!1,o,k,n),u.push(new Date(h.toString())),i=n&&"Month"===s?this.calculateQuarterEndDate(h,o).getTime():(t=Math.abs(this.getIncrement(h,o,s,n,!0)),h.getTime()+t),n=!1,!this.parent.timelineSettings.showWeekend&&"Day"===s){for(var R=0,M=new Date(h);R<o;)M.setDate(M.getDate()+1),-1===this.parent.nonWorkingDayIndex.indexOf(M.getDay())&&R++;i=M.getTime()}h.setTime(i),!m||"Day"!==s&&"Month"!==s&&"Week"!==s||h.setHours(0,0,0,0),p<=h&&(v=this.getHeaterTemplateString(u[u.length-1],s,e,!0,o,k)),r.appendChild(v);C="topTier"===e?this.topTierCollection:this.bottomTierCollection;k.endDate=new Date(h.getTime()),(this.parent.pdfExportModule&&this.parent.pdfExportModule.isPdfExport&&this.parent.enableTimelineVirtualization?"topTier"===e?this.pdfExportTopTierCollection:this.pdfExportBottomTierCollection:C).push(k),g+=k.width,this.weekendEndDate=k.endDate>=p?p:k.endDate}}}while((!this.parent.enableTimelineVirtualization||this.parent.pdfExportModule&&(!this.parent.pdfExportModule||this.parent.pdfExportModule.isPdfExport)||g<f)&&h<p);return r},a.prototype.isNonWorkingDayHeader=function(e,t,i){return("Day"===e||"Hour"===e||"Minutes"===e)&&-1!==this.parent.nonWorkingDayIndex.indexOf(i.getDay())},a.prototype.updateTimelineAfterZooming=function(e,t){var i,n=document.getElementsByClassName("e-chart-scroll-container e-content")[0];if(!oe.isNullOrUndefined(n)){var a=!this.parent.isLoad&&this.parent.splitterModule&&this.parent.splitterModule.splitterObject&&"Chart"===this.parent.splitterSettings.view?n.offsetWidth+this.parent.splitterModule.splitterObject.allPanes[0].offsetWidth:n.offsetWidth,n=n.offsetHeight,r=document.getElementsByClassName("e-chart-rows-container")[0].offsetHeight,s=Math.abs(this.timelineStartDate.getTime()-e.getTime());if(s/=864e5,i="None"===this.bottomTier?this.getPerDayWidth(this.customTimelineSettings.timelineUnitSize,this.customTimelineSettings.topTier.count,this.topTier):this.getPerDayWidth(this.customTimelineSettings.timelineUnitSize,this.customTimelineSettings.bottomTier.count,this.bottomTier),(n=n<r?i*s+17:i*s)<=a){r=a-n;if(this.parent.timelineSettings.showWeekend)r=Math.round(r/i),e.setDate(e.getDate()+r);else{for(var s=Math.floor(a*(864e5/i)/864e5),n=7-this.parent.nonWorkingDayIndex.length,o=s%n,l=7*Math.floor(s/n)+o,d=e.getDay();0<o;)-1===this.parent.nonWorkingDayIndex.indexOf(d=(d+1)%7)&&o--,l++;e.setDate(e.getDate()+l)}this.parent.timelineModule.timelineEndDate=e,t&&this.parent.updateProjectDates(this.timelineStartDate,this.timelineEndDate,this.parent.isTimelineRoundOff)}}},a.prototype.getTimelineRoundOffEndDate=function(e){var t="None"===this.topTier?this.bottomTier:this.topTier,e=new Date(e.toString());return this.parent.isTimelineRoundOff&&("Hour"===t?e.setMinutes(60):"Minutes"===t?e.setSeconds(60):e.setHours(24,0,0,0)),oe.isNullOrUndefined(this.parent.projectEndDate)&&this.updateTimelineAfterZooming(e,!1),e},a.prototype.getIncrement=function(e,t,i,n,a){var r=new Date(e.getTime()),s=new Date(e.getTime()),o=!1,l=new Date(r);switch(i){case"Year":var r=e,s=new Date(e.getFullYear()+(t-1),11,31),d=q(e),h=this.resetToNextYear(e,t),p=this.adjustForDST(r,s,h-d,s.getTime()-r.getTime()+864e5,a,!0);break;case"Month":r=e,s=new Date(e.getFullYear(),e.getMonth()+t,1);d=q(e),h=this.resetToNextMonth(e,t);p=this.adjustForDST(r,s,h-d,s.getTime()-r.getTime(),a,!0);break;case"Week":var u=this.parent.timelineModule.customTimelineSettings.weekStartDay,c=e.getDay()<u?u-e.getDay():6-e.getDay()+u,u=(t=0<c?t-1:0,s.setHours(24,0,0,0),c=e.getDay()<u&&0<c?c-1:c,s.setDate(s.getDate()+(c+7*t)),this.resetToNextDay(e)),d=q(e),h=u+24*(c+7*t)*60*60*1e3;p=this.adjustForDST(r,s,h-d,s.getTime()-r.getTime(),a,!0);break;case"Day":s.setHours(24,0,0,0);c=(h=(u=this.resetToNextDay(r))+24*(t-1)*60*60*1e3)-(d=q(r));p=s.getTime()-r.getTime()+864e5*(t-1),(g=new Date(r)).setTime(g.getTime()+p),p=this.adjustForDST(r,g,c,g.getTime()-r.getTime(),a,!0);break;case"Hour":s.setMinutes(60),s.setSeconds(0);u=(h=this.resetToNextHour(r)+60*(t-1)*60*1e3)-(d=q(r));p=s.getTime()-r.getTime()+36e5*(t-1);(g=new Date(r)).setTime(g.getTime()+p),n&&12===t&&0!==r.getHours()&&g.setHours(0,0,0,0);c=new Date(r);c.setHours(c.getHours()-t),-30==r.getTimezoneOffset()-c.getTimezoneOffset()&&(g.setMinutes(g.getMinutes()+30),this.inconsistenceDstApplied=!0),g.getHours()<l.getHours()+t&&(o=!0),p=this.adjustForDST(r,g,u,g.getTime()-r.getTime(),a,o);break;case"Minutes":s.setSeconds(60);var g,c=(h=this.resetToNextMinute(r)+60*(t-1)*1e3)-(d=q(r));p=s.getTime()-r.getTime()+6e4*(t-1),(g=new Date(r)).setTime(g.getTime()+p),g.getMinutes()<=l.getMinutes()&&(o=!0),p=this.adjustForDST(r,g,c,g.getTime()-r.getTime(),a,o)}return p},a.prototype.resetToNextYear=function(e,t){e=e.getFullYear()+t;return Date.UTC(e,0,1,0,0,0,0)},a.prototype.resetToNextMonth=function(e,t){var i=e.getFullYear(),e=e.getMonth();return Date.UTC(i,e+t,1,0,0,0,0)},a.prototype.resetToNextDay=function(e){var t=e.getFullYear(),i=e.getMonth(),e=e.getDate();return Date.UTC(t,i,e+1,0,0,0,0)},a.prototype.resetToNextHour=function(e){var t=e.getFullYear(),i=e.getMonth(),n=e.getDate(),e=e.getHours();return Date.UTC(t,i,n,e+1,0,0,0)},a.prototype.resetToNextMinute=function(e){var t=e.getFullYear(),i=e.getMonth(),n=e.getDate(),a=e.getHours(),e=e.getMinutes();return Date.UTC(t,i,n,a,e+1,0,0)},a.prototype.adjustForDST=function(e,t,i,n,a,r){if(this.parent.dataOperation.hasDSTTransition(e.getFullYear())&&!this.inconsistenceDstApplied){var s=n-i;if(t.getTimezoneOffset()>e.getTimezoneOffset()&&a)return this.dstIncreaseHour=!0,this.fromDummyDate?i:r?n+36e5:n;0<s?n-=s:s<0&&(n+=Math.abs(s))}return n},a.prototype.isWeekendHeaderCell=function(e,t,i){return!("Day"!==e&&"Hour"!==e&&"Minutes"!==e||1!==this.customTimelineSettings[t].count&&"Hour"!==e&&"Minutes"!==e||-1===this.parent.nonWorkingDayIndex.indexOf(i.getDay()))},a.prototype.calculateQuarterEndDate=function(e,t){var i=e.getMonth();return 3===t?0<=i&&i<=2?new Date(e.getFullYear(),3,1):3<=i&&i<=5?new Date(e.getFullYear(),6,1):6<=i&&i<=8?new Date(e.getFullYear(),9,1):new Date(e.getFullYear()+1,0,1):0<=i&&i<=5?new Date(e.getFullYear(),6,1):new Date(e.getFullYear()+1,0,1)},a.prototype.calculateTotalHours=function(e,t){var i=0;switch(e){case"Hour":i=+t;break;case"Day":i=24*t;break;case"Week":i=168*t;break;case"Minutes":i=t/60}return i},a.prototype.getHeaterTemplateString=function(e,t,i,n,a,r,s,o){var l=null,d=(oe.isNullOrUndefined(this.parent.timelineTemplate)||(l=this.parent.chartRowsModule.templateCompiler(this.parent.timelineTemplate)),("topTier"===i?this.parent.timelineModule.customTimelineSettings.topTier:this.parent.timelineModule.customTimelineSettings.bottomTier).format),h=("topTier"===i?this.parent.timelineModule.customTimelineSettings.topTier:this.parent.timelineModule.customTimelineSettings.bottomTier).formatter,p=this.getIncrement(e,a,t,s),u=(this.parent.timelineSettings.showWeekend||"Week"!==t&&"Month"!==t&&"Year"!==t||"topTier"!==i||"Day"!==this.parent.currentZoomingLevel.bottomTier.unit||(c=new Date(e),u=new Date(e),u=new Date(u.getTime()+p),p-=24*this.calculateNonWorkingDaysBetweenDates(c,u)*60*60*1e3),c=Math.abs(p/864e5*this.parent.perDayWidth)),c=n?this.calculateWidthBetweenTwoDate(t,e,this.timelineRoundOffEndDate,r,n):s&&"Hour"!==t?this.calculateWidthBetweenTwoDate(t,e,this.calculateQuarterEndDate(e,a)):c,p=(this.isFirstLoop&&this.parent.isInDst(e)&&1===e.getHours()&&this.isDateAffectedByDST(e)&&(c+=this.parent.perDayWidth/24),this.isFirstLoop=!1,this.isWeekendHeaderCell(t,i,e)),g="topTier"===i?" e-gantt-top-cell-text":"",f=(s&&20===e.getHours()&&12===a&&"bottomTier"===i&&"Hour"===this.parent.timelineModule.customTimelineSettings.bottomTier.unit&&e.setTime(e.getTime()-72e6),new Date(e));if(this.parent.timelineSettings.showWeekend)f=new Date(e);else if(this.isWeekend(f))for(;-1!==this.parent.nonWorkingDayIndex.indexOf(f.getDay());)f.setDate(f.getDate()+1);var m,s=oe.isNullOrUndefined(h)?this.parent.globalize.formatDate(f,{format:this.parent.getDateFormat()}):this.customFormat(f,d,i,t,h),a=this.applyDstHour?oe.isNullOrUndefined(h)?this.formatDateHeader(d,f,o):this.customFormat(f,d,i,t,h):oe.isNullOrUndefined(h)?this.formatDateHeader(d,f):this.customFormat(f,d,i,t,h),o=(oe.isNullOrUndefined(l)||(e=(m=l(oe.extend({},{date:s,tier:i,value:a}),this.parent,"TimelineTemplate",this.parent.chartRowsModule.getTemplateID("TimelineTemplate"),!1,void 0,null,this.parent.root))[0])instanceof HTMLElement&&(e.setAttribute("data-tier",i),e.setAttribute("date",s),e.setAttribute("value",a)),this.parent.timelineModule.isSingleTier?"e-timeline-single-header-cell":"e-timeline-top-header-cell"),d=oe.createElement("th",{className:o+(p?" e-weekend-header-cell":""),styles:"width:"+c+"px;"+(p&&this.customTimelineSettings.weekendBackground?"background-color:"+this.customTimelineSettings.weekendBackground+";":"")}),t=(d.tabIndex=-1,d.setAttribute("aria-label",this.parent.localeObj.getConstant("timelineCell")+" "+s),oe.createElement("div",{className:"e-header-cell-label"+g,styles:"width:"+(c-1)+"px;"}));return t.title=this.parent.timelineSettings.showTooltip?s:"",t.textContent=a,t.setAttribute("data-tier",i),this.parent.isReact&&!oe.isNullOrUndefined(m)&&0<m.length&&(m[0].style.width="100%",m[0].style.height="100%"),!oe.isNullOrUndefined(l)&&!oe.isNullOrUndefined(m)&&0<m.length?oe.append(m,d):d.append(t),d.outerHTML,!this.isSingleTier&&"topTier"!==i||n?(this.isSingleTier||"topTier"===i)&&n&&(this.totalTimelineWidth=this.totalTimelineWidth-u+c):this.totalTimelineWidth=this.totalTimelineWidth+c,r.value=a,r.isWeekend=p,r.width=c,d},a.prototype.calculateNonWorkingDaysBetweenDates=function(e,t){for(var t=Math.ceil((t.getTime()-e.getTime())/864e5),i=t%7,n=Math.floor(t/7)*this.parent.nonWorkingDayIndex.length,a=e.getDay(),r=0;r<i;r++)-1!==this.parent.nonWorkingDayIndex.indexOf((a+r)%7)&&n++;return n},a.prototype.isWeekend=function(e){e=e.getDay();return-1!==this.parent.nonWorkingDayIndex.indexOf(e)},a.prototype.calculateWidthBetweenTwoDate=function(e,t,i,n,a){t=new Date(t.getTime()),i=new Date(i.getTime());this.parent.dateValidationModule.updateDateWithTimeZone(t,i);i=(i.getTime()-t.getTime())/864e5;if(this.parent.timelineSettings.showWeekend||"Day"!==this.parent.currentZoomingLevel.bottomTier.unit)return i*this.parent.perDayWidth;var r=Math.floor(i/7)*(7-this.parent.nonWorkingDayIndex.length),s=i%7;if(1<s||1<r){for(var o=0,l=new Date(t),d=0;d<s;d++){var h=l.getDay();-1===this.parent.nonWorkingDayIndex.indexOf(h)&&o++,l.setDate(l.getDate()+1)}return(r+o)*this.parent.perDayWidth}return this.isZoomToFit&&a?n.width:i*this.parent.perDayWidth},a.prototype.timelineWidthCalculation=function(){var e=this.customTimelineSettings.timelineUnitSize,t=this.customTimelineSettings.bottomTier.count,i=this.customTimelineSettings.topTier.count;this.bottomTierCellWidth=e,"None"===this.bottomTier?this.parent.perDayWidth=this.getPerDayWidth(e,i,this.topTier):this.parent.perDayWidth=this.getPerDayWidth(e,t,this.bottomTier),this.topTierCellWidth="None"!==this.bottomTier?"Week"===this.topTier?7*this.parent.perDayWidth:"Hour"===this.topTier?this.parent.perDayWidth/24:"Minutes"===this.topTier?this.parent.perDayWidth/1440:this.parent.perDayWidth:e,this.topTierCellWidth=this.isSingleTier?this.topTierCellWidth:this.topTierCellWidth*i},a.prototype.getPerDayWidth=function(e,t,i){var n;switch(i){case"Year":n=e/t/336;break;case"Month":n=e/t/28;break;case"Week":n=e/t/7;break;case"Day":n=e/t;break;case"Hour":n=24/t*e;break;case"Minutes":n=1440/t*e}return n},a.prototype.roundOffDays=function(){var e=this.parent.cloneProjectStartDate,t=this.parent.cloneProjectEndDate,i="None"===this.topTier?this.bottomTier:this.topTier;if(this.parent.isTimelineRoundOff){if("Year"===i)e=new Date(e.getFullYear(),0,1),t=new Date(t.getFullYear(),11,31);else if("Month"===i)e=new Date(e.getFullYear(),e.getMonth(),1),t=new Date(t.getFullYear(),t.getMonth()+1,0);else if("Week"===i){var n=oe.isNullOrUndefined(this.customTimelineSettings.weekStartDay)?0:this.parent.timelineModule.customTimelineSettings.weekStartDay,a=e.getDay()<n?e.getDate()-(7-n+e.getDay()):e.getDate()-e.getDay()+n;if(!this.parent.timelineSettings.showWeekend)for(;this.isWeekend(new Date(e.getFullYear(),e.getMonth(),a));)a++;e.setDate(a);var r=t.getDate()-t.getDay();t.setDate(6+r+n)}"Hour"===i?e.setMinutes(0):"Minutes"===i?e.setSeconds(0):e.setHours(0,0,0,0)}this.timelineStartDate=e,this.timelineEndDate=t,this.timelineRoundOffEndDate=this.getTimelineRoundOffEndDate(this.timelineEndDate)},a.prototype.updateScheduleDatesByToolBar=function(e,t,i,n){var a,r;"Year"===e&&("prevTimeSpan"===t?i=0===i.getMonth()?new Date(i.getFullYear()-1,0,1):new Date(i.getFullYear(),0,1):n=11===n.getMonth()?new Date(n.getFullYear()+1,0,1):new Date(n.getFullYear(),12,1)),"Month"===e&&("prevTimeSpan"===t?i=1===i.getDate()?new Date(i.getFullYear(),i.getMonth()-1,1):new Date(i.getFullYear(),i.getMonth(),1):n=new Date(n.getFullYear(),n.getMonth()+1,1)),"Week"===e&&(a=this.parent.timelineModule.customTimelineSettings.weekStartDay,r=void 0,"prevTimeSpan"===t?(r=i.getDay()<a?7-(a-i.getDay()):i.getDay()-a,i.setHours(0,0,0,0),0===r?i.setDate(i.getDate()-7):i.setDate(i.getDate()-r)):(r=n.getDay()<a?a-n.getDay():7-n.getDay()+a,n.setHours(0,0,0,0),0===r?n.setDate(n.getDate()+6):n.setDate(n.getDate()+r))),"Day"===e&&("prevTimeSpan"===t?0===i.getHours()?i.setTime(i.getTime()-864e5):i.setHours(0):0===n.getHours()?n.setTime(n.getTime()+864e5):n.setHours(24)),"Hour"===e&&("prevTimeSpan"===t?0===i.getMinutes()?i.setTime(i.getTime()-36e5):i.setMinutes(0):0===n.getMinutes()?n.setTime(n.getTime()+36e5):n.setMinutes(60)),"Minutes"===e&&("prevTimeSpan"===t?0===i.getSeconds()?i.setTime(i.getTime()-6e4):i.setSeconds(0):0===n.getSeconds()?n.setTime(n.getTime()+6e4):n.setSeconds(60)),this.parent.cloneProjectStartDate=i,this.parent.cloneProjectEndDate=n},a.prototype.updateTimeLineOnEditing=function(e,t){if(1<=e[0].length)for(var i=0;i<e.length;i++){var n=e[parseInt(i.toString(),10)],a=n.filter(function(e){return!oe.isNullOrUndefined(e.ganttProperties.startDate)}),r=n.filter(function(e){return!oe.isNullOrUndefined(e.ganttProperties.endDate)}),s=0<a.length?new Date(y.DataUtil.aggregates.min(a,"ganttProperties.startDate")):null,o=0<a.length?new Date(y.DataUtil.aggregates.min(r,"ganttProperties.endDate")):null,r=0<r.length?new Date(y.DataUtil.aggregates.max(r,"ganttProperties.endDate")):null,l=new Date(this.parent.dataOperation.checkStartDate(this.timelineStartDate).getTime()),d=new Date(this.parent.dataOperation.checkEndDate(this.timelineEndDate).getTime()),h=oe.isNullOrUndefined(s)?null:this.parent.dataOperation.getTaskLeft(s,!1),p=oe.isNullOrUndefined(r)?null:this.parent.dataOperation.getTaskLeft(r,!1),l=this.parent.dataOperation.getTaskLeft(l,!1),d=this.parent.dataOperation.getTaskLeft(d,!1),u=void 0,c=this.parent.editModule.taskbarEditModule,a=0<a.length?new Date(y.DataUtil.aggregates.min(a,"ganttProperties.startDate")).setHours(0,0,0,0):null,g=new Date(this.timelineStartDate.getTime()).setHours(0,0,0,0),s=!(!oe.isNullOrUndefined(h)&&!oe.isNullOrUndefined(c)&&(c.taskBarEditAction&&"RightResizing"!==c.taskBarEditAction||oe.isNullOrUndefined(c.taskBarEditAction))&&a<=g&&(h<this.bottomTierCellWidth||h<=l))||(u="prevTimeSpan",s>this.timelineStartDate)?this.timelineStartDate:s,r=!(!oe.isNullOrUndefined(p)&&p>=(this.parent.enableTimelineVirtualization?this.wholeTimelineWidth:this.totalTimelineWidth)-this.bottomTierCellWidth&&d<p)||(u="prevTimeSpan"===u?"both":"nextTimeSpan",r<this.timelineEndDate)?this.timelineEndDate:r;u?this.performTimeSpanAction(u,t,s,r):oe.isNullOrUndefined(n[0].ganttProperties.segments)||this.parent.dataOperation.updateWidthLeft(n[0]),!oe.isNullOrUndefined(s)&&!oe.isNullOrUndefined(o)&&o<=s&&("CellEditing"===t||"DialogEditing"===t)&&this.parent.allowUnscheduledTasks?(s=new Date(Math.min(s.getTime(),o.getTime())),s=new Date(Math.min(s.getTime(),this.timelineStartDate.getTime())),this.performTimeSpanAction("prevTimeSpan",t,s,r)):oe.isNullOrUndefined(o)&&o<=s&&("CellEditing"===t||"DialogEditing"===t)&&this.parent.allowUnscheduledTasks&&1===e[0].length&&!oe.isNullOrUndefined(e[0][0].ganttProperties.endDate)&&oe.isNullOrUndefined(n[0].ganttProperties.startDate)&&n[0].ganttProperties.endDate<=this.timelineStartDate&&(s=new Date(Math.min(e[0][0].ganttProperties.endDate.getTime(),s.getTime())),this.performTimeSpanAction("prevTimeSpan",t,s,r));break}},a.prototype.performTimeSpanAction=function(e,t,i,n,a){a=oe.isNullOrUndefined(a)?"None"===this.parent.timelineModule.topTier?this.parent.timelineModule.bottomTier:this.parent.timelineModule.topTier:a;var r=new Date(this.parent.cloneProjectStartDate.getTime()),s=new Date(this.parent.cloneProjectEndDate.getTime()),a=("publicMethod"!==t&&"both"===e?(this.updateScheduleDatesByToolBar(a,"prevTimeSpan",i,n),this.updateScheduleDatesByToolBar(a,"nextTimeSpan",new Date(this.parent.cloneProjectStartDate.getTime()),n)):this.updateScheduleDatesByToolBar(a,e,i,n),this.timeSpanActionEvent("actionBegin",e,t));a.cancel?(this.parent.cloneProjectStartDate=r,this.parent.cloneProjectEndDate=s):(this.restrictRender=!0,this.performedTimeSpanAction=!0,i=this.parent.ganttChartModule.scrollElement.scrollLeft,this.parent.updateProjectDates(a.projectStartDate,a.ProjectEndDate,a.isTimelineRoundOff,t),"prevTimeSpan"===e&&"publicMethod"===t?(this.parent.ganttChartModule.updateScrollLeft(0),this.parent.timelineModule.isZoomToFit=!1):"nextTimeSpan"===e&&"publicMethod"===t?(this.parent.ganttChartModule.updateScrollLeft(this.parent.enableTimelineVirtualization?this.wholeTimelineWidth:this.totalTimelineWidth),this.parent.timelineModule.isZoomToFit=!1):"nextTimeSpan"===e&&"TaskbarEditing"===t&&(n=document.getElementsByClassName("e-chart-scroll-container e-content")[0].scrollLeft,this.parent.element.querySelector(".e-timeline-header-container").scrollLeft=n,this.parent.timelineModule.isZoomToFit=!1),"TaskbarEditing"===t&&this.parent.enableTimelineVirtualization&&(this.wholeTimelineWidth>3*this.parent.element.offsetWidth||oe.isNullOrUndefined(this.parent.projectStartDate)&&oe.isNullOrUndefined(this.parent.projectEndDate))&&(this.parent.ganttChartModule.scrollObject.setScrollLeft(i),this.parent.ganttChartModule.scrollObject.updateContent()),this.parent.timelineModule.timeSpanActionEvent("actionComplete",e,t))},a.prototype.timeSpanActionEvent=function(e,t,i){var n={};return n.projectStartDate=new Date(this.parent.cloneProjectStartDate.getTime()),n.ProjectEndDate=new Date(this.parent.cloneProjectEndDate.getTime()),n.requestType="publicMethod"===i?t:"beforeAdd"===i?"TimelineRefreshOnAdd":"TaskbarEditing"===i?"TimelineRefreshOnEdit":t,"actionBegin"===e&&(n.isTimelineRoundOff=this.parent.isTimelineRoundOff,n.cancel=!1),n.action="TimescaleUpdate",this.parent.trigger(e,n),n},a);function a(e){this.isZoomIn=!1,this.isZooming=!1,this.isZoomToFit=!1,this.topTierCollection=[],this.bottomTierCollection=[],this.pdfExportTopTierCollection=[],this.pdfExportBottomTierCollection=[],this.restrictRender=!0,this.applyDstHour=!1,this.performedTimeSpanAction=!1,this.dstIncreaseHour=!1,this.fromDummyDate=!1,this.isZoomedToFit=!1,this.isZoomingAction=!1,this.increaseIteration=!1,this.isFirstLoop=!1,this.inconsistenceDstApplied=!1,this.parent=e,this.initProperties()}var Rt=function(e){this.allowEditing=!0,this.allowReordering=!0,this.allowResizing=!0,this.allowSorting=!0,this.allowFiltering=!0,this.edit={},oe.merge(this,e)},Mt=(r.prototype.addEventListener=function(){this.parent.on("renderPanels",this.createContainer,this),this.parent.on("chartScroll",this.updateScrollTop,this),this.parent.on("destroy",this.destroy,this),this.parent.treeGrid.on("renderReactTemplate",this.renderReactTemplate,this)},r.prototype.renderReactTemplate=function(e){for(var t="portals",i=0,n=e;i<n.length;i++){var a=n[i];-1===this.parent[t].indexOf(a)&&this.parent[t].push(a)}this.parent.renderTemplates()},r.prototype.createContainer=function(){this.treeGridElement=oe.createElement("div",{id:"treeGrid"+this.parent.element.id,className:"e-gantt-tree-grid"});var e=oe.createElement("div",{className:"e-gantt-temp-header"});this.parent.treeGridPane.appendChild(this.treeGridElement),this.treeGridElement.appendChild(e),this.parent.treeGridPane.classList.add("e-temp-content")},r.prototype.renderTreeGrid=function(){this.composeProperties(),this.bindEvents();var e="root";this.parent.treeGrid[e]=this.parent[e]||this.parent,oe.setValue("registeredTemplate",this.registeredTemplate,this.parent.treeGrid);oe.setValue("viewContainerRef",this.parent.viewContainerRef,this.parent.treeGrid),this.treeGridElement.contains(this.parent.treeGrid.element)||this.parent.treeGrid.appendTo(this.treeGridElement),this.parent.treeGrid.grid&&this.parent.toolbarModule&&this.parent.isReact&&(this.parent.treeGrid.grid.portals=this.parent.portals),this.wireEvents()},r.prototype.composeProperties=function(){var e;this.parent.treeGrid.enableAdaptiveUI=this.parent.enableAdaptiveUI,this.parent.treeGrid.hasChildMapping=this.parent.taskFields.hasChildMapping,this.parent.treeGrid.query=this.parent.query,this.parent.treeGrid.loadChildOnDemand=this.parent.loadChildOnDemand,this.parent.treeGrid.isFromGantt=!0,this.parent.treeGrid.parentIdMapping=this.parent.taskFields.parentID,this.parent.taskFields.parentID&&(this.parent.treeGrid.idMapping=this.parent.taskFields.id),this.parent.treeGrid.showColumnMenu=this.parent.showColumnMenu,this.parent.treeGrid.enableCollapseAll=this.parent.collapseAllParentTasks,this.parent.treeGrid.columnMenuItems=this.parent.columnMenuItems,this.parent.treeGrid.enableRtl=this.parent.enableRtl,this.parent.treeGrid.childMapping=oe.isNullOrUndefined(this.parent.taskFields.child)?"":this.parent.taskFields.child,this.parent.treeGrid.treeColumnIndex=this.parent.treeColumnIndex,this.parent.treeGrid.columns=this.treeGridColumns,this.parent.treeGrid.loadingIndicator=this.parent.loadingIndicator,this.parent.treeGrid.enableVirtualMaskRow=this.parent.enableVirtualMaskRow,this.parent.dataSource instanceof Object&&j(this.parent)?(this.parent.treeGrid.hasChildMapping="isParent",e=oe.getValue("count",this.parent.dataSource),this.parent.treeGrid.dataSource={result:this.parent.flatData,count:e}):this.parent.treeGrid.loadChildOnDemand&&this.parent.taskFields.hasChildMapping?this.parent.treeGrid.dataSource=this.parent.dataSource:(this.parent.treeGrid.hasChildMapping=null,this.parent.treeGrid.dataSource=this.parent.flatData),this.parent.treeGrid.expandStateMapping=this.parent.taskFields.expandState,this.parent.treeGrid.isGantt=!0,this.parent.treeGrid.rowHeight=this.parent.rowHeight,this.parent.treeGrid.gridLines=this.parent.gridLines,0===this.parent.searchSettings.fields.length&&""===this.parent.searchSettings.key||(this.parent.treeGrid.searchSettings=this.parent.searchSettings);this.parent.treeGrid.isJsComponent=!0,this.parent.treeGrid.height=this.parent.element.getElementsByClassName("e-chart-scroll-container e-content")[0].offsetHeight-(0===this.parent.flatData.length?0:19)},r.prototype.getContentDiv=function(){return this.treeGridElement.querySelector(".e-content")},r.prototype.getHeaderDiv=function(){return this.treeGridElement.querySelector(".e-headercontent")},r.prototype.getScrollbarWidth=function(){var e=document.createElement("div"),t=(e.style.visibility="hidden",e.style.overflow="scroll",e.style.msOverflowStyle="scrollbar",document.createElement("div")),t=(e.appendChild(t),this.parent.element.appendChild(e),e.offsetWidth-t.offsetWidth);return e.parentNode.removeChild(e),t},r.prototype.ensureScrollBar=function(){var e=this.getContentDiv(),t=this.getHeaderDiv(),i=this.getScrollbarWidth(),n=/Android|Mac|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);0!==i||navigator.userAgent.includes("Firefox")?e.style.cssText+="width: calc(100% + "+(i+1)+"px);":e.classList.add("e-gantt-scroll-padding"),0===i&&n&&(t.style.cssText+="width: calc(100% + 17px);")},r.prototype.bindEvents=function(){this.parent.treeGrid.dataBound=this.dataBound.bind(this),this.parent.treeGrid.collapsing=this.collapsing.bind(this),this.parent.treeGrid.collapsed=this.collapsed.bind(this),this.parent.treeGrid.expanding=this.expanding.bind(this),this.parent.treeGrid.expanded=this.expanded.bind(this),this.parent.treeGrid.actionBegin=this.actionBegin.bind(this),this.parent.treeGrid.actionComplete=this.treeActionComplete.bind(this),this.parent.treeGrid.created=this.created.bind(this),this.parent.treeGrid.actionFailure=this.actionFailure.bind(this),this.parent.treeGrid.headerCellInfo=this.headerCellInfo.bind(this),this.parent.treeGrid.rowDataBound=this.rowDataBound.bind(this),this.parent.treeGrid.columnMenuOpen=this.columnMenuOpen.bind(this),this.parent.treeGrid.columnMenuClick=this.columnMenuClick.bind(this),this.parent.treeGrid.beforeDataBound=this.beforeDataBound.bind(this),this.parent.treeGrid.dataStateChange=this.dataStateChange.bind(this),null!=this.parent.queryCellInfo&&(this.parent.treeGrid.queryCellInfo=this.queryCellInfo.bind(this))},r.prototype.beforeDataBound=function(e){!oe.isNullOrUndefined(this.parent.selectionModule)&&this.parent.selectionSettings&&this.parent.selectionSettings.persistSelection&&0<this.parent.selectionModule.getSelectedRowIndexes().length&&"sorting"===e.actionArgs.requestType&&(this.isPersist=!0),this.parent.updatedRecords=this.parent.virtualScrollModule&&this.parent.enableVirtualization?oe.getValue("virtualScrollModule.visualData",this.parent.treeGrid):oe.getValue("result",e),this.parent.virtualScrollModule&&this.parent.enableVirtualization&&this.parent.updateContentHeight(e),oe.setValue("contentModule.objectEqualityChecker",this.objectEqualityChecker,this.parent.treeGrid.grid)},r.prototype.dataBound=function(e){this.parent.isReact&&this.parent.clearTemplate(["TaskbarTemplate","ParentTaskbarTemplate","MilestoneTemplate","TaskLabelTemplate","RightLabelTemplate","LeftLabelTemplate"]),this.ensureScrollBar(),this.parent.treeDataBound(e),this.parent.isVirtualScroll&&((this.parent.enableVirtualMaskRow&&this.parent.enableVirtualization||this.parent.enableVirtualization&&!this.parent.enableVirtualMaskRow&&"Shimmer"===this.parent.loadingIndicator.indicatorType||"Shimmer"===this.parent.loadingIndicator.indicatorType)&&this.parent.hideMaskRow(),this.parent.editModule&&this.parent.editModule.cellEditModule&&(this.parent.editModule.cellEditModule.isCellEdit=!1),this.parent.isVirtualScroll=!1,oe.isNullOrUndefined(this.parent.selectionModule)||oe.isNullOrUndefined(this.parent.toolbarModule)||this.parent.toolbarModule.refreshToolbarItems()),this.prevCurrentView=oe.extend([],[],this.parent.currentViewData,!0)},r.prototype.dataStateChange=function(e){e.action&&"refresh"===e.action.requestType&&(this.parent.treeGrid.dataSource={result:oe.getValue("result",this.parent.treeGrid.dataSource),count:oe.getValue("count",this.parent.treeGrid.dataSource)}),this.parent.trigger("dataStateChange",e)},r.prototype.collapsing=function(e){var t,i=oe.getValue("data",e),n=i.length;if(!this.parent.ganttChartModule.isExpandCollapseFromChart){if(oe.isNullOrUndefined(n))t=this.createExpandCollapseArgs(e,null),this.parent.ganttChartModule.collapseGanttRow(t);else for(var a=0;a<n;a++)t=this.createExpandCollapseArgs(e,i[a]),this.parent.ganttChartModule.collapseGanttRow(t);oe.setValue("cancel",oe.getValue("cancel",t),e)}},r.prototype.expanding=function(e){var t,i=oe.getValue("data",e),n=i.length;if(!this.parent.ganttChartModule.isExpandCollapseFromChart){if(oe.isNullOrUndefined(n))t=this.createExpandCollapseArgs(e,null),this.parent.ganttChartModule.expandGanttRow(t);else for(var a=0;a<n;a++)t=this.createExpandCollapseArgs(e,i[a]),this.parent.ganttChartModule.expandGanttRow(t);oe.setValue("cancel",oe.getValue("cancel",t),e)}},r.prototype.collapsed=function(e){var t=e.data,t=t&&t.expanded;if(this.parent.loadChildOnDemand&&this.parent.taskFields.hasChildMapping&&!this.parent.enableVirtualization&&!t&&(e.data[this.parent.taskFields.expandState]=!1),!this.parent.ganttChartModule.isExpandCollapseFromChart&&!this.parent.isExpandCollapseLevelMethod){var i=void 0,n=oe.getValue("data",e),a=n.length;if(oe.isNullOrUndefined(a))i=this.createExpandCollapseArgs(e,null),this.parent.ganttChartModule.collapsedGanttRow(i);else for(var r=0;r<a;r++)i=this.createExpandCollapseArgs(e,n[r]),this.parent.ganttChartModule.collapsedGanttRow(i);this.parent.ganttChartModule.isCollapseAll||!i.gridRow||this.parent.allowTaskbarOverlap||(i.gridRow.style.height=i.chartRow.style.height,this.parent.contentHeight=(this.parent.enableRtl?this.parent.element.getElementsByClassName("e-content")[2]:this.parent.element.getElementsByClassName("e-content")[0]).children[0].offsetHeight,document.getElementsByClassName("e-chart-rows-container")[0].style.height=this.parent.contentHeight+"px")}oe.isNullOrUndefined(this.parent.loadingIndicator)||"Shimmer"!==this.parent.loadingIndicator.indicatorType?this.parent.hideSpinner():this.parent.hideMaskRow(),this.parent.trigger("collapsed",e)},r.prototype.expanded=function(e){if(!this.parent.ganttChartModule.isExpandCollapseFromChart&&!this.parent.isExpandCollapseLevelMethod){var t=void 0,i=oe.getValue("data",e),n=i.length;if(oe.isNullOrUndefined(n))t=this.createExpandCollapseArgs(e,null),this.parent.ganttChartModule.expandedGanttRow(t);else for(var a=0;a<n;a++)t=this.createExpandCollapseArgs(e,i[a]),this.parent.ganttChartModule.expandedGanttRow(t);this.parent.ganttChartModule.isExpandAll||!e.row||this.parent.allowTaskbarOverlap||(e.row.style.height=this.parent.rowHeight+"px",this.parent.contentHeight=(this.parent.enableRtl?this.parent.element.getElementsByClassName("e-content")[2]:this.parent.element.getElementsByClassName("e-content")[0]).children[0].offsetHeight,document.getElementsByClassName("e-chart-rows-container")[0].style.height=this.parent.contentHeight+"px")}oe.isNullOrUndefined(this.parent.loadingIndicator)||"Shimmer"!==this.parent.loadingIndicator.indicatorType?this.parent.hideSpinner():this.parent.hideMaskRow(),this.parent.isCollapseAll=!1,this.parent.trigger("expanded",e)},r.prototype.actionBegin=function(e){var t;!this.parent.undoRedoModule||"filtering"!==e.requestType&&"searching"!==e.requestType&&"sorting"!==e.requestType&&"filterAfterOpen"!==e.requestType||(this.parent.undoRedoModule.canUpdateIndex=!1),"filterchoicerequest"===e.requestType&&(t=oe.getValue("filterModel.dlg",e))&&(t.style.display="none"),this.parent.notify("actionBegin",e),null!==oe.getValue("doubleClickTarget",this.parent.treeGrid.editModule)&&oe.setValue("doubleClickTarget",null,this.parent.treeGrid.editModule),this.parent.trigger("actionBegin",e),"virtualscroll"===e.requestType||"edit"===e.type||"beginEdit"===e.requestType||e.cancel||(oe.isNullOrUndefined(this.parent.loadingIndicator)||"Shimmer"!==this.parent.loadingIndicator.indicatorType?this.parent.showSpinner():this.parent.showMaskRow())},r.prototype.created=function(e){this.updateKeyConfigSettings()},r.prototype.actionFailure=function(e){this.parent.trigger("actionFailure",e)},r.prototype.createExpandCollapseArgs=function(e,t){var i=oe.getValue("data",e).length;return oe.isNullOrUndefined(i)?{data:i=oe.getValue("data",e),gridRow:oe.getValue("row",e),chartRow:this.parent.ganttChartModule.getChartRows()[this.parent.currentViewData.indexOf(i)],cancel:!1}:{data:t,gridRow:oe.getValue("row",e),chartRow:this.parent.ganttChartModule.getChartRows()[this.parent.currentViewData.indexOf(t)],cancel:!1}},r.prototype.treeActionComplete=function(e){var t,i,n,a,r=this,s=oe.extend({},e);if("reorder"===oe.getValue("requestType",e)&&this.parent.undoRedoModule&&!this.parent.undoRedoModule.isFromUndoRedo&&this.parent.isUndoRedoItemPresent("ColumnReorder")&&(this.parent.undoRedoModule.redoEnabled&&this.parent.undoRedoModule.disableRedo(),this.parent.undoRedoModule.createUndoCollection(),(a={action:"ColumnReorder"}).fromIndex=oe.extend([],[],[e.fromIndex],!0)[0],a.toIndex=oe.extend([],[],[e.toIndex],!0)[0],a.toColumn=oe.extend([],[],[this.parent.treeGrid.columns[e.toIndex].field],!0)[0],a.fromColumn=oe.extend([],[],[this.parent.treeGrid.columns[e.fromIndex].field],!0)[0],this.parent.undoRedoModule.getUndoCollection[this.parent.undoRedoModule.getUndoCollection.length-1]=a),"columnstate"===oe.getValue("requestType",e)&&this.parent.undoRedoModule&&!this.parent.undoRedoModule.isFromUndoRedo&&this.parent.isUndoRedoItemPresent("ColumnState")&&(this.parent.undoRedoModule.redoEnabled&&this.parent.undoRedoModule.disableRedo(),this.parent.undoRedoModule.createUndoCollection(),(a={action:"ColumnState"}).showhideColumns=oe.extend([],[],e.columns,!0),this.parent.undoRedoModule.getUndoCollection[this.parent.undoRedoModule.getUndoCollection.length-1]=a),"sorting"===oe.getValue("requestType",e)?(this.parent.undoRedoModule&&this.parent.isUndoRedoItemPresent("Sorting")&&(this.parent.undoRedoModule.currentAction&&this.parent.undoRedoModule.currentAction.sortColumns&&1<this.parent.undoRedoModule.currentAction.sortColumns.length&&this.parent.undoRedoModule.sortedColumnsLength++,this.parent.undoRedoModule.currentAction&&(!this.parent.undoRedoModule.currentAction.sortColumns||this.parent.undoRedoModule.sortedColumnsLength===this.parent.undoRedoModule.currentAction.sortColumns.length)||this.parent.undoRedoModule.isFromUndoRedo||(this.parent.undoRedoModule.redoEnabled&&this.parent.undoRedoModule.disableRedo(),this.parent.undoRedoModule.createUndoCollection(),(a={action:"Sorting",sortColumns:[]}).sortColumns=this.parent.undoRedoModule.previousSortedColumns,this.parent.undoRedoModule.getUndoCollection[this.parent.undoRedoModule.getUndoCollection.length-1]=a),this.parent.undoRedoModule.previousSortedColumns=this.parent.treeGrid.sortSettings.columns),this.parent.notify("updateModel",{}),oe.deleteObject(s,"isFrozen")):"filtering"===oe.getValue("requestType",e)?(this.parent.undoRedoModule&&!this.parent.undoRedoModule.isFromUndoRedo&&this.parent.isUndoRedoItemPresent("Filtering")&&(this.parent.undoRedoModule.redoEnabled&&this.parent.undoRedoModule.disableRedo(),this.parent.undoRedoModule.createUndoCollection(),(a={action:"Filtering"}).filteredColumns=oe.extend([],[],e.columns,!0),this.parent.undoRedoModule.getUndoCollection[this.parent.undoRedoModule.getUndoCollection.length-1]=a),this.parent.notify("updateModel",{})):"save"===oe.getValue("type",e)&&this.parent.editModule&&this.parent.editModule.cellEditModule&&(i=oe.getValue("data",e),oe.isNullOrUndefined(i)||oe.isNullOrUndefined(this.parent.getTaskByUniqueID(i.uniqueID))||(this.parent.getTaskByUniqueID(i.uniqueID).taskData[this.parent.taskFields.duration]=i.taskData[this.parent.taskFields.duration],oe.isNullOrUndefined(i.taskData[this.parent.taskFields.resourceInfo]))||(this.parent.getTaskByUniqueID(i.uniqueID).taskData[this.parent.taskFields.resourceInfo]=i.taskData[this.parent.taskFields.resourceInfo]),z(this.currentEditRow)&&e.column&&e.column.edit&&e.column.field===this.parent.taskFields.resourceInfo&&(n=this.parent.taskFields.resourceInfo,this.currentEditRow=((t={})[n]=i.resources,t)),this.parent.editModule.cellEditModule.initiateCellEdit(e,this.currentEditRow),this.parent.editModule.cellEditModule.isCellEdit=!1,this.currentEditRow={}),"filterAfterOpen"===oe.getValue("requestType",e)&&this.parent.notify("actionComplete",e),"searching"===oe.getValue("requestType",e)&&(this.parent.undoRedoModule&&this.parent.isUndoRedoItemPresent("Search")&&(this.parent.undoRedoModule.isFromUndoRedo||(this.parent.undoRedoModule.redoEnabled&&this.parent.undoRedoModule.disableRedo(),this.parent.undoRedoModule.createUndoCollection(),(a={action:"Search"}).searchString=this.parent.undoRedoModule.searchString,this.parent.undoRedoModule.getUndoCollection[this.parent.undoRedoModule.getUndoCollection.length-1]=a),this.parent.undoRedoModule.searchString=this.parent.treeGrid.searchSettings.key),this.parent.notify("actionComplete",e)),oe.isNullOrUndefined(this.parent.toolbarModule)||oe.isNullOrUndefined(oe.getValue("batchChanges",e))||this.parent.toolbarModule.refreshToolbarItems(),this.parent.isCancelled&&(oe.setValue("requestType","cancel",s),oe.setValue("action","CellEditing",s),this.parent.isCancelled=!1),"refresh"===oe.getValue("requestType",e)&&oe.isNullOrUndefined(oe.getValue("type",e))&&this.parent.addDeleteRecord){if(-1!==this.parent.selectedRowIndex)if(!oe.isNullOrUndefined(this.parent.selectionModule)&&this.parent.selectionSettings&&this.parent.selectionSettings.persistSelection&&this.parent.editModule.isAdded){var o=this.parent.selectionModule.selectedRowIndexes;if(1<o.length&&this.parent.selectionSettings.persistSelection)for(var l=0;l<o.length;l++){var d=this.parent.flatData[o[l].toString()];this.parent.selectRows(d)}}else this.parent.selectRow(this.parent.selectedRowIndex),this.parent.selectedRowIndex>this.parent.currentViewData.length-1&&(this.parent.selectedRowIndex=-1);else{if(!oe.isNullOrUndefined(this.parent.selectionModule)&&this.parent.selectionSettings&&this.parent.selectionSettings.persistSelection&&this.parent.editModule&&!this.parent.editModule.isAdded)for(var h=this.parent.selectionModule.getSelectedRecords(),p=this,l=h.length-1;0<=l;l--)!function(e){var t=h[e][p.parent.taskFields.id];p.parent.editModule.deletedRecord.some(function(e){return e.ganttProperties.taskId===t})&&h.splice(e,1)}(l);var u=0;(this.parent.enableVirtualization?this.parent.flatData:this.parent.currentViewData).map(function(e,t){oe.isNullOrUndefined(r.parent.currentSelection)||e.ganttProperties.taskId!==r.parent.currentSelection[r.parent.taskFields.id]||("ResourceView"!==r.parent.viewType||e.ganttProperties.rowUniqueID!==r.parent.currentSelection.rowUniqueID)&&"ResourceView"===r.parent.viewType||(u=t)}),this.addedRecord=!0,this.parent.selectRow(oe.isNullOrUndefined(u)?0:u)}this.parent.isExpandPerformed||(this.parent.addDeleteRecord=!1),this.parent.isExpandPerformed=!1}if(this.parent.undoRedoModule&&(this.parent.undoRedoModule.isFromUndoRedo=!1),"refresh"===oe.getValue("requestType",e)&&this.parent.initiateEditAction(!1),this.parent.trigger("actionComplete",s),this.parent.showOverAllocation&&!this.parent.allowTaskbarOverlap){for(l=0;l<this.parent.currentViewData.length;l++)this.parent.currentViewData[l].hasChildRecords&&!this.parent.currentViewData[l].expanded&&this.parent.chartRowsModule.updateDragDropRecords(this.parent.currentViewData[l]);this.parent.ganttChartModule.renderRangeContainer(this.parent.currentViewData)}oe.isNullOrUndefined(this.parent.loadingIndicator)||"Shimmer"!==this.parent.loadingIndicator.indicatorType?this.parent.hideSpinner():this.parent.hideMaskRow()},r.prototype.updateKeyConfigSettings=function(){delete this.parent.treeGrid.grid.keyboardModule.keyConfigs.delete,delete this.parent.treeGrid.grid.keyboardModule.keyConfigs.insert,delete this.parent.treeGrid.grid.keyboardModule.keyConfigs.upArrow,delete this.parent.treeGrid.grid.keyboardModule.keyConfigs.downArrow,delete this.parent.treeGrid.grid.keyboardModule.keyConfigs.ctrlHome,delete this.parent.treeGrid.grid.keyboardModule.keyConfigs.ctrlEnd,delete this.parent.treeGrid.grid.keyboardModule.keyConfigs.enter,delete this.parent.treeGrid.grid.keyboardModule.keyConfigs.tab,delete this.parent.treeGrid.grid.keyboardModule.keyConfigs.shiftTab,delete this.parent.treeGrid.keyboardModule.keyConfigs.enter,delete this.parent.treeGrid.keyboardModule.keyConfigs.upArrow,delete this.parent.treeGrid.keyboardModule.keyConfigs.downArrow,delete this.parent.treeGrid.keyboardModule.keyConfigs.ctrlShiftUpArrow,delete this.parent.treeGrid.keyboardModule.keyConfigs.ctrlShiftDownArrow,delete this.parent.treeGrid.keyboardModule.keyConfigs.ctrlUpArrow,delete this.parent.treeGrid.keyboardModule.keyConfigs.ctrlDownArrow,delete this.parent.treeGrid.keyboardModule.keyConfigs.tab,delete this.parent.treeGrid.keyboardModule.keyConfigs.shiftTab},r.prototype.wireEvents=function(){var e=this.parent.treeGrid.element.querySelector(".e-content");e&&oe.EventHandler.add(e,"scroll",this.scrollHandler,this),this.parent.isAdaptive&&oe.EventHandler.add(this.parent.treeGridPane,"click",this.treeGridClickHandler,this)},r.prototype.unWireEvents=function(){var e=this.parent.treeGrid.element&&this.parent.treeGrid.element.querySelector(".e-content");e&&oe.EventHandler.remove(e,"scroll",this.scrollHandler),this.parent.isAdaptive&&oe.EventHandler.remove(this.parent.treeGridPane,"click",this.treeGridClickHandler)},r.prototype.scrollHandler=function(e){var t=this.parent.treeGrid.element.querySelector(".e-content");t.scrollTop!==this.previousScroll.top&&this.parent.notify("grid-scroll",{top:t.scrollTop}),this.previousScroll.top=t.scrollTop,this.parent.contextMenuModule&&this.parent.contextMenuModule.isOpen&&this.parent.contextMenuModule.contextMenu.close()},r.prototype.validateGanttColumns=function(){for(var n=this.parent,e=n.columns.length,a=this.parent.taskFields,r=(this.parent.columnMapping={},this.parent.columnByField={},this.parent.customColumns=[],["id","name","startDate","endDate","duration","dependency","progress","baselineStartDate","baselineEndDate","resourceInfo","notes","work","manual","type","milestone","segments"]),s=this,t=0;t<e;t++)!function(e){var t={},e=("string"==typeof n.columns[e]?t.field=n.columns[e]:t=n.columns[e],[]);if(0===(e=0<r.length?r.filter(function(e){return t.field===a[e]}):e).length)return t.field!==s.parent.resourceFields.group&&(s.parent.customColumns.push(t.field),t.headerText=t.headerText||t.field,t.width=t.width||150,t.editType=t.editType||"stringedit",t.type=t.type||"string","checkbox"===t.type&&(s.parent.selectionSettings.type="Multiple"),s.bindTreeGridColumnProperties(t,!0));var i=r.indexOf(e[0]);r.splice(i,1),s.createTreeGridColumn(t,!0),s.parent.columnMapping[e[0]]=t.field}(t);for(var i=0;i<r.length;i++){var o={};oe.isNullOrUndefined(a[r[i]])||(o.field=a[r[i]],this.createTreeGridColumn(o,0===e),this.parent.columnMapping[r[i]]=o.field)}"ProjectView"!==this.parent.viewType&&(this.composeUniqueIDColumn(o={}),this.createTreeGridColumn(o,!0))},r.prototype.createTreeGridColumn=function(t,e){var i,n=this,a=this.parent.taskFields,r=this.parent.previousGanttColumns.filter(function(e){return t.field===e.field})[0];t.disableHtmlEncode=(oe.isNullOrUndefined(t.disableHtmlEncode)?this.parent:t).disableHtmlEncode,a.id!==t.field&&(t.clipMode=t.clipMode||"EllipsisWithTooltip"),a.id===t.field?this.composeIDColumn(t):a.name===t.field?(this.parent.isLocaleChanged&&r?t.headerText=r.headerText||this.parent.localeObj.getConstant("name"):t.headerText=t.headerText||this.parent.localeObj.getConstant("name"),t.width=t.width||150,t.editType=t.editType||"stringedit",t.type=t.type||"string"):a.startDate===t.field?(this.parent.isLocaleChanged&&r?t.headerText=r.headerText||this.parent.localeObj.getConstant("startDate"):t.headerText=t.headerText||this.parent.localeObj.getConstant("startDate"),t.editType=t.editType||(-1!==this.parent.getDateFormat().toLowerCase().indexOf("hh")?"datetimepickeredit":"datepickeredit"),t.format=t.format||{type:"date",format:this.parent.getDateFormat()},t.width=t.width||150,t.edit&&t.edit.params?t.edit.params.renderDayCell=this.parent.renderWorkingDayCell.bind(this.parent):t.edit?t.edit.params={renderDayCell:this.parent.renderWorkingDayCell.bind(this.parent)}:t.edit={params:{renderDayCell:this.parent.renderWorkingDayCell.bind(this.parent)}}):a.endDate===t.field?(this.parent.isLocaleChanged&&r?t.headerText=r.headerText||this.parent.localeObj.getConstant("endDate"):t.headerText=t.headerText||this.parent.localeObj.getConstant("endDate"),t.format=t.format||{type:"date",format:this.parent.getDateFormat()},t.editType=t.editType||(-1!==this.parent.getDateFormat().toLowerCase().indexOf("hh")?"datetimepickeredit":"datepickeredit"),t.width=t.width||150,t.edit&&t.edit.params?t.edit.params.renderDayCell=this.parent.renderWorkingDayCell.bind(this.parent):t.edit?t.edit.params={renderDayCell:this.parent.renderWorkingDayCell.bind(this.parent)}:t.edit={params:{renderDayCell:this.parent.renderWorkingDayCell.bind(this.parent)}}):a.duration===t.field?(t.width=t.width||150,this.parent.isLocaleChanged&&r?t.headerText=r.headerText||this.parent.localeObj.getConstant("duration"):t.headerText=t.headerText||this.parent.localeObj.getConstant("duration"),t.valueAccessor=t.valueAccessor||(oe.isNullOrUndefined(t.edit)||oe.isNullOrUndefined(t.edit.read)?this.durationValueAccessor.bind(this):null),t.editType=t.editType||"stringedit",t.type=t.type||"string"):a.progress===t.field?this.composeProgressColumn(t):a.dependency===t.field?(this.parent.isLocaleChanged&&r?t.headerText=r.headerText||this.parent.localeObj.getConstant("dependency"):t.headerText=t.headerText||this.parent.localeObj.getConstant("dependency"),t.width=t.width||150,t.editType=t.editType||"stringedit",t.type="string",t.allowFiltering=!1!==t.allowFiltering,t.valueAccessor=t.valueAccessor||this.dependencyValueAccessor.bind(this),oe.isNullOrUndefined(t.filter)&&"en-US"!==this.parent.locale&&(t.filter={ui:{create:function(e){var t=oe.createElement("input",{className:"flm-input"});e.target.appendChild(t),n.dropInstance=new F.AutoComplete({dataSource:n.changeLocale(n.parent.treeGrid.grid.dataSource),fields:{text:n.parent.taskFields.dependency,value:n.parent.taskFields.dependency},placeholder:n.parent.localeObj.getConstant("enterValue"),popupHeight:"200px"}),n.dropInstance.appendTo(t)},write:function(e){n.dropInstance.value=e.filteredValue},read:function(e){e.fltrObj.filterByColumn(e.column.field,e.operator,n.changeDelocale(n.dropInstance.value))}}})):a.resourceInfo===t.field?this.composeResourceColumn(t):a.notes===t.field?(r&&this.parent.isLocaleChanged?t.headerText=r.headerText||this.parent.localeObj.getConstant("notes"):t.headerText=t.headerText||this.parent.localeObj.getConstant("notes"),t.width=t.width||150,t.editType=t.editType||"stringedit",this.parent.showInlineNotes||t.template||(t.template=oe.initializeCSPTemplate(function(){return'<div class="e-ganttnotes-info">\n                            <span class="e-icons e-notes-info"></span>\n                        </div>'}))):a.baselineStartDate===t.field||a.baselineEndDate===t.field?(i=a.baselineEndDate===t.field?"baselineEndDate":"baselineStartDate",t.width=t.width||150,this.parent.isLocaleChanged&&r?t.headerText=r.headerText||this.parent.localeObj.getConstant(i):t.headerText=t.headerText||this.parent.localeObj.getConstant(i),t.format=t.format||{type:"date",format:this.parent.getDateFormat()},t.editType=t.editType||(-1!==this.parent.getDateFormat().toLowerCase().indexOf("hh")?"datetimepickeredit":"datepickeredit")):a.work===t.field?(r&&this.parent.isLocaleChanged?t.headerText=r.headerText||this.parent.localeObj.getConstant("work"):t.headerText=t.headerText||this.parent.localeObj.getConstant("work"),t.width=t.width||150,t.valueAccessor=t.valueAccessor||this.workValueAccessor.bind(this),t.editType=t.editType||"numericedit"):a.type===t.field?(r&&this.parent.isLocaleChanged?t.headerText=r.headerText||this.parent.localeObj.getConstant("taskType"):t.headerText=t.headerText||this.parent.localeObj.getConstant("taskType"),t.width=t.width||150,t.editType="dropdownedit",t.valueAccessor=t.valueAccessor||this.taskTypeValueAccessor.bind(this)):a.manual===t.field&&"Custom"===this.parent.taskMode&&(r&&this.parent.isLocaleChanged?t.headerText=r.headerText||this.parent.localeObj.getConstant("taskMode"):t.headerText=t.headerText||this.parent.localeObj.getConstant("taskMode"),t.width=t.width||120,t.editType=t.editType||"dropdownedit",t.valueAccessor=t.valueAccessor||this.modeValueAccessor.bind(this),t.edit={params:{query:new y.Query,dataSource:[{id:1,text:this.parent.localeObj.getConstant("manual"),value:!0},{id:2,text:this.parent.localeObj.getConstant("auto"),value:!1}],fields:{text:"text",value:"value"}}}),this.bindTreeGridColumnProperties(t,e)},r.prototype.changeLocale=function(e){var a=this,t=[];return e.map(function(e){return e.ganttProperties.predecessorsName}).map(function(e){var i,n;oe.isNullOrUndefined(e)||(i="",(n=e.split(",")).map(function(e,t){e.includes("FS")?i=(i+=e.replace("FS",a.parent.localeObj.getConstant("FS")))+(n.length!==t+1?",":""):e.includes("FF")?i=(i+=e.replace("FF",a.parent.localeObj.getConstant("FF")))+(n.length!==t+1?",":""):e.includes("SS")?i=(i+=e.replace("SS",a.parent.localeObj.getConstant("SS")))+(n.length!==t+1?",":""):e.includes("SF")&&(i=(i+=e.replace("SF",a.parent.localeObj.getConstant("SF")))+(n.length!==t+1?",":""))}),t.push(i))}),t},r.prototype.changeDelocale=function(e){var i,n,a=this.parent.localeObj.getConstant("FF"),r=this.parent.localeObj.getConstant("FS"),s=this.parent.localeObj.getConstant("SS"),o=this.parent.localeObj.getConstant("SF");return oe.isNullOrUndefined(e)?null:(i=e.split(","),n="",i.map(function(e,t){n=e.includes(a)?(n+=e.replace(a,"FF"))+(i.length!==t+1?",":""):e.includes(r)?(n+=e.replace(r,"FS"))+(i.length!==t+1?",":""):e.includes(s)?(n+=e.replace(s,"SS"))+(i.length!==t+1?",":""):e.includes(o)?(n+=e.replace(o,"SF"))+(i.length!==t+1?",":""):(n+=e)+(i.length!==t+1?",":"")}),n)},r.prototype.composeResourceColumn=function(t){var e=this.parent.previousGanttColumns.filter(function(e){return t.field===e.field})[0];e&&this.parent.isLocaleChanged?t.headerText=e.headerText||this.parent.localeObj.getConstant("resourceName"):t.headerText=t.headerText||this.parent.localeObj.getConstant("resourceName"),t.width=t.width||150,t.type="string",t.valueAccessor=t.valueAccessor||this.resourceValueAccessor.bind(this),t.allowFiltering=!1!==t.allowFiltering},r.prototype.getResourceIds=function(e){var t=oe.getValue(this.parent.taskFields.resourceInfo,e.taskData),i=[];if(oe.isNullOrUndefined(t))return t;for(var n=0;n<t.length;n++)i.push("object"==typeof t[n]?t[n][this.parent.resourceFields.id]:t[n]);return i},r.prototype.composeIDColumn=function(t){var e,i,n="ProjectView"===this.parent.viewType,a=this.parent.dataSource?this.parent.dataSource.length:0;t.isPrimaryKey=n,this.parent.isLocaleChanged?(i=this.parent.previousGanttColumns.filter(function(e){return t.field===e.field})[0])&&(t.headerText=i.headerText||this.parent.localeObj.getConstant("id")):t.headerText=t.headerText||this.parent.localeObj.getConstant("id"),t.width=t.width||100;for(var r=0;r<a;r++)if(!oe.isNullOrUndefined(this.parent.dataSource[r][this.parent.taskFields.id])){e=this.parent.dataSource[r][this.parent.taskFields.id];break}"string"==typeof e||oe.isNullOrUndefined(e)?("ResourceView"===this.parent.viewType?t.allowEditing=t.allowEditing||!1:t.allowEditing=t.allowEditing||!0,t.editType=t.editType||"stringedit"):(t.allowEditing=t.allowEditing||!1,t.editType=t.editType||"numericedit"),t.valueAccessor=n?null:this.idValueAccessor.bind(this)},r.prototype.composeUniqueIDColumn=function(e){e.field="rowUniqueID",e.isPrimaryKey=!0,e.headerText="UniqueID",e.allowEditing=!1,e.visible=!1},r.prototype.composeProgressColumn=function(t){var e=this.parent.previousGanttColumns.filter(function(e){return t.field===e.field})[0];this.parent.isLocaleChanged&&e?t.headerText=e.headerText||this.parent.localeObj.getConstant("progress"):t.headerText=t.headerText||this.parent.localeObj.getConstant("progress"),t.width=t.width||150,t.editType=t.editType||"numericedit"},r.prototype.bindTreeGridColumnProperties=function(e,t){for(var i={},n={},a=0,r=Object.keys(e);a<r.length;a++){var s=r[a];i[s]=n[s]=e[s]}this.parent.columnByField[n.field]=n,this.parent.ganttColumns.push(new Rt(n)),t&&this.treeGridColumns.push(i)},r.prototype.durationValueAccessor=function(e,t,i){return oe.isNullOrUndefined(t)||oe.isNullOrUndefined(t.ganttProperties)?this.parent.loadChildOnDemand&&this.parent.taskFields.hasChildMapping?this.parent.dataOperation.getDurationString(parseInt(t[this.parent.taskFields.duration],10),this.parent.durationUnit):"":(t=t.ganttProperties,this.parent.dataOperation.getDurationString(t.duration,t.durationUnit))},r.prototype.dependencyValueAccessor=function(e,t,i){var n,a,r=this;return t&&t.ganttProperties&&!oe.isNullOrUndefined(t.ganttProperties.predecessorsName)?(n="",(a=t.ganttProperties.predecessorsName.split(",")).map(function(e,t){e.includes("FS")?n=(n+=e.replace("FS",r.parent.localeObj.getConstant("FS")))+(a.length!==t+1?",":""):e.includes("FF")?n=(n+=e.replace("FF",r.parent.localeObj.getConstant("FF")))+(a.length!==t+1?",":""):e.includes("SS")?n=(n+=e.replace("SS",r.parent.localeObj.getConstant("SS")))+(a.length!==t+1?",":""):e.includes("SF")&&(n=(n+=e.replace("SF",r.parent.localeObj.getConstant("SF")))+(a.length!==t+1?",":""))}),n):""},r.prototype.resourceValueAccessor=function(e,t,i){t=t.ganttProperties;return oe.isNullOrUndefined(t)?"":t.resourceNames},r.prototype.workValueAccessor=function(e,t,i){t=t.ganttProperties;return oe.isNullOrUndefined(t)?"":this.parent.dataOperation.getWorkString(t.work,t.workUnit)},r.prototype.taskTypeValueAccessor=function(e,t,i){t=t.ganttProperties;return oe.isNullOrUndefined(t)?"":t.taskType},r.prototype.modeValueAccessor=function(e,t,i){return t[e]?"Manual":"Auto"},r.prototype.idValueAccessor=function(e,t,i){return 0===t.level?"R-"+t.ganttProperties.taskId:"T-"+t.ganttProperties.taskId},r.prototype.updateScrollTop=function(e){e=oe.getValue("top",e);this.treeGridElement.querySelector(".e-content").scrollTop=e,this.previousScroll.top=this.treeGridElement.querySelector(".e-content").scrollTop},r.prototype.treeGridClickHandler=function(e){this.parent.notify("treeGridClick",e)},r.prototype.removeEventListener=function(){this.parent.off("renderPanels",this.createContainer),this.parent.off("chartScroll",this.updateScrollTop),this.parent.off("destroy",this.destroy),this.parent.treeGrid.off("reactTemplateRender",this.renderReactTemplate)},r.prototype.destroy=function(){this.removeEventListener(),this.unWireEvents(),this.parent.treeGrid.element&&this.parent.treeGrid.destroy()},r);function r(e){var s=this;this.isPersist=!1,this.previousScroll={top:0,left:0},this.queryCellInfo=function(e){s.parent.trigger("queryCellInfo",e)},this.headerCellInfo=function(e){s.parent.trigger("headerCellInfo",e)},this.rowDataBound=function(e){s.parent.trigger("rowDataBound",e)},this.columnMenuOpen=function(e){s.parent.notify("columnMenuOpen",e),s.parent.trigger("columnMenuOpen",e),document.querySelector(".e-colmenu").addEventListener("mousemove",function(){var e=document.querySelector(".e-filter-popup"),t=document.querySelector(".e-filter-item");oe.isNullOrUndefined(e)||t.classList.contains("e-focused")||oe.remove(s.parent.filterModule.filterMenuElement)})},this.columnMenuClick=function(e){s.parent.trigger("columnMenuClick",e)},this.objectEqualityChecker=function(e,t){if(e){for(var i=Object.keys(e),n=!0,a=["Children","childRecords","taskData","uniqueID","parentItem","parentUniqueID","ganttProperties"],r=0;r<i.length;r++)if((e[i[parseInt(r.toString(),10)]]instanceof Date?new Date(e[i[parseInt(r.toString(),10)]]).getTime():e[i[parseInt(r.toString(),10)]])!==(t[i[parseInt(r.toString(),10)]]instanceof Date?new Date(t[i[parseInt(r.toString(),10)]]).getTime():t[i[parseInt(r.toString(),10)]])&&-1===a.indexOf(i[r])){s.parent.modifiedRecords.push(t),n=!1;break}return n}return!1},this.parent=e,this.parent.treeGrid=new T.TreeGrid,this.parent.treeGrid.allowSelection=!1,this.parent.treeGrid.allowKeyboard=this.parent.allowKeyboard,this.parent.treeGrid["${enableHtmlSanitizer}"]=this.parent.enableHtmlSanitizer,this.parent.treeGrid.enableImmutableMode=this.parent.enableImmutableMode,this.treeGridColumns=[],!this.parent.isLocaleChanged&&this.parent.isLoad&&(this.parent.previousGanttColumns=oe.extend([],[],this.parent.columns,!0)),this.validateGanttColumns(),this.parent.isLocaleChanged&&(this.parent.isLocaleChanged=!1),this.addEventListener()}xt=function(e,t){return(xt=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])}))(e,t)};var xt,Ot,It=function(e,t){function i(){this.constructor=e}xt(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},Et=function(e,t,i,n){var a,r=arguments.length,s=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var o=e.length-1;0<=o;o--)(a=e[o])&&(s=(r<3?a(s):3<r?a(t,i,s):a(t,i))||s);return 3<r&&s&&Object.defineProperty(t,i,s),s},It=(Ot=oe.ChildProperty,It(Ut,Ot),Et([oe.Property(null)],Ut.prototype,"from",void 0),Et([oe.Property(null)],Ut.prototype,"to",void 0),Ut);function Ut(){return null!==Ot&&Ot.apply(this,arguments)||this}Ft=function(e,t){return(Ft=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])}))(e,t)};var Ft,Nt,Et=function(e,t){function i(){this.constructor=e}Ft(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},Lt=function(e,t,i,n){var a,r=arguments.length,s=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var o=e.length-1;0<=o;o--)(a=e[o])&&(s=(r<3?a(s):3<r?a(t,i,s):a(t,i))||s);return 3<r&&s&&Object.defineProperty(t,i,s),s},Et=(Nt=oe.ChildProperty,Et(Vt,Nt),Lt([oe.Property(null)],Vt.prototype,"type",void 0),Lt([oe.Property(null)],Vt.prototype,"headerText",void 0),Lt([oe.Property([])],Vt.prototype,"fields",void 0),Lt([oe.Property({})],Vt.prototype,"additionalParams",void 0),Vt);function Vt(){return null!==Nt&&Nt.apply(this,arguments)||this}Bt=function(e,t){return(Bt=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])}))(e,t)};var Bt,At,Lt=function(e,t){function i(){this.constructor=e}Bt(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},Wt=function(e,t,i,n){var a,r=arguments.length,s=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var o=e.length-1;0<=o;o--)(a=e[o])&&(s=(r<3?a(s):3<r?a(t,i,s):a(t,i))||s);return 3<r&&s&&Object.defineProperty(t,i,s),s},Lt=(At=oe.ChildProperty,Lt(Ht,At),Wt([oe.Property(null)],Ht.prototype,"type",void 0),Wt([oe.Property(null)],Ht.prototype,"headerText",void 0),Wt([oe.Property([])],Ht.prototype,"fields",void 0),Wt([oe.Property({})],Ht.prototype,"additionalParams",void 0),Ht);function Ht(){return null!==At&&At.apply(this,arguments)||this}jt=function(e,t){return(jt=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])}))(e,t)};var jt,Gt,Wt=function(e,t){function i(){this.constructor=e}jt(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},zt=function(e,t,i,n){var a,r=arguments.length,s=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var o=e.length-1;0<=o;o--)(a=e[o])&&(s=(r<3?a(s):3<r?a(t,i,s):a(t,i))||s);return 3<r&&s&&Object.defineProperty(t,i,s),s},Wt=(Gt=oe.ChildProperty,Wt(qt,Gt),zt([oe.Property(!1)],qt.prototype,"allowEditing",void 0),zt([oe.Property(!1)],qt.prototype,"allowAdding",void 0),zt([oe.Property(!1)],qt.prototype,"allowDeleting",void 0),zt([oe.Property("Auto")],qt.prototype,"mode",void 0),zt([oe.Property("Top")],qt.prototype,"newRowPosition",void 0),zt([oe.Property(!1)],qt.prototype,"showDeleteConfirmDialog",void 0),zt([oe.Property(!1)],qt.prototype,"allowTaskbarEditing",void 0),zt([oe.Property(!1)],qt.prototype,"allowNextRowEdit",void 0),qt);function qt(){return null!==Gt&&Gt.apply(this,arguments)||this}_t=function(e,t){return(_t=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])}))(e,t)};var _t,Xt,zt=function(e,t){function i(){this.constructor=e}_t(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},Zt=function(e,t,i,n){var a,r=arguments.length,s=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var o=e.length-1;0<=o;o--)(a=e[o])&&(s=(r<3?a(s):3<r?a(t,i,s):a(t,i))||s);return 3<r&&s&&Object.defineProperty(t,i,s),s},zt=(Xt=oe.ChildProperty,zt(Yt,Xt),Zt([oe.Property(null)],Yt.prototype,"day",void 0),Zt([oe.Property(null)],Yt.prototype,"label",void 0),Zt([oe.Property(null)],Yt.prototype,"cssClass",void 0),Yt);function Yt(){return null!==Xt&&Xt.apply(this,arguments)||this}Kt=function(e,t){return(Kt=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])}))(e,t)};var Kt,Qt,Zt=function(e,t){function i(){this.constructor=e}Kt(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},Jt=function(e,t,i,n){var a,r=arguments.length,s=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var o=e.length-1;0<=o;o--)(a=e[o])&&(s=(r<3?a(s):3<r?a(t,i,s):a(t,i))||s);return 3<r&&s&&Object.defineProperty(t,i,s),s},Zt=(Qt=oe.ChildProperty,Zt($t,Qt),Jt([oe.Collection([],b.Predicate)],$t.prototype,"columns",void 0),Jt([oe.Property("Menu")],$t.prototype,"type",void 0),Jt([oe.Property()],$t.prototype,"operators",void 0),Jt([oe.Property(!1)],$t.prototype,"ignoreAccent",void 0),Jt([oe.Property("Parent")],$t.prototype,"hierarchyMode",void 0),$t);function $t(){return null!==Qt&&Qt.apply(this,arguments)||this}ei=function(e,t){return(ei=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])}))(e,t)};var ei,ti,Jt=function(e,t){function i(){this.constructor=e}ei(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},ii=function(e,t,i,n){var a,r=arguments.length,s=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var o=e.length-1;0<=o;o--)(a=e[o])&&(s=(r<3?a(s):3<r?a(t,i,s):a(t,i))||s);return 3<r&&s&&Object.defineProperty(t,i,s),s},Jt=(ti=oe.ChildProperty,Jt(ni,ti),ii([oe.Property([])],ni.prototype,"fields",void 0),ii([oe.Property(!1)],ni.prototype,"ignoreCase",void 0),ii([oe.Property("contains")],ni.prototype,"operator",void 0),ii([oe.Property("")],ni.prototype,"key",void 0),ii([oe.Property("Parent")],ni.prototype,"hierarchyMode",void 0),ni);function ni(){return null!==ti&&ti.apply(this,arguments)||this}ai=function(e,t){return(ai=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])}))(e,t)};var ai,ri,ii=function(e,t){function i(){this.constructor=e}ai(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},si=function(e,t,i,n){var a,r=arguments.length,s=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var o=e.length-1;0<=o;o--)(a=e[o])&&(s=(r<3?a(s):3<r?a(t,i,s):a(t,i))||s);return 3<r&&s&&Object.defineProperty(t,i,s),s},ii=(ri=oe.ChildProperty,ii(oi,ri),si([oe.Property(null)],oi.prototype,"from",void 0),si([oe.Property(null)],oi.prototype,"to",void 0),si([oe.Property(null)],oi.prototype,"label",void 0),si([oe.Property(null)],oi.prototype,"cssClass",void 0),oi);function oi(){return null!==ri&&ri.apply(this,arguments)||this}li=function(e,t){return(li=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])}))(e,t)};var li,di,si=function(e,t){function i(){this.constructor=e}li(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},hi=function(e,t,i,n){var a,r=arguments.length,s=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var o=e.length-1;0<=o;o--)(a=e[o])&&(s=(r<3?a(s):3<r?a(t,i,s):a(t,i))||s);return 3<r&&s&&Object.defineProperty(t,i,s),s},si=(di=oe.ChildProperty,si(pi,di),hi([oe.Property(null)],pi.prototype,"rightLabel",void 0),hi([oe.Property(null)],pi.prototype,"leftLabel",void 0),hi([oe.Property(null)],pi.prototype,"taskLabel",void 0),pi);function pi(){return null!==di&&di.apply(this,arguments)||this}ui=function(e,t){return(ui=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])}))(e,t)};var ui,ci,hi=function(e,t){function i(){this.constructor=e}ui(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},gi=function(e,t,i,n){var a,r=arguments.length,s=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var o=e.length-1;0<=o;o--)(a=e[o])&&(s=(r<3?a(s):3<r?a(t,i,s):a(t,i))||s);return 3<r&&s&&Object.defineProperty(t,i,s),s},hi=(ci=oe.ChildProperty,hi(fi,ci),gi([oe.Property("Row")],fi.prototype,"mode",void 0),gi([oe.Property("Flow")],fi.prototype,"cellSelectionMode",void 0),gi([oe.Property("Single")],fi.prototype,"type",void 0),gi([oe.Property(!1)],fi.prototype,"persistSelection",void 0),gi([oe.Property(!1)],fi.prototype,"enableToggle",void 0),fi);function fi(){return null!==ci&&ci.apply(this,arguments)||this}mi=function(e,t){return(mi=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])}))(e,t)};var mi,yi,gi=function(e,t){function i(){this.constructor=e}mi(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},Di=function(e,t,i,n){var a,r=arguments.length,s=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var o=e.length-1;0<=o;o--)(a=e[o])&&(s=(r<3?a(s):3<r?a(t,i,s):a(t,i))||s);return 3<r&&s&&Object.defineProperty(t,i,s),s},gi=(yi=oe.ChildProperty,gi(ki,yi),Di([oe.Property(null)],ki.prototype,"position",void 0),Di([oe.Property(-1)],ki.prototype,"columnIndex",void 0),Di([oe.Property(4)],ki.prototype,"separatorSize",void 0),Di([oe.Property(null)],ki.prototype,"minimum",void 0),Di([oe.Property("Default")],ki.prototype,"view",void 0),ki);function ki(){return null!==yi&&yi.apply(this,arguments)||this}wi=function(e,t){return(wi=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])}))(e,t)};var wi,bi,Di=function(e,t){function i(){this.constructor=e}wi(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},s=function(e,t,i,n){var a,r=arguments.length,s=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var o=e.length-1;0<=o;o--)(a=e[o])&&(s=(r<3?a(s):3<r?a(t,i,s):a(t,i))||s);return 3<r&&s&&Object.defineProperty(t,i,s),s},Di=(bi=oe.ChildProperty,Di(o,bi),s([oe.Property(null)],o.prototype,"id",void 0),s([oe.Property(null)],o.prototype,"name",void 0),s([oe.Property(null)],o.prototype,"parentID",void 0),s([oe.Property(null)],o.prototype,"hasChildMapping",void 0),s([oe.Property(null)],o.prototype,"startDate",void 0),s([oe.Property(null)],o.prototype,"endDate",void 0),s([oe.Property(null)],o.prototype,"dependency",void 0),s([oe.Property(null)],o.prototype,"progress",void 0),s([oe.Property(null)],o.prototype,"child",void 0),s([oe.Property(null)],o.prototype,"milestone",void 0),s([oe.Property(null)],o.prototype,"duration",void 0),s([oe.Property(null)],o.prototype,"durationUnit",void 0),s([oe.Property(null)],o.prototype,"cssClass",void 0),s([oe.Property(null)],o.prototype,"baselineStartDate",void 0),s([oe.Property(null)],o.prototype,"baselineEndDate",void 0),s([oe.Property(null)],o.prototype,"resourceInfo",void 0),s([oe.Property(null)],o.prototype,"expandState",void 0),s([oe.Property(null)],o.prototype,"indicators",void 0),s([oe.Property(null)],o.prototype,"notes",void 0),s([oe.Property(null)],o.prototype,"work",void 0),s([oe.Property(null)],o.prototype,"manual",void 0),s([oe.Property(null)],o.prototype,"type",void 0),s([oe.Property(null)],o.prototype,"segments",void 0),s([oe.Property(null)],o.prototype,"segmentId",void 0),o);function o(){return null!==bi&&bi.apply(this,arguments)||this}Ti=function(e,t){return(Ti=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])}))(e,t)};var Ti,vi,s=function(e,t){function i(){this.constructor=e}Ti(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},Pi=function(e,t,i,n){var a,r=arguments.length,s=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var o=e.length-1;0<=o;o--)(a=e[o])&&(s=(r<3?a(s):3<r?a(t,i,s):a(t,i))||s);return 3<r&&s&&Object.defineProperty(t,i,s),s},Si=(vi=oe.ChildProperty,s(Ci,vi),Pi([oe.Property("")],Ci.prototype,"format",void 0),Pi([oe.Property("None")],Ci.prototype,"unit",void 0),Pi([oe.Property(1)],Ci.prototype,"count",void 0),Pi([oe.Property(null)],Ci.prototype,"formatter",void 0),Ci);function Ci(){return null!==vi&&vi.apply(this,arguments)||this}Ri=oe.ChildProperty,s(Mi,Ri),Pi([oe.Property("Week")],Mi.prototype,"timelineViewMode",void 0),Pi([oe.Complex({},Si)],Mi.prototype,"topTier",void 0),Pi([oe.Complex({},Si)],Mi.prototype,"bottomTier",void 0),Pi([oe.Property(33)],Mi.prototype,"timelineUnitSize",void 0),Pi([oe.Property(0)],Mi.prototype,"weekStartDay",void 0),Pi([oe.Property(null)],Mi.prototype,"weekendBackground",void 0),Pi([oe.Property(!0)],Mi.prototype,"showTooltip",void 0),Pi([oe.Property(!0)],Mi.prototype,"updateTimescaleView",void 0),Pi([oe.Property(!0)],Mi.prototype,"showWeekend",void 0);var Ri,s=Mi;function Mi(){return null!==Ri&&Ri.apply(this,arguments)||this}xi=function(e,t){return(xi=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])}))(e,t)};var xi,Oi,Pi=function(e,t){function i(){this.constructor=e}xi(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},Ii=function(e,t,i,n){var a,r=arguments.length,s=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var o=e.length-1;0<=o;o--)(a=e[o])&&(s=(r<3?a(s):3<r?a(t,i,s):a(t,i))||s);return 3<r&&s&&Object.defineProperty(t,i,s),s},Pi=(Oi=oe.ChildProperty,Pi(Ei,Oi),Ii([oe.Property(!0)],Ei.prototype,"showTooltip",void 0),Ii([oe.Property()],Ei.prototype,"taskbar",void 0),Ii([oe.Property()],Ei.prototype,"baseline",void 0),Ii([oe.Property()],Ei.prototype,"connectorLine",void 0),Ii([oe.Property()],Ei.prototype,"editing",void 0),Ii([oe.Property()],Ei.prototype,"timeline",void 0),Ei);function Ei(){return null!==Oi&&Oi.apply(this,arguments)||this}Ui=function(e,t){return(Ui=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])}))(e,t)};var Ui,Fi,Ii=function(e,t){function i(){this.constructor=e}Ui(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},Ni=function(e,t,i,n){var a,r=arguments.length,s=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var o=e.length-1;0<=o;o--)(a=e[o])&&(s=(r<3?a(s):3<r?a(t,i,s):a(t,i))||s);return 3<r&&s&&Object.defineProperty(t,i,s),s},Li=(Fi=oe.ChildProperty,Ii(Vi,Fi),Ni([oe.Property()],Vi.prototype,"field",void 0),Ni([oe.Property()],Vi.prototype,"direction",void 0),Vi);function Vi(){return null!==Fi&&Fi.apply(this,arguments)||this}Bi=oe.ChildProperty,Ii(Ai,Bi),Ni([oe.Collection([],Li)],Ai.prototype,"columns",void 0),Ni([oe.Property(!0)],Ai.prototype,"allowUnsort",void 0);var Bi,Ii=Ai;function Ai(){return null!==Bi&&Bi.apply(this,arguments)||this}Wi=function(e,t){return(Wi=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])}))(e,t)};var Wi,Hi,Ni=function(e,t){function i(){this.constructor=e}Wi(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},ji=function(e,t,i,n){var a,r=arguments.length,s=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var o=e.length-1;0<=o;o--)(a=e[o])&&(s=(r<3?a(s):3<r?a(t,i,s):a(t,i))||s);return 3<r&&s&&Object.defineProperty(t,i,s),s},Ni=(Hi=oe.ChildProperty,Ni(Gi,Hi),ji([oe.Property(null)],Gi.prototype,"id",void 0),ji([oe.Property(null)],Gi.prototype,"name",void 0),ji([oe.Property(null)],Gi.prototype,"unit",void 0),ji([oe.Property(null)],Gi.prototype,"group",void 0),Gi);function Gi(){return null!==Hi&&Hi.apply(this,arguments)||this}zi=function(e,t){return(zi=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])}))(e,t)};var zi,qi,ji=function(e,t){function i(){this.constructor=e}zi(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},_i=function(e,t,i,n){var a,r=arguments.length,s=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var o=e.length-1;0<=o;o--)(a=e[o])&&(s=(r<3?a(s):3<r?a(t,i,s):a(t,i))||s);return 3<r&&s&&Object.defineProperty(t,i,s),s},ji=(qi=oe.ChildProperty,ji(Xi,qi),_i([oe.Property("Spinner")],Xi.prototype,"indicatorType",void 0),Xi);function Xi(){return null!==qi&&qi.apply(this,arguments)||this}Zi=function(e,t){return(Zi=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])}))(e,t)};var Zi,Yi,_i=function(e,t){function i(){this.constructor=e}Zi(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},Ki=function(e,t,i,n){var a,r=arguments.length,s=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var o=e.length-1;0<=o;o--)(a=e[o])&&(s=(r<3?a(s):3<r?a(t,i,s):a(t,i))||s);return 3<r&&s&&Object.defineProperty(t,i,s),s},_i=(Yi=oe.ChildProperty,_i(Qi,Yi),Ki([oe.Property()],Qi.prototype,"dayOfWeek",void 0),Ki([oe.Collection([],It)],Qi.prototype,"timeRange",void 0),Qi);function Qi(){return null!==Yi&&Yi.apply(this,arguments)||this}Ji=function(e,t){return(Ji=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])}))(e,t)};(function(e,t){function i(){this.constructor=e}Ji(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)})(d,$i=$),d.prototype.initPublicProp=function(){this.ganttChartTableBody=null},d.prototype.addEventListener=function(){this.parent.on("renderPanels",this.createChartTable,this),this.parent.on("dataReady",this.initiateTemplates,this),this.parent.on("destroy",this.destroy,this)},d.prototype.refreshChartByTimeline=function(){this.taskTable.style.width=oe.formatUnit(this.parent.enableTimelineVirtualization?this.parent.timelineModule.wholeTimelineWidth:this.parent.timelineModule.totalTimelineWidth);var e=oe.getValue("prevProjectStartDate",this.parent.dataOperation),t=!1;e&&(t=e.getTime()===this.parent.cloneProjectStartDate.getTime()),this.isUpdated=!!(this.parent.isFromOnPropertyChange&&t&&oe.getValue("mutableData",this.parent.treeGrid.grid.contentModule)),this.refreshGanttRows(),this.isUpdated=!0},d.prototype.createChartTable=function(){this.taskTable=oe.createElement("table",{className:"e-task-table e-zero-spacing",id:"GanttTaskTable"+this.parent.element.id,styles:"position: absolute;width:"+(this.parent.enableTimelineVirtualization?this.parent.timelineModule.wholeTimelineWidth:this.parent.timelineModule.totalTimelineWidth)+"px;",attrs:{cellspacing:"0.25px"}});var e=oe.createElement("colgroup"),t=oe.createElement("col",{styles:"width:"+this.parent.timelineModule.totalTimelineWidth+"px;"});e.appendChild(t),this.taskTable.appendChild(e),this.ganttChartTableBody=oe.createElement("tbody",{id:this.parent.element.id+"GanttTaskTableBody"}),this.taskTable.appendChild(this.ganttChartTableBody),this.parent.ganttChartModule.chartBodyContent.appendChild(this.taskTable)},d.prototype.initiateTemplates=function(){this.taskTable.style.width=oe.formatUnit(this.parent.enableTimelineVirtualization?this.parent.timelineModule.wholeTimelineWidth:this.parent.timelineModule.totalTimelineWidth),this.initChartHelperPrivateVariable(),this.initializeChartTemplate()},d.prototype.renderChartRows=function(){this.createTaskbarTemplate(),this.parent.isGanttChartRendered=!0},d.prototype.getIndicatorNode=function(e){e='<label class="'+l+' e-indicator-span" style="display: inline-flex; align-items: center; margin-top: 0; line-height:'+this.parent.rowHeight+"px;"+(this.parent.enableRtl?"right:":"left:")+this.getIndicatorleft(e.date)+'px;"><i class="'+e.iconClass+'" style="margin-right: 3px;"></i> </label>';return this.createDivElement(e)},d.prototype.getIndicatorleft=function(e){return e=this.parent.dateValidationModule.getDateFromFormat(e),this.parent.dataOperation.getTaskLeft(e,!1)},d.prototype.getChildTaskbarNode=function(e,t){var i,n,a,r,s=null,o=this.templateData,l=this.parent.enableRtl?"right:":"left:",s=this.childTaskbarTemplateFunction?this.childTaskbarTemplateFunction(oe.extend({index:e},o),this.parent,"TaskbarTemplate",this.getTemplateID("TaskbarTemplate"),!1,void 0,t[0],this.parent.treeGrid.root):(r=t="",n=i=void 0,o.ganttProperties.startDate&&o.ganttProperties.endDate&&o.ganttProperties.duration&&(i=this.createDivElement('<div class="'+be+" "+Be+" "+(o.ganttProperties.isAutoSchedule?"":Ge)+'"style="width:'+o.ganttProperties.width+"px;height:"+this.taskBarHeight+'px; margin-top :-1px"></div>'),n=this.createDivElement('<div class="'+Te+" "+Ae+" "+(o.ganttProperties.isAutoSchedule?"":"e-gantt-child-manualprogressbar")+'" style="border-style:'+(o.ganttProperties.progressWidth?"solid;":"none;")+"width:"+o.ganttProperties.progressWidth+"px;height:100%;border-top-right-radius:"+this.getBorderRadius(o.ganttProperties)+"px;border-bottom-right-radius:"+this.getBorderRadius(o.ganttProperties)+'px;"></div>')),a=oe.createElement("div"),this.taskLabelTemplateFunction&&!oe.isNullOrUndefined(n)&&0<n.length?(e=this.taskLabelTemplateFunction(oe.extend({index:e},o),this.parent,"TaskLabelTemplate",this.getTemplateID("TaskLabelTemplate"),!1,void 0,n[0]))&&0<e.length&&(oe.append(e,a),t=a.innerHTML,t="isCustomTemplate"===(t=this.getTaskLabel(this.parent.labelSettings.taskLabel))?a.innerHTML:t,this.parent.enableHtmlSanitizer)&&"string"==typeof t&&(t=oe.SanitizeHtmlHelper.sanitize(t)):(e=this.parent.labelSettings.taskLabel,t="isCustomTemplate"===(t=this.getTaskLabel(e))?this.parent.labelSettings.taskLabel:t,this.parent.enableHtmlSanitizer&&"string"==typeof t&&(t=oe.SanitizeHtmlHelper.sanitize(t))),-1===t.indexOf("null")&&("isCustomTemplate"!==this.getTaskLabel(this.parent.labelSettings.taskLabel)||this.isTemplate(this.parent.labelSettings.taskLabel)||(t=""),r=isNaN(parseInt(t,10))?'<span class="'+we+'" style="line-height:'+(this.taskBarHeight-1)+"px; text-align:"+(this.parent.enableRtl?"right;":"left;")+"display:inline-block;width:"+(o.ganttProperties.width-10)+"px; height:"+this.taskBarHeight+'px;"></span>':'<span class="'+we+'" style="line-height:'+(this.taskBarHeight-1)+"px;"+("ResourceView"===this.parent.viewType?"text-align:"+(this.parent.enableRtl?"right;":"left;"):"")+ +("ResourceView"===this.parent.viewType?"display:inline-flex;":"")+ +("ResourceView"===this.parent.viewType?o.ganttProperties.width-10:"")+"px; height:"+this.taskBarHeight+'px;"></span>'),e=!oe.isNullOrUndefined(o.ganttProperties.segments)&&0<o.ganttProperties.segments.length?this.splitTaskbar(o,t):o.ganttProperties.startDate&&o.ganttProperties.endDate&&o.ganttProperties.duration?r:!o.ganttProperties.startDate||o.ganttProperties.endDate||o.ganttProperties.duration?!o.ganttProperties.endDate||o.ganttProperties.startDate||o.ganttProperties.duration?!o.ganttProperties.duration||o.ganttProperties.startDate||o.ganttProperties.endDate?"":'<div class="'+Te+" "+Be+" e-gantt-unscheduled-taskbar "+(o.ganttProperties.isAutoSchedule?"":Ge)+'"style="'+l+o.ganttProperties.left+"px; width:"+o.ganttProperties.width+"px; height:"+this.taskBarHeight+'px;"></div>':'<div class="'+Te+" "+Be+" "+$e+" "+(o.ganttProperties.isAutoSchedule?"":Ge)+'"style="'+l+o.ganttProperties.left+"px; height:"+this.taskBarHeight+'px;"></div>':'<div class="'+Te+" "+Be+" "+Je+" "+(o.ganttProperties.isAutoSchedule?"":Ge)+'"style="'+l+o.ganttProperties.left+"px; height:"+this.taskBarHeight+'px;"></div>',o.ganttProperties.segments&&0<o.ganttProperties.segments.length&&(e+=this.getSplitProgressResizerNode()),o.ganttProperties.startDate&&o.ganttProperties.endDate&&o.ganttProperties.duration&&(oe.isNullOrUndefined(o.ganttProperties.segments)||!oe.isNullOrUndefined(o.ganttProperties.segments)&&0===o.ganttProperties.segments.length)?(""!==e&&!oe.isNullOrUndefined(n)&&0<n.length&&(r=this.createDivElement(e)[0],this.parent.disableHtmlEncode?r.innerText=t:r.innerHTML=t,(l=this.parent.labelSettings.taskLabel)&&l.elementRef&&r.appendChild(a),n[0].appendChild(r),""!==n[0].querySelectorAll(".e-task-label")[0].textContent&&!this.isTemplate(l)&&n[0].querySelectorAll(".e-task-label")[0].children[0]&&this.parent.disableHtmlEncode&&n[0].querySelectorAll(".e-task-label")[0].children[0].remove(),""===n[0].querySelectorAll(".e-task-label")[0].textContent)&&l&&!l.elementRef&&""!==a.innerHTML&&(n[0].querySelectorAll(".e-task-label")[0].textContent=l),!oe.isNullOrUndefined(i)&&0<i.length&&i[0].appendChild([].slice.call(n)[0]),i):this.createDivElement(e));return this.parent.enableRtl&&!oe.isNullOrUndefined(s)&&s[0]&&s[0].querySelector(".e-task-label")&&(s[0].querySelector(".e-task-label").style.marginLeft="15px",s[0].querySelector(".e-task-label").style.marginRight="8px",s[0].querySelector(".e-gantt-child-progressbar"))&&(s[0].querySelector(".e-gantt-child-progressbar").style.textAlign="left"),s},d.prototype.splitTaskbar=function(e,t){for(var i="",n=0;n<e.ganttProperties.segments.length;n++){var a=e.ganttProperties.segments[n],r=void 0,r=a.showProgress?"initial":"hidden",s=0===n?"e-segment-first":n===e.ganttProperties.segments.length-1?"e-segment-last":"e-segment-inprogress";i+='<div class="'+be+" "+s+" "+Be+'  e-segmented-taskbar"style="width:'+a.width+"px;position: absolute;"+(this.parent.enableRtl?"right:":"left:")+a.left+"px;height:"+this.taskBarHeight+"px; overflow:"+r+';" data-segment-index = "'+n+'" aria-label = "'+this.generateSpiltTaskAriaLabel(a,e.ganttProperties)+'"> '+this.getSplitTaskbarLeftResizerNode()+'<div class="'+Te+" "+Ae+' " style="border-style:'+(a.progressWidth?"solid;":"none;")+"display:"+(0<=a.progressWidth?"block;":"none;")+"width:"+a.progressWidth+"px;height:100%;text-align:"+(this.parent.enableRtl?"left;":"right;")+"border-top-right-radius:"+this.getSplitTaskBorderRadius(a)+"px;border-bottom-right-radius:"+this.getSplitTaskBorderRadius(a)+'px;"><span class="'+we+'" style="line-height:'+(this.taskBarHeight-1)+"px;display:"+(a.showProgress?"inline;":"none;")+"height:"+this.taskBarHeight+'px;">'+t+"</span></div>"+this.getSplitTaskbarRightResizerNode(a)+"</div></div>"}return i},d.prototype.getSplitTaskbarLeftResizerNode=function(){var e=!oe.isNullOrUndefined(document.body.className)&&document.body.className.includes("e-bigger")?5:-2;return'<div class="'+Oe+" "+Le+'" style="'+(this.parent.enableRtl?"right:":"left:")+e+"px;height:"+this.taskBarHeight+'px;z-index:1"></div>'},d.prototype.getSplitTaskbarRightResizerNode=function(e){var t=!oe.isNullOrUndefined(document.body.className)&&document.body.className.includes("e-bigger")?-17:-10;return'<div class="'+Ie+" "+Le+'" style="'+(this.parent.enableRtl?"right:":"left:")+(e.width+t)+"px;height:"+this.taskBarHeight+'px;z-index:1"></div>'},d.prototype.getSplitProgressResizerNode=function(){var e=this.parent.enableRtl?this.templateData.ganttProperties.progressWidth+8:this.templateData.ganttProperties.progressWidth-6;return'<div class="'+Ee+'" style="'+(this.parent.enableRtl?"right:":"left:")+e+"px;margin-top:"+(this.taskBarHeight-4)+'px;"><div class="'+Ue+'"><div class="'+Fe+'"></div><div class="'+Ne+'"></div></div>'},d.prototype.getSegmentIndex=function(e,t){var i=-1,n=t.ganttProperties,a=n.segments;if(!oe.isNullOrUndefined(a)){a.sort(function(e,t){return e.startDate.getTime()-t.startDate.getTime()});for(var r=a.length,s=0;s<r;s++){var o,l,d=a[s];e.getTime()===n.startDate.getTime()?(this.dropSplit=!0,i=0):e.getTime()===d.startDate.getTime()?(this.dropSplit=!0,(o=d.startDate).setDate(o.getDate()+1),o=d.startDate=this.parent.dataOperation.checkStartDate(o,n,!1),d.startDate=o,l=d.endDate,l=this.parent.dataOperation.getEndDate(o,d.duration,n.durationUnit,n,!1),d.endDate=l,s===a.length-1&&this.parent.setRecordValue("endDate",l,n,!0),this.incrementSegments(a,s,t),i=d.segmentIndex):(d.endDate=this.parent.dataOperation.getEndDate(d.startDate,d.duration,n.durationUnit,n,!1),e.getTime()>=d.startDate.getTime()&&e.getTime()<=d.endDate.getTime()&&(i=d.segmentIndex)),this.parent.setRecordValue("segments",n.segments,n,!0)}}return-1===i&&(this.dropSplit=!0),i},d.prototype.mergeTask=function(t,e){var i,n,a=e.length,r=this.parent.taskFields,s=this.parent.flatData.filter(function(e){return e[r.id]===t?e:null})[0],o=(this.parent.undoRedoModule&&!this.parent.undoRedoModule.isUndoRedoPerformed&&(i={action:"MergeTaskbar"},this.parent.isUndoRedoItemPresent("Edit"))&&(this.parent.editModule&&this.parent.editModule.taskbarEditModule.isDragged&&0<this.parent.getUndoActions().length&&this.parent.undoRedoModule.getUndoCollection.splice(this.parent.undoRedoModule.getUndoCollection.length-1,1),this.parent.undoRedoModule.createUndoCollection(),n=this.parent.previousFlatData[s.index],i.modifiedRecords=oe.extend([],[n],[],!0),this.parent.undoRedoModule.getUndoCollection[this.parent.undoRedoModule.getUndoCollection.length-1]=i),s.ganttProperties.segments);e=e.sort(function(e,t){return t.firstSegmentIndex-e.firstSegmentIndex});for(var l,d=0;d<a;d++){var h=o[e[d].firstSegmentIndex],p=o[e[d].secondSegmentIndex],p=h.duration+p.duration,u=this.parent.dataOperation.getEndDate(h.startDate,p,s.ganttProperties.durationUnit,s.ganttProperties,!1),h={startDate:h.startDate,endDate:u,duration:p},p=e[d].firstSegmentIndex;o.splice(p,2,h),this.parent.setRecordValue("segments",o,s.ganttProperties,!0),this.parent.dataOperation.updateMappingData(s,"segments"),1===o.length?(this.parent.setRecordValue("endDate",u,s.ganttProperties,!0),this.parent.setRecordValue("EndDate",u,s,!0),this.parent.setRecordValue("segments",null,s.ganttProperties,!0),this.parent.dataOperation.updateMappingData(s,"segments")):s.ganttProperties.endDate!==o[o.length-1].endDate&&this.parent.setRecordValue("endDate",o[o.length-1].endDate,s.ganttProperties,!0)}oe.isNullOrUndefined(s[r.segments])||oe.isNullOrUndefined(s[r.segments][0])||(l=Object.keys(s[r.segments][0]));for(var c=[],g=0;g<o.length;g++)oe.isNullOrUndefined(l)||c[g]||(c[g]={}),oe.isNullOrUndefined(l)||-1===l.indexOf("StartDate")||(c[g][r.startDate]=o[g].startDate),oe.isNullOrUndefined(l)||-1===l.indexOf("EndDate")||(c[g][r.endDate]=o[g].endDate),oe.isNullOrUndefined(l)||-1===l.indexOf("Duration")||(c[g][r.duration]=o[g].duration);s[r.segments]=c,this.updateSegment(s.ganttProperties.segments,t),this.refreshChartAfterSegment(s,"mergeSegment")},d.prototype.updateSegment=function(e,t){var i=this;if(!oe.isNullOrUndefined(this.parent.taskFields.segmentId)&&0<this.parent.segmentData.length){if(oe.isNullOrUndefined(e))o=this.parent.segmentData.filter(function(e){return!(t===e[i.parent.taskFields.segmentId])});else{for(var n=[],a=0;a<e.length;a++){var r={},s=e[a];r[this.parent.taskFields.segmentId]=t,oe.isNullOrUndefined(this.parent.taskFields.startDate)||(r[this.parent.taskFields.startDate]=s.startDate),oe.isNullOrUndefined(this.parent.taskFields.duration)||(r[this.parent.taskFields.duration]=s.duration),oe.isNullOrUndefined(this.parent.taskFields.endDate)||(r[this.parent.taskFields.endDate]=s.endDate),n.push(r)}for(var o=this.parent.segmentData.filter(function(e){return!(t===e[i.parent.taskFields.segmentId])}),a=0;a<n.length;a++)o.push(n[a])}this.parent.segmentData=o}},d.prototype.refreshChartAfterSegment=function(e,t){this.parent.setRecordValue("segments",this.parent.dataOperation.setSegmentsInfo(e,!1),e.ganttProperties,!0),this.parent.dataOperation.updateMappingData(e,"segments"),this.parent.dataOperation.updateWidthLeft(e),this.parent.dataOperation.updateParentItems(e),e.ganttProperties.sharedTaskUniqueIds&&1<e.ganttProperties.sharedTaskUniqueIds.length&&this.parent.editModule.updateSharedTask(e),this.parent.predecessorModule&&this.parent.taskFields.dependency&&(this.parent.predecessorModule.updatedRecordsDateByPredecessor(),this.parent.connectorLineModule.removePreviousConnectorLines(this.parent.flatData),this.parent.connectorLineEditModule.refreshEditedRecordConnectorLine(this.parent.flatData),e.parentItem)&&this.parent.getParentTask(e.parentItem).ganttProperties.isAutoSchedule&&this.parent.isInPredecessorValidation&&this.parent.dataOperation.updateParentItems(e.parentItem),this.refreshRecords(this.parent.currentViewData);var i=this.ganttChartTableBody.querySelectorAll("tr")[this.parent.currentViewData.indexOf(e)],n={requestType:t,rowData:e,modifiedRecords:this.parent.editedRecords,modifiedTaskData:X(this.parent.editedRecords,!0)},a=(this.triggerQueryTaskbarInfoByIndex(i,e),this.parent.selectionModule&&this.parent.selectionModule.clearSelection(),n.rowData.taskData[this.parent.taskFields.segments]);if(this.parent.timezone&&null!=a)for(var r=0;r<a.length;r++)a[r][this.parent.taskFields.startDate]=this.parent.dateValidationModule.remove(n.rowData.ganttProperties.segments[r].startDate,this.parent.timezone),this.parent.taskFields.endDate&&(a[r][this.parent.taskFields.endDate]=this.parent.dateValidationModule.remove(n.rowData.ganttProperties.segments[r].endDate,this.parent.timezone));this.parent.trigger("actionComplete",n),oe.isNullOrUndefined(this.parent.loadingIndicator)||"Shimmer"!==this.parent.loadingIndicator.indicatorType?this.parent.hideSpinner():this.parent.hideMaskRow(),oe.setValue("isEdit",!1,this.parent.contextMenuModule),oe.setValue("isEdit",!1,this.parent)},d.prototype.splitTask=function(t,e){var i=this.parent.taskFields,n=e,a=this.parent.flatData.filter(function(e){return e[i.id]===t?e:null})[0],r=(this.parent.undoRedoModule&&!this.parent.undoRedoModule.isUndoRedoPerformed&&(r={action:"MergeTaskbar"},this.parent.isUndoRedoItemPresent("Edit"))&&(this.parent.undoRedoModule.createUndoCollection(),r.modifiedRecords=oe.extend([],[a],[],!0),this.parent.undoRedoModule.getUndoCollection[this.parent.undoRedoModule.getUndoCollection.length-1]=r),a.ganttProperties),s=(this.dropSplit=!1,-1),o=r.segments;if(oe.isNullOrUndefined(e.length)||e.length<0){var l=this.parent.dataOperation.checkStartDate(n,r,!1);if(l.getTime()!==r.startDate.getTime()&&r.isAutoSchedule){if(!oe.isNullOrUndefined(o)&&0<o.length&&(s=this.getSegmentIndex(l,a)),!1===this.dropSplit&&n.getTime()>r.startDate.getTime()&&n.getTime()<r.endDate.getTime()){for(var o=-1!==s?o:[],l=-1!==s?o[s].startDate:new Date(r.startDate.getTime()),d=-1!==s?o[s].endDate:new Date(r.endDate.getTime()),h=this.parent.dataOperation.getDuration(l,d,r.durationUnit,r.isAutoSchedule,r.isMilestone),p=(this.parent.setRecordValue("segments",this.splitSegmentedTaskbar(l,d,n,s,o,a,h),r,!0),[]),u=0;u<o.length;u++)p[u]||(p[u]={}),p[u][i.startDate]=o[u].startDate,p[u][i.endDate]=o[u].endDate,p[u][i.duration]=o[u].duration;a[i.segments]=p,-1!==s&&this.incrementSegments(o,s+1,a),this.parent.setRecordValue("endDate",o[o.length-1].endDate,r,!0),this.parent.taskFields.endDate&&this.parent.dataOperation.updateMappingData(a,"endDate")}this.updateSegment(a.ganttProperties.segments,t),this.refreshChartAfterSegment(a,"splitTaskbar")}}else e.sort(function(e,t){return e.getTime()-t.getTime()}),this.parent.setRecordValue("segments",this.constructSegments(e,a.ganttProperties),a.ganttProperties,!0),this.updateSegment(a.ganttProperties.segments,t),this.refreshChartAfterSegment(a,"splitTask")},d.prototype.constructSegments=function(e,t){for(var i,n,a=[],r=new Date,s=0;s<e.length+1&&(r=0===s?t.startDate:r,r=this.parent.dataOperation.checkStartDate(r,t,!1),i=s===e.length||new Date(e[s].getTime())>t.endDate?t.endDate:new Date(e[s].getTime()),i=this.parent.dataOperation.checkEndDate(i,t,!1),n=this.parent.dataOperation.getDuration(r,i,t.durationUnit,t.isAutoSchedule,t.isMilestone),i.getTime()>=r.getTime()&&a.push({startDate:r,endDate:i,duration:n}),s!==e.length);s++)(r=new Date(e[s].getTime())).setDate(e[s].getDate()+1);return a},d.prototype.splitSegmentedTaskbar=function(e,t,i,n,a,r,s){var o=r.ganttProperties,r=this.parent.includeWeekend?-1:this.parent.nonWorkingDayIndex.indexOf(i.getDay()),l=-1===r?0:0===r||1===r?1:2,d=(e=this.parent.dataOperation.checkStartDate(e,o,!1),new Date(i.getTime()));d=this.parent.dataOperation.checkEndDate(d,o,!1);for(var h=0;h<2;h++){0<this.parent.weekWorkingTime.length&&(p=this.parent.getCurrentDayEndTime(d),this.setTime(p,d));var p={startDate:e,endDate:d,duration:this.parent.dataOperation.getDuration(e,d,o.durationUnit,o.isAutoSchedule,o.isMilestone),offsetDuration:1},u=this.parent.includeWeekend?-1:this.parent.nonWorkingDayIndex.indexOf(d.getDay()),c=(-1!==n&&(a.splice(n,1),n=-1),a.push(p),this.parent.timelineModule.customTimelineSettings.bottomTier.unit);if("Hour"===c||"Minutes"===c){e=new Date(i.getTime()),e=this.parent.dataOperation.checkStartDate(e,o,!1);var c=this.parent.timelineModule.customTimelineSettings.bottomTier.count,g=this.parent.timelineModule.customTimelineSettings.bottomTier.unit,f=this.parent.timelineModule.getIncrement(e,c,g),m=e.getTime()+f;e.setTime(m+l),d=new Date(t.getTime()),f=this.parent.timelineModule.getIncrement(d,c,g),m=d.getTime()+f,d.setTime(m+l)}else{(e=new Date(i.getTime())).setDate(e.getDate()+1+l);c=this.parent.getCurrentDayStartTime(e);if(this.setTime(c,e),e=this.parent.dataOperation.checkStartDate(e,o,!1),!this.parent.taskFields.duration&&l<=0&&e.setDate(e.getDate()+1),(d=new Date(t.getTime()))<e&&d.setDate(d.getDate()+1),this.isOnHolidayOrWeekEnd(d,!0))for(;d.setDate(d.getDate()+1),this.isOnHolidayOrWeekEnd(d,!0););this.parent.includeWeekend||(d=this.getNextWorkingDay(d))}d=-1!==u?this.parent.dataOperation.getEndDate(e,s-p.duration,o.durationUnit,o,!1):this.parent.dataOperation.checkEndDate(d,o,!1)}return a.sort(function(e,t){return e.startDate.getTime()-t.startDate.getTime()}),a},d.prototype.incrementSegments=function(e,t,i){for(var n=i.ganttProperties,a=t+1;a<e.length;a++){var r=e[a],s=0!==a?new Date(e[a-1].endDate.getTime()):new Date(r.startDate.getTime()),s=(this.parent.dataOperation.fromSegments=!0,s=this.parent.dataOperation.getEndDate(s,r.offsetDuration,n.durationUnit,n,!1),this.parent.dataOperation.fromSegments=!1,s=this.parent.dataOperation.checkStartDate(s,n,!1),r.startDate=s,r.endDate=this.parent.dataOperation.getEndDate(s,r.duration,n.durationUnit,n,!1));r.endDate=s,a===e.length-1&&(this.parent.setRecordValue("endDate",s,n,!0),this.parent.taskFields.endDate)&&this.parent.dataOperation.updateMappingData(i,"endDate")}e.sort(function(e,t){return e.startDate.getTime()-t.startDate.getTime()}),this.parent.setRecordValue("segments",e,n,!0),this.parent.dataOperation.updateMappingData(i,"segments")},d.prototype.calculateLeftValue=function(e){var t=this.parent.renderBaseline?.45:!oe.isNullOrUndefined(document.body.className)&&document.body.className.includes("e-bigger")?.7:.62,t=Math.floor(this.parent.rowHeight*t);return!oe.isNullOrUndefined(this.parent.taskbarHeight)&&this.parent.taskbarHeight<=t||oe.isNullOrUndefined(this.parent.taskbarHeight)&&e<=36||e<=36?1:-1/12*(e-36)+1},d.prototype.getMilestoneNode=function(e,t){var i=this.templateData,n=this.parent.rowHeight,n=this.calculateLeftValue(n);return this.milestoneTemplateFunction?this.milestoneTemplateFunction(oe.extend({index:e},i),this.parent,"MilestoneTemplate",this.getTemplateID("MilestoneTemplate"),!1,void 0,t[0],this.parent.treeGrid.root):(e='<div class="'+Ve+'" style="width:'+(this.parent.renderBaseline?this.taskBarHeight:this.taskBarHeight-6)+"px;height:"+(this.parent.renderBaseline?this.taskBarHeight:this.taskBarHeight-6)+"px;position:absolute;transform: rotate(45deg);left:"+n+'px;"> </div>',this.createDivElement(e))},d.prototype.getTaskBaselineNode=function(){var e=this.templateData,e='<div class="'+Ce+' " role="term" style="margin-top:'+this.baselineTop+"px;"+(this.parent.enableRtl?"right:":"left:")+e.ganttProperties.baselineLeft+"px;width:"+e.ganttProperties.baselineWidth+"px;height:"+this.baselineHeight+"px;"+(this.baselineColor?"background-color: "+this.baselineColor+";":"")+'"></div>';return this.createDivElement(e)},d.prototype.updateTaskBaselineNode=function(e){e='<div class="'+Ce+' " role="term" style="margin-top:'+this.baselineTop+"px;"+(this.parent.enableRtl?"right:":"left:")+e.ganttProperties.baselineLeft+"px;width:"+e.ganttProperties.baselineWidth+"px;height:"+this.baselineHeight+"px;"+(this.baselineColor?"background-color: "+this.baselineColor+";":"")+'"></div>';return this.createDivElement(e)},d.prototype.getMilestoneBaselineNode=function(){var e=this.templateData,t=this.parent.renderBaseline?5:2,e='<div class="'+Re+'" style="width:'+(this.parent.renderBaseline?this.taskBarHeight:this.taskBarHeight-10)+"px;height:"+(this.parent.renderBaseline?this.taskBarHeight:this.taskBarHeight-10)+"px;position:absolute;transform:rotate(45deg);"+(this.parent.enableRtl?"right:":"left:")+(this.parent.enableRtl?e.ganttProperties.left-this.milestoneHeight/2+3:e.ganttProperties.baselineLeft-this.milestoneHeight/2+1)+"px;"+(this.baselineColor?"background-color: "+this.baselineColor+";":"")+"margin-top:"+(-Math.floor(this.parent.rowHeight-this.milestoneMarginTop)+t+2)+'px"> </div>';return this.createDivElement(e)},d.prototype.getLeftLabelNode=function(e){var t,i=this.leftLabelContainer(),n=(""!==this.generateTaskLabelAriaLabel("left")&&i[0].setAttribute("aria-label",this.generateTaskLabelAriaLabel("left")),null);return this.leftTaskLabelTemplateFunction?n=this.leftTaskLabelTemplateFunction(oe.extend({index:e},this.templateData),this.parent,"LeftLabelTemplate",this.getTemplateID("LeftLabelTemplate"),!1,void 0,i[0],this.parent.treeGrid.root):(e=this.parent.labelSettings.leftLabel,(t=this.getTaskLabel(e))&&(n=this.getLableText(t="isCustomTemplate"===t?e:t,ye),this.parent.enableHtmlSanitizer)&&"string"==typeof t&&(t=oe.SanitizeHtmlHelper.sanitize(t),n=this.getLableText(t="isCustomTemplate"===t?e:t,ye))),n&&0<n.length&&("null"===n[0].data&&(n[0].data=""),oe.append(n,i[0])),this.parent.enableRtl&&(i[0].style.paddingLeft="25px",i[0].style.paddingRight="0px"),i},d.prototype.getLableText=function(e,t){var i=this.parent.renderBaseline?(this.parent.rowHeight-this.taskBarHeight)/2:this.taskBarMarginTop,t=oe.createElement("div",{className:t,styles:"height:"+this.taskBarHeight+"px;margin-top:"+i+"px;"}),i=oe.createElement("span",{className:l}),e=(i[this.parent.disableHtmlEncode?"textContent":"innerHTML"]=e,t.appendChild(i),oe.createElement("div"));return e.appendChild(t),e.childNodes},d.prototype.getRightLabelNode=function(e){var t,i=this.rightLabelContainer(),n=(""!==this.generateTaskLabelAriaLabel("right")&&i[0].setAttribute("aria-label",this.generateTaskLabelAriaLabel("right")),null);return this.rightTaskLabelTemplateFunction?n=this.rightTaskLabelTemplateFunction(oe.extend({index:e},this.templateData),this.parent,"RightLabelTemplate",this.getTemplateID("RightLabelTemplate"),!1,void 0,i[0],this.parent.treeGrid.root):(e=this.parent.labelSettings.rightLabel,(t=this.getTaskLabel(e))&&(n=this.getLableText(t="isCustomTemplate"===t?e:t,ke),this.parent.enableHtmlSanitizer)&&"string"==typeof t&&(t=oe.SanitizeHtmlHelper.sanitize(t),n=this.getLableText(t="isCustomTemplate"===t?e:t,ke))),n&&0<n.length&&("null"===n[0].data&&(n[0].data=""),oe.append(n,i[0])),this.parent.enableRtl&&(i[0].style.marginLeft="0px",i[0].style.paddingRight="25px"),i},d.prototype.getManualTaskbar=function(){var e=this.templateData,t=this.taskBarHeight/2-1,i=(e.ganttProperties.startDate&&e.ganttProperties.endDate&&(e.ganttProperties.duration||e.hasChildRecords)?'<div class="'+He+'" style="width:'+e.ganttProperties.width+"px;height:"+t/5+"px;border-left-width:"+t/5+"px; border-bottom:"+t/5+'px solid transparent;"></div>':e.ganttProperties.startDate||e.ganttProperties.endDate||!e.ganttProperties.duration?'<div class="'+He+" "+(e.ganttProperties.startDate?Je:$e)+'" style="width:'+e.ganttProperties.width+"px;height:"+2*t+"px;border-left-width:"+t/5+"px; border-bottom:"+t/5+'px solid transparent;"></div>':'<div class="'+He+' e-gantt-unscheduled-manualtask" style="width:'+e.ganttProperties.width+"px;height:"+(t/5+1)+"px;border-left-width:"+t/5+"px; border-bottom:"+t/5+'px solid transparent;"></div>')+(e.ganttProperties.startDate&&e.ganttProperties.endDate&&(e.ganttProperties.duration||e.hasChildRecords)||e.ganttProperties.duration?'<div class="e-gantt-manualparenttaskbar-left" style='+(this.parent.enableRtl?"margin-right:0px;":"")+'"height:'+(t/5+8)+"px;border-left-width:"+t/5+"px; border-bottom:"+t/5+'px solid transparent;"></div><div class="e-gantt-manualparenttaskbar-right" style="'+(this.parent.enableRtl?"margin-right:-8px;":"")+(this.parent.enableRtl?"right:":"left:")+(e.ganttProperties.width-Math.floor((t/5+8)/5))+"px;height:"+(t/5+8)+"px;border-right-width:"+t/5+"px;border-bottom:"+t/5+'px solid transparent;"></div></div>':""),t='<div class="'+We+'"style='+(this.parent.enableRtl?"right:":"left:")+(e.ganttProperties.left-e.ganttProperties.autoLeft)+"px;width:"+e.ganttProperties.width+"px;height:"+t+"px;cursor:"+(this.parent.editSettings.allowTaskbarEditing?"move;":"default;")+"</div>",n='<div class="'+je+'" style="width:'+(this.parent.renderBaseline?this.taskBarHeight-3:this.taskBarHeight-7)+"px;height:"+(this.parent.renderBaseline?this.taskBarHeight-3:this.taskBarHeight-7)+"px;position:absolute;transform: rotate(45deg);top:"+(40<this.parent.rowHeight?0:2)+"px;left:"+(this.parent.renderBaseline?2:1)+'px;"> </div>';return this.createDivElement(0===e.ganttProperties.duration&&e.hasChildRecords&&!e.ganttProperties.isAutoSchedule?n+i:t+i)},d.prototype.getParentTaskbarNode=function(e,t){var i,n,a,r,s=null,o=this.templateData,s=this.parentTaskbarTemplateFunction?this.parentTaskbarTemplateFunction(oe.extend({index:e},o),this.parent,"ParentTaskbarTemplate",this.getTemplateID("ParentTaskbarTemplate"),!1,void 0,t[0],this.parent.treeGrid.root):(t="",r=void 0,i=this.taskBarHeight/5,i=this.createDivElement('<div class="e-gantt-parent-taskbar-inner-div '+this.getExpandClass(o)+" "+qe+'" style="width:'+(o.ganttProperties.isAutoSchedule?o.ganttProperties.width:o.ganttProperties.autoWidth)+"px;height:"+(o.ganttProperties.isAutoSchedule?this.taskBarHeight:3*i)+"px;margin-top:"+(o.ganttProperties.isAutoSchedule?-1:2*i)+'px; "></div>'),n=this.createDivElement('<div class="e-gantt-parent-progressbar-inner-div '+this.getExpandClass(o)+" "+_e+'" style="border-style:'+(o.ganttProperties.progressWidth?"solid;":"none;")+"width:"+o.ganttProperties.progressWidth+"px;border-top-right-radius:"+this.getBorderRadius(o)+"px;border-bottom-right-radius:"+this.getBorderRadius(o)+'px;height:100%;"></div>'),a=oe.createElement("div"),this.taskLabelTemplateFunction?(e=this.taskLabelTemplateFunction(oe.extend({index:e},o),this.parent,"TaskLabelTemplate",this.getTemplateID("TaskLabelTemplate"),!1,void 0,n[0]))&&0<e.length&&(oe.append(e,a),t=a.innerHTML,t="isCustomTemplate"===(t=this.getTaskLabel(this.parent.labelSettings.taskLabel))?a.innerHTML:t,this.parent.enableHtmlSanitizer)&&"string"==typeof t&&(t=oe.SanitizeHtmlHelper.sanitize(t)):(t="isCustomTemplate"===(t=this.getTaskLabel(this.parent.labelSettings.taskLabel))?this.parent.labelSettings.taskLabel:t,this.parent.enableHtmlSanitizer&&"string"==typeof t&&(t=oe.SanitizeHtmlHelper.sanitize(t))),-1===t.indexOf("null")&&("isCustomTemplate"!==this.getTaskLabel(this.parent.labelSettings.taskLabel)||this.isTemplate(this.parent.labelSettings.taskLabel)||(t=""),r=isNaN(parseInt(t,10))?'<span class="'+we+'" style="line-height:'+(o[this.parent.taskFields.manual]&&o.hasChildRecords?Math.floor(.6*this.taskBarHeight):this.taskBarHeight-1)+"px; text-align:"+(this.parent.enableRtl?"right;":"left;")+"display:inline-block;width:"+(o.ganttProperties.width-10)+"px; height:"+this.taskBarHeight+'px;"></span>':'<span class="'+we+'" style="line-height:'+(o[this.parent.taskFields.manual]&&o.hasChildRecords?Math.floor(.6*this.taskBarHeight):this.taskBarHeight-1)+"px;"+("ResourceView"===this.parent.viewType?"display:inline-flex;":"")+("ResourceView"===this.parent.viewType?"width:"+(o.ganttProperties.width-10):"")+"px; height:"+(this.taskBarHeight-1)+"px;"+("ResourceView"===this.parent.viewType?"display: inline-flex;":"")+("ResourceView"===this.parent.viewType?"width:"+(o.ganttProperties.width-10):"")+"px; height:"+this.taskBarHeight+'px;"></span>',e=this.createDivElement(r)[0],this.parent.disableHtmlEncode?e.innerText=t:e.innerHTML=t,(r=this.parent.labelSettings.taskLabel)&&r.elementRef&&e.appendChild(a),n[0].appendChild(e),""!==n[0].querySelectorAll(".e-task-label")[0].textContent&&!this.isTemplate(r)&&n[0].querySelectorAll(".e-task-label")[0].children[0]&&this.parent.disableHtmlEncode&&n[0].querySelectorAll(".e-task-label")[0].children[0].remove(),""===n[0].querySelectorAll(".e-task-label")[0].textContent)&&r&&!r.elementRef&&""!==a.innerHTML&&(n[0].querySelectorAll(".e-task-label")[0].textContent=r),t='<div class="e-gantt-parent-milestone" style="width:'+(this.parent.renderBaseline?this.taskBarHeight-3:this.taskBarHeight-7)+"px;height:"+(this.parent.renderBaseline?this.taskBarHeight-3:this.taskBarHeight-7)+"px;position:absolute;transform: rotate(45deg);top:"+(40<this.parent.rowHeight?0:2)+"px;left:"+(this.parent.renderBaseline?2:1)+'px;"> </div>',i[0].appendChild([].slice.call(n)[0]),o.ganttProperties.isMilestone?this.createDivElement(o.ganttProperties.isAutoSchedule?t:""):i);return this.parent.enableRtl&&s[0]&&s[0].querySelector(".e-task-label")&&(s[0].querySelector(".e-task-label").style.marginLeft="15px",s[0].querySelector(".e-task-label").style.marginRight="8px",s[0].querySelector(".e-gantt-parent-progressbar"))&&(s[0].querySelector(".e-gantt-parent-progressbar").style.textAlign="left"),s},d.prototype.getTableTrNode=function(e){var t,i,n=this,a=oe.createElement("table"),r="Horizontal"===this.parent.gridLines||"Both"===this.parent.gridLines?"e-chart-row-border":"",s=(this.parent.treeGridModule.isPersist?setTimeout(function(){oe.isNullOrUndefined(n.parent.treeGrid.grid)||oe.isNullOrUndefined(n.parent.treeGrid.grid.contentModule)||oe.isNullOrUndefined(n.parent.treeGrid.grid.contentModule.getRows())||(i=n.parent.treeGrid.grid.contentModule.getRows()[e],t=i&&i.isSelected?"e-active":"")},0):(i=this.parent.treeGrid.grid.contentModule.getRows()[e],t=i&&i.isSelected?"e-active":""),a.querySelector("tbody")),o=(s||(s=document.createElement("tbody"),a.appendChild(s)),document.createElement("tr")),l=(o.classList.add(this.getRowClassName(this.templateData),xe),t&&o.classList.add(t),o.style.display=this.getExpandDisplayProp(this.templateData),o.style.height=this.parent.rowHeight+"px",document.createElement("td"));return r?l.classList.add(Me,r):l.classList.add(Me),l.style.width=this.parent.timelineModule.totalTimelineWidth+"px",o.appendChild(l),s.appendChild(o),a.childNodes},d.prototype.initializeChartTemplate=function(){oe.isNullOrUndefined(this.parent.parentTaskbarTemplate)||(this.parentTaskbarTemplateFunction=this.templateCompiler(this.parent.parentTaskbarTemplate)),!oe.isNullOrUndefined(this.parent.labelSettings.leftLabel)&&this.isTemplate(this.parent.labelSettings.leftLabel)&&(this.leftTaskLabelTemplateFunction=this.templateCompiler(this.parent.labelSettings.leftLabel)),!oe.isNullOrUndefined(this.parent.labelSettings.rightLabel)&&this.isTemplate(this.parent.labelSettings.rightLabel)&&(this.rightTaskLabelTemplateFunction=this.templateCompiler(this.parent.labelSettings.rightLabel)),!oe.isNullOrUndefined(this.parent.labelSettings.taskLabel)&&this.isTemplate(this.parent.labelSettings.taskLabel)&&(this.taskLabelTemplateFunction=this.templateCompiler(this.parent.labelSettings.taskLabel)),oe.isNullOrUndefined(this.parent.taskbarTemplate)||(this.childTaskbarTemplateFunction=this.templateCompiler(this.parent.taskbarTemplate)),oe.isNullOrUndefined(this.parent.milestoneTemplate)||(this.milestoneTemplateFunction=this.templateCompiler(this.parent.milestoneTemplate))},d.prototype.createDivElement=function(e){var t=document.createElement("div");return this.parseTemplate(e).forEach(function(e){return t.appendChild(e)}),t.childNodes},d.prototype.parseTemplate=function(e){var t=this;return this.parseHtmlStringToElementTree(e).map(function(e){return t.constructElementFromNode(e)})},d.prototype.parseHtmlStringToElementTree=function(e){for(var t=[],i=[],n=0;null!==(o=this.tagRegex.exec(e));){var a=o[0],r=o[1],s=o[2],s=void 0===s?"":s,o=e.substring(n,o.index).trim(),n=this.tagRegex.lastIndex,r={tagName:r,attributes:s,children:[]};a.startsWith("</")?(0<i.length&&o&&(i[i.length-1].value=o),i.pop()):a.endsWith("/>")||((0<i.length?i[i.length-1].children:t).push(r),i.push(r))}return t},d.prototype.constructElementFromNode=function(e){var t=this,i=document.createElement(e.tagName);return e.value&&(i.textContent=e.value),this.setAttributes(i,e.attributes),e.children.forEach(function(e){e=t.constructElementFromNode(e);i.appendChild(e)}),i},d.prototype.setAttributes=function(e,t){for(t=t.replace(/style=([^"'\s][^ >]*)/g,'style="$1"');null!==(n=this.attributeRegex.exec(t));){var i=n[1],n=n[2];"class"===i?e.className=n:"style"===i?e.style.cssText=this.cleanStyleString(n):e.setAttribute(i,n)}},d.prototype.cleanStyleString=function(e){return e.split(";").map(function(e){return e.trim()}).filter(Boolean).join("; ")},d.prototype.isTemplate=function(e){for(var t=!1,i=0;i<this.parent.ganttColumns.length;i++)if(e===this.parent.ganttColumns[i].field){t=!0;break}return t="string"!=typeof e||0===e.indexOf("#")||-1<e.indexOf("<")||-1<e.indexOf("$")||!t},d.prototype.getTemplateID=function(e){return this.parent.element.id+e},d.prototype.leftLabelContainer=function(){var e='<div class="'+(this.leftTaskLabelTemplateFunction?"e-left-label-container e-left-label-temp-container":me)+' " tabindex="-1" role="term" style="height:'+(this.parent.rowHeight-2)+"px;width:"+this.taskNameWidth(this.templateData)+'"></div>';return this.createDivElement(e)},d.prototype.taskbarContainer=function(){var e=this.templateData,t=!(!this.parent.editModule||!this.parent.editSettings.allowTaskbarEditing||"ParentResizing"!==this.parent.editModule.taskbarEditModule.taskBarEditAction),t='<div class="'+S+" "+this.parent.getUnscheduledTaskClass(e.ganttProperties)+" "+(e.ganttProperties.cssClass||"")+'"  tabindex="-1" role="term" style="'+(!e.ganttProperties.isMilestone||t||e.hasChildRecords&&!e.ganttProperties.isAutoSchedule?"width:"+e.ganttProperties.width+"px;margin-top:"+this.taskBarMarginTop+"px;"+(this.parent.enableRtl?"right:":"left:")+(!e.hasChildRecords||e.ganttProperties.isAutoSchedule?e.ganttProperties.left:e.ganttProperties.autoLeft)+"px;height:"+this.taskBarHeight+"px;cursor:"+(this.parent.editSettings.allowTaskbarEditing?"move;":"default;"):"width:"+this.milestoneHeight+"px;height:"+this.milestoneHeight+"px;margin-top:"+this.milestoneMarginTop+"px;"+(this.parent.enableRtl?"right:":"left:")+(e.ganttProperties.left-this.milestoneHeight/2)+"px;cursor:"+(this.parent.editSettings.allowTaskbarEditing?"move;":"default;"))+'"></div>';return this.createDivElement(t)},d.prototype.rightLabelContainer=function(){var e='<div class="'+(this.rightTaskLabelTemplateFunction?"e-right-label-container e-right-label-temp-container":De)+'"  tabindex="-1" role="term" style="'+(this.parent.enableRtl?"right:":"left:")+this.getRightLabelLeft(this.templateData)+"px; height:"+(this.parent.rowHeight-2)+'px;"></div>';return this.createDivElement(e)},d.prototype.childTaskbarLeftResizer=function(){var e=!oe.isNullOrUndefined(document.body.className)&&document.body.className.includes("e-bigger")?5:-2,e='<div class="'+Oe+" "+Le+'"style="'+(this.parent.enableRtl?"right:":"left:")+e+"px;height:"+this.taskBarHeight+'px;z-index:1"></div>';return this.createDivElement(e)},d.prototype.childTaskbarRightResizer=function(){var e=!oe.isNullOrUndefined(document.body.className)&&document.body.className.includes("e-bigger")?-17:-11,e='<div class="'+Ie+" "+Le+'"style="'+(this.parent.enableRtl?"right:":"left:")+(this.templateData.ganttProperties.width+e)+"px;height:"+this.taskBarHeight+'px;z-index:1"></div>';return this.createDivElement(e)},d.prototype.childTaskbarProgressResizer=function(){var e=this.parent.enableRtl?this.templateData.ganttProperties.progressWidth+8:this.templateData.ganttProperties.progressWidth-6,e='<div class="'+Ee+'"style="'+(this.parent.enableRtl?"right:":"left:")+e+"px;margin-top:"+(this.taskBarHeight-4)+'px;"><div class="'+Ue+'"><div class="'+Fe+'"></div><div class="'+Ne+'"></div></div>';return this.createDivElement(e)},d.prototype.getLeftPointNode=function(){var e=this.templateData,t=!oe.isNullOrUndefined(document.body.className)&&document.body.className.includes("e-bigger")?12:0,i=!oe.isNullOrUndefined(document.body.className)&&document.body.className.includes("e-bigger")?6:3,t=-(2+this.connectorPointWidth+t),i=-(this.connectorPointWidth+i),n=Math.floor(this.milesStoneRadius-this.connectorPointWidth/2),a=!this.templateData.ganttProperties.isAutoSchedule&&this.templateData.hasChildRecords&&this.parent.allowParentDependency?"":"margin-top:"+this.connectorPointMargin+"px",r=!0,n=(e.hasChildRecords&&!this.parent.allowParentDependency&&(r=!1),'<div class="e-left-connectorpoint-outer-div" style="'+(e.ganttProperties.isMilestone?"margin-top:"+n+"px;left:"+i+"px;":a+";left:"+t+"px;")+'"><div class="'+(r?st:"")+" "+this.parent.getUnscheduledTaskClass(e.ganttProperties)+'" style="width: '+this.connectorPointWidth+"px;"+(this.parent.enableRtl?"margin-right:2px;":"")+"height: "+this.connectorPointWidth+'px;">'+this.touchLeftConnectorpoint+"</div></div>");return this.createDivElement(n)},d.prototype.getRightPointNode=function(){var e=this.templateData,t=-(3+(!oe.isNullOrUndefined(document.body.className)&&document.body.className.includes("e-bigger")?-12:0)),i=Math.floor(this.milesStoneRadius-this.connectorPointWidth/2),n=!this.templateData.ganttProperties.isAutoSchedule&&this.templateData.hasChildRecords&&this.parent.allowParentDependency?"":"margin-top:"+this.connectorPointMargin+"px",a=!0,i=(e.hasChildRecords&&!this.parent.allowParentDependency&&(a=!1),'<div class="'+ht+'" style="'+(e.ganttProperties.isMilestone?"left:"+(!oe.isNullOrUndefined(document.body.className)&&document.body.className.includes("e-bigger")?this.milestoneHeight+5:this.milestoneHeight-2)+"px;margin-top:"+i+"px;":"left:"+(e.ganttProperties.width+t)+"px;"+n+";")+'"><div class="'+(a?ot:"")+" "+this.parent.getUnscheduledTaskClass(e.ganttProperties)+'" style="width:'+this.connectorPointWidth+"px;height:"+this.connectorPointWidth+'px;">'+this.touchRightConnectorpoint+"</div></div>");return this.createDivElement(i)},d.prototype.getTaskLabel=function(e){var t=this.parent.ganttColumns.length,i=null;if(oe.isNullOrUndefined(e)||""===e)i="";else if(e===this.parent.taskFields.resourceInfo)i=this.getResourceName(this.templateData);else{for(var n=0;n<t;n++)if(e===this.parent.ganttColumns[n].field){i=this.getFieldValue(this.templateData[e]).toString();break}if(oe.isNullOrUndefined(i))return"isCustomTemplate"}return i},d.prototype.getExpandDisplayProp=function(e){return e=this.templateData,this.parent.getExpandStatus(e)?"table-row":"none"},d.prototype.getRowClassName=function(e){var t="gridrowtaskId",i=(e=this.templateData).parentItem;return i&&(t+=i.taskId.toString()),t=(t+="level")+e.level.toString()},d.prototype.getBorderRadius=function(e){e=(e=this.templateData).ganttProperties.width-e.ganttProperties.progressWidth;return e<=4?4-e:0},d.prototype.getSplitTaskBorderRadius=function(e){e=e.width-e.progressWidth;return e<=4?4-e:0},d.prototype.taskNameWidth=function(e){var t=(e=this.templateData).ganttProperties,t=e.ganttProperties.isMilestone?e.ganttProperties.left-this.parent.getTaskbarHeight()/2:e.hasChildRecords&&!t.isAutoSchedule?this.parent.allowUnscheduledTasks?t.left<t.autoLeft?t.left:t.autoLeft:t.autoStartDate.getTime()<t.startDate.getTime()?t.autoLeft:t.left:e.ganttProperties.left;return(t=t<0?0:t)+"px"},d.prototype.getRightLabelLeft=function(e){var t,i=(e=this.templateData).ganttProperties;return e.ganttProperties.isMilestone?e.ganttProperties.left+this.parent.getTaskbarHeight()/2:e.hasChildRecords&&!i.isAutoSchedule?(i=this.parent.allowUnscheduledTasks?(t=i.left<i.autoLeft?i.autoLeft:i.left,i.autoWidth):(t=i.autoStartDate.getTime()<i.startDate.getTime()?i.autoLeft:i.left,(i.autoEndDate.getTime()<i.endDate.getTime()?this.parent.dataOperation.getTaskLeft(i.endDate,i.isMilestone):this.parent.dataOperation.getTaskLeft(i.autoEndDate,i.isMilestone))-t),t+i):e.ganttProperties.left+e.ganttProperties.width},d.prototype.getExpandClass=function(e){return(e=this.templateData).expanded?"e-row-expand":!e.expanded&&e.hasChildRecords?"e-row-collapse":""},d.prototype.getFieldValue=function(e){return oe.isNullOrUndefined(e)?"":e},d.prototype.getResourceName=function(e){e=this.templateData;var t=null;if(!oe.isNullOrUndefined(e.ganttProperties.resourceInfo)){var i=e.ganttProperties.resourceInfo.length;if(0<i){for(var n=0;n<i;n++){var a=e.ganttProperties.resourceInfo[n][this.parent.resourceFields.name],r=e.ganttProperties.resourceInfo[n][this.parent.resourceFields.unit];100!==r&&(a+="["+r+"%]"),oe.isNullOrUndefined(t)?t=a:t+=" , "+a}return t}}return""},d.prototype.initChartHelperPrivateVariable=function(){var e=this.parent.renderBaseline?.45:!oe.isNullOrUndefined(document.body.className)&&document.body.className.includes("e-bigger")?.7:.62,t=this.parent.renderBaseline?4:2,i=this.parent.renderBaseline?1.13:.82;this.parent.rowHeight=oe.isNullOrUndefined(this.parent.rowHeight)?36:this.parent.rowHeight,this.baselineColor=oe.isNullOrUndefined(this.parent.baselineColor)||""===this.parent.baselineColor?null:this.parent.baselineColor,this.taskBarHeight=oe.isNullOrUndefined(this.parent.taskbarHeight)||this.parent.taskbarHeight>=this.parent.rowHeight?Math.floor(this.parent.rowHeight*e):this.parent.taskbarHeight,this.parent.renderBaseline&&(e=void 0,e=this.taskBarHeight+this.baselineHeight<=this.parent.rowHeight?this.taskBarHeight:this.taskBarHeight-(this.baselineHeight+1),this.taskBarHeight=e),this.milestoneHeight=Math.floor(this.taskBarHeight*i),this.taskBarMarginTop=Math.floor((this.parent.rowHeight-this.taskBarHeight)/t),this.milestoneMarginTop=Math.floor((this.parent.rowHeight-this.milestoneHeight)/2),this.milesStoneRadius=Math.floor(this.milestoneHeight/2),this.baselineTop=-(Math.floor(this.parent.rowHeight-(this.taskBarHeight+this.taskBarMarginTop))-4),this.connectorPointWidth=this.parent.isAdaptive?Math.round(this.taskBarHeight/2):9,this.connectorPointMargin=Math.floor(this.taskBarHeight/2-this.connectorPointWidth/1.5)},d.prototype.refreshGanttRows=function(){if(this.parent.currentViewData=this.parent.treeGrid.getCurrentViewRecords().slice(),this.createTaskbarTemplate(),this.parent.showOverAllocation){for(var e=0;e<this.parent.currentViewData.length;e++){var t=this.parent.currentViewData[e];0<t.childRecords.length&&(this.parent.setRecordValue("workTimelineRanges",this.parent.dataOperation.mergeRangeCollections(t.ganttProperties.workTimelineRanges,!0),t.ganttProperties,!0),this.parent.dataOperation.calculateRangeLeftWidth(t.ganttProperties.workTimelineRanges))}this.parent.ganttChartModule.renderRangeContainer(this.parent.currentViewData)}this.parent.ganttChartModule.updateLastRowBottomWidth()},d.prototype.createTaskbarTemplate=function(){var e,t=this,i=[].slice.call(this.ganttChartTableBody.querySelectorAll("tr")),n=(this.ganttChartTableBody.innerHTML="",[]),a=this.parent.treeGridModule.prevCurrentView;if(this.refreshedTr=[],this.refreshedData=[],this.parent.enableImmutableMode&&a&&0<a.length&&this.isUpdated){for(var r={},s=[],o=this.parent.treeGrid.getPrimaryKeyFieldNames()[0],l=0;l<a.length;l++)s[l]=i[l],r[a[l][o]]=l;for(var d=0;d<this.parent.currentViewData.length;d++){var h=r[this.parent.currentViewData[d][o]],p=this.parent.modifiedRecords.indexOf(this.parent.currentViewData[d]);oe.isNullOrUndefined(h)||-1!==p||this.parent.isFromRenderBaseline?(g=this.getGanttChartRow(d,this.parent.currentViewData[d]),this.ganttChartTableBody.appendChild(g),this.refreshedTr.push(this.ganttChartTableBody.querySelectorAll("tr")[d]),this.refreshedData.push(this.parent.currentViewData[d])):this.ganttChartTableBody.appendChild(s[h]),this.ganttChartTableBody.querySelectorAll("tr")[d].setAttribute("aria-rowindex",(d+1).toString())}}else{for(var u=oe.createElement("tbody",{id:this.parent.element.id+"GanttTaskTableBody"}),l=0;l<this.parent.currentViewData.length;l++){var c=this.parent.currentViewData[l],g=(!c.expanded&&this.parent.enableMultiTaskbar&&n.push(c),this.getGanttChartRow(l,c));c.hasChildRecords&&!c.expanded&&this.parent.enableMultiTaskbar&&!this.parent.allowTaskbarOverlap&&this.updateDragDropRecords(c,g),u.appendChild(g),this.parent.enableImmutableMode&&(this.refreshedTr.push(u.querySelectorAll("tr")[l]),this.refreshedData.push(this.parent.currentViewData[l])),this.parent.selectionModule&&this.parent.allowSelection&&this.parent.selectionModule.maintainSelectedRecords(parseInt(g.getAttribute("aria-rowindex"),10)-1)}(e=this.ganttChartTableBody).replaceChildren.apply(e,u.childNodes),this.ganttChartTableBody.childNodes.forEach(function(e){e instanceof Element&&(e.addEventListener("touchmove",t.handleTouchMove),e.addEventListener("touchend",t.handleTouchEnd))}),this.parent.initialChartRowElements=this.parent.ganttChartModule.getChartRows()}if(this.parent.enableCriticalPath&&this.parent.criticalPathModule&&(e=this.parent.criticalPathModule).criticalPathCollection&&this.parent.criticalPathModule.criticalConnectorLine(e.criticalPathCollection,e.detailPredecessorCollection,!0,e.predecessorCollectionTaskIds),this.parent.renderTemplates(),this.triggerQueryTaskbarInfo(),this.parent.modifiedRecords=[],this.parent.showOverAllocation&&this.updateOverlapped(),n.length)for(var f=0;f<n.length;f++)n[f].hasChildRecords&&(this.parent.isGanttChartRendered=!0,this.parent.chartRowsModule.refreshRecords([n[f]]));this.parent.isGanttChartRendered=!0,this.parent.renderTemplates()},d.prototype.getGanttChartRow=function(e,t){this.templateData=t;var i,n,a=this.getTableTrNode(e),r=this.getLeftLabelNode(e);if((o=this.taskbarContainer())[0].setAttribute("aria-label",this.generateAriaLabel(this.templateData)),o[0].setAttribute("rowUniqueId",this.templateData.ganttProperties.rowUniqueID),i=this.getLeftPointNode(),(this.templateData.ganttProperties.isAutoSchedule&&"ProjectView"===this.parent.viewType||!this.templateData.hasChildRecords)&&o[0].appendChild([].slice.call(i)[0]),this.templateData.hasChildRecords){var s=void 0;if(!this.parent.enableMultiTaskbar||this.parent.enableMultiTaskbar&&this.templateData.expanded)s=this.getParentTaskbarNode(e,o);else for(var o=[],l=0;l<this.templateData.childRecords.length;l++){this.templateData=this.templateData.childRecords[l];var d=this.taskbarContainer();d[0].setAttribute("aria-label",this.generateAriaLabel(this.templateData)),d[0].setAttribute("rowUniqueId",this.templateData.ganttProperties.rowUniqueID),this.parent.allowParentDependency?(i=this.getLeftPointNode(),!this.templateData.ganttProperties.isAutoSchedule&&this.templateData.hasChildRecords||d[0].appendChild([].slice.call(i)[0])):(i=this.getLeftPointNode(),d[0].appendChild([].slice.call(i)[0])),this.appendChildTaskbars(t,e,d,n,o)}this.templateData.ganttProperties.isAutoSchedule||(h=this.getManualTaskbar(),oe.isNullOrUndefined(h[0]))||(this.parent.allowParentDependency&&(i=this.getLeftPointNode(),h[0].appendChild([].slice.call(i)[0]),p=this.getRightPointNode(),h[0].appendChild([].slice.call(p)[0])),o[0].appendChild([].slice.call(h)[0])),0!==this.templateData.ganttProperties.autoDuration&&!this.templateData.ganttProperties.isMilestone&&s&&0<s.length?oe.append(s,o[0]):0===this.templateData.ganttProperties.duration&&this.templateData.ganttProperties.isMilestone&&this.templateData.ganttProperties.isAutoSchedule&&(p=this.getMilestoneNode(e,o))&&0<p.length&&oe.append(p,o[0]),this.parent.renderBaseline&&this.templateData.ganttProperties.baselineStartDate&&this.templateData.ganttProperties.baselineEndDate&&(this.taskBaselineTemplateNode=this.templateData.ganttProperties.baselineStartDate.getTime()!==this.templateData.ganttProperties.baselineEndDate.getTime()&&(oe.isNullOrUndefined(this.templateData.ganttProperties.baselineStartDate)||oe.isNullOrUndefined(this.templateData.ganttProperties.startDate)||this.templateData.ganttProperties.baselineStartDate.getTime()!==this.templateData.ganttProperties.startDate.getTime()||oe.isNullOrUndefined(this.templateData.ganttProperties.baselineEndDate)||oe.isNullOrUndefined(this.templateData.ganttProperties.endDate)||this.templateData.ganttProperties.baselineEndDate.getTime()!==this.templateData.ganttProperties.endDate.getTime()||!this.templateData.ganttProperties.isMilestone)?this.getTaskBaselineNode():this.getMilestoneBaselineNode()),!(!this.parent.enableMultiTaskbar||this.parent.enableMultiTaskbar&&this.templateData.expanded)||(this.parent.allowParentDependency&&(this.templateData.ganttProperties.isAutoSchedule&&"ProjectView"===this.parent.viewType||!this.templateData.hasChildRecords)||!this.parent.allowParentDependency)&&(n=this.getRightPointNode(),o[0].appendChild([].slice.call(n)[0]))}else this.appendChildTaskbars(t,e,o,n);var h=this.getRightLabelNode(e);if(this.parent.enableMultiTaskbar&&this.templateData.hasChildRecords&&!this.templateData.expanded){s=oe.createElement("div",{className:"e-collapse-parent"});a[0].childNodes[0].childNodes[0].appendChild(s);for(l=0;l<o.length;l++)oe.addClass([o[l]],"collpse-parent-border"),a[0].childNodes[0].childNodes[0].childNodes[0].appendChild([].slice.call(o)[l]);a[0].childNodes[0].childNodes[0].appendChild([].slice.call(r)[0]),this.templateData.ganttProperties.indicators&&0<this.templateData.ganttProperties.indicators.length&&this.appendIndicators(e,a)}else a[0].childNodes[0].childNodes[0].appendChild([].slice.call(r)[0]),a[0].childNodes[0].childNodes[0].appendChild([].slice.call(o)[0]),this.templateData.ganttProperties.indicators&&0<this.templateData.ganttProperties.indicators.length&&this.appendIndicators(e,a),h&&0<h.length&&a[0].childNodes[0].childNodes[0].appendChild([].slice.call(h)[0]);oe.isNullOrUndefined(this.taskBaselineTemplateNode)||a[0].childNodes[0].childNodes[0].appendChild([].slice.call(this.taskBaselineTemplateNode)[0]),this.taskBaselineTemplateNode=null;var p=a[0].childNodes[0];return this.setAriaRowIndex(t,p),p},d.prototype.setAriaRowIndex=function(t,e){var i,n=this,a=this.parent.treeGrid.getCurrentViewRecords(),a=this.parent.virtualScrollModule&&this.parent.enableVirtualization?oe.getValue("virtualScrollModule.visualData",this.parent.treeGrid):a;this.parent.loadChildOnDemand&&this.parent.taskFields.hasChildMapping?(i=this.parent.treeGrid.grid.contentModule.rows.filter(function(e){if(e.data[n.parent.taskFields.id]===t.ganttProperties.taskId)return e})[0],e.setAttribute("data-rowindex",i.index.toString()),e.setAttribute("aria-rowindex",(i.index+1).toString())):(i=a.indexOf(t),e.setAttribute("aria-rowindex",(i+1).toString()))},d.prototype.triggerQueryTaskbarInfo=function(){if(this.parent.queryTaskbarInfo)for(var e=(this.parent.enableImmutableMode?this.refreshedTr:this.ganttChartTableBody.querySelectorAll("tr")).length,t=0;t<e;t++){var i=(this.parent.enableImmutableMode?this.refreshedTr:this.ganttChartTableBody.querySelectorAll("tr"))[t],n=(0<this.refreshedData.length?this.refreshedData:this.parent.currentViewData)[t],a=!oe.isNullOrUndefined(n.ganttProperties.segments)&&n.ganttProperties.segments.length;if(0<a)for(var r=0;r<a;r++){var s=i.getElementsByClassName("e-segmented-taskbar")[r];this.triggerQueryTaskbarInfoByIndex(s,n)}else i&&this.triggerQueryTaskbarInfoByIndex(i,n)}},d.prototype.appendIndicators=function(e,t){for(var i,n,a=this.templateData.ganttProperties.indicators,r=0;r<a.length;r++)(n=this.getIndicatorNode(a[r]))[0].setAttribute("aria-label",a[r].name),i=-1<a[r].name.indexOf("$")||-1<a[r].name.indexOf("#")?this.templateCompiler(a[r].name)(oe.extend({index:e},this.templateData),this.parent,"indicatorLabelText"):((i=oe.createElement("Text")).innerHTML=a[r].name,this.parent.enableHtmlSanitizer&&"string"==typeof a[r].name&&(a[r].name=oe.SanitizeHtmlHelper.sanitize(a[r].name)),i.childNodes),n[0].appendChild([].slice.call(i)[0]),n[0].title=oe.isNullOrUndefined(a[r].tooltip)?"":a[r].tooltip,t[0].childNodes[0].childNodes[0].appendChild([].slice.call(n)[0])},d.prototype.appendChildTaskbars=function(e,t,i,n,a){if(this.templateData.ganttProperties.isMilestone){var r=this.getMilestoneNode(t,i);r&&0<r.length&&oe.append(r,i[0]),this.parent.renderBaseline&&this.templateData.ganttProperties.baselineStartDate&&this.templateData.ganttProperties.baselineEndDate&&(this.taskBaselineTemplateNode=this.templateData.ganttProperties.baselineStartDate.getTime()!==this.templateData.ganttProperties.baselineEndDate.getTime()&&(oe.isNullOrUndefined(this.templateData.ganttProperties.baselineStartDate)||oe.isNullOrUndefined(this.templateData.ganttProperties.startDate)||this.templateData.ganttProperties.baselineStartDate.getTime()!==this.templateData.ganttProperties.startDate.getTime()||oe.isNullOrUndefined(this.templateData.ganttProperties.baselineEndDate)||oe.isNullOrUndefined(this.templateData.ganttProperties.endDate)||this.templateData.ganttProperties.baselineEndDate.getTime()!==this.templateData.ganttProperties.endDate.getTime()||!this.templateData.ganttProperties.isMilestone)?this.getTaskBaselineNode():this.getMilestoneBaselineNode()),a&&(a.push(i[0]),this.templateData=e)}else{var r=H(this.templateData.ganttProperties),s=null,o=null,l=null;if(!oe.isNullOrUndefined(r)){(r||this.templateData.ganttProperties.duration)&&r&&(oe.isNullOrUndefined(this.templateData.ganttProperties.segments)||this.templateData.ganttProperties.segments.length<=0)&&(s=this.childTaskbarProgressResizer(),l=this.childTaskbarLeftResizer(),o=this.childTaskbarRightResizer());var d=this.getChildTaskbarNode(t,i);if(l&&i[0].appendChild([].slice.call(l)[0]),d&&0<d.length)if(this.templateData.ganttProperties.segments&&0<this.templateData.ganttProperties.segments.length){var h=this.templateData.ganttProperties.segments.length,r=this.createDivElement('<div class="e-gantt-split-container-line"></div>');i[0].appendChild([].slice.call(r)[0]);for(var p=0;p<h;p++)oe.append(d,i[0])}else oe.append(d,i[0]);s&&i[0].appendChild([].slice.call(s)[0]),o&&i[0].appendChild([].slice.call(o)[0])}this.parent.renderBaseline&&this.templateData.ganttProperties.baselineStartDate&&this.templateData.ganttProperties.baselineEndDate&&(this.taskBaselineTemplateNode=this.templateData.ganttProperties.baselineStartDate.getTime()!==this.templateData.ganttProperties.baselineEndDate.getTime()&&(oe.isNullOrUndefined(this.templateData.ganttProperties.baselineStartDate)||oe.isNullOrUndefined(this.templateData.ganttProperties.startDate)||this.templateData.ganttProperties.baselineStartDate.getTime()!==this.templateData.ganttProperties.startDate.getTime()||oe.isNullOrUndefined(this.templateData.ganttProperties.baselineEndDate)||oe.isNullOrUndefined(this.templateData.ganttProperties.endDate)||this.templateData.ganttProperties.baselineEndDate.getTime()!==this.templateData.ganttProperties.endDate.getTime()||!this.templateData.ganttProperties.isMilestone)?this.getTaskBaselineNode():this.getMilestoneBaselineNode())}(this.parent.allowParentDependency&&(this.templateData.ganttProperties.isAutoSchedule&&"ProjectView"===this.parent.viewType||!this.templateData.hasChildRecords)||!this.parent.allowParentDependency)&&(n=this.getRightPointNode(),i[0].appendChild([].slice.call(n)[0])),a&&(a.push(i[0]),this.templateData=e)},d.prototype.customizeTaskbars=function(e,t,i){var n,a,r,s=this,e=(e.ganttProperties.segments&&0<e.ganttProperties.segments.length&&t&&t.parentElement&&t.parentElement.parentElement&&t.parentElement.parentElement.parentElement&&(n=t.parentElement.parentElement.parentElement),{data:e,rowElement:t,taskbarElement:i,taskbarType:e.hasChildRecords?"ParentTask":e.ganttProperties.isMilestone?"Milestone":"ChildTask"}),o=this.getClassName(e);"Milestone"===e.taskbarType?(e.milestoneColor=i.querySelector(o[0])?getComputedStyle(i.querySelector(o[0])).backgroundColor:null,e.baselineColor=t.querySelector(o[1])?getComputedStyle(t.querySelector(o[1])).backgroundColor:t.querySelector("."+Ce)?getComputedStyle(t.querySelector("."+Ce)).backgroundColor:null):i&&(a=i.querySelector(o[0]),r=i.querySelector(o[1]),e.taskbarBgColor=oe.isNullOrUndefined(a)?null:(i.classList.contains(Be)?getComputedStyle(i):getComputedStyle(i.querySelector(o[0]))).backgroundColor,e.taskbarBorderColor=oe.isNullOrUndefined(a)?null:i.classList.contains(Be)?getComputedStyle(i).backgroundColor:getComputedStyle(i.querySelector(o[0])).outlineColor,e.progressBarBgColor=oe.isNullOrUndefined(r)?null:(i.classList.contains(Ae)?getComputedStyle(i):getComputedStyle(i.querySelector(o[1]))).backgroundColor,e.baselineColor=n?n.querySelector("."+Ce)?getComputedStyle(n.querySelector("."+Ce)).backgroundColor:null:t.querySelector("."+Ce)?getComputedStyle(t.querySelector("."+Ce)).backgroundColor:null,e.taskLabelColor=i.querySelector("."+we)?getComputedStyle(i.querySelector("."+we)).color:null),n?(e.rightLabelColor=n.querySelector("."+De)&&n.querySelector("."+De).querySelector("."+l)?getComputedStyle(n.querySelector("."+De).querySelector("."+l)).color:null,e.leftLabelColor=n.querySelector("."+me)&&n.querySelector("."+me).querySelector("."+l)?getComputedStyle(n.querySelector("."+me).querySelector("."+l)).color:null):(e.rightLabelColor=t.querySelector("."+De)&&t.querySelector("."+De).querySelector("."+l)?getComputedStyle(t.querySelector("."+De).querySelector("."+l)).color:null,e.leftLabelColor=t.querySelector("."+me)&&t.querySelector("."+me).querySelector("."+l)?getComputedStyle(t.querySelector("."+me).querySelector("."+l)).color:null),this.parent.trigger("queryTaskbarInfo",e,function(e){s.updateQueryTaskbarInfoArgs(e,void 0,void 0)})},d.prototype.triggerQueryTaskbarInfoByIndex=function(e,t){if(!oe.isNullOrUndefined(e)){var i=t;if(!oe.isNullOrUndefined(t.ganttProperties.segments)&&0<t.ganttProperties.segments.length)(r=e)&&this.customizeTaskbars(t,e,r);else if(this.parent.enableMultiTaskbar)for(var n=e.querySelectorAll("."+S),a=0;a<n.length;a++){var r=n[a],i=!t.expanded&&t.hasChildRecords?t.childRecords[a]:i,s="ResourceView"===this.parent.viewType?r.getAttribute("rowUniqueId"):i.ganttProperties.taskId.toString();if(i.ganttProperties.segments&&0<i.ganttProperties.segments.length&&i.parentItem&&!t.expanded&&(s="ResourceView"===this.parent.viewType?t.ganttProperties.rowUniqueID:t.ganttProperties.taskId.toString()),e=(e=this.parent.getRowByID(s))||r.querySelector(".e-gantt-child-taskbar"),e=oe.isNullOrUndefined(e)&&i.ganttProperties.isMilestone?r:e){s=e.querySelectorAll(".e-segmented-taskbar");if(s&&0<s.length)for(var o=(e.querySelector('.e-taskbar-main-container[rowuniqueid="'+i.ganttProperties.rowUniqueID+'"]')||e).querySelectorAll(".e-segmented-taskbar"),l=0;l<o.length;l++)r=o[l],this.customizeTaskbars(i,o[l],r);else this.customizeTaskbars(i,e,r)}}else{var d=e.querySelector("."+S);e&&this.customizeTaskbars(i,e,d)}}},d.prototype.updateQueryTaskbarInfoArgs=function(e,t,i){var n,a=e.rowElement,r=this.parent.enableVirtualization?e.rowElement:e.taskbarElement,s=this.getClassName(e);e.data.ganttProperties.segments&&0<e.data.ganttProperties.segments.length&&(n=a.parentElement.parentElement.parentElement),"Milestone"===e.taskbarType?(r.querySelector(s[0])&&getComputedStyle(r.querySelector(s[0])).backgroundColor!==e.milestoneColor&&(r.querySelector(s[0]).style.backgroundColor=e.milestoneColor),a.querySelector(s[1])&&getComputedStyle(a.querySelector(s[1])).backgroundColor!==e.baselineColor&&(a.querySelector(s[1]).style.backgroundColor=e.baselineColor),a.querySelector("."+Ce)&&getComputedStyle(a.querySelector("."+Ce)).borderTopColor!==e.baselineColor&&(a.querySelector("."+Ce).style.backgroundColor=e.baselineColor)):r&&(r.querySelector(s[0])&&getComputedStyle(r.querySelector(s[0])).backgroundColor!==e.taskbarBgColor&&(r.querySelector(s[0]).style.backgroundColor=e.taskbarBgColor),r.querySelector(s[0])&&getComputedStyle(r.querySelector(s[0])).outlineColor!==e.taskbarBorderColor&&(r.querySelector(s[0]).style.outlineColor=e.taskbarBorderColor),r.querySelector(s[1])&&getComputedStyle(r.querySelector(s[1])).backgroundColor!==e.progressBarBgColor&&(r.querySelector(s[1]).style.backgroundColor=e.progressBarBgColor),r.classList.contains(Be)&&getComputedStyle(r).backgroundColor!==e.taskbarBgColor&&(r.style.backgroundColor=e.taskbarBgColor),r.classList.contains(Be)&&getComputedStyle(r).outlineColor!==e.taskbarBorderColor&&(r.style.outlineColor=e.taskbarBorderColor),r.classList.contains(Ae)&&getComputedStyle(r).backgroundColor!==e.progressBarBgColor&&(r.style.backgroundColor=e.progressBarBgColor),r.querySelector("."+we)&&getComputedStyle(r.querySelector("."+we)).color!==e.taskLabelColor&&(r.querySelector("."+we).style.color=e.taskLabelColor),n?n.querySelector("."+Ce)&&getComputedStyle(n.querySelector("."+Ce)).backgroundColor!==e.baselineColor&&(n.querySelector("."+Ce).style.backgroundColor=e.baselineColor):a.querySelector("."+Ce)&&getComputedStyle(a.querySelector("."+Ce)).backgroundColor!==e.baselineColor&&(a.querySelector("."+Ce).style.backgroundColor=e.baselineColor)),n?(n.querySelector("."+me)&&n.querySelector("."+me).querySelector("."+l)&&getComputedStyle(n.querySelector("."+me).querySelector("."+l)).color!==e.leftLabelColor&&(n.querySelector("."+me).querySelector("."+l).style.color=e.leftLabelColor),n.querySelector("."+De)&&n.querySelector("."+De).querySelector("."+l)&&getComputedStyle(n.querySelector("."+De).querySelector("."+l)).color!==e.rightLabelColor&&(n.querySelector("."+De).querySelector("."+l).style.color=e.rightLabelColor)):(a.querySelector("."+me)&&a.querySelector("."+me).querySelector("."+l)&&getComputedStyle(a.querySelector("."+me).querySelector("."+l)).color!==e.leftLabelColor&&(a.querySelector("."+me).querySelector("."+l).style.color=e.leftLabelColor),a.querySelector("."+De)&&a.querySelector("."+De).querySelector("."+l)&&getComputedStyle(a.querySelector("."+De).querySelector("."+l)).color!==e.rightLabelColor&&(a.querySelector("."+De).querySelector("."+l).style.color=e.rightLabelColor))},d.prototype.getClassName=function(e){var t=[];return t.push("."+("ParentTask"===e.taskbarType?qe:"ChildTask"===e.taskbarType?Be:Ve)),t.push("."+("ParentTask"===e.taskbarType?_e:"ChildTask"===e.taskbarType?Ae:Re)),t},d.prototype.templateCompiler=function(t){if(!oe.isNullOrUndefined(t)&&""!==t)try{return"function"!=typeof t&&document.querySelectorAll(t).length?oe.compile(document.querySelector(t).innerHTML.trim(),this.parent):oe.compile(t,this.parent)}catch(e){return oe.compile(t,this.parent)}return null},d.prototype.updateOverlapped=function(){for(var e=0;e<this.parent.treeGrid.parentData.length;e++)for(var t=this.parent.treeGrid.parentData[e].childRecords,i=0;i<t.length;i++){t[i+1]&&(t[i].ganttProperties.eOverlapped=void 0);for(var n=i+1;n<t.length;n++)t[n].ganttProperties.eOverlapped=void 0,t[i].ganttProperties.startDate.getTime()<t[n].ganttProperties.endDate.getTime()&&t[i].ganttProperties.endDate.getTime()>t[n].ganttProperties.startDate.getTime()?(t[n].ganttProperties.eOverlapped=!0,t[i].ganttProperties.eOverlapped=!0):(oe.isNullOrUndefined(t[n].ganttProperties.eOverlapped)&&(t[n].ganttProperties.eOverlapped=!1),oe.isNullOrUndefined(t[i].ganttProperties.eOverlapped)&&(t[i].ganttProperties.eOverlapped=!1))}},d.prototype.updateDragDropRecords=function(e,t){var i=e.childRecords,n=this.parent.currentViewData.indexOf(e),a=(this.parent.enableRtl?this.parent.element.getElementsByClassName("e-content")[2]:this.parent.element.getElementsByClassName("e-content")[0]).children[0].offsetHeight,r=(t=t||this.ganttChartTableBody.childNodes[n],this.parent.ganttChartModule.isExpandAll||this.parent.ganttChartModule.isCollapseAll?t.style.height=this.parent.treeGrid.getRowByIndex(n).style.height=this.parent.rowHeight+"px":t.style.height=this.parent.treeGrid.getRows()[n].style.height=this.parent.rowHeight+"px",this.parent.contentHeight=a,[]),s=0;if(e){for(var o=0;o<i.length;o++)for(var l=o+1;l<i.length;l++)for(var d=t.getElementsByClassName("e-taskbar-main-container"),h=0;h<d.length;h++){var p=("ResourceView"===this.parent.viewType?i[l]:i[l].ganttProperties).rowUniqueID;i[o].ganttProperties.startDate.getTime()<i[l].ganttProperties.endDate.getTime()&&i[o].ganttProperties.endDate.getTime()>i[l].ganttProperties.startDate.getTime()?d[h].getAttribute("rowuniqueid")===p&&-1===r.indexOf(p)&&(r.push(p),s++,t.children[0].style.verticalAlign="baseline",t.getElementsByClassName("e-taskbar-main-container")[h].style.marginTop=s*this.parent.rowHeight+this.taskBarMarginTop+"px",this.parent.ganttChartModule.isExpandAll||this.parent.ganttChartModule.isCollapseAll?t.style.height=this.parent.treeGrid.getRowByIndex(n).style.height=parseInt(t.style.height,10)+this.parent.rowHeight+"px":t.style.height=this.parent.treeGrid.getRows()[n].style.height=parseInt(t.style.height,10)+this.parent.rowHeight+"px"):d[h].getAttribute("rowuniqueid")===p&&-1===r.indexOf(p)&&this.parent.rowDragAndDropModule&&this.parent.rowDragAndDropModule.draggedRecord&&d[h].getAttribute("rowuniqueid")===this.parent.rowDragAndDropModule.draggedRecord.rowUniqueID&&this.parent.rowDragAndDropModule.draggedRecord.rowUniqueID===i[l].rowUniqueID&&(t.getElementsByClassName("e-taskbar-main-container")[h].style.marginTop=this.parent.editModule.taskbarEditModule.draggedRecordMarginTop)}this.parent.contentHeight=a,document.getElementsByClassName("e-chart-rows-container")[0].style.height=this.parent.contentHeight+"px"}},d.prototype.refreshRow=function(e,t,i){var n=this,a=this.ganttChartTableBody.childNodes[e],r=(i?this.parent.previousFlatData:this.parent.currentViewData)[e];if(-1!==e&&r){var s,o,l=r,d=(!this.parent.allowTaskbarOverlap&&l.expanded&&(this.parent.ganttChartModule.isExpandAll||this.parent.ganttChartModule.isCollapseAll?a.style.height=this.parent.treeGrid.getRowByIndex(e).style.height=this.parent.rowHeight+"px":a.style.height=this.parent.treeGrid.getRows()[e].style.height=this.parent.rowHeight+"px"),l.hasChildRecords&&!l.expanded&&this.parent.enableMultiTaskbar?(a.replaceChild(this.getGanttChartRow(e,l).childNodes[0],a.childNodes[0]),this.parent.renderBaseline&&l.childRecords.forEach(function(e){oe.isNullOrUndefined(e.ganttProperties.baselineStartDate&&e.ganttProperties.baselineEndDate)||a.childNodes[0].appendChild(n.updateTaskBaselineNode(e)[0])})):this.parent.allowTaskbarDragAndDrop&&!l.expanded?a.replaceWith(this.getGanttChartRow(e,l)):(a.replaceChild(this.getGanttChartRow(e,l).childNodes[0],a.childNodes[0]),this.parent.enableMultiTaskbar&&l.parentItem&&(u=l.parentItem.taskId,(s=this.parent.getRecordByID(u)).expanded||(o=this.parent.getRowByID(u)).replaceChild(this.getGanttChartRow(Number(u),s).childNodes[0],o.childNodes[0]))),this.parent.renderTemplates(),this.parent.showOverAllocation&&this.parent.allowTaskbarOverlap&&(l.hasChildRecords||l.parentItem&&this.parent.editedRecords.every(function(e){return e.ganttProperties.taskId.toString()!==l.parentItem.taskId.toString()}))&&(t?this.parent.ganttChartModule.renderRangeContainer(this.parent.currentViewData):(u=l.hasChildRecords?l:this.parent.getRecordByID(l.parentItem.taskId),this.parent.dataOperation.updateOverlappingValues(u),this.parent.ganttChartModule.renderRangeContainer([u]))),!oe.isNullOrUndefined(l.ganttProperties.segments)&&l.ganttProperties.segments.length);if(0<d)for(var h=0;h<d;h++){var p=a.getElementsByClassName("e-segmented-taskbar")[h];this.triggerQueryTaskbarInfoByIndex(p,l)}else this.triggerQueryTaskbarInfoByIndex(a,l),this.parent.enableMultiTaskbar&&l.parentItem&&this.parent.queryTaskbarInfo&&!this.parent.getParentTask(l.parentItem).expanded&&(s=l.parentItem.index,o=void 0,o=(i?this.parent.previousFlatData:this.parent.currentViewData)[s],this.triggerQueryTaskbarInfoByIndex(this.ganttChartTableBody.querySelectorAll("tr")[s],o));var t="ProjectView"===this.parent.viewType?l.ganttProperties.taskId:l.ganttProperties.rowUniqueID,u=(this.parent.ganttChartModule.isExpandAll||this.parent.ganttChartModule.isCollapseAll||this.parent.treeGrid.grid.setRowData(t,l),l.hasChildRecords&&!l.expanded&&this.parent.enableMultiTaskbar&&!this.parent.allowTaskbarOverlap&&this.updateDragDropRecords(r,a),l.hasChildRecords&&this.parent.showOverAllocation&&!this.parent.allowTaskbarOverlap&&(this.parent.dataOperation.updateOverlappingValues(l),this.parent.ganttChartModule.renderRangeContainer(this.parent.currentViewData)),this.parent.ganttChartModule.tempNextElement),i=(this.parent.ganttChartModule.isEditableElement&&u&&(this.parent.treeGrid.grid.focusModule.focus(),oe.addClass([this.parent.treeGrid.getRows()[parseInt(a.getAttribute("aria-rowindex"),10)-1].children[this.parent.ganttChartModule.childrenIndex]],"e-focused"),this.parent.ganttChartModule.tempNextElement=null),this.parent.treeGrid.grid.getRowObjectFromUID(this.parent.treeGrid.grid.getDataRows()[e].getAttribute("data-uid")));oe.isNullOrUndefined(i)||(i.data=l)}},d.prototype.updateResourceTaskbarElement=function(e,t){var i=e.querySelector(".e-taskbar-main-container"),e=("ProjectView"===this.parent.viewType&&e.querySelector(".e-collapse-parent")&&(i=e.querySelector(".e-collapse-parent")),null===e.querySelector(".e-collapse-parent")&&oe.addClass([i],"collpse-parent-border"),e.querySelector("."+S).getAttribute("rowUniqueId")),n=this.parent.getRecordByID(e);if(!oe.isNullOrUndefined(n)&&n.ganttProperties.segments&&0<n.ganttProperties.segments.length)for(var a=i.getElementsByClassName("e-segmented-taskbar"),r=0;r<a.length;r++)this.triggerQueryTaskbarInfoByIndex(a[r],n);else this.parent.queryTaskbarInfo&&(e=i.querySelector(".e-gantt-child-taskbar"),oe.isNullOrUndefined(e)||this.triggerQueryTaskbarInfoByIndex(e,n));e="",n&&!oe.isNullOrUndefined(n.ganttProperties.eOverlapIndex)&&(e=n.ganttProperties.eOverlapIndex.toString()),i=i.cloneNode(!0);i.style.zIndex=e,t[0].childNodes[0].childNodes[0].childNodes[0].appendChild(i)},d.prototype.refreshRecords=function(e,t,i){if(this.parent.isGanttChartRendered){this.parent.renderTemplates(),this.parent.enableMultiTaskbar&&(e=new y.DataManager(e).executeLocal((new y.Query).sortBy("expanded","Descending")));for(var n=0;n<e.length;n++){var a=void 0,a=i?this.parent.ids.indexOf(e[n].ganttProperties.taskId.toString()):this.parent.currentViewData.indexOf(e[n]);this.parent.enableMultiTaskbar&&(!this.parent.enableMultiTaskbar||!e[n].expanded&&this.parent.isLoad)||this.refreshRow(a,t,i)}this.parent.ganttChartModule.updateLastRowBottomWidth()}},d.prototype.removeEventListener=function(){var t=this;this.parent.isDestroyed||(this.ganttChartTableBody.childNodes.forEach(function(e){e instanceof Element&&(e.removeEventListener("touchmove",t.handleTouchMove),e.removeEventListener("touchend",t.handleTouchEnd))}),this.parent.off("renderPanels",this.createChartTable),this.parent.off("dataReady",this.initiateTemplates),this.parent.off("destroy",this.destroy))},d.prototype.destroy=function(){this.removeEventListener()},d.prototype.generateAriaLabel=function(e){e=this.templateData;var t="",i=this.parent.localeObj.getConstant("name"),n=this.parent.localeObj.getConstant("startDate"),a=this.parent.localeObj.getConstant("endDate"),r=this.parent.localeObj.getConstant("duration"),s=e.ganttProperties.taskName,o=e.ganttProperties.startDate,l=e.ganttProperties.endDate,d=e.ganttProperties.duration;return e.ganttProperties.isMilestone?t=i+" "+s+" "+n+" "+this.parent.getFormatedDate(o):(s&&(t+=i+" "+s+" "),o&&(t+=n+" "+this.parent.getFormatedDate(o)+" "),l&&(t+=a+" "+this.parent.getFormatedDate(l)+" "),d&&(t+=r+" "+this.parent.getDurationString(d,e.ganttProperties.durationUnit))),t},d.prototype.generateBaselineAriaLabel=function(e){e=this.templateData;var t="",i=this.parent.localeObj.getConstant("name"),n=this.parent.localeObj.getConstant("startDate"),a=this.parent.localeObj.getConstant("endDate"),r=e.ganttProperties.taskName,s=e.ganttProperties.baselineStartDate,e=e.ganttProperties.baselineEndDate;return t+"Baseline "+(i+" "+r+" ")+(n+" "+this.parent.getFormatedDate(s)+" ")+(a+" "+this.parent.getFormatedDate(e)+" ")},d.prototype.generateSpiltTaskAriaLabel=function(e,t){var i="",n=this.parent.localeObj.getConstant("startDate"),a=this.parent.localeObj.getConstant("endDate"),r=this.parent.localeObj.getConstant("duration"),s=e.startDate,o=e.endDate,e=e.duration;return s&&(i+=n+" "+this.parent.getFormatedDate(s)+" "),o&&(i+=a+" "+this.parent.getFormatedDate(o)+" "),e&&(i+=r+" "+this.parent.getDurationString(e,t.durationUnit)),i},d.prototype.generateTaskLabelAriaLabel=function(e){var t="";return"left"===e&&this.parent.labelSettings.leftLabel&&!this.leftTaskLabelTemplateFunction?t+=this.parent.localeObj.getConstant("leftTaskLabel")+" "+this.getTaskLabel(this.parent.labelSettings.leftLabel):"right"===e&&this.parent.labelSettings.rightLabel&&!this.rightTaskLabelTemplateFunction&&(t+=this.parent.localeObj.getConstant("rightTaskLabel")+" "+this.getTaskLabel(this.parent.labelSettings.rightLabel)),t};var Ji,$i,en=d;function d(e){var t=$i.call(this,e)||this;return t.taskBarHeight=0,t.milestoneHeight=0,t.milesStoneRadius=0,t.baselineTop=0,t.baselineHeight=8,t.touchLeftConnectorpoint="",t.touchRightConnectorpoint="",t.dropSplit=!1,t.refreshedTr=[],t.refreshedData=[],t.isUpdated=!0,t.tagRegex=/<\/?(\w+)([^>]*?)(\/?)>/g,t.attributeRegex=/([\w-]+)\s*=\s*"([^"]*)"/g,t.taskBaselineTemplateNode=null,t.handleTouchMove=function(e){t.parent.ganttChartModule.ganttChartMove(e)},t.handleTouchEnd=function(e){t.parent.ganttChartModule.documentMouseUp(e)},t.parent=e,t.initPublicProp(),t.addEventListener(),t}u.prototype.ensurePredecessorCollection=function(){for(var e=0,t=this.parent.predecessorsCollection;e<t.length;e++){var i=t[e];(i.hasChildRecords||this.parent.allowParentDependency)&&!this.parent.allowParentDependency||this.ensurePredecessorCollectionHelper(i,i.ganttProperties)}},u.prototype.ensurePredecessorCollectionHelper=function(e,t){var i=t.predecessorsName;if(!i||"string"!=typeof i&&"number"!=typeof i){if(i&&"object"==typeof i&&i.length){for(var n=[],a=0;a<i.length;a++){var r=i[a],s={},o=(s.from=oe.getValue("from",r)?oe.getValue("from",r):i[a],s.to=oe.getValue("to",r)?oe.getValue("to",r):t.rowUniqueID,s.type=oe.getValue("type",r)?oe.getValue("type",r):"FS",oe.getValue("offset",r));oe.isNullOrUndefined(o)?(s.offset=0,s.offsetUnit=this.parent.durationUnit.toLocaleLowerCase()):"string"==typeof o?(r=this.getOffsetDurationUnit(oe.getValue("offset",r)),s.offset=r.duration,s.offsetUnit=r.durationUnit):(s.offset=parseFloat(o.toString()),s.offsetUnit=this.parent.durationUnit.toLocaleLowerCase()),this.checkIsParent(s.from.toString())||n.push(s)}this.parent.setRecordValue("predecessor",n,t,!0)}}else this.parent.setRecordValue("predecessor",this.calculatePredecessor(i,e),t,!0);this.parent.setRecordValue("predecessorsName",this.getPredecessorStringValue(e),t,!0),this.parent.setRecordValue("taskData."+this.parent.taskFields.dependency,t.predecessorsName,e),this.parent.setRecordValue(this.parent.taskFields.dependency,t.predecessorsName,e)},u.prototype.updateUnscheduledDependency=function(e){for(var t=this.parent.taskFields,i=oe.isNullOrUndefined(e[t.dependency])?[]:e[t.dependency].toString().split(","),n=0;n<i.length;n++){var a=parseInt(i[n],10);if(!isNaN(a)){var a=this.parent.connectorLineModule.getRecordByID(a.toString()),r=oe.isNullOrUndefined(a)?null:oe.extend({},{},a.taskData,!0);if(!oe.isNullOrUndefined(r)&&oe.isNullOrUndefined(r[t.startDate])&&oe.isNullOrUndefined(r[t.duration])&&oe.isNullOrUndefined(r[t.endDate])){r[t.duration]=1;var s=void 0;if(a.parentItem){for(var o=this.parent.getParentTask(a.parentItem);o&&!o.ganttProperties.startDate;)o=this.parent.getParentTask(o.parentItem);s=o?o.ganttProperties.startDate:this.parent.cloneProjectStartDate}else s=this.parent.cloneProjectStartDate;r[t.startDate]=s,this.parent.updateRecordByID(r)}}}},u.prototype.checkIsParent=function(e){var t=!1;return t=this.parent.connectorLineModule.getRecordByID(e).hasChildRecords?!0:t},u.prototype.getRootParent=function(t){var e=t;return t.parentItem&&(e=this.parent.flatData.filter(function(e){return e.uniqueID===t.parentUniqueID})[0]).parentItem?this.getRootParent(e):e},u.prototype.validateParentPredecessor=function(e,t){if(e&&t)if(t.hasChildRecords&&!e.hasChildRecords){if(e.parentUniqueID===t.uniqueID)return!1;do{if(e.parentItem&&(e=this.parent.flatData[this.parent.ids.indexOf(e.parentItem.taskId)]).uniqueID===t.uniqueID)return!1}while(e.parentItem)}else if(!t.hasChildRecords&&e.hasChildRecords){if(t.parentUniqueID===e.uniqueID)return!1;do{if(t.parentItem&&(t=this.parent.flatData[this.parent.ids.indexOf(t.parentItem.taskId)]).uniqueID===e.uniqueID)return!1}while(t.parentItem)}else if(t.hasChildRecords&&e.hasChildRecords)if(t.parentItem&&e.parentItem){if(e.parentUniqueID===t.uniqueID||e.uniqueID===t.parentUniqueID)return!1}else if(!t.parentItem&&e.parentItem){if(this.getRootParent(e).uniqueID===t.uniqueID)return!1}else if(t.parentItem&&!e.parentItem)if(this.getRootParent(t).uniqueID===e.uniqueID)return!1;return!0},u.prototype.calculatePredecessor=function(e,l){var d,h,p,u=this,e=e.toString(),c=[],g=[],f=[],n=(e.split(",").forEach(function(e){var t,i,n,a,r=!1,s=!1,o=e.split("-"),o=(6===o.length&&(o[4]=o[4]+"-"+o[5],o.pop()),5===o.length&&12<=o[4].length&&(i=e.substring(0,36),/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/.test(i))&&(r=!0),e.includes("-")&&(i=e.lastIndexOf("-"),i=e.substring(i+1),n=((n=e.replace(i,"").trim().match(/(FS|SS|SF|FF)-$/))?n[0]:"")+i,n=n=/^(FS|SS|SF|FF)/.test(n)?n:(i=n.match(/(FS|SS|SF|FF)/))?i[0]+n.slice(n.indexOf(i[0])+i[0].length):e,e.includes("-"))&&/[A-Za-z]/.test(n)&&-1!==(i=e.indexOf(n))&&(a=e.substring(0,i)).includes("-")&&(s=!0),r?(r=i=void 0,1===(i=o[4].split("+")).length?g[0]=e:(r=i[1].length,g[0]=e.slice(0,-(r+1)),g[1]=i[1]),h="+",0<=o[4].indexOf("-")&&(1===(i=o[4].split("-")).length?g[0]=e:(r=i[1].length,g[0]=e.slice(0,-(r+1)),g[1]=i[1]),h="-")):s&&a.includes("-")?g[0]=a:(g=e.split("+"),h="+",0<=e.indexOf("-")&&(g=e.split("-"),h="-")),d=[],"ResourceView"===u.parent.viewType?u.parent.getTaskIds():u.parent.ids),r=(-1===("ResourceView"===u.parent.viewType?o.indexOf("T"+g[0]):o.indexOf(g[0]))&&-1===o.indexOf(g[0])?1===(d=g[0].split(" ")).length&&(-1!==d[0].indexOf(" ")?d=g[0].match(/(\d+|[A-z]+)/g):(d[0]=g[0].slice(0,-2),d[1]=g[0].slice(-2))):d[0]=g[0],"ResourceView"===u.parent.viewType?o.indexOf("T"+d[0]):o.indexOf(d[0]));d[0]&&-1!==r&&(p=1<d.length?"FS"===(t=d[1].toUpperCase())||"FF"===t||"SF"===t||"SS"===t?t:(u.parent.trigger("actionFailure",{error:"The provided dependency type, "+t+", is invalid. Please ensure that the Dependency Type is FS or FF or SS or SF"}),"FS"):e.includes("-")&&/[A-Za-z]/.test(n)&&a.includes("-")&&((t=e.slice(-2).toString()).toUpperCase(),"FS"===t||"FF"===t||"SF"===t||"SS"===t)?t:"FS",i=1<g.length?h+""+g[1]:"0",s=u.getOffsetDurationUnit(i),o={from:d[0],type:p,isDrawn:!1,to:("ResourceView"===u.parent.viewType?l.ganttProperties.taskId:l.ganttProperties.rowUniqueID).toString(),offsetUnit:s.durationUnit,offset:s.duration},r=u.checkIsParent(d[0]),u.parent.allowParentDependency?(n=u.parent.connectorLineModule.getRecordByID(o.to),(a=u.parent.connectorLineModule.getRecordByID(o.from))&&n?u.validateParentPredecessor(a,n)&&(c.push(o),-1===f.indexOf(a))&&a.hasChildRecords&&u.parent.editModule&&u.parent.editModule.cellEditModule&&u.parent.editModule.cellEditModule.isCellEdit&&f.push(oe.extend([],[],[a],!0)[0]):c.push(o),d.splice(0)):r||c.push(o))}),0<f.length&&this.parent.undoRedoModule&&this.parent.editModule&&this.parent.editModule.cellEditModule&&this.parent.editModule.cellEditModule.isCellEdit&&(this.parent.undoRedoModule.getUndoCollection[this.parent.undoRedoModule.getUndoCollection.length-1].connectedRecords=f),[]);return c.map(function(e){var t=e.from,i=e.to,e=c.filter(function(e){return e.from===t&&e.to===i});-1===n.indexOf(e[e.length-1])&&n.push(e[e.length-1])}),n},u.prototype.getPredecessorStringValue=function(e){var t=e.ganttProperties.predecessor,i="",n=[];if(t)for(var a=t.length,r=0;r<a;r++){var s=t[r],o="",l="ResourceView"===this.parent.viewType?e.ganttProperties.taskId:e.ganttProperties.rowUniqueID;s.from!==l.toString()&&(o=s.from+s.type,o="string"==typeof e.ganttProperties.taskId?(n[0]=o.slice(0,-2),n[1]=o.slice(-2),n[0]+" "+n[1]):o,0!==s.offset&&(o+=0<s.offset?"+"+s.offset+" ":s.offset+" ",l=1!==s.offset,"day"===s.offsetUnit?o+=l?this.parent.localeObj.getConstant("days"):this.parent.localeObj.getConstant("day"):"hour"===s.offsetUnit?o+=l?this.parent.localeObj.getConstant("hours"):this.parent.localeObj.getConstant("hour"):o+=l?this.parent.localeObj.getConstant("minutes"):this.parent.localeObj.getConstant("minute")),i=0<i.length?i+","+o:o)}return i},u.prototype.getOffsetDurationUnit=function(e){var t=0,i=this.parent.durationUnit.toLocaleLowerCase(),n=this.parent.durationUnitEditText;if("string"==typeof e){for(var a=e.match(/[^0-9]+|[0-9]+/g),r=0;r<a.length;r++)a[r]=a[r].trim();"-"===a[0]&&a[1]?(a[1]=a[0]+a[1],a.shift()):"+"===a[0]&&a.shift(),"."!==a[1]||isNaN(parseInt(a[2],10))||(a[0]+=a[1]+a[2],a.splice(1,2)),a&&a.length<=2&&(t=parseFloat(a[0]),i=a[1]?a[1].toLowerCase().trim():"",i=-1!==oe.getValue("minute",n).indexOf(i)?"minute":-1!==oe.getValue("hour",n).indexOf(i)?"hour":-1!==oe.getValue("day",n).indexOf(i)?"day":this.parent.durationUnit.toLocaleLowerCase())}else t=e,i=this.parent.durationUnit.toLocaleLowerCase();return isNaN(t)&&(this.parent.trigger("actionFailure",{error:"The provided value for the offset field is invalid.Please ensure the offset field contains only valid numeric values"}),t=0,i=this.parent.durationUnit.toLocaleLowerCase()),{duration:t,durationUnit:i}},u.prototype.updatePredecessors=function(e){void 0===e&&(e=null);for(var t,i=this.parent.predecessorsCollection,n=i.length,a=0;a<n;a++)((t=i[a]).hasChildRecords||this.parent.allowParentDependency)&&!this.parent.allowParentDependency||(this.updatePredecessorHelper(t,i,e),t.ganttProperties.isAutoSchedule)||!this.parent.editSettings.allowEditing||(this.parent.connectorLineEditModule.validatedOffsetIds=[],this.parent.connectorLineEditModule.calculateOffset(t))},u.prototype.updatePredecessorHelper=function(e,t,i){void 0===i&&(i=null);var n=e.ganttProperties.predecessor,a=n.length;t=oe.isNullOrUndefined(t)?[]:t;for(var r=0;r<a;r++){var s=n[r],o="ProjectView"!==this.parent.viewType||oe.isNullOrUndefined(i)?this.parent.connectorLineModule.getRecordByID(s.from):i.get(s.from),l="ResourceView"===this.parent.viewType?e.ganttProperties.taskId:e.ganttProperties.rowUniqueID;s.from!==l.toString()&&o&&(l=void 0,o.ganttProperties.predecessor?((l=oe.extend([],o.ganttProperties.predecessor,[],!0)).push(s),this.parent.setRecordValue("predecessor",l,o.ganttProperties,!0)):((l=[]).push(s),this.parent.setRecordValue("predecessor",l,o.ganttProperties,!0),t.push(o)))}},u.prototype.traverseParents=function(e){this.parent.dataOperation.updateParentItems(e)},u.prototype.updatedRecordsDateByPredecessor=function(e){if(void 0===e&&(e=null),this.parent.autoCalculateDateScheduling&&!(this.parent.isLoad&&this.parent.treeGrid.loadChildOnDemand&&this.parent.taskFields.hasChildMapping)){var t=this.parent.flatData,i=t.length;if(oe.isNullOrUndefined(e)){e=new Map;for(var n=0,a=t;n<a.length;n++){var r=a[n];e.set(r.ganttProperties.rowUniqueID.toString(),r)}}for(var s=0;s<i;s++){var o=t[s],l=o.ganttProperties;if(l.predecessorsName){this.validatePredecessorDates(o,e);var d=l.predecessor;if(d&&1<d.length)for(var h=0,p=d;h<p.length;h++){var u=p[h],c=void 0;(c="ProjectView"===this.parent.viewType?e.get(u.to):this.parent.connectorLineModule.getRecordByID(u.to))&&this.validatePredecessorDates(c,e)}o.hasChildRecords&&l.startDate&&this.parent.allowParentDependency&&this.updateChildItems(o),o.parentItem&&(d=o.parentItem.taskId,l=void 0,l="ProjectView"===this.parent.viewType?e.get(d):this.parent.getRecordByID(d))&&this.traverseParents(l)}}}},u.prototype.updateParentPredecessor=function(e){if(void 0===e&&(e=null),this.parent.enablePredecessorValidation)for(var t=this.parentPredecessors.length-1;0<=t;t--){var i=this.parentPredecessors[t];this.validatePredecessorDates(i,e),i.ganttProperties.startDate&&this.updateChildItems(i)}},u.prototype.validatePredecessorDates=function(e,t){if(void 0===t&&(t=null),e.ganttProperties.predecessor)for(var i=e.ganttProperties.predecessor,n=void 0,a=void 0,r=null,s=("ResourceView"===this.parent.viewType?e.ganttProperties.taskId:e.ganttProperties.rowUniqueID).toString(),o=i.filter(function(e){return e.to===s?e:null}),n=0;n<o.length;n++){var l,d=o[n],r="ProjectView"!==this.parent.viewType||oe.isNullOrUndefined(t)?(a=this.parent.connectorLineModule.getRecordByID(d.from),this.parent.connectorLineModule.getRecordByID(d.to)):(a=t.get(d.from),t.get(d.to));this.parent.allowParentDependency&&a.hasChildRecords&&this.parent.dataOperation.updateParentItems(a),"ProjectView"===this.parent.viewType&&this.parent.allowTaskbarDragAndDrop&&(l=void 0,oe.isNullOrUndefined(r)?(l=this.parent.editModule.taskbarEditModule.previousIds.indexOf(d.to),r=this.parent.editModule.taskbarEditModule.previousFlatData[l]):oe.isNullOrUndefined(a)&&(l=this.parent.editModule.taskbarEditModule.previousIds.indexOf(d.from),a=this.parent.editModule.taskbarEditModule.previousFlatData[l])),this.parent.allowParentDependency&&this.parent.isLoad&&-1===this.parentPredecessors.indexOf(e)&&(e.hasChildRecords||r.hasChildRecords)&&this.parentPredecessors.push(e),(r.ganttProperties.isAutoSchedule||this.parent.validateManualTasksOnLinking)&&this.validateChildGanttRecord(a,r,t)}},u.prototype.validateChildGanttRecord=function(e,t,i){var n,a;void 0===i&&(i=null),this.parent.editedTaskBarItem===t||e&&oe.isNullOrUndefined(H(e.ganttProperties))||t&&oe.isNullOrUndefined(H(t.ganttProperties))||this.parent.isInPredecessorValidation&&(t.ganttProperties.isAutoSchedule||this.parent.validateManualTasksOnLinking)&&(e=t.ganttProperties,n=("ResourceView"===this.parent.viewType?e.taskId:e.rowUniqueID).toString(),a=e.predecessor.filter(function(e){return e.to===n?e:null}),a=this.getPredecessorDate(t,a,i),this.parent.setRecordValue("startDate",a,e,!0),this.parent.dataOperation.updateMappingData(t,"startDate"),i=t.ganttProperties.segments,(oe.isNullOrUndefined(i)||!oe.isNullOrUndefined(i)&&0===i.length)&&this.dateValidateModule.calculateEndDate(t),this.parent.dataOperation.updateWidthLeft(t),!this.parent.isLoad)&&!this.parent.isFromOnPropertyChange&&t.parentItem&&this.parent.isInPredecessorValidation&&this.parent.getParentTask(t.parentItem).ganttProperties.isAutoSchedule&&-1===this.parentIds.indexOf(t.parentItem.uniqueID)&&(this.parentIds.push(t.parentItem.uniqueID),this.parentRecord.push(t.parentItem))},u.prototype.getPredecessorDate=function(i,e,t){var n,a,r,s=this,o=(void 0===t&&(t=null),e.filter(function(e){var t="ResourceView"===s.parent.viewType?i.ganttProperties.taskId:i.ganttProperties.rowUniqueID;return e.to===t.toString()?e:null}));if(o)for(var l=o.length,d=0;d<l;d++){var h=o[d],p="ProjectView"!==this.parent.viewType||oe.isNullOrUndefined(t)?(r=this.parent.connectorLineModule.getRecordByID(h.from),this.parent.connectorLineModule.getRecordByID(h.to)):(r=t.get(h.from),t.get(h.to));"ProjectView"!==this.parent.viewType||!this.parent.allowTaskbarDragAndDrop||oe.isNullOrUndefined(p)&&oe.isNullOrUndefined(r)||(p=oe.isNullOrUndefined(p)?this.getRecord(r,p,h):p,r=oe.isNullOrUndefined(r)?this.getRecord(r,p,h):r),p&&r&&(a=this.getValidatedStartDate(p.ganttProperties,r.ganttProperties,h)),null!==n&&1!==this.dateValidateModule.compareDates(a,n)||(n=a)}return n},u.prototype.getValidatedStartDate=function(e,t,i){var n=i.type,a=i.offset;switch(n){case"FS":o=this.dateValidateModule.getValidEndDate(t),e.isMilestone&&0===a||(o=this.dateValidateModule.checkStartDate(o,e)),0!==a&&(o=this.updateDateByOffset(o,i,e)),s=e.isMilestone?o:this.dateValidateModule.checkStartDate(o,e);break;case"FF":case"SF":var r,s,o="FF"===n?this.dateValidateModule.getValidEndDate(t):this.dateValidateModule.getValidStartDate(t);0!==a&&(o=this.updateDateByOffset(o,i,e)),e.isMilestone||((r=new Date(o)).setDate(r.getDate()-1),o=this.dateValidateModule.checkEndDate(o,e)),s=e.segments&&0!==e.segments.length?(r=this.dateValidateModule.getDuration(e.startDate,e.endDate,e.durationUnit,e.isAutoSchedule,e.isMilestone),this.dateValidateModule.getStartDate(o,r,e.durationUnit,e)):this.dateValidateModule.getStartDate(o,e.duration,e.durationUnit,e);break;case"SS":o=this.dateValidateModule.getValidStartDate(t),0!==a&&(o=this.updateDateByOffset(o,i,e)),s=e.isMilestone?o:this.dateValidateModule.checkStartDate(o,e)}return s},u.prototype.updateDateByOffset=function(e,t,i){var n,a=t.offset,t=t.offsetUnit;return a<0&&!oe.isNullOrUndefined(e)?n=this.dateValidateModule.getStartDate(this.dateValidateModule.checkEndDate(e,i),-1*a,t,i,!0):(oe.isNullOrUndefined(e)||(n=this.dateValidateModule.getEndDate(e,a,t,i,!1)),i.isMilestone||(n=this.dateValidateModule.checkStartDate(n,i))),n},u.prototype.createConnectorLinesCollection=function(e){var t,i=e||this.parent.currentViewData,e=this.parent.pdfExportModule,n=e&&e.isPdfExport,a=(n&&(h=(t=e.helper&&e.helper.exportProps)&&t.fitToWidthSettings,t)&&h&&h.isFitToWidth&&(h=t.exportType,t=e.helper.beforeSinglePageExport,i="CurrentViewData"===h?t.cloneCurrentViewData:t.cloneFlatData),i.length),e=(this.parent.pdfExportModule&&this.parent.pdfExportModule.isPdfExport&&this.parent.pdfExportModule.helper.exportProps&&this.parent.pdfExportModule.helper.exportProps.fitToWidthSettings&&this.parent.pdfExportModule.helper.exportProps.fitToWidthSettings.isFitToWidth&&this.parent.pdfExportModule.isPdfExport?this.parent.connectorLineModule.expandedRecords=this.parent.virtualScrollModule&&this.parent.enableVirtualization?this.parent.pdfExportModule.helper.beforeSinglePageExport.cloneFlatData:this.parent.getExpandedRecords(this.parent.pdfExportModule.helper.beforeSinglePageExport.cloneFlatData):this.parent.connectorLineModule.expandedRecords=this.parent.virtualScrollModule&&this.parent.enableVirtualization?this.parent.updatedRecords:this.parent.getExpandedRecords(this.parent.updatedRecords),this.parent.flatData),r=n?null:new Map;if(!n&&!oe.isNullOrUndefined(e))for(var s=0,o=e;s<o.length;s++){var l=o[s];r.set(l.ganttProperties.rowUniqueID.toString(),l)}for(var d,h=this.parent.ganttChartModule.getChartRows(),p=!oe.isNullOrUndefined(h)&&h[0]&&h[0].offsetHeight,u=0;u<a;u++)this.parent.editModule&&0<this.parent.editModule.deletedTaskDetails.length&&(d=i[u].parentItem)&&(d=oe.isNullOrUndefined(r)?this.parent.getRecordByID(d.taskId.toString()):r.get(d.taskId.toString()),this.parent.setRecordValue("parentItem",this.parent.dataOperation.getCloneParent(d),i[u])),this.parent.undoRedoModule&&this.parent.undoRedoModule.canUpdateIndex&&(i[u].index=u,i[u].parentItem)&&this.parent.getParentTask(i[u].parentItem)&&(i[u].parentItem.index=this.parent.getParentTask(i[u].parentItem).index),(d=i[u].ganttProperties.predecessor)&&this.addPredecessorsCollection(d,r,p)},u.prototype.addPredecessorsCollection=function(e,t,i){var n,a,r;if(void 0===t&&(t=null),void 0===i&&(i=0),e)for(n=e.length,a=0;a<n;a++){var s;if((s=e[a]).from===s.to)break;var o="ProjectView"!==this.parent.viewType||oe.isNullOrUndefined(t)?(r=this.parent.connectorLineModule.getRecordByID(s.from),this.parent.connectorLineModule.getRecordByID(s.to)):(r=t.get(s.from),t.get(s.to)),l=!0;(l=(r&&r.hasChildRecords&&!r.expanded||o&&o.hasChildRecords&&!o.expanded)&&!this.parent.allowTaskbarOverlap&&"ProjectView"===this.parent.viewType?!1:l)&&this.parent.connectorLineModule.expandedRecords&&-1!==this.parent.connectorLineModule.expandedRecords.indexOf(r)&&-1!==this.parent.connectorLineModule.expandedRecords.indexOf(o)&&this.updateConnectorLineObject(r,o,s,i)}},u.prototype.updateConnectorLineObject=function(e,t,i,n){n=this.parent.connectorLineModule.createConnectorLineObject(e,t,i,n=void 0===n?0:n);return n&&(t.isCritical&&e.isCritical&&(n.isCritical=!0),0<this.parent.connectorLineIds.length&&-1===this.parent.connectorLineIds.indexOf(n.connectorLineId)||0===this.parent.connectorLineIds.length?(this.parent.updatedConnectorLineCollection.push(n),this.parent.connectorLineIds.push(n.connectorLineId)):-1!==this.parent.connectorLineIds.indexOf(n.connectorLineId)&&(t=this.parent.connectorLineIds.indexOf(n.connectorLineId),this.parent.updatedConnectorLineCollection[t]=n),i.isDrawn=!0),n},u.prototype.validatePredecessor=function(e,t,i){if(this.parent.isInPredecessorValidation&&e.ganttProperties.predecessor){for(var n,a=this.parent.editModule.taskbarEditModule,r=void 0,s=(a&&(r=a.taskBarEditRecord),e.ganttProperties.predecessor),o=void 0,l=null,d=("ResourceView"===this.parent.viewType?e.ganttProperties.taskId:e.ganttProperties.rowUniqueID).toString(),h=s.filter(function(e){return e.to===d?e:null}),p=s.filter(function(e){return e.from===d?e:null}),u=void 0,c=0;c<h.length;c++){n=h[c],o=this.parent.connectorLineModule.getRecordByID(n.from),(l=this.parent.connectorLineModule.getRecordByID(n.to)).parentItem&&(u=this.parent.getTaskByUniqueID(l.parentItem.uniqueID),-1===this.parent.editModule.updateParentRecords.indexOf(u))&&this.parent.editModule.updateParentRecords.push(u),o.parentItem&&(u=this.parent.getTaskByUniqueID(o.parentItem.uniqueID),-1===this.parent.editModule.updateParentRecords.indexOf(u))&&this.parent.editModule.updateParentRecords.push(u),"ProjectView"!==this.parent.viewType||!this.parent.allowTaskbarDragAndDrop||oe.isNullOrUndefined(l)&&oe.isNullOrUndefined(o)||(l=oe.isNullOrUndefined(l)?this.getRecord(o,l,n):l,o=oe.isNullOrUndefined(o)?this.getRecord(o,l,n):o),this.parent.isInPredecessorValidation&&l.ganttProperties.isAutoSchedule?this.parent.isValidationEnabled=!0:this.parent.isValidationEnabled=!1;var g="ResourceView"===this.parent.viewType?e.ganttProperties.taskId:e.ganttProperties.rowUniqueID;g.toString()!==n.to&&g.toString()!==n.from||i&&"predecessor"!==i||(this.validateChildGanttRecord(o,l),this.parent.editModule.editedRecord&&this.parent.editModule.editedRecord.hasChildRecords&&!this.parent.editModule.editedRecord.parentItem&&(this.isValidatedParentTaskID=l.ganttProperties.taskId))}for(var f,c=0;c<p.length;c++){if(m=p[c],o=this.parent.connectorLineModule.getRecordByID(m.from),(l=this.parent.connectorLineModule.getRecordByID(m.to)).parentItem&&(u=this.parent.getTaskByUniqueID(l.parentItem.uniqueID),-1===this.parent.editModule.updateParentRecords.indexOf(u))&&this.parent.editModule.updateParentRecords.push(u),o.parentItem&&(u=this.parent.getTaskByUniqueID(o.parentItem.uniqueID),-1===this.parent.editModule.updateParentRecords.indexOf(u))&&this.parent.editModule.updateParentRecords.push(u),"ProjectView"!==this.parent.viewType||!this.parent.allowTaskbarDragAndDrop||oe.isNullOrUndefined(l)&&oe.isNullOrUndefined(o)||(l=oe.isNullOrUndefined(l)?this.getRecord(o,l,m):l,o=oe.isNullOrUndefined(o)?this.getRecord(o,l,m):o),this.parent.isInPredecessorValidation&&l.ganttProperties.isAutoSchedule?this.parent.isValidationEnabled=!0:this.parent.isValidationEnabled=!1,"predecessor"!==i&&this.parent.isValidationEnabled){if(this.validateChildGanttRecord(o,l),this.parent.editModule.editedRecord&&l){var m=o.parentItem?this.getRootParent(o):null;if(l.hasChildRecords&&(!this.parent.editModule.editedRecord.hasChildRecords||!l.parentItem&&(!m||m.ganttProperties.taskId===this.parent.editModule.editedRecord.ganttProperties.taskId))&&this.isValidatedParentTaskID!==l.ganttProperties.taskId){this.updateChildItems(l);for(var y=0;y<l.childRecords.length;y++){var D=l.childRecords[y].ganttProperties;if(-1!==this.isChildRecordValidated.indexOf(D.taskId))return;if(this.isChildRecordValidated.push(D.taskId),D.predecessor&&0<D.predecessor.length)for(var k=0;k<D.predecessor.length;k++){var w=void 0;(w=D.predecessor[k].to!==l.ganttProperties.taskId.toString()?this.parent.flatData[this.parent.ids.indexOf(D.predecessor[k].to)]:this.parent.flatData[this.parent.ids.indexOf(D.predecessor[k].from)])&&(this.validatePredecessor(w,[],""),w.hasChildRecords&&this.parent.editModule.editedRecord.hasChildRecords&&this.updateChildItems(w),this.isValidatedParentTaskID=w.ganttProperties.taskId)}}this.isValidatedParentTaskID=l.ganttProperties.taskId}this.parent.editModule.editedRecord.hasChildRecords&&!this.parent.editModule.editedRecord.parentItem&&(this.isValidatedParentTaskID=l.ganttProperties.taskId)}}else!l.ganttProperties.isAutoSchedule&&this.parent.updateOffsetOnTaskbarEdit&&(this.parent.connectorLineEditModule.validatedOffsetIds=[],this.parent.connectorLineEditModule.calculateOffset(l));!1===o.expanded||!1===l.expanded?l&&this.validatePredecessor(l,void 0,"successor"):l&&(this.parent.editModule.isFirstCall&&(m="ResourceView"===this.parent.viewType?this.parent.getTaskIds():this.parent.ids,this.storeId=JSON.parse(JSON.stringify(m)),this.parent.editModule.isFirstCall=!1),this.storeId?(T=void 0,m=l[this.parent.taskFields.id].toString(),-1!==(T="ResourceView"===this.parent.viewType?this.storeId.includes(f="T"+m)?this.storeId.indexOf(f):-1:this.storeId.indexOf(m))&&(this.storeId=this.storeId.slice(0,T).concat(this.storeId.slice(T+1)),this.validatePredecessor(l,void 0,"successor"))):this.validatePredecessor(l,void 0,"successor"))}l&&!l.hasChildRecords&&l.parentItem&&-1===this.validatedParentIds.indexOf(l.parentItem.taskId)&&this.validatedParentIds.push(l.parentItem.taskId);s=!0;if(s=l&&l.hasChildRecords&&-1!==this.validatedParentIds.indexOf(l.ganttProperties.taskId.toString())?!1:s)if(l&&l.ganttProperties.taskId!==this.isValidatedParentTaskID&&r){if("ParentDrag"!==a.taskBarEditAction&&"ChildDrag"!==a.taskBarEditAction&&!r.hasChildRecords&&l.hasChildRecords&&(this.updateChildItems(l),this.isValidatedParentTaskID=l.ganttProperties.taskId),l.parentItem){this.parent.dataOperation.updateParentItems(l,!0);var b=this.parent.getParentTask(l.parentItem),T=this.storeId&&-1!==this.storeId.indexOf(b[this.parent.taskFields.id].toString())?this.storeId.indexOf(b[this.parent.taskFields.id].toString()):-1;if(b.ganttProperties.predecessor&&0<b.ganttProperties.predecessor.length&&-1!==T)for(y=0;y<b.ganttProperties.predecessor.length;y++)b.ganttProperties.predecessor[y].to!==b.ganttProperties.taskId.toString()&&(w=this.parent.flatData[this.parent.ids.indexOf(b.ganttProperties.predecessor[y].to)])&&w.parentItem&&this.validateChildGanttRecord(l,w)}}else l&&l.hasChildRecords&&this.isValidatedParentTaskID!==l.ganttProperties.taskId&&!r&&(this.updateChildItems(l),this.isValidatedParentTaskID=l.ganttProperties.taskId)}},u.prototype.updateChildItems=function(e){var t=this;if(0<e.childRecords.length&&this.validatedChildItems&&0<this.validatedChildItems.length)if(!!e.childRecords.some(function(e){return t.validatedChildItems.includes(e)}))return;var i,n,a,r=this.parent.previousRecords[e.uniqueID],s=(oe.isNullOrUndefined(r)||oe.isNullOrUndefined(r)&&!oe.isNullOrUndefined(r.ganttProperties)?i=new Date(e.ganttProperties.startDate.getTime()):oe.isNullOrUndefined(r.ganttProperties.startDate)||(i=new Date(r.ganttProperties.startDate.getTime())),e.ganttProperties.startDate),o=[];if(this.getUpdatableChildRecords(e,o),0!==o.length){for(var l,d=!oe.isNullOrUndefined(i)&&!oe.isNullOrUndefined(s)&&i.getTime()>s.getTime()?(n=this.parent.dateValidationModule.checkStartDate(s),a=this.parent.dateValidationModule.checkEndDate(i,e.ganttProperties),!1):(n=this.parent.dateValidationModule.checkStartDate(i),a=this.parent.dateValidationModule.checkEndDate(s,e.ganttProperties),!0),h=!oe.isNullOrUndefined(n)&&!oe.isNullOrUndefined(a)&&n.getTime()>=a.getTime()?0:this.parent.dateValidationModule.getDuration(n,a,"minute",!0,!1),p=0;p<o.length;p++)o[p].ganttProperties.isAutoSchedule&&(0<h?(l=H(o[p].ganttProperties)?o[p].ganttProperties.startDate:o[p].ganttProperties.startDate||o[p].ganttProperties.endDate||new Date(i.toString()),l=d?this.parent.dateValidationModule.getEndDate(this.parent.dateValidationModule.checkStartDate(l,o[p].ganttProperties,o[p].ganttProperties.isMilestone),h,"minute",o[p].ganttProperties,!1):this.parent.dateValidationModule.getStartDate(this.parent.dateValidationModule.checkEndDate(l,o[p].ganttProperties),h,"minute",o[p].ganttProperties),this.calculateDateByRoundOffDuration(o[p],l),this.parent.isOnEdit&&-1===this.validatedChildItems.indexOf(o[p])&&this.validatedChildItems.push(o[p])):oe.isNullOrUndefined(r)&&(l=i,o[p].ganttProperties.startDate.getTime()<=l.getTime()&&this.calculateDateByRoundOffDuration(o[p],l),this.parent.isOnEdit)&&-1===this.validatedChildItems.indexOf(o[p])&&this.validatedChildItems.push(o[p]));o.length&&this.parent.dataOperation.updateParentItems(e,!0)}},u.prototype.getUpdatableChildRecords=function(e,t){for(var i=e.childRecords,n=0;n<i.length;n++)i[n].ganttProperties.isAutoSchedule&&(t.push(i[n]),i[n].hasChildRecords)&&this.getUpdatableChildRecords(i[n],t)},u.prototype.calculateDateByRoundOffDuration=function(e,t){var i,n=e,a=n.ganttProperties,t=new Date(t.getTime());!oe.isNullOrUndefined(a.endDate)&&oe.isNullOrUndefined(a.startDate)?(i=this.parent.dateValidationModule.checkStartDate(t,a,null),this.parent.setRecordValue("endDate",this.parent.dateValidationModule.checkEndDate(i,n.ganttProperties),a,!0)):(this.parent.setRecordValue("startDate",this.parent.dateValidationModule.checkStartDate(t,a,!1),a,!0),oe.isNullOrUndefined(a.duration)||this.parent.dateValidationModule.calculateEndDate(n)),this.parent.dataOperation.updateWidthLeft(e),this.parent.dataOperation.updateTaskData(n)},u.prototype.getRecord=function(e,t,i){var n,a;return oe.isNullOrUndefined(t)?(n=this.parent.editModule.taskbarEditModule.previousIds.indexOf(i.to),a=this.parent.editModule.taskbarEditModule.previousFlatData[n]):oe.isNullOrUndefined(e)&&(n=this.parent.editModule.taskbarEditModule.previousIds.indexOf(i.from),a=this.parent.editModule.taskbarEditModule.previousFlatData[n]),a},u.prototype.getValidPredecessor=function(i){var e,n=this,t=[];return oe.isNullOrUndefined(i)||(e=i.ganttProperties.predecessor)&&0<e.length&&(t=e.filter(function(e){var t="ResourceView"===n.parent.viewType?i.ganttProperties.taskId:i.ganttProperties.rowUniqueID;return e.from!==t.toString()})),t};var tn=u;function u(e){this.parentRecord=[],this.parentIds=[],this.parentPredecessors=[],this.validatedParentIds=[],this.storeId=null,this.isChildRecordValidated=[],this.parent=e,this.dateValidateModule=this.parent.dateValidationModule}c.prototype.getconnectorLineGap=function(e){return e.milestoneChild?this.parent.chartRowsModule.milestoneMarginTop/2+this.parent.chartRowsModule.milestoneHeight/2:this.parent.chartRowsModule.taskBarMarginTop/2+this.parent.chartRowsModule.taskBarHeight/2},c.prototype.initPublicProp=function(){this.lineColor=this.parent.connectorLineBackground,this.lineStroke=4<this.parent.connectorLineWidth?4:this.parent.connectorLineWidth,this.createConnectorLineTooltipTable()},c.prototype.getTaskbarMidpoint=function(e){return Math.floor(e?this.parent.chartRowsModule.milestoneMarginTop+this.parent.chartRowsModule.milestoneHeight/2:this.parent.chartRowsModule.taskBarMarginTop+this.parent.chartRowsModule.taskBarHeight/2)+1},c.prototype.createConnectorLineObject=function(t,i,e,n){void 0===n&&(n=0);var a,r,s={},o=this.parent.pdfExportModule&&this.parent.pdfExportModule.isPdfExport&&this.parent.pdfExportModule.helper.exportProps&&this.parent.pdfExportModule.helper.exportProps.fitToWidthSettings&&this.parent.pdfExportModule.helper.exportProps.fitToWidthSettings.isFitToWidth?this.parent.pdfExportModule.helper.beforeSinglePageExport.cloneFlatData:this.parent.pdfExportModule&&this.parent.pdfExportModule.isPdfExport?this.parent.flatData:this.expandedRecords,o=(r=this.parent.pdfExportModule&&this.parent.pdfExportModule.isPdfExport&&this.parent.pdfExportModule.helper.exportProps&&this.parent.pdfExportModule.helper.exportProps.fitToWidthSettings&&this.parent.pdfExportModule.helper.exportProps.fitToWidthSettings.isFitToWidth?(a=this.parent.flatData.filter(function(e){return e.ganttProperties.taskId.toString()===t.ganttProperties.taskId.toString()})[0],r=this.parent.flatData.filter(function(e){return e.ganttProperties.taskId.toString()===i.ganttProperties.taskId.toString()})[0],a=a.index,r.index):(a=o.indexOf(t),o.indexOf(i)),t.ganttProperties),l=i.ganttProperties,d=this.parent.pdfExportModule&&this.parent.pdfExportModule.isPdfExport&&this.parent.pdfExportModule.helper.exportProps&&this.parent.pdfExportModule.helper.exportProps.fitToWidthSettings&&this.parent.pdfExportModule.helper.exportProps.fitToWidthSettings.isFitToWidth?this.parent.virtualScrollModule&&this.parent.enableVirtualization?this.parent.pdfExportModule.helper.beforeSinglePageExport.cloneFlatData:this.parent.getExpandedRecords(this.parent.pdfExportModule.helper.beforeSinglePageExport.cloneFlatData):this.parent.virtualScrollModule&&this.parent.enableVirtualization?this.parent.currentViewData:this.parent.expandedRecords;return s.parentIndexInCurrentView=d.indexOf(t),s.childIndexInCurrentView=d.indexOf(i),!(this.parent.virtualScrollModule&&this.parent.enableVirtualization)&&(-1===s.parentIndexInCurrentView||-1===s.childIndexInCurrentView)||-1===s.parentIndexInCurrentView&&-1===s.childIndexInCurrentView||(s.parentLeft=o.isMilestone?o.left-this.parent.chartRowsModule.milestoneHeight/2:o.left,s.childLeft=l.isMilestone?l.left-this.parent.chartRowsModule.milestoneHeight/2:l.left,s.parentWidth=0===o.width||o.isMilestone?Math.floor(this.parent.chartRowsModule.milestoneHeight):o.width,s.childWidth=0===l.width||l.isMilestone?Math.floor(this.parent.chartRowsModule.milestoneHeight):l.width,s.parentIndex=a,s.childIndex=r,0===n?(d=this.parent.ganttChartModule.getChartRows(),s.rowHeight=!oe.isNullOrUndefined(d)&&d[0]&&d[0].offsetHeight):s.rowHeight=n,s.type=e.type,a="ResourceView"===this.parent.viewType?o.taskId:o.rowUniqueID,r="ResourceView"===this.parent.viewType?l.taskId:l.rowUniqueID,s.connectorLineId="parent"+a+"child"+r,s.milestoneParent=!!o.isMilestone,s.milestoneChild=!!l.isMilestone,s.parentEndPoint=s.parentLeft+s.parentWidth,s.childEndPoint=s.childLeft+s.childWidth,oe.isNullOrUndefined(H(o)))||oe.isNullOrUndefined(H(l))?null:s},c.prototype.renderConnectorLines=function(e){var t,i=[];this.svgObject.innerHTML="";for(var n=0;n<e.length;n++)t=this.getConnectorLineTemplate(e[n]),this.svgObject.appendChild(t),i.push(e[n]);for(var a=this.parent.connectorLineModule.svgObject.childNodes,r=0;r<a.length;r++)for(var s=a[r].childNodes,o=0;o<s.length;o++){var l="Connector Line "+this.parent.connectorLineModule.generateAriaLabel(i[r]);s[o].setAttribute("aria-label",l),s[o].setAttribute("role","img")}this.parent.ganttChartModule.chartBodyContent.insertBefore(this.dependencyViewContainer,this.parent.ganttChartModule.chartBodyContent.lastChild),this.dependencyViewContainer.appendChild(this.svgObject);for(r=0;r<this.svgObject.children.length;r++)this.svgObject.children[r].children[0].setAttribute("tabindex","-1")},c.prototype.getParentPosition=function(e){if(e.parentIndex<e.childIndex){if("FF"===e.type)return e.childLeft+e.childWidth>=e.parentLeft+e.parentWidth?"FFType2":"FFType1";if(e.parentLeft<e.childLeft&&e.childLeft>e.parentLeft+e.parentWidth+25){if("FS"===e.type)return"FSType1";if("SF"===e.type)return"SFType1";if("SS"===e.type)return"SSType2"}else if(e.parentLeft<e.childLeft&&e.childLeft<e.parentLeft+e.parentWidth||e.parentLeft===e.childLeft||e.parentLeft>e.childLeft){if(e.parentLeft>e.childLeft+e.childWidth+25&&"SF"===e.type)return"SFType2";if(e.parentLeft>e.childLeft){if("SS"===e.type)return"SSType1";if("SF"===e.type)return"SFType1"}if("FS"===e.type)return"FSType2";if("SS"===e.type)return"SSType2";if("SF"===e.type)return"SFType1"}else if(e.parentLeft<e.childLeft){if("FS"===e.type)return"FSType2";if("SS"===e.type)return"SSType2";if("SF"===e.type)return"SFType1"}}else if(e.parentIndex>e.childIndex)if(e.parentLeft<e.childLeft&&e.childLeft>e.parentLeft+e.parentWidth){if("FS"===e.type)return e.childLeft-(e.milestoneParent?e.parentLeft+e.parentWidth+4:e.parentLeft+e.parentWidth)<=30?"FSType3":"FSType4";if(e.childLeft+e.childWidth>e.parentLeft+e.parentWidth){if("SS"===e.type)return"SSType4";if("FF"===e.type)return"FFType4";if("SF"===e.type)return"SFType4"}}else if(e.parentLeft<e.childLeft&&e.childLeft<e.parentLeft+e.parentWidth||e.parentLeft===e.childLeft||e.parentLeft>e.childLeft){if(e.childLeft+e.childWidth<=e.parentLeft+e.parentWidth){if("FF"===e.type)return"FFType3";if("SF"===e.type)return e.childLeft+e.childWidth+25<e.parentLeft?"SFType3":"SFType4";if("SS"===e.type)return e.childLeft<=e.parentLeft?"SSType3":"SSType4"}else if(e.childLeft+e.childWidth>e.parentLeft+e.parentWidth){if("FF"===e.type)return"FFType4";if("SF"===e.type)return"SFType4";if("SS"===e.type)return e.childLeft<=e.parentLeft?"SSType3":"SSType4"}if("FS"===e.type)return"FSType3"}else if(e.parentLeft<e.childLeft){if("FS"===e.type)return"FSType3";if("SS"===e.type)return"SSType4";if("FF"===e.type)return"FFType4";if("SF"===e.type)return"SFType4"}return null},c.prototype.getHeightValue=function(){return this.parent.showOverAllocation&&this.parent.allowTaskbarOverlap,this.parentRowIndexHeight>this.childRowIndexHeight?this.parentRowIndexHeight-this.childRowIndexHeight:this.childRowIndexHeight-this.parentRowIndexHeight},c.prototype.getInnerElementWidthSSType2=function(e){return e.parentLeft===e.childLeft?10:e.childLeft-e.parentLeft},c.prototype.getInnerElementLeftSSType2=function(e){return e.parentLeft===e.childLeft?e.parentLeft-20:e.parentLeft-10},c.prototype.getInnerChildWidthSSType2=function(e){return e.parentLeft+e.parentWidth<e.childLeft?10:e.parentLeft===e.childLeft?20:e.parentLeft+e.parentWidth>=e.childLeft?10:e.childLeft-e.parentLeft},c.prototype.calculateAdjustments=function(e,t,i){var n=this.parent.renderBaseline?.45:!oe.isNullOrUndefined(document.body.className)&&document.body.className.includes("e-bigger")?.7:.62,n=Math.floor(this.parent.rowHeight*n);return oe.isNullOrUndefined(this.parent.taskbarHeight)&&e<=36||!oe.isNullOrUndefined(this.parent.taskbarHeight)&&this.parent.taskbarHeight<=n||!t||e<=36?{adjustY1:0,adjustX:0,adjustY2:0,adjustZ:0}:{adjustY1:(e-36)/("FSType2"===i||"FSType3"===i||"FSType4"===i||"SSType1"===i||"SSType2"===i||"SSType4"===i||"SFType2"===i?12:24),adjustX:-(e-36)/4,adjustZ:-2*(e-36)/24}},c.prototype.shouldAdjustForBaseline=function(e,t){if(!this.parent.renderBaseline||!e.milestoneParent&&!e.milestoneChild||e.milestoneParent&&e.milestoneChild)return 0;switch(t){case"FSType1":case"FSType2":return e.milestoneParent?-this.parent.chartRowsModule.milestoneMarginTop/2:this.parent.chartRowsModule.taskBarMarginTop;case"FSType3":case"FFType2":case"SFType2":case"SSType2":return e.milestoneParent?this.parent.chartRowsModule.milestoneMarginTop/2:-this.parent.chartRowsModule.taskBarMarginTop;case"FSType4":case"FFType3":case"SFType4":case"FFType4":case"SFType3":case"SFType1":return e.milestoneParent?-this.parent.chartRowsModule.milestoneMarginTop/2:this.parent.chartRowsModule.taskBarMarginTop;case"SSType3":return e.milestoneParent?-this.parent.chartRowsModule.taskBarMarginTop:this.parent.chartRowsModule.taskBarMarginTop;case"SSType1":case"FFType1":return e.milestoneParent?this.parent.chartRowsModule.taskBarMarginTop:-this.parent.chartRowsModule.milestoneMarginTop/2;default:return 0}},c.prototype.updateParentChildRowsHeight=function(e){var t=this.parent.currentViewData.length-1,i=this.parent.ganttChartModule.getChartRows(),n=(this.parentRowIndexHeight=e.parentIndexInCurrentView*e.rowHeight,this.childRowIndexHeight=e.childIndexInCurrentView*e.rowHeight,this.lastRowIndexHeight=t*e.rowHeight,0);if(!this.parent.allowTaskbarOverlap&&this.parent.enableMultiTaskbar)for(var a=this.parentRowIndexHeight=this.childRowIndexHeight=this.lastRowIndexHeight=0;a<t;a++){var r=i[a];r&&"none"!==r.style.display&&(n<e.parentIndexInCurrentView&&(this.parentRowIndexHeight+=i[a].offsetHeight),n<e.childIndexInCurrentView&&(this.childRowIndexHeight+=i[a].offsetHeight),this.lastRowIndexHeight+=i[a].offsetHeight,n++)}},c.prototype.getConnectorLineTemplate=function(e){var t=this.getInnerChildWidthSSType2(e),i=this.getInnerElementWidthSSType2(e),n=this.getInnerElementLeftSSType2(e),a=(this.updateParentChildRowsHeight(e),this.getHeightValue()),r=!!e.milestoneChild,s=this.getPosition(e,this.getParentPosition(e),a),a=this.getPosition(e,this.getParentPosition(e),a).top,s=(this.parent.renderBaseline&&(this.parent.rowHeight,e.milestoneParent&&e.milestoneChild||(e.milestoneParent||e.milestoneChild)),s.height),o=0,l=0,d=0,h=0;if(this.parent.showOverAllocation&&!this.parent.allowTaskbarOverlap){for(var p=0;p<this.parent.currentViewData.length;p++)"none"!==this.parent.getRowByIndex(p).style.display&&h<e.parentIndex&&(h++,this.parent.getRowByIndex(p).offsetHeight);for(var h=0,u=0;u<this.parent.currentViewData.length;u++)"none"!==this.parent.getRowByIndex(u).style.display&&h<e.childIndex&&(h++,d+=this.parent.getRowByIndex(u).offsetHeight)}this.parent.currentViewData[e.parentIndex]&&this.parent.currentViewData[e.childIndex]&&this.parent.allowParentDependency&&(D=this.parent.currentViewData[e.parentIndex].hasChildRecords,c=this.parent.currentViewData[e.childIndex].hasChildRecords,f=this.parent.currentViewData[e.parentIndex].ganttProperties.isAutoSchedule,g=this.parent.currentViewData[e.childIndex].ganttProperties.isAutoSchedule,!(D&&f&&!c||c&&g&&!D||D&&f&&g&&c||!D&&!c))&&(D&&!f&&c&&!g?l=-11:e.childIndex>e.parentIndex?!D&&c?o=-11:l=-(o=11):D&&!c?o=-11:l=-(o=11),this.parent.currentViewData[e.parentIndex].ganttProperties.isMilestone?e.parentIndex>e.childIndex?(l=-11,o=12):"SS"!==e.type&&"FF"!==e.type||(l=-5):this.parent.currentViewData[e.childIndex].ganttProperties.isMilestone?e.parentIndex>e.childIndex?(l=5,o=-10):e.parentIndex<e.childIndex&&("SS"!==e.type&&"FF"!==e.type||(l=-10)):(e.parentIndex<e.childIndex&&f&&!g||e.childIndex<e.parentIndex&&!f&&g)&&(l=0,o=-11),a+=l);var c,g,f,m,y,D=this.getParentPosition(e);return D&&(c=this.getParentPosition(e),f=this.parent.rowHeight,g=this.calculateAdjustments(f,r,c),this.transform=this.parent.enableRtl?"translate("+(this.parent.enableTimelineVirtualization?this.parent.timelineModule.wholeTimelineWidth:this.parent.timelineModule.totalTimelineWidth)+", 0) scale(-1, 1)":"",this.connectorId="ConnectorLine"+e.connectorLineId,this.groupObject=this.renderer.createGroup({id:this.connectorId,transform:this.transform,style:"pointer-events: stroke",class:et}),this.connectorPath=this.renderer.drawPath({class:tt,d:this.connectorLinePath,fill:"transparent","stroke-width":this.lineStroke}),this.arrowlinePath=this.renderer.drawPath({d:this.arrowPath,class:at}),l=this.lineColor&&!this.parent.enableCriticalPath?this.lineColor:"",this.connectorPath.style.stroke=l,this.arrowlinePath.style.fill=l,this.groupObject.appendChild(this.connectorPath),this.groupObject.appendChild(this.arrowlinePath),f=this.shouldAdjustForBaseline(e,D),"FSType1"===D&&(this.taskLineValue=e.milestoneChild?1:0,this.x1=e.parentEndPoint+(e.milestoneParent||e.milestoneChild?-1:0),this.x2=e.milestoneParent?e.childLeft-(e.parentLeft+e.parentWidth+10)+this.lineStroke-10+1:e.childLeft-(e.parentLeft+e.parentWidth+10)+this.lineStroke-10,this.y1=a,this.y2=s+this.taskLineValue+o-this.lineStroke,this.connectorLinePath="M "+this.x1+" "+(this.y1-f)+" L "+(this.x1+this.x2+g.adjustZ)+" "+(this.y1-f)+" L "+(this.x1+this.x2+g.adjustZ)+" "+(this.y1+this.y2+g.adjustY1)+" L "+(this.x1+this.x2+12+g.adjustX)+" "+(this.y1+this.y2+g.adjustY1),this.arrowPath="M "+(this.x1+this.x2+20+g.adjustX)+" "+(this.y1+this.y2+g.adjustY1)+" L "+(this.x1+this.x2+12+g.adjustX)+" "+(this.y1+this.y2-(4+this.lineStroke)+g.adjustY1)+" L "+(this.x1+this.x2+12+g.adjustX)+" "+(this.y1+this.y2+4+g.adjustY1)+" Z"),"FSType2"===D&&(this.x1=e.parentLeft,this.x2=e.parentWidth+(e.milestoneParent?-1:0),this.x3=this.x2+(e.milestoneParent?11:10),this.x4=e.parentWidth-(e.parentEndPoint-e.childLeft+20),this.y1=a,this.y2=s+o-this.getconnectorLineGap(e)-this.lineStroke,this.y3=this.getconnectorLineGap(e),this.y4=this.parent.allowTaskbarOverlap?this.y1+this.y2-(this.y1+this.y2)%e.rowHeight:d,this.connectorLinePath="M "+(this.x1+this.x2)+" "+(this.y1-f)+"  L "+(this.x1+this.x3)+" "+(this.y1-f)+" L "+(this.x1+this.x3)+" "+this.y4+" L "+(this.x1+this.x4+g.adjustZ)+" "+this.y4+" L "+(this.x1+this.x4+g.adjustZ)+" "+(this.y1+this.y2+this.y3+g.adjustY1)+" L "+(this.x1+this.x4+12+g.adjustX)+" "+(this.y1+this.y2+this.y3+g.adjustY1),this.arrowPath="M "+(this.x1+this.x4+20+g.adjustX)+" "+(this.y1+this.y2+this.y3+g.adjustY1)+" L "+(this.x1+this.x4+12+g.adjustX)+" "+(this.y1+this.y2+this.y3-(4+this.lineStroke)+g.adjustY1)+" L "+(this.x1+this.x4+12+g.adjustX)+" "+(this.y1+this.y2+this.y3+4+this.lineStroke+g.adjustY1)+" Z"),"FSType3"===D&&(this.taskLineValue=e.milestoneChild?1:0,this.point1=a,this.x1=e.childLeft+(e.milestoneChild?-1:0)+(e.milestoneParent?1:0)-20,this.x2=e.parentEndPoint-e.childLeft+30,this.y1=this.point1,this.y2=this.point1+s+o-this.getconnectorLineGap(e)-this.lineStroke+this.taskLineValue,this.y3=this.getconnectorLineGap(e),this.y4=this.y2-this.y2%e.rowHeight,this.connectorLinePath="M "+(this.x1+12)+" "+(this.y1-f+g.adjustY1)+" L "+this.x1+" "+(this.y1-f+g.adjustY1)+" L "+this.x1+" "+this.y4+" L "+(this.x1+this.x2)+" "+this.y4+" L "+(this.x1+this.x2)+" "+(this.y2+this.y3)+" L "+(this.x1+this.x2-12)+" "+(this.y2+this.y3),this.arrowPath="M "+(this.x1+20+g.adjustX)+" "+(this.y1-f+g.adjustY1)+" L "+(this.x1+12+g.adjustX)+" "+(this.y1-(4+this.lineStroke)-f+g.adjustY1)+" L "+(this.x1+12+g.adjustX)+" "+(this.y1+4+this.lineStroke-f+g.adjustY1)+" Z"),"FSType4"===D&&(this.point1=a,this.taskLineValue=this.parent.renderBaseline?this.taskLineValue:0,this.x1=e.parentEndPoint+(e.milestoneChild?-1:0)+(e.milestoneParent?1:0),this.x2=e.childLeft-e.parentEndPoint-20,this.y1=this.point1+(e.milestoneChild?-1:0),this.y2=this.point1+s+o-this.lineStroke+1+this.taskLineValue,this.connectorLinePath="M "+(this.x1+this.x2+12)+" "+(this.y1+g.adjustY1)+" L "+(this.x1+this.x2)+" "+(this.y1+g.adjustY1)+" L "+(this.x1+this.x2)+" "+(this.y2-f)+" L "+this.x1+" "+(this.y2-f),this.arrowPath="M "+(this.x1+this.x2+20+g.adjustX)+" "+(this.y1+g.adjustY1)+" L "+(this.x1+this.x2+12+g.adjustX)+" "+(this.y1-(4+this.lineStroke)+g.adjustY1)+" L "+(this.x1+this.x2+12+g.adjustX)+" "+(this.y1+4+this.lineStroke+g.adjustY1)+" Z"),"SSType4"===D&&(y=0!==g.adjustX?g.adjustX+2:g.adjustX,this.taskLineValue=this.parent.renderBaseline?this.taskLineValue:0,this.point1=s+this.taskLineValue+o,this.point2=a,this.x1=e.parentLeft-10,this.x2=e.childLeft-e.parentLeft,this.y1=this.point2+(e.milestoneChild?1:0),this.y2=(e.milestoneChild?this.parent.chartRowsModule.taskBarMarginTop+this.parent.chartRowsModule.taskBarHeight/2:this.parent.chartRowsModule.milestoneMarginTop+this.parent.chartRowsModule.milestoneHeight/2)+this.point1,this.connectorLinePath="M "+(this.x1+this.x2+y)+" "+this.y1+" L "+this.x1+" "+this.y1+" L "+this.x1+" "+this.y2+" L "+(this.x1+10)+" "+this.y2,this.arrowPath="M "+(this.x1+this.x2+8+y)+" "+this.y1+" L "+(this.x1+this.x2+y)+" "+(this.y1-(4+this.lineStroke))+" L "+(this.x1+this.x2+y)+" "+(this.y1+4+this.lineStroke)+" Z"),"SSType3"===D&&(this.taskLineValue=this.parent.renderBaseline?this.taskLineValue:e.milestoneChild?1:0,this.point1=s+this.taskLineValue+o-(this.lineStroke-1),this.x1=e.childLeft-20,this.y1=a,this.x2=e.parentLeft-e.childLeft+21,this.y2=this.y1+this.point1,this.connectorLinePath="M "+(this.x1+12+g.adjustX)+" "+this.y1+" L "+this.x1+" "+this.y1+" L "+this.x1+" "+(this.y2-f)+" L "+(this.x1+this.x2)+" "+(this.y2-f),this.arrowPath="M "+(this.x1+20+g.adjustX)+" "+this.y1+" L "+(this.x1+12+g.adjustX)+" "+(this.y1-(4+this.lineStroke))+" L "+(this.x1+12+g.adjustX)+" "+(this.y1+4+this.lineStroke)+" Z"),"SSType2"===D&&(y=0!==g.adjustX?g.adjustX+2:g.adjustX,this.taskLineValue=this.parent.renderBaseline?this.taskLineValue:e.milestoneChild?1:0,this.point1=s+this.taskLineValue+o-this.lineStroke,this.x1=n,this.x2=t+1,this.y1=a,this.y2=this.y1+this.point1,this.connectorLinePath="M "+(this.x1+this.x2)+" "+this.y1+" L "+this.x1+" "+this.y1+" L "+this.x1+" "+(this.y2+g.adjustY1-f)+" L "+(this.x1+i+y)+" "+(this.y2+g.adjustY1-f),this.arrowPath="M "+(this.x1+i+8+y)+" "+(this.y2+g.adjustY1-f)+" L "+(this.x1+i+y)+" "+(this.y2-(4+this.lineStroke)+g.adjustY1-f)+" L "+(this.x1+i+y)+" "+(this.y2+4+this.lineStroke+g.adjustY1-f)+" Z"),"SSType1"===D&&(this.taskLineValue=this.parent.renderBaseline?this.taskLineValue:e.milestoneChild?1:0,this.point1=s+this.taskLineValue+o-this.lineStroke,this.x1=e.childLeft-20,this.x2=e.parentLeft-e.childLeft+21,this.y1=a,this.y2=this.y1+this.point1,this.connectorLinePath="M "+(this.x1+this.x2)+" "+this.y1+" L "+this.x1+" "+this.y1+" L "+this.x1+" "+(this.y2+g.adjustY1-f)+" L "+(this.x1+12+g.adjustX)+" "+(this.y2+g.adjustY1-f),this.arrowPath="M "+(this.x1+20+g.adjustX)+" "+(this.y2+g.adjustY1-f)+" L "+(this.x1+12+g.adjustX)+" "+(this.y2-(4+this.lineStroke)+g.adjustY1-f)+" L "+(this.x1+12+g.adjustX)+" "+(this.y2+4+this.lineStroke+g.adjustY1-f)+" Z"),"FFType1"===D&&(y=0!==g.adjustX?g.adjustX+11:g.adjustX,this.taskLineValue=this.parent.renderBaseline?this.taskLineValue:e.milestoneChild?1:0,this.x1=e.childEndPoint,this.x2=e.parentEndPoint+(e.milestoneParent?-1:0),this.x3=e.milestoneParent?22:21,this.x4=e.milestoneChild?4:8,this.y1=a,this.y2=s+this.taskLineValue+o-this.lineStroke+1,this.connectorLinePath="M "+this.x2+" "+this.y1+" L "+(this.x2+this.x3)+" "+this.y1+" L "+(this.x2+this.x3)+" "+(this.y1+this.y2+g.adjustY1-f)+" L "+(this.x1+this.x4)+" "+(this.y1+this.y2+g.adjustY1-f),this.arrowPath="M "+(this.x1+y)+" "+(this.y1+this.y2+g.adjustY1-f)+" L "+(this.x1+8+y)+" "+(this.y1+this.y2-(4+this.lineStroke)+g.adjustY1-f)+" L "+(this.x1+8+y)+" "+(this.y1+this.y2+4+this.lineStroke+g.adjustY1-f)+" Z"),"FFType2"===D&&(y=0!==g.adjustX?g.adjustX+11:g.adjustX,this.taskLineValue=this.parent.renderBaseline?this.taskLineValue:e.milestoneChild?1:0,this.x1=e.parentEndPoint,this.x2=e.childEndPoint+(e.milestoneParent?22:21),this.x3=e.childEndPoint+(e.milestoneChild?9:8),this.y1=a,this.y2=s+this.taskLineValue+o-this.lineStroke+1,m=this.parent.renderBaseline?0:y,this.connectorLinePath="M "+this.x1+" "+this.y1+" L "+this.x2+" "+this.y1+" L "+this.x2+" "+(this.y1+this.y2+g.adjustY1-f)+" L "+this.x3+" "+(this.y1+this.y2+g.adjustY1-f),this.arrowPath="M "+(this.x3-8+m)+" "+(this.y1+this.y2+g.adjustY1-f)+" L "+(this.x3+m)+" "+(this.y1+this.y2-(4+this.lineStroke)+g.adjustY1-f)+" L "+(this.x3+m)+" "+(this.y1+this.y2+4+this.lineStroke+g.adjustY1-f)+" Z"),"FFType3"===D&&(y=0!==g.adjustX?g.adjustX+11:g.adjustX,this.taskLineValue=this.parent.renderBaseline?this.taskLineValue:0,this.x1=e.childEndPoint,this.x2=this.x1+(e.milestoneChild?4:8),this.x3=e.parentEndPoint-e.childEndPoint+(e.milestoneChild?16:10),this.x4=e.parentEndPoint+(e.milestoneParent?-1:0),this.y1=a,this.y2=s+this.taskLineValue+o-this.lineStroke+1,this.connectorLinePath="M "+this.x2+" "+this.y1+" L "+(this.x2+this.x3)+" "+this.y1+" L "+(this.x2+this.x3)+" "+(this.y1+this.y2-f)+" L "+this.x4+" "+(this.y1+this.y2-f),this.arrowPath="M "+(this.x1+y)+" "+this.y1+" L "+(this.x1+8+y)+" "+(this.y1-(4+this.lineStroke))+" L "+(this.x1+8+y)+" "+(this.y1+4+this.lineStroke)+" Z"),"FFType4"===D&&(y=0!==g.adjustX?g.adjustX+11:g.adjustX,this.taskLineValue=this.parent.renderBaseline?this.taskLineValue:0,this.x1=e.parentEndPoint,this.x2=e.childEndPoint+(e.milestoneChild?7:8),this.x3=this.x2+(e.milestoneChild?12:11),this.y1=a,this.y2=s+this.taskLineValue+o-this.lineStroke+1,m=this.parent.renderBaseline?0:y,this.connectorLinePath="M "+this.x2+" "+this.y1+" L "+this.x3+" "+this.y1+" L "+this.x3+" "+(this.y1+this.y2-f)+" L "+this.x1+" "+(this.y1+this.y2-f),this.arrowPath="M "+(this.x2-8+m)+" "+this.y1+" L "+(this.x2+m)+" "+(this.y1-(4+this.lineStroke))+" L "+(this.x2+m)+" "+(this.y1+4+this.lineStroke)+" Z"),"SFType4"===D&&(y=0!==g.adjustX?g.adjustX+11:g.adjustX,this.taskLineValue=this.parent.renderBaseline?this.taskLineValue:e.milestoneChild?-1:0,this.point1=this.taskLineValue+s+o-this.getconnectorLineGap(e)-(this.lineStroke-1),this.point2=a,this.x1=e.parentLeft-10,this.x2=this.x1+(e.childEndPoint-e.parentLeft+18),this.x3=this.x2+(e.milestoneChild?16:11),this.y1=this.point2,this.y2=this.y1+this.point1,this.y3=this.getconnectorLineGap(e),this.y4=this.y2-this.y2%e.rowHeight,m=this.parent.renderBaseline?0:y,this.connectorLinePath="M "+this.x2+" "+(this.y1-g.adjustY1)+" L "+this.x3+" "+(this.y1-g.adjustY1)+" L "+this.x3+" "+this.y4+" L "+this.x1+" "+this.y4+" L "+this.x1+" "+(this.y2+this.y3-f)+" L "+(this.x1+11)+" "+(this.y2+this.y3-f),this.arrowPath="M "+(this.x2-8+m)+" "+(this.y1-g.adjustY1)+" L "+(this.x2+m)+" "+(this.y1-(4+this.lineStroke)-g.adjustY1)+" L "+(this.x2+m)+" "+(this.y1+4+this.lineStroke-g.adjustY1)+" Z"),"SFType3"===D&&(y=0!==g.adjustX?g.adjustX+11:g.adjustX,this.taskLineValue=this.parent.renderBaseline?this.taskLineValue:0,this.point1=e.parentLeft-(e.childEndPoint+(e.milestoneParent?23:20))+1,this.point2=a,this.x1=e.childEndPoint,this.x2=this.x1+(e.milestoneChild?9:8),this.x3=this.x2+(e.milestoneChild?17:11),this.y1=this.point2,this.y2=this.y1+s+o-(this.lineStroke-1)+this.taskLineValue,this.connectorLinePath="M "+this.x2+" "+this.y1+" L "+this.x3+" "+this.y1+" L "+this.x3+" "+(this.y2-f)+" L "+(this.x3+this.point1)+" "+(this.y2-f),this.arrowPath="M "+(this.x2-8+y)+" "+this.y1+" L "+(this.x2+y)+" "+(this.y1-(4+this.lineStroke))+" L "+(this.x2+y)+" "+(this.y1+4+this.lineStroke)+" Z"),"SFType1"===D&&(y=0!==g.adjustX?g.adjustX+11:g.adjustX,this.taskLineValue=this.parent.renderBaseline?this.taskLineValue:e.milestoneChild?1:0,this.point1=s+o-this.getconnectorLineGap(e)+this.taskLineValue-this.lineStroke,this.point2=this.getconnectorLineGap(e),this.x1=e.parentLeft-10,this.y1=a,this.x2=e.childEndPoint-e.parentLeft+31,this.y2=this.y1+this.point1,this.x3=e.childEndPoint-e.parentLeft+18,this.y3=this.y2-this.y2%e.rowHeight,m=this.parent.renderBaseline?0:y,this.connectorLinePath="M "+(this.x1+11)+" "+(this.y1-f)+" L "+this.x1+" "+(this.y1-f)+" L "+this.x1+" "+this.y3+" L "+(this.x1+this.x2)+" "+this.y3+" L "+(this.x1+this.x2)+" "+(this.y2+this.point2+g.adjustY1)+" L "+(this.x1+this.x3)+" "+(this.y2+this.point2+g.adjustY1),this.arrowPath="M "+(this.x1+this.x3-8+m)+" "+(this.y2+this.point2+g.adjustY1)+" L "+(this.x1+this.x3+m)+" "+(this.y2+this.point2-(4+this.lineStroke)+g.adjustY1)+" L "+(this.x1+this.x3+m)+" "+(this.y2+this.point2+4+this.lineStroke+g.adjustY1)+" Z"),"SFType2"===D&&(y=0!==g.adjustX?g.adjustX+11:g.adjustX,this.taskLineValue=this.parent.renderBaseline?this.taskLineValue:0,this.x1=e.childEndPoint,this.y1=a,this.x2=e.parentLeft-e.childEndPoint,this.y2=this.y1+s+this.taskLineValue+o-this.lineStroke,this.connectorLinePath="M "+(this.x1+this.x2+1)+" "+this.y1+" L "+(this.x1+this.x2-10)+" "+this.y1+" L "+(this.x1+this.x2-10)+" "+(this.y2+g.adjustY1-f)+" L "+(this.x1+8)+" "+(this.y2+g.adjustY1-f),this.arrowPath="M "+(this.x1+y)+" "+(this.y2+g.adjustY1-f)+" L "+(this.x1+8+y)+" "+(this.y2-(4+this.lineStroke)+g.adjustY1-f)+" L "+(this.x1+8+y)+" "+(this.y2+4+this.lineStroke+g.adjustY1-f)+" Z"),this.connectorPath.setAttribute("d",this.connectorLinePath),this.arrowlinePath.setAttribute("d",this.arrowPath)),this.groupObject},c.prototype.getPosition=function(e,t,i){var n=0,a=0,r=!!e.milestoneParent,s=!!e.milestoneChild,r=this.getTaskbarMidpoint(r)-(this.lineStroke-1),s=this.getTaskbarMidpoint(s)-(this.lineStroke-1),o=-1!==e.parentIndexInCurrentView,e=-1!==e.childIndexInCurrentView;return"SSType1"===t||"SSType2"===t||"FFType1"===t||"FFType2"===t||"SFType2"===t?(n=o?this.parentRowIndexHeight+r:0,a=o&&e?i:e?this.childRowIndexHeight+r:this.lastRowIndexHeight+r):"SSType3"===t||"SSType4"===t||"FSType4"===t||"FFType3"===t||"FFType4"===t||"SFType4"===t||"SFType3"===t?(n=e?this.childRowIndexHeight+s:0,a=o&&e?i:o?this.parentRowIndexHeight+s:this.lastRowIndexHeight+s):"FSType3"===t?(n=e?this.childRowIndexHeight+r:0,a=o&&e?i:o?this.parentRowIndexHeight+s:this.lastRowIndexHeight+r):"SFType1"!==t&&"FSType1"!==t&&"FSType2"!==t||(n=o?this.parentRowIndexHeight+s:0,a=o&&e?i:e?this.childRowIndexHeight+s:this.lastRowIndexHeight+s),{top:n,height:a}},c.prototype.createConnectorLineTooltipTable=function(){this.tooltipTable=oe.createElement("table",{className:".e-tooltiptable",styles:"margin-top:0px",attrs:{cellspacing:"2px",cellpadding:"2px"}});var e=oe.createElement("tbody");e.innerHTML="",this.tooltipTable.appendChild(e)},c.prototype.getConnectorLineTooltipInnerTd=function(e,t,i,n){function a(e,t,i,n){var a=document.createElement("tr");return a.id=e,(e=document.createElement("td")).style.padding="2px",e.textContent=r.parent.localeObj.getConstant(t),(t=document.createElement("td")).textContent=i,(i=document.createElement("td")).style.padding="2px",i.textContent=r.parent.localeObj.getConstant(n),a.append(e,t,i),a}var r=this,s=document.createElement("tbody");return s.appendChild(a("fromPredecessor","from",e,t)),s.appendChild(a("toPredecessor","to",i||"",n||"")),s},c.prototype.generateAriaLabel=function(e){var t=e.type,i=this.expandedRecords,n=i[e.parentIndex].ganttProperties.taskName,i=i[e.childIndex].ganttProperties.taskName,e=this.parent.localeObj.getConstant("start"),a=this.parent.localeObj.getConstant("finish");return"FS"===t?n+" "+a+" to "+i+" "+e:"FF"===t?n+" "+a+" to "+i+" "+a:"SS"===t?n+" "+e+" to "+i+" "+e:n+" "+e+" to "+i+" "+a},c.prototype.getRecordByID=function(t){return oe.isNullOrUndefined(t)?null:this.parent.pdfExportModule&&this.parent.pdfExportModule.isPdfExport&&this.parent.pdfExportModule.helper.exportProps&&this.parent.pdfExportModule.helper.exportProps.fitToWidthSettings&&this.parent.pdfExportModule.helper.exportProps.fitToWidthSettings.isFitToWidth?this.parent.pdfExportModule.helper.beforeSinglePageExport.cloneFlatData.filter(function(e){return e.ganttProperties.taskId.toString()===t.toString()})[0]:"ResourceView"===this.parent.viewType?this.parent.flatData[this.parent.getTaskIds().indexOf("T"+t.toString())]:this.parent.getRecordByID(t)},c.prototype.removePreviousConnectorLines=function(e){for(var t=!0===oe.isObject(e),i=(t?Object.keys(e):e).length,n=Object.keys(e),a=0;a<i;a++){var r=void 0,s=(r=t?e[n[a]]:e[a]).ganttProperties&&r.ganttProperties.predecessor;if(s&&0<s.length)for(var o=0;o<s.length;o++){var l="parent"+s[o].from+"child"+s[o].to;this.removeConnectorLineById(l)}}},c.prototype.removeConnectorLineById=function(e){e=this.parent.connectorLineModule.dependencyViewContainer.querySelector("#ConnectorLine"+e.replace(/([.])/g,"\\$1"));oe.isNullOrUndefined(e)||oe.remove(e)};var nn=c;function c(e){this.transform="",this.connectorLinePath="",this.arrowPath="",this.taskLineValue=0,this.expandedRecords=[],this.parent=e,this.dependencyViewContainer=oe.createElement("div",{className:"e-gantt-dependency-view-container"}),Object.assign(this.dependencyViewContainer.style,{width:"100%",height:"100%",zIndex:2,position:"absolute",pointerEvents:"none"}),this.renderer=new N.SvgRenderer(this.parent.element.id),this.initPublicProp(),this.svgObject=this.renderer.createSvg({id:this.parent.element.id+"_svg"}),this.svgObject.setAttribute("height","100%"),this.svgObject.setAttribute("width","100%")}rn.prototype.renderSplitter=function(){var a=this,e=this.calculateSplitterPosition(this.parent.splitterSettings),t=(this.parent.splitterElement=oe.createElement("div",{className:"e-gantt-splitter"}),this.parent.treeGridPane=oe.createElement("div",{className:"e-gantt-tree-grid-pane"}),this.parent.chartPane=oe.createElement("div",{className:"e-gantt-chart-pane"}),oe.addClass([this.parent.chartPane],"e-droppable"),this.parent.enableRtl?(this.parent.splitterElement.appendChild(this.parent.chartPane),this.parent.splitterElement.appendChild(this.parent.treeGridPane)):(this.parent.splitterElement.appendChild(this.parent.treeGridPane),this.parent.splitterElement.appendChild(this.parent.chartPane)),this.splitterObject=new L.Splitter({height:null,width:this.parent.ganttWidth.toString(),enableRtl:this.parent.enableRtl,separatorSize:this.parent.splitterSettings.separatorSize,paneSettings:[{resizable:!0,size:e,min:this.getSpliterPositionInPercentage(this.parent.splitterSettings.minimum)},{resizable:!0}],orientation:"Horizontal",resizeStart:function(e){a.parent.contextMenuModule&&a.parent.contextMenuModule.isOpen&&a.parent.contextMenuModule.contextMenu.close();var t=e.pane[0],i=e.pane[1],n=(a.splitterPreviousPositionGrid=t.scrollWidth+1+"px",a.splitterPreviousPositionChart=i.scrollWidth+1+"px",new y.Deferred);return a.parent.trigger("splitterResizeStart",e,function(e){n.resolve(e)}),n},resizing:function(e){a.parent.trigger("splitterResizing",e),a.parent.timelineModule.isZoomToFit&&a.parent.timelineModule.updateTimelineAfterZooming(a.parent.timelineModule.timelineEndDate,!0)},resizeStop:function(e){a.parent.calculateDimensions(),a.isSplitterResized=!0;var t=e.pane[0],i=(a.splitterPreviousPositionGrid=t.scrollWidth+1+"px",a.splitterObject.paneSettings[0].size=a.getSpliterPositionInPercentage(a.splitterPreviousPositionGrid),a.parent.splitterSettings.position=a.splitterObject.paneSettings[0].size,new y.Deferred);return a.parent.trigger("splitterResized",e,function(e){!0===e.cancel&&(a.splitterObject.paneSettings[0].size=null,a.splitterObject.paneSettings[0].size=a.getSpliterPositionInPercentage(a.splitterPreviousPositionGrid),a.parent.splitterSettings.position=a.splitterObject.paneSettings[0].size,a.splitterObject.paneSettings[1].size=null,a.splitterObject.paneSettings[1].size=a.getSpliterPositionInPercentage(a.splitterPreviousPositionChart)),oe.isNullOrUndefined(a.parent.projectEndDate)&&a.parent.timelineModule.updateTimelineAfterZooming(a.parent.timelineModule.timelineEndDate,!0),i.resolve(e)}),i}}),this.parent.element.appendChild(this.parent.splitterElement),this.splitterObject.appendTo(this.parent.splitterElement),this.splitterObject.element.querySelector(".e-split-bar"));t&&(e=parseFloat(e.replace("%","")),e=Math.min(100,Math.max(0,e)),t.setAttribute("aria-valuenow",e.toString()))},rn.prototype.calculateSplitterPosition=function(e){var t;return!oe.isNullOrUndefined(this.splitterObject)&&this.parent.enablePersistence?this.splitterObject.paneSettings[0].size:"Grid"===e.view?this.parent.enableRtl?"0%":"100%":"Chart"===e.view?this.parent.enableRtl?"100%":"0%":oe.isNullOrUndefined(e.position)||""===e.position?!oe.isNullOrUndefined(e.columnIndex)&&0<=e.columnIndex?150*e.columnIndex<this.parent.ganttWidth||!this.parent.element.classList.contains("e-device")?this.getSpliterPositionInPercentage(this.getTotalColumnWidthByIndex(e.columnIndex).toString()+"px"):this.getSpliterPositionInPercentage(130*e.columnIndex+"px"):(t=this.parent.ganttWidth,this.parent.enableRtl?this.getSpliterPositionInPercentage(t-250+"px"):this.getSpliterPositionInPercentage("250px")):this.getSpliterPositionInPercentage(e.position)},rn.prototype.getSpliterPositionInPercentage=function(e){var t,i=oe.isNullOrUndefined(e)||""===e?null:e;return i=oe.isNullOrUndefined(i)?i:-1!==e.indexOf("px")?(t=parseInt(e,10))/this.parent.ganttWidth*100<=100?t/this.parent.ganttWidth*100+"%":"25%":this.parent.enableRtl?100-parseFloat(e)+"%":-1===e.indexOf("%")?e+"%":e},rn.prototype.getTotalColumnWidthByIndex=function(e){var t=0,i=this.parent.ganttWidth,n=this.parent.ganttColumns.filter(function(e){return void 0===e.visible||!0===e.visible}).map(function(e){return Object.assign({},e)});if(e=n.length>e?e:n.length,this.parent.enableRtl){for(var a=0;a<e;a++)t+=parseInt(n[a].width,10);t=i-t}else for(a=0;a<e;a++)t+=parseInt(n[a].width,10);return t},rn.prototype.updateSplitterPosition=function(){this.splitterObject.separatorSize=this.parent.splitterSettings.separatorSize;var e=this.calculateSplitterPosition(this.parent.splitterSettings);this.splitterObject.paneSettings[0].min=this.getSpliterPositionInPercentage(this.parent.splitterSettings.minimum),this.splitterObject.dataBind(),this.isSplitterResized||(this.splitterObject.paneSettings[0].size=e),this.isSplitterResized=!1,oe.isNullOrUndefined(this.parent.projectEndDate)&&this.parent.timelineModule.updateTimelineAfterZooming(this.parent.timelineModule.timelineEndDate,!0)},rn.prototype.triggerCustomResizedEvent=function(){var e=this.splitterObject.element.querySelectorAll(".e-pane")[0],t=this.splitterObject.element.querySelectorAll(".e-pane")[1],e={event:null,element:this.splitterObject.element,pane:[e,t],index:[0,1],separator:this.splitterObject.element.querySelector(".e-split-bar"),paneSize:[e.offsetWidth,t.offsetWidth]};this.parent.trigger("splitterResized",e),!0===e.cancel&&(this.splitterObject.paneSettings[0].size=this.getSpliterPositionInPercentage(this.splitterPreviousPositionGrid),this.splitterObject.paneSettings[1].size=this.getSpliterPositionInPercentage(this.splitterPreviousPositionChart))},rn.prototype.destroy=function(){this.splitterObject.destroy(),this.parent.off("destroy",this.destroy)};var an=rn;function rn(e){this.isSplitterResized=!1,this.parent=e,this.parent.on("destroy",this.destroy,this)}on.prototype.createTooltip=function(){this.toolTipObj=new U.Tooltip,this.toolTipObj.target=".e-header-cell-label, .e-gantt-child-taskbar,.e-gantt-parent-taskbar, .e-gantt-milestone, .e-gantt-unscheduled-taskbar.e-event-markers, .e-baseline-bar, .e-event-markers,.e-connector-line-container, .e-indicator-span, .e-notes-info, .e-gantt-manualparent-milestone,.e-taskbar-left-resizer, .e-taskbar-right-resizer, .e-baseline-gantt-milestone-container, .e-gantt-manualparenttaskbar",this.toolTipObj.position="BottomCenter",this.toolTipObj.openDelay=700,this.toolTipObj.enableRtl=this.parent.enableRtl,this.toolTipObj.enableHtmlSanitizer=this.parent.enableHtmlSanitizer,this.toolTipObj.cssClass=ut,this.toolTipObj.animation={open:{effect:"None",delay:0},close:{effect:"None",delay:0}},this.toolTipObj.afterOpen=this.updateTooltipPosition.bind(this),this.toolTipObj.showTipPointer=!1,this.toolTipObj.beforeRender=this.tooltipBeforeRender.bind(this),this.toolTipObj.afterClose=this.tooltipCloseHandler.bind(this),this.toolTipObj.isStringTemplate=!0,this.toolTipObj.appendTo(this.parent.element)},on.prototype.tooltipBeforeRender=function(t){var e,i,n,a,r,s,o,l=this.parent;if(!l.isOnEdit)return a=oe.closest(t.target,"div."+S),a=oe.isNullOrUndefined(a)?P(t.target,Me):t.target,i={data:{},args:t,cancel:!1,content:""},t.target.classList.contains("e-header-cell-label")?l.timelineSettings.showTooltip?(r=t.target.getAttribute("data-tier"),n=t.target.title,s=oe.isNullOrUndefined(l.timelineTemplate)?t.target.textContent:t.target.getAttribute("value"),n=l.tooltipSettings.timeline?l.tooltipModule.templateCompiler(l.tooltipSettings.timeline,l,oe.extend({},{date:n,value:s,tier:r}),"TooltipTaskbarTemplate"):null,s=document.createElement("div"),n?(oe.append(n,s),i.content=this.toolTipObj.content=s):i.content=this.toolTipObj.content=l.tooltipModule.getTooltipContent("timeline",e,l,t)):t.cancel=!0:l.tooltipSettings.showTooltip?(a&&(i.data=l.ganttChartModule.getRecordByTaskBar(a),e=i.data),t.target.classList.contains("e-gantt-child-taskbar")||t.target.classList.contains("e-gantt-parent-taskbar")||t.target.classList.contains("e-gantt-milestone")||t.target.classList.contains("e-gantt-unscheduled-taskbar")||t.target.classList.contains("e-taskbar-left-resizer")||t.target.classList.contains("e-taskbar-right-resizer")||t.target.classList.contains("e-gantt-manualparenttaskbar")&&l.tooltipSettings.taskbar?(r=void 0,l.tooltipSettings.taskbar&&(r=l.tooltipModule.templateCompiler(l.tooltipSettings.taskbar,l,e,"TooltipTaskbarTemplate")),s=document.createElement("div"),r&&oe.append(r,s),i.content=this.toolTipObj.content=r?s:e?l.tooltipModule.getTooltipContent(e.ganttProperties.isMilestone?"milestone":"taskbar",e,l,t):""):t.target.classList.contains("e-baseline-bar")||t.target.classList.contains("e-baseline-gantt-milestone-container")?(n=void 0,l.tooltipSettings.baseline&&(n=l.tooltipModule.templateCompiler(l.tooltipSettings.baseline,l,e,"TooltipBaselineTemplate")),a=document.createElement("div"),n&&oe.append(n,a),i.content=this.toolTipObj.content=n?a:e?l.tooltipModule.getTooltipContent(e.ganttProperties.isMilestone?"milestone":"baseline",e,l,t):""):t.target.classList.contains("e-event-markers")?i.content=this.toolTipObj.content=l.tooltipModule.getTooltipContent("marker",e,l,t):t.target.classList.contains("e-connector-line-container")?(r=void 0,l.tooltipModule.predecessorTooltipData=l.tooltipModule.getPredecessorTooltipData(t),i.data=this.predecessorTooltipData,l.tooltipSettings.connectorLine&&(r=l.tooltipModule.templateCompiler(l.tooltipSettings.connectorLine,l,l.tooltipModule.predecessorTooltipData,"TooltipConnectorLineTemplate")),i.content=this.toolTipObj.content=r?r[0]:l.tooltipModule.getTooltipContent("connectorLine",e,l,t)):t.target.classList.contains("e-indicator-span")?(i.content=this.toolTipObj.content=l.tooltipModule.getTooltipContent("indicator",e,l,t),oe.isNullOrUndefined(i.content)&&(t.cancel=!0)):t.target.classList.contains("e-notes-info")?(s=this.parent.ganttChartModule.getRecordByTarget(t.event),i.content=this.toolTipObj.content=s.ganttProperties.notes,oe.isNullOrUndefined(i.content)&&(t.cancel=!0)):t.target.classList.contains("e-gantt-manualparenttaskbar")?(i.content=this.toolTipObj.content=l.tooltipModule.getTooltipContent("manualtaskbar",e,l,t),oe.isNullOrUndefined(i.content)&&(t.cancel=!0)):t.target.classList.contains("e-gantt-manualparent-milestone")&&(i.content=this.toolTipObj.content=l.tooltipModule.getTooltipContent("manualmilestone",e,l,t),oe.isNullOrUndefined(i.content))&&(t.cancel=!0)):t.cancel=!0,!1===t.cancel?(o=new y.Deferred,l.trigger("beforeTooltipRender",i,function(e){o.resolve(e),e.cancel&&(t.cancel=!0)}),this.toolTipObj.content=i.content,this.parent.isAdaptive||"mouseover"!==t.event.type||(this.currentTarget=t.target,oe.EventHandler.add(this.currentTarget,"mousemove",this.mouseMoveHandler.bind(this))),this.parent.renderTemplates(),o):void 0;t.cancel=!0},on.prototype.tooltipCloseHandler=function(e){this.tooltipMouseEvent=null,this.parent.isAdaptive||oe.isNullOrUndefined(this.currentTarget)||oe.EventHandler.remove(this.currentTarget,"mousemove",this.mouseMoveHandler),this.currentTarget=null},on.prototype.mouseMoveHandler=function(e){this.tooltipMouseEvent=e},on.prototype.updateTooltipPosition=function(e){e.element.style.visibility="visible";var t=this.parent.element.closest('[style*="zoom"]');if(oe.isNullOrUndefined(t)&&!oe.isNullOrUndefined(this.tooltipMouseEvent)&&!e.target.classList.contains("e-notes-info")){var t=this.getPointorPosition(this.tooltipMouseEvent),i=this.parent.getOffsetRect(this.parent.chartPane),n=i.top+this.parent.chartPane.offsetHeight,a=i.left+this.parent.chartPane.offsetWidth,r=t.x,i=t.y;if(a<r+e.element.offsetWidth+10)for(;a<r+e.element.offsetWidth+10;)r=a-e.element.offsetWidth-10,e.element.style.left=r+"px";else e.element.style.left=(r+=10)+"px";e.event.clientY>e.element.offsetHeight&&n<(i=window.innerHeight<e.element.offsetHeight+i?i-e.element.offsetHeight-10:i)+e.element.offsetHeight+20?i=i-e.element.offsetHeight-10:i+=10,e.element.style.top=i+"px"}},on.prototype.getPointorPosition=function(e){var t,i;return oe.isNullOrUndefined(oe.getValue("pageX",e))&&oe.isNullOrUndefined(oe.getValue("pageY",e))?oe.isNullOrUndefined(oe.getValue("clientX",e))&&oe.isNullOrUndefined(oe.getValue("clientY",e))||(t=oe.getValue("clientX",e)+document.body.scrollLeft+document.documentElement.scrollLeft,i=oe.getValue("clientY",e)+document.body.scrollTop+document.documentElement.scrollTop):(t=oe.getValue("pageX",e),i=oe.getValue("pageY",e)),{x:t,y:i}},on.prototype.getTooltipContent=function(e,t,i,n){var a,r,s,o;switch(t&&(s=(r=t.ganttProperties).taskName,this.parent.enableHtmlSanitizer&&"string"==typeof s&&(s=oe.SanitizeHtmlHelper.sanitize(s)),a=oe.isNullOrUndefined(s)?"":'<tr class = "e-gantt-tooltip-rowcell"><td colspan="3">'+(this.parent.disableHtmlEncode?s.replace(/</g,"&lt;").replace(/>/g,"&gt;"):s)+"</td></tr>"),e){case"milestone":var l=void 0,d=(n.target.className.includes("e-baseline-gantt-milestone-container")&&!oe.isNullOrUndefined(r.baselineStartDate)?l=r.baselineStartDate:oe.isNullOrUndefined(r.startDate)||(l=r.startDate),this.parent.getFormatedDate(l,this.parent.getDateFormat())),h=(this.parent.enableHtmlSanitizer&&"string"==typeof d&&(d=oe.SanitizeHtmlHelper.sanitize(d)),oe.isNullOrUndefined(l)?"":'<tr><td class = "e-gantt-tooltip-label"> Date</td><td>:</td><td class = "e-gantt-tooltip-value">'+d+"</td></tr>"),l=function(){return'<table class = "e-gantt-tooltiptable"><tbody>'+a+h+"</tbody></table>"},p=oe.initializeCSPTemplate(l);break;case"taskbar":var d=!(t.hasChildRecords&&!r.isAutoSchedule),u=this.parent.getFormatedDate(d?r.startDate:r.autoStartDate,this.parent.getDateFormat()),c=this.parent.getFormatedDate(d?r.endDate:r.autoEndDate,this.parent.getDateFormat()),g=this.parent.getDurationString(d?r.duration:r.autoDuration,r.durationUnit),f=r.progress,m=(this.parent.enableHtmlSanitizer&&(u="string"==typeof u?oe.SanitizeHtmlHelper.sanitize(u):u,c="string"==typeof c?oe.SanitizeHtmlHelper.sanitize(c):c,g=oe.SanitizeHtmlHelper.sanitize(g)),r.startDate?'<tr><td class = "e-gantt-tooltip-label">'+this.parent.localeObj.getConstant(d?"startDate":"subTasksStartDate")+"</td><td class="+Qe+'>:</td><td class = "e-gantt-tooltip-value"> '+u+"</td></tr>":""),y=r.endDate?'<tr><td class = "e-gantt-tooltip-label">'+this.parent.localeObj.getConstant(d?"endDate":"subTasksEndDate")+"</td><td class="+Qe+'>:</td><td class = "e-gantt-tooltip-value">'+c+"</td></tr>":"",D=oe.isNullOrUndefined(r.duration)?"":'<tr><td class = "e-gantt-tooltip-label">'+this.parent.localeObj.getConstant("duration")+"</td><td class="+Qe+'>:</td><td class = "e-gantt-tooltip-value"> '+g+"</td></tr>",k='<tr><td class = "e-gantt-tooltip-label">'+this.parent.localeObj.getConstant("progress")+"</td><td class="+Qe+">:</td><td>"+f+"</td></tr>",l=function(){return'<table class = "e-gantt-tooltiptable"><tbody>'+a+m+y+D+k+"</tbody></table>"};p=oe.initializeCSPTemplate(l);break;case"baseline":var w=this.parent.getFormatedDate(r.baselineStartDate,this.parent.getDateFormat()),b=this.parent.getFormatedDate(r.baselineEndDate,this.parent.getDateFormat()),l=(this.parent.enableHtmlSanitizer&&(w=oe.SanitizeHtmlHelper.sanitize(w),b=oe.SanitizeHtmlHelper.sanitize(b)),function(){return'<table class = "e-gantt-tooltiptable"><tbody>'+a+'<tr><td class = "e-gantt-tooltip-label">'+this.parent.localeObj.getConstant("baselineStartDate")+'</td><td>:</td><td class = "e-gantt-tooltip-value">'+w+'</td></tr><tr><td class = "e-gantt-tooltip-label">'+this.parent.localeObj.getConstant("baselineEndDate")+'</td><td>:</td><td class = "e-gantt-tooltip-value">'+b+"</td></tr></tbody></table>"});p=oe.initializeCSPTemplate(l,this);break;case"marker":var u=i.tooltipModule.getMarkerTooltipData(n),T=this.parent.getFormatedDate(this.parent.dateValidationModule.getDateFromFormat(u.day),this.parent.getDateFormat()),v=u.label||"",l=(this.parent.enableHtmlSanitizer&&(v=oe.SanitizeHtmlHelper.sanitize(v),T=oe.SanitizeHtmlHelper.sanitize(T)),function(){return'<table class = "e-gantt-tooltiptable"><tbody><tr><td>'+T+"</td></tr><tr><td>"+(this.parent.disableHtmlEncode?v.replace(/</g,"&lt;").replace(/>/g,"&gt;"):v)+"</td></tr></tbody></table>"});p=oe.initializeCSPTemplate(l,this);break;case"connectorLine":var P=i.tooltipModule.predecessorTooltipData.fromName,S=i.tooltipModule.predecessorTooltipData.fromId,C=i.tooltipModule.predecessorTooltipData.toName,R=i.tooltipModule.predecessorTooltipData.toId,M=i.tooltipModule.predecessorTooltipData.linkText,x=i.tooltipModule.predecessorTooltipData.offsetString,l=(this.parent.enableHtmlSanitizer&&(P=oe.SanitizeHtmlHelper.sanitize(P),S=oe.SanitizeHtmlHelper.sanitize(S),C=oe.SanitizeHtmlHelper.sanitize(C),R=oe.SanitizeHtmlHelper.sanitize(R),M=oe.SanitizeHtmlHelper.sanitize(M),x=oe.SanitizeHtmlHelper.sanitize(x)),function(){return'<table class = "e-gantt-tooltiptable"><tbody><tr><td class = "e-gantt-tooltip-label">'+this.parent.localeObj.getConstant("from")+'</td><td>:</td><td class = "e-gantt-tooltip-value">'+(this.parent.disableHtmlEncode?P.replace(/</g,"&lt;").replace(/>/g,"&gt;"):P)+" ("+(this.parent.disableHtmlEncode&&"string"==typeof S?S.replace(/</g,"&lt;").replace(/>/g,"&gt;"):S)+')</td></tr><tr><td class = "e-gantt-tooltip-label">'+this.parent.localeObj.getConstant("to")+'</td><td>:</td><td class = "e-gantt-tooltip-value">'+(this.parent.disableHtmlEncode?C.replace(/</g,"&lt;").replace(/>/g,"&gt;"):C)+" ("+R+')</td></tr><tr><td class = "e-gantt-tooltip-label">'+this.parent.localeObj.getConstant("taskLink")+'</td><td>:</td><td class = "e-gantt-tooltip-value"> '+M+'</td></tr><tr><td class = "e-gantt-tooltip-label">'+this.parent.localeObj.getConstant("lag")+'</td><td>:</td><td class = "e-gantt-tooltip-value">'+x+"</td></tr></tbody></table>"});p=oe.initializeCSPTemplate(l,this);break;case"indicator":n.target.title.length&&(o=n.target.title,this.parent.enableHtmlSanitizer&&"string"==typeof o&&(o=oe.SanitizeHtmlHelper.sanitize(o)),p=oe.initializeCSPTemplate(l=function(){return'<table class = "e-gantt-tooltiptable"><tbody><tr>'+o+"</tr></tbody></table>"}));break;case"timeline":var O=n.target.title,l=(this.parent.enableHtmlSanitizer&&"string"==typeof O&&(O=oe.SanitizeHtmlHelper.sanitize(O)),function(){return'<table class = "e-gantt-tooltiptable"><tbody><tr>'+O+"</tr></tbody></table>"});p=oe.initializeCSPTemplate(l);break;case"manualtaskbar":var d=this.parent.getFormatedDate(r.autoStartDate,this.parent.getDateFormat()),c=this.parent.getFormatedDate(r.autoEndDate,this.parent.getDateFormat()),g=this.parent.getDurationString(r.duration,r.durationUnit),f=this.parent.getFormatedDate(r.startDate,this.parent.getDateFormat()),u=this.parent.getFormatedDate(r.endDate,this.parent.getDateFormat()),I=(this.parent.enableHtmlSanitizer&&(d=oe.SanitizeHtmlHelper.sanitize(d),c=oe.SanitizeHtmlHelper.sanitize(c),g=oe.SanitizeHtmlHelper.sanitize(g),f=oe.SanitizeHtmlHelper.sanitize(f),u=oe.SanitizeHtmlHelper.sanitize(u)),'<tr><td class = "e-gantt-tooltip-label">'+this.parent.localeObj.getConstant("subTasksStartDate")+'</td><td>:</td><td class = "e-gantt-tooltip-value"> '+d+"</td></tr>"),E='<tr><td class = "e-gantt-tooltip-label">'+this.parent.localeObj.getConstant("subTasksEndDate")+'</td><td>:</td><td class = "e-gantt-tooltip-value">'+c+"</td></tr>",U='<tr><td class = "e-gantt-tooltip-label">'+this.parent.localeObj.getConstant("duration")+'</td><td>:</td><td class = "e-gantt-tooltip-value"> '+g+"</td></tr>",F='<tr><td class = "e-gantt-tooltip-label">'+this.parent.localeObj.getConstant("startDate")+'</td><td>:</td><td class = "e-gantt-tooltip-value"> '+f+"</td></tr>",N='<tr><td class = "e-gantt-tooltip-label">'+this.parent.localeObj.getConstant("endDate")+'</td><td>:</td><td class = "e-gantt-tooltip-value">'+u+"</td></tr>",l=function(){return'<table class = "e-gantt-tooltiptable"><tbody>'+a+F+I+N+E+U+"</tbody></table>"};p=oe.initializeCSPTemplate(l);break;case"manualmilestone":var d=this.parent.getFormatedDate(r.autoStartDate,this.parent.getDateFormat()),c=this.parent.getFormatedDate(r.autoEndDate,this.parent.getDateFormat()),g=this.parent.getFormatedDate(r.startDate,this.parent.getDateFormat()),L=(this.parent.enableHtmlSanitizer&&(d=oe.SanitizeHtmlHelper.sanitize(d),c=oe.SanitizeHtmlHelper.sanitize(c),g=oe.SanitizeHtmlHelper.sanitize(g)),'<tr><td class = "e-gantt-tooltip-label">'+this.parent.localeObj.getConstant("subTasksStartDate")+'</td><td>:</td><td class = "e-gantt-tooltip-value"> '+d+"</td></tr>"),V='<tr><td class = "e-gantt-tooltip-label">'+this.parent.localeObj.getConstant("subTasksEndDate")+'</td><td>:</td><td class = "e-gantt-tooltip-value">'+c+"</td></tr>",B='<tr><td class = "e-gantt-tooltip-label"> Date</td><td>:</td><td class = "e-gantt-tooltip-value">'+g+"</tr>",l=function(){return'<table class = "e-gantt-tooltiptable"><tbody>'+a+B+L+V+"</tbody></table>"};p=oe.initializeCSPTemplate(l)}return p},on.prototype.getMarkerTooltipData=function(e){e=e.target.id.match(/\d+/g);return this.parent.eventMarkers[Number(e)]},on.prototype.getPredecessorTooltipData=function(e){var t,e=e.target.id,i=(e=this.parent.enableHtmlSanitizer&&"string"==typeof e?oe.SanitizeHtmlHelper.sanitize(e):e).match(/ConnectorLineparent(.*)child(.*)/),n=(i.shift(),e="ResourceView"===this.parent.viewType?(t=this.parent.flatData[this.parent.getTaskIds().indexOf("T"+i[0])],this.parent.flatData[this.parent.getTaskIds().indexOf("T"+i[1])]):(t=this.parent.flatData[this.parent.ids.indexOf(i[0])],this.parent.flatData[this.parent.ids.indexOf(i[1])]),t.ganttProperties.predecessor.filter(function(e){return e.to===i[1]}));return{fromId:"ResourceView"===this.parent.viewType?t.ganttProperties.taskId:t.ganttProperties.rowUniqueID,toId:"ResourceView"===this.parent.viewType?e.ganttProperties.taskId:e.ganttProperties.rowUniqueID,fromName:t.ganttProperties.taskName,toName:e.ganttProperties.taskName,linkType:n[0].type,linkText:this.parent.getPredecessorTextValue(n[0].type),offset:n[0].offset,offsetUnit:n[0].offsetUnit,offsetString:this.parent.getDurationString(n[0].offset,n[0].offsetUnit)}},on.prototype.templateCompiler=function(e,t,i,n){var e=t.chartRowsModule.templateCompiler(e),a=t.chartRowsModule.getTemplateID(n);return e(oe.extend({index:0},i),t,n,a,!0)},on.prototype.destroy=function(){this.toolTipObj.destroy()};var sn=on;function on(e){this.parent=e,this.createTooltip(),this.parent.on("destroy",this.destroy,this)}dn.prototype.getActiveElement=function(e){return e?this.previousActiveElement:this.activeElement},dn.prototype.setActiveElement=function(e){this.previousActiveElement=this.activeElement,this.activeElement=e},dn.prototype.onKeyPress=function(e){var t=this.parent,i=e.target,n=t.getExpandedRecords(t.currentViewData),a=(!oe.isNullOrUndefined(this.parent.focusModule.getActiveElement())||"expandAll"!==e.action&&"collapseAll"!==e.action||this.parent.element.querySelector(".e-treegrid").focus(),!this.parent.isEdit&&!oe.isNullOrUndefined(i)&&i.closest(".e-headercell")&&"Enter"===e.key&&this.parent.sortModule&&this.parent.allowSorting&&(e.action="enter",this.parent.treeGrid.grid.notify("key-pressed",e)),this.parent.focusModule.getActiveElement());if("home"!==e.action&&"end"!==e.action&&"downArrow"!==e.action&&"upArrow"!==e.action&&"delete"!==e.action&&"rightArrow"!==e.action&&"leftArrow"!==e.action&&"focusTask"!==e.action&&"focusSearch"!==e.action&&"expandAll"!==e.action&&"collapseAll"!==e.action&&"undo"!==e.action&&"redo"!==e.action&&"selectAll"!==e.action||oe.isNullOrUndefined(t.editModule)||oe.isNullOrUndefined(t.editModule.cellEditModule)||!0!==t.editModule.cellEditModule.isCellEdit)switch(!t.isAdaptive||"addRowDialog"!==e.action&&"editRowDialog"!==e.action&&"delete"!==e.action&&"addRow"!==e.action||t.selectionModule&&"Multiple"===t.selectionSettings.type&&(t.selectionModule.hidePopUp(),document.getElementsByClassName("e-gridpopup")[0].style.display="none"),e.action){case"home":if(t.selectionModule&&"Cell"!==t.selectionSettings.mode){if(0===t.selectedRowIndex)return;t.selectionModule&&0===t.selectionModule.getCellSelectedRecords().length&&t.selectionModule.selectRow(0,!1,!0)}break;case"end":if(t.selectionModule&&"Cell"!==t.selectionSettings.mode){var r=n[n.length-1];if(t.selectedRowIndex===t.flatData.indexOf(r))return;t.selectionModule&&0===t.selectionModule.getCellSelectedRecords().length&&t.selectionModule.selectRow(t.flatData.indexOf(r),!1,!0)}break;case"downArrow":case"upArrow":(d=t.element.querySelector("#"+t.element.id+"_searchbar"))&&d.parentElement.classList.contains("e-input-focus")&&t.selectionModule.clearSelection(),t.element.classList.contains("e-scroll-disabled")||(this.upDownKeyNavigate(e),oe.isNullOrUndefined(a)||oe.isNullOrUndefined(a.closest(".e-chart-row"))||t.ganttChartModule.manageFocus(this.getActiveElement(),"remove",!0,e.action),t.selectionSettings&&"Both"===t.selectionSettings.mode&&e.target instanceof HTMLElement&&e.target.classList.contains("e-cellselectionbackground")&&e.target.classList.remove("e-cellselectionbackground"));break;case"expandAll":t.ganttChartModule.expandCollapseAll("expand");break;case"collapseAll":t.ganttChartModule.expandCollapseAll("collapse");break;case"expandRow":case"collapseRow":this.expandCollapseKey(e);break;case"saveRequest":if(!oe.isNullOrUndefined(t.editModule)&&!oe.isNullOrUndefined(t.editModule.cellEditModule)&&t.editModule.cellEditModule.isCellEdit){var r=t.editModule.cellEditModule.editedColumn;if(r.field!==t.columnMapping.duration||oe.isNullOrUndefined(r.edit)||oe.isNullOrUndefined(r.edit.read)||(l=e.target.ej2_instances[0],s=e.target.value,o=void 0,r.field===t.columnMapping.duration&&s!==(o=oe.isNullOrUndefined(r.edit)||oe.isNullOrUndefined(r.edit.read)?o:r.edit.read()).toString()&&(l.value=s,l.dataBind())),t.editModule.dialogModule.dialogObj&&oe.getValue("dialogOpen",t.editModule.dialogModule.dialogObj))return;t.treeGrid.grid.saveCell(),t.element.querySelector(".e-treegrid").focus()}!oe.isNullOrUndefined(a)&&!oe.isNullOrUndefined(a.closest(".e-chart-row"))&&(r=e.target,o=a.querySelector(".e-gantt-parent-taskbar,.e-gantt-child-taskbar,.e-gantt-milestone"))&&this.parent.ganttChartModule.onTaskbarClick(e,r,o);break;case"escape":oe.isNullOrUndefined(t.editModule)||oe.isNullOrUndefined(t.editModule.cellEditModule)||(t.editModule.cellEditModule.isCellEdit=!1,oe.isNullOrUndefined(t.toolbarModule))||t.toolbarModule.refreshToolbarItems();break;case"addRow":t.editModule&&t.editModule.cellEditModule&&t.editModule.cellEditModule.isCellEdit?e.stopPropagation():oe.isNullOrUndefined(document.getElementById(this.parent.element.id+"_dialog"))&&(e.preventDefault(),t.addRecord(void 0,this.parent.editSettings.newRowPosition,this.parent.selectedRowIndex),t.element.focus());break;case"addRowDialog":if(e.preventDefault(),t.editModule&&t.editModule.dialogModule&&t.editSettings.allowAdding){if(t.editModule.dialogModule.dialogObj&&oe.getValue("dialogOpen",t.editModule.dialogModule.dialogObj))return;t.editModule.dialogModule.openAddDialog()}break;case"editRowDialog":if(e.preventDefault(),t.element.querySelector(".e-treegrid").focus(),t.editModule&&t.editModule.dialogModule&&t.editSettings.allowEditing){if(t.editModule.dialogModule.dialogObj&&oe.getValue("dialogOpen",t.editModule.dialogModule.dialogObj))return;t.editModule.dialogModule.openToolbarEditDialog()}break;case"delete":t.selectionModule&&t.editModule&&t.editModule.dialogModule&&(!t.editModule.dialogModule.dialogObj||t.editModule.dialogModule.dialogObj&&!t.editModule.dialogModule.dialogObj.visible)&&(!t.editSettings.allowTaskbarEditing||t.editSettings.allowTaskbarEditing&&!t.editModule.taskbarEditModule.touchEdit)&&("Cell"!==t.selectionSettings.mode&&t.selectionModule.selectedRowIndexes.length||"Cell"===t.selectionSettings.mode&&t.selectionModule.getSelectedRowCellIndexes().length)&&(oe.isNullOrUndefined(e.target)||"INPUT"!==e.target.tagName)&&t.editModule.startDeleteAction();break;case"focusTask":e.preventDefault();var s=void 0;t.selectionModule&&(l=t.currentViewData,"Cell"===t.selectionSettings.mode||oe.isNullOrUndefined(l[t.selectedRowIndex])?"Cell"===t.selectionSettings.mode&&0<t.selectionModule.getSelectedRowCellIndexes().length&&(s=l[(r=t.selectionModule.getSelectedRowCellIndexes())[r.length-1].rowIndex].ganttProperties.rowUniqueID):s=t.currentViewData[t.selectedRowIndex].ganttProperties.rowUniqueID),s&&t.scrollToTask(s.toString());break;case"focusSearch":t.element.querySelector("#"+t.element.id+"_searchbar")&&((d=t.element.querySelector("#"+t.element.id+"_searchbar")).setAttribute("tabIndex","-1"),d.focus());break;case"tab":case"shiftTab":t.element.classList.contains("e-scroll-disabled")||t.ganttChartModule.onTabAction(e);break;case"contextMenu":var o=document.getElementById(this.parent.element.id+"_contextmenu").ej2_instances[0],l=this.parent.getOffsetRect(e.target),r=l.top+l.height/2,s=l.left+l.width/2;this.setActiveElement(e.target),o.open(r,s),e.preventDefault();break;case"undo":this.parent.undoRedoModule&&0<this.parent.undoRedoModule.getUndoCollection.length&&this.parent.undo();break;case"redo":this.parent.undoRedoModule&&0<this.parent.undoRedoModule.getRedoCollection.length&&this.parent.redo();break;case"selectAll":e.preventDefault();var d=[].slice.call(this.parent.ganttChartModule.chartBodyContent.querySelector("tbody").children);0<d.length&&(l=parseInt(d[0].getAttribute("aria-rowindex"),10)-1,o=parseInt(d[d.length-1].getAttribute("aria-rowindex"),10)-1,oe.isNullOrUndefined(l)||(l=Number(l)),oe.isNullOrUndefined(o)||(o=Number(o)),oe.isNullOrUndefined(l)||oe.isNullOrUndefined(o)||this.parent.selectionModule.selectRowsByRange(l,o));break;default:r={requestType:"keyPressed",action:e.action,keyEvent:e};t.trigger("actionComplete",r)}},dn.prototype.upDownKeyNavigate=function(e){e.preventDefault();var t,i,n,a,r,s=this.parent,o=("downArrow"===e.action||"upArrow"===e.action)&&this.parent.selectionModule&&this.parent.allowSelection&&this.parent.virtualScrollModule&&this.parent.enableVirtualization?s.getExpandedRecords(s.flatData):s.getExpandedRecords(s.currentViewData);s.selectionModule&&("Cell"!==s.selectionSettings.mode&&-1!==s.selectedRowIndex?(i=void 0,i=(("downArrow"===e.action||"upArrow"===e.action)&&this.parent.selectionModule&&this.parent.allowSelection&&this.parent.virtualScrollModule&&this.parent.enableVirtualization?s.flatData:s.currentViewData)[s.selectedRowIndex],(n=s.element.querySelector(".e-focused"))&&oe.removeClass([n],"e-focused"),n=o.indexOf(i),a="downArrow"===e.action?o[n+1]:o[n-1],r=this.parent.args,document.activeElement!==r&&(("downArrow"===e.action||"upArrow"===e.action)&&this.parent.selectionModule&&this.parent.allowSelection&&this.parent.virtualScrollModule&&this.parent.enableVirtualization?s.selectionModule.selectRow(s.flatData.indexOf(a),!1,!0):s.selectionModule.selectRow(s.currentViewData.indexOf(a),!1,!0))):"Cell"===s.selectionSettings.mode&&0<s.selectionModule.getSelectedRowCellIndexes().length&&(t=(r=(r=s.selectionModule.getSelectedRowCellIndexes())[r.length-1]).cellIndexes[r.cellIndexes.length-1],i=s.currentViewData[r.rowIndex],n=o.indexOf(i),a="downArrow"===e.action?o[n+1]:o[n-1],r={rowIndex:s.currentViewData.indexOf(a),cellIndex:t},s.selectionModule.selectCell(r)),this.parent.ganttChartModule.focusedRowIndex=this.parent.selectedRowIndex)},dn.prototype.expandCollapseKey=function(e){var t,i,n=this.parent;n.selectionModule&&-1!==n.selectedRowIndex&&("Cell"!==n.selectionSettings.mode?i=n.selectedRowIndex:"Cell"===n.selectionSettings.mode&&0<n.selectionModule.getSelectedRowCellIndexes().length&&(t=n.selectionModule.getSelectedRowCellIndexes(),i=t[t.length-1].rowIndex),this.parent.virtualScrollModule&&this.parent.enableVirtualization&&(i=this.parent.currentViewData.findIndex(function(e){return e.ganttProperties.rowUniqueID===i.toString()})+1),"expandRow"===e.action?(this.isFromKeyboardAction=!0,n.expandByIndex(i)):(this.isFromKeyboardAction=!0,n.collapseByIndex(i)),this.isFromKeyboardAction=!1)};var ln=dn;function dn(e){this.isFromKeyboardAction=!1,this.parent=e,this.activeElement=null,this.previousActiveElement=null}hn=function(e,t){return(hn=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])}))(e,t)};var hn,pn,Ki=function(e,t){function i(){this.constructor=e}hn(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},g=function(e,t,i,n){var a,r=arguments.length,s=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var o=e.length-1;0<=o;o--)(a=e[o])&&(s=(r<3?a(s):3<r?a(t,i,s):a(t,i))||s);return 3<r&&s&&Object.defineProperty(t,i,s),s},Ki=(pn=oe.Component,Ki(f,pn),f.prototype.getModuleName=function(){return"gantt"},f.prototype.preRender=function(){this.initProperties()},f.prototype.getCurrentDayStartTime=function(e){e=0<this.weekWorkingTime.length?this.getStartTime(e):this.defaultStartTime;return e},f.prototype.getCurrentDayEndTime=function(e){e=0<this.weekWorkingTime.length?this.getEndTime(e):this.defaultEndTime;return e},f.prototype.getStartTime=function(e){var t;switch(e.getDay()){case 0:t=this.sundayDefaultStartTime;break;case 1:t=this.mondayDefaultStartTime;break;case 2:t=this.tuesdayDefaultStartTime;break;case 3:t=this.wednesdayDefaultStartTime;break;case 4:t=this.thursdayDefaultStartTime;break;case 5:t=this.fridayDefaultStartTime;break;default:t=this.saturdayDefaultStartTime}return t},f.prototype.getEndTime=function(e){var t;switch(e.getDay()){case 0:t=this.sundayDefaultEndTime;break;case 1:t=this.mondayDefaultEndTime;break;case 2:t=this.tuesdayDefaultEndTime;break;case 3:t=this.wednesdayDefaultEndTime;break;case 4:t=this.thursdayDefaultEndTime;break;case 5:t=this.fridayDefaultEndTime;break;default:t=this.saturdayDefaultEndTime}return t},f.prototype.getNonWorkingRange=function(e){var t;switch(e.getDay()){case 0:t=this.sundayNonWorkingTimeRanges;break;case 1:t=this.mondayNonWorkingTimeRanges;break;case 2:t=this.tuesdayNonWorkingTimeRanges;break;case 3:t=this.wednesdayNonWorkingTimeRanges;break;case 4:t=this.thursdayNonWorkingTimeRanges;break;case 5:t=this.fridayNonWorkingTimeRanges;break;default:t=this.saturdayNonWorkingTimeRanges}return t},f.prototype.getWorkingRange=function(e){var t;switch(e.getDay()){case 0:t=this.sundayWorkingTimeRanges;break;case 1:t=this.mondayWorkingTimeRanges;break;case 2:t=this.tuesdayWorkingTimeRanges;break;case 3:t=this.wednesdayWorkingTimeRanges;break;case 4:t=this.thursdayWorkingTimeRanges;break;case 5:t=this.fridayWorkingTimeRanges;break;default:t=this.saturdayWorkingTimeRanges}return t},f.prototype.getSecondsPerDay=function(e){var t;switch(e.getDay()){case 0:t=this.sundaySeconds;break;case 1:t=this.mondaySeconds;break;case 2:t=this.tuesdaySeconds;break;case 3:t=this.wednesdaySeconds;break;case 4:t=this.thursdaySeconds;break;case 5:t=this.fridaySeconds;break;case 6:t=this.saturdaySeconds;break;default:t=this.secondsPerDay}return t},f.prototype.initProperties=function(){this.globalize=new oe.Internationalization(this.locale),this.isAdaptive=oe.Browser.isDevice,this.flatData=[],this.currentViewData=[],this.updatedRecords=[],this.ids=[],this.ganttColumns=[],this.updateOffsetOnTaskbarEdit=!1===this.UpdateOffsetOnTaskbarEdit?this.UpdateOffsetOnTaskbarEdit:this.updateOffsetOnTaskbarEdit,this.localeObj=new oe.L10n(this.getModuleName(),this.getDefaultLocale(),this.locale),this.dataOperation=new ie(this),this.nonWorkingHours=[],this.mondayNonWorkingHours=[],this.tuesdayNonWorkingHours=[],this.wednesdayNonWorkingHours=[],this.thursdayNonWorkingHours=[],this.fridayNonWorkingHours=[],this.saturdayNonWorkingHours=[],this.sundayNonWorkingHours=[],this.nonWorkingTimeRanges=[],this.mondayNonWorkingTimeRanges=[],this.tuesdayNonWorkingTimeRanges=[],this.wednesdayNonWorkingTimeRanges=[],this.thursdayNonWorkingTimeRanges=[],this.fridayNonWorkingTimeRanges=[],this.saturdayNonWorkingTimeRanges=[],this.sundayNonWorkingTimeRanges=[],this.workingTimeRanges=[],this.mondayWorkingTimeRanges=[],this.tuesdayWorkingTimeRanges=[],this.wednesdayWorkingTimeRanges=[],this.thursdayWorkingTimeRanges=[],this.fridayWorkingTimeRanges=[],this.saturdayWorkingTimeRanges=[],this.sundayWorkingTimeRanges=[],this.defaultEndTime=null,this.defaultStartTime=null,this.mondayDefaultStartTime=null,this.mondayDefaultEndTime=null,this.tuesdayDefaultStartTime=null,this.tuesdayDefaultEndTime=null,this.wednesdayDefaultStartTime=null,this.wednesdayDefaultEndTime=null,this.thursdayDefaultStartTime=null,this.thursdayDefaultEndTime=null,this.fridayDefaultStartTime=null,this.fridayDefaultEndTime=null,this.saturdayDefaultStartTime=null,this.saturdayDefaultEndTime=null,this.sundayDefaultStartTime=null,this.sundayDefaultEndTime=null,this.durationUnitTexts={days:"days",hours:"hours",minutes:"minutes",day:"day",hour:"hour",minute:"minute"},this.durationUnitEditText={minute:["m","min","minute","minutes"],hour:["h","hr","hour","hours"],day:["d","dy","day","days"]},this.perDayWidth=null,this.isMileStoneEdited=!1,this.chartVerticalLineContainer=null,this.updatedConnectorLineCollection=[],this.connectorLineIds=[],this.predecessorsCollection=[],this.isInPredecessorValidation=this.enablePredecessorValidation,this.isValidationEnabled=!0,this.isLoad=!0,this.editedTaskBarItem=null,this.validationDialogElement=null,this.currentEditedArgs={},this.dialogValidateMode={respectLink:!1,removeLink:!1,preserveLinkWithEditing:!0},this.secondsPerDay=this.dataOperation.getSecondsPerDay(),this.nonWorkingDayIndex=[],this.dataOperation.getNonWorkingDayIndex(),this.columnMapping={},this.controlId=this.element.id,this.cloneProjectStartDate=this.enablePersistence&&this.cloneProjectStartDate?this.cloneProjectStartDate:null,this.cloneProjectEndDate=this.enablePersistence&&this.cloneProjectEndDate?this.cloneProjectEndDate:null,this.totalHolidayDates=this.dataOperation.getHolidayDates(),this.ganttChartModule=new Pt(this),this.timelineModule=new Ct(this),this.chartRowsModule=new en(this),this.treeGridModule=new Mt(this),this.dateValidationModule=new $(this),this.predecessorModule=new tn(this),this.connectorLineModule=new nn(this),this.splitterModule=new an(this),this.tooltipModule=new sn(this),this.keyConfig={home:"home",end:"end",downArrow:"downarrow",upArrow:"uparrow",collapseAll:"ctrl+uparrow",expandAll:"ctrl+downarrow",collapseRow:"ctrl+shift+uparrow",expandRow:"ctrl+shift+downarrow",saveRequest:"13",escape:"27",addRow:"insert",addRowDialog:"ctrl+insert",editRowDialog:"ctrl+f2",delete:"delete",tab:"tab",shiftTab:"shift+tab",focusTask:"shift+f5",indentLevel:"shift+leftarrow",outdentLevel:"shift+rightarrow",focusSearch:"ctrl+shift+70",contextMenu:"shift+F10",undo:"ctrl+z",redo:"ctrl+y",selectAll:"ctrl+a"},this.focusModule=new ln(this),0===this.zoomingLevels.length&&this.setProperties({zoomingLevels:this.getZoomingLevels()},!0),this.resourceFieldsMapping(),oe.isNullOrUndefined(this.resourceFields.unit)&&this.setProperties({resourceFields:{unit:"unit"}},!0),this.taskIds=[]},f.prototype.isUndoRedoItemPresent=function(e){return!(!this.undoRedoModule||!this.undoRedoActions||-1===this.undoRedoActions.indexOf(e))},f.prototype.getDateFormat=function(){return oe.isNullOrUndefined(this.dateFormat)?this.globalize.getDatePattern({skeleton:"yMd"}):this.dateFormat},f.prototype.getDefaultTZOffset=function(){var e=new Date((new Date).getFullYear(),0,1),t=new Date((new Date).getFullYear(),6,1);return Math.max(e.getTimezoneOffset(),t.getTimezoneOffset())},f.prototype.isInDst=function(e){return e.getTimezoneOffset()<this.getDefaultTZOffset()},f.prototype.resourceFieldsMapping=function(){var e=this.resourceFields;e.id=oe.isNullOrUndefined(e.id)?this.resourceIDMapping:e.id,e.name=oe.isNullOrUndefined(e.name)?this.resourceNameMapping:e.name},f.prototype.validateDimentionValue=function(e){return oe.isNullOrUndefined(e)?null:"string"==typeof e&&"auto"!==e&&-1===e.indexOf("%")?-1===e.indexOf("px")?e+"px":e:"number"==typeof e?e+"px":e.toString()},f.prototype.calculateDimensions=function(){var e=this.validateDimentionValue(this.height),t=this.validateDimentionValue(this.width),i=(oe.isNullOrUndefined(this.width)||"string"!=typeof this.width||-1===this.width.indexOf("%")||(t=this.width),this.element.style.height),n=this.element.style.width;t&&(this.element.style.width=t),e&&(this.element.style.height=e),e||i||(this.element.style.height="auto"),t||n||(this.element.style.width="auto"),this.ganttHeight=this.element.offsetHeight,this.ganttWidth=this.element.offsetWidth},f.prototype.render=function(){this.isReact&&(this.treeGrid.isReact=!0,this.treeGrid.grid.isReact=!0),this.isVue&&(this.treeGrid.isVue=!0,this.treeGrid.grid.isVue=!0,this.treeGrid.vueInstance=this.vueInstance,this.treeGrid.grid.vueInstance=this.vueInstance),this.element.setAttribute("role","application"),U.createSpinner({target:this.element},this.createElement),this.trigger("load",{}),this.element.classList.add(ne),this.isAdaptive?this.element.classList.add(pe):this.element.classList.remove(pe),this.calculateDimensions(),oe.isNullOrUndefined(this.toolbarModule)||this.renderToolbar(),this.splitterModule.renderSplitter(),this.notify("renderPanels",null),this.actionFailures(),oe.isNullOrUndefined(this.loadingIndicator)||"Shimmer"!==this.loadingIndicator.indicatorType?this.showSpinner():this.showMaskRow(),this.dataMap&&this.dataMap.clear(),this.dataOperation.checkDataBinding()},f.prototype.actionFailures=function(){for(var e,t,i,n,a,r,s=[],o=/^[a-zA-Z\s/]+$/,l=!0,d=this.taskFields.properties,h=(Object.keys(d).forEach(function(e){null!==d[e]&&(l=!1)}),!0),p=0;p<this.columns.length;p++)if(this.columns[p].isPrimaryKey){h=!1;break}function u(t,e,i,n){var a;oe.isNullOrUndefined(i)||(a=i.filter(function(e){return e.prototype.getModuleName()===t})),e&&!oe.isNullOrUndefined(a)&&0===a.length&&n.push("Module "+t+" is not available in Gantt component! You either misspelled the module name or forgot to load it!")}l&&s.push("Gantt Task Fields are not configured properly. The task fields are crucial for both the project and resource views to function properly. Please ensure that the gantt task fields are properly configured!"),"ResourceView"!==this.viewType||this.resourceFields.id||s.push("Gantt Resource Fields are not properly configured, which is crucial for the Resource View. Please ensure that the resource fields are configured correctly!"),this.dataSource instanceof y.DataManager&&oe.isNullOrUndefined(this.taskFields.hasChildMapping)&&s.push("hasChildMapping property is not configured for load-on-demand. Please ensure its properly configured in the Gantt Task Fields!"),oe.isNullOrUndefined(this.timelineSettings.topTier.format)||""===this.timelineSettings.topTier.format||o.test(this.timelineSettings.topTier.format)||s.push("The provided top tier format is invalid. Please ensure that you provide a valid format for these tier. Make sure to use only letters and avoid numbers or special characters!"),oe.isNullOrUndefined(this.timelineSettings.bottomTier.format)||""===this.timelineSettings.bottomTier.format||o.test(this.timelineSettings.bottomTier.format)||s.push("The provided bottom  tier format is invalid. Please ensure that you provide a valid format for these tier. Make sure to use only letters and avoid numbers or special characters!"),h&&"ResourceView"!==this.viewType&&s.push("Primarykey is not configured properly. The primarykey is crucial for doing CRUD operations or map taskId in column field of gantt!"),0<this.eventMarkers.length&&this.eventMarkers.forEach(function(e){e.day||s.push("Day is not configured properly in event markers.Please ensure that the day in event markers is properly configured!")}),u("sort",this.allowSorting,this.injectedModules,s),u("edit",e=this.editSettings.allowAdding||this.editSettings.allowDeleting||this.editSettings.allowEditing||this.editSettings.allowNextRowEdit||this.editSettings.allowTaskbarEditing||this.editSettings.mode||this.editSettings.newRowPosition||this.editSettings.showDeleteConfirmDialog?!0:e,this.injectedModules,s),u("reorder",this.allowReordering,this.injectedModules,s),u("excelExport",this.allowExcelExport,this.injectedModules,s),u("rowDragAndDrop",t=this.allowRowDragAndDrop||this.allowTaskbarDragAndDrop?!0:t,this.injectedModules,s),u("criticalPath",this.enableCriticalPath,this.injectedModules,s),u("undoRedo",this.enableUndoRedo,this.injectedModules,s),u("resize",this.allowResizing,this.injectedModules,s),u("toolbar",i=this.toolbar&&0<this.toolbar.length?!0:i,this.injectedModules,s),u("filter",n=this.allowFiltering||this.toolbar&&-1!==this.toolbar.indexOf("Search")?!0:n,this.injectedModules,s),u("selection",this.allowSelection,this.injectedModules,s),u("dayMarkers",a=this.highlightWeekends||this.holidays&&0<this.holidays.length||this.eventMarkers&&0<this.eventMarkers.length?!0:a,this.injectedModules,s),u("contextMenu",this.enableContextMenu,this.injectedModules,s),u("columnMenu",this.showColumnMenu,this.injectedModules,s),u("pdfExport",this.allowPdfExport,this.injectedModules,s),u("virtualScroll",this.enableVirtualization,this.injectedModules,s),0<s.length&&(r={error:{}},s.forEach(function(e,t){r.error[parseInt(t,10)]=e}),this.trigger("actionFailure",r))},f.prototype.hideMaskRow=function(){var e,t=this.element.querySelectorAll(".e-masked-table").length;for(oe.isNullOrUndefined(this.contentMaskTable)||0===t&&!this.contentMaskTable||(e=this.contentMaskTable,oe.remove(e),this.contentMaskTable=null),t=this.element.querySelectorAll(".e-masked-table").length,oe.isNullOrUndefined(this.headerMaskTable)||0===t&&!this.headerMaskTable||(e=this.headerMaskTable,oe.remove(e),this.headerMaskTable=null);0!==this.element.querySelectorAll(".e-table-background").length;)this.element.querySelectorAll(".e-table-background")[0].remove();for(;0!==this.element.querySelectorAll(".e-temp-timeline").length;)this.element.querySelectorAll(".e-temp-timeline")[0].remove();if(0!==this.element.querySelectorAll("."+ge).length)for(var i=0;i<this.singleTier;i++)oe.isNullOrUndefined(this.element.querySelectorAll("."+ge)[parseInt(i.toString(),10)])||(this.element.querySelectorAll("."+ge)[parseInt(i.toString(),10)].style.visibility="visible");oe.isNullOrUndefined(this.element.querySelector("."+ce))||(this.element.querySelector("."+ce).style.position="relative"),oe.isNullOrUndefined(this.element.getElementsByClassName(se)[0])||(this.element.getElementsByClassName(se)[0].style.visibility="visible")},f.prototype.showMaskRow=function(){var e=this.chartPane.childNodes[0].childNodes[0],t=(this.scrollLeftValue=this.chartPane.childNodes[0].childNodes[0].scrollLeft,this.chartPane.childNodes[0].childNodes[1]);if(this.treeGrid.element&&this.ganttChartModule.setVirtualHeight(),!this.contentMaskTable){if(t){var i=t;if(this.renderBackGround(i),this.ganttChartModule.scrollObject.isSetScrollLeft){if(0!==this.element.querySelectorAll("."+ge).length){this.singleTier=this.timelineModule.isSingleTier?1:2;for(var n=0;n<this.singleTier;n++)this.element.querySelectorAll("."+ge)[parseInt(n.toString(),10)].style.visibility="hidden"}0===this.singleTier&&(this.singleTier=2)}this.element.getElementsByClassName(se)[0].style.visibility="hidden",this.contentMaskTable=this.contentMaskTable=this.createMaskTable(i)}e&&this.ganttChartModule.scrollObject.isSetScrollLeft&&(this.element.querySelector("."+ce).style.position="static",this.renderHeaderBackground(i=e),this.headerMaskTable=this.headerMaskTable=this.createMaskTable(i))}},f.prototype.renderHeaderBackground=function(e){var t=e;if(!!oe.closest(t,"."+ce)){for(var i=this.createElement("div",{className:"e-table-background"}),n=0,a=Math.round(e.getBoundingClientRect().width),r=0;r<3;r++)this.enableRtl?i.appendChild(this.createElement("div",{className:"e-div-background",attrs:{style:"left: "+(a-=160)+"px; top:0px;"}})):i.appendChild(this.createElement("div",{className:"e-div-background",attrs:{style:"left: "+(n+=160)+"px; top:0px;"}}));t.insertBefore(i,t.firstChild)}},f.prototype.renderBackGround=function(e){var t=e;if(!!oe.closest(t,"."+re)){for(var i=this.createElement("div",{className:"e-table-background"}),n=0,a=Math.round(e.getBoundingClientRect().width),r=0;r<3;r++)this.enableRtl?i.appendChild(this.createElement("div",{className:"e-div-background",attrs:{style:"left: "+(a-=160)+"px;z-index:1;"}})):i.appendChild(this.createElement("div",{className:"e-div-background",attrs:{style:"left: "+(n+=160)+"px;z-index:1;"}}));t.insertBefore(i,t.firstChild)}},f.prototype.createMaskTable=function(e){var t,i=e,n=e.getBoundingClientRect().height,a=!!oe.closest(i,"."+ce);return a?((t=this.createEmptyTimeLineTable(n)).style.position="sticky",t.style.left="0px",this.enableRtl&&t.style.removeProperty("left")):((t=this.createEmptyMaskTable(n)).style.position="absolute",t.style.zIndex=1),a?(t.style.height=e.getBoundingClientRect().height+"px",(n=this.createElement("div",{className:"e-temp-timeline"})).style.width=this.element.getElementsByClassName("e-timeline-header-container")[0].offsetWidth+"px",n.style.position="sticky",this.enableRtl?n.style["margin-right"]=Math.abs(this.scrollLeftValue)+"px":n.style["margin-left"]=this.scrollLeftValue+"px",n.appendChild(t),i.insertBefore(n,i.firstChild)):(t.style.height=e.getBoundingClientRect().height+"px",i.insertBefore(t,i.firstChild)),t},f.prototype.createEmptyTimeLineTable=function(e){for(var t=this.createElement("table",{className:"e-table e-masked-table"}),i=this.createElement("tbody",{className:"e-masked-tbody"}),n=[],a=this.createElement("tr",{className:"e-masked-row e-row",attrs:{style:"height: "+e/2+"px;"}}),r=0;r<this.singleTier;r++)n.push(a.cloneNode(!0));for(r=this.topBottomHeader=0;r<n.length;r++)i.appendChild(this.applyTimelineMaskRow(n[parseInt(r.toString(),10)])),this.topBottomHeader=this.topBottomHeader+1;return t.appendChild(i),t.style.width="100%",t},f.prototype.applyTimelineMaskRow=function(e){var t=e,i=4;4<this.element.getElementsByClassName("e-timeline-header-container")[0].offsetWidth/166&&(i=this.element.getElementsByClassName("e-timeline-header-container")[0].offsetWidth/166);for(var n=0;n<i;n++)t.appendChild(this.createElement("td",{className:"e-timeline-masked-top-header-cell"}));for(n=0;n<t.childNodes.length-1;n++)t.childNodes[parseInt(n.toString(),10)].style.width="166px";for(var a=[].slice.call(t.childNodes),n=0;n<a.length;n++){var r=a[parseInt(n.toString(),10)];switch(this.topBottomHeader){case 0:this.enableRtl?(r.innerHTML='<span class="e-mask e-skeleton e-skeleton-text e-shimmer-wave e-timelineHeader"></span>',r.children[0].style.left="-20px"):r.innerHTML='<span class="e-mask e-skeleton e-skeleton-text e-shimmer-wave e-timelineHeader"></span>';break;case 1:r.appendChild(this.createElement("td",{className:"e-timeline-masked-top-header-cell"})),r.appendChild(this.createElement("td",{className:"e-timeline-masked-top-header-cell"})),r.appendChild(this.createElement("td",{className:"e-timeline-masked-top-header-cell"}));for(var s=[].slice.call(r.childNodes),o=0;o<s.length;o++){var l=s[parseInt(o.toString(),10)];0===o?this.enableRtl?(l.innerHTML='<span class="e-mask e-skeleton e-skeleton-text e-shimmer-wave e-innerHTML"></span>',l.children[0].style.left="-14px"):l.innerHTML='<span class="e-mask e-skeleton e-skeleton-text e-shimmer-wave e-innerHTML"></span>':1===o?this.enableRtl?(l.innerHTML='<span class="e-mask e-skeleton e-skeleton-text e-shimmer-wave e-innerHTML1"></span>',l.children[0].style.left="-30px"):l.innerHTML='<span class="e-mask e-skeleton e-skeleton-text e-shimmer-wave e-innerHTML1"></span>':this.enableRtl?(l.innerHTML='<span class="e-mask e-skeleton e-skeleton-text e-shimmer-wave e-innerHTML2"></span>',l.children[0].style.left="-60px"):l.innerHTML='<span class="e-mask e-skeleton e-skeleton-text e-shimmer-wave e-innerHTML2"></span>'}}}return t},f.prototype.createEmptyMaskTable=function(e){for(var t=this.createElement("table",{className:"e-table e-masked-table"}),i=this.createElement("tbody",{className:"e-masked-tbody"}),n=[],a=this.createElement("tr",{className:"e-masked-row e-row",attrs:{style:"height: "+e/7+"px;"}}),r=this.columnLoop=0;r<6;r++)n.push(a.cloneNode(!0));for(var s=0;s<n.length;s++)this.columnLoop<4?this.columnLoop=this.columnLoop+1:4===this.columnLoop&&(this.columnLoop=1),i.appendChild(this.applyMaskRow(n[parseInt(s.toString(),10)]));t.appendChild(i),t.style.width="100%";e=this.createElement("div",{className:"e-temp-container"});return e.style.width="calc(100% - 17px)",e.style.overflow="hidden",e.appendChild(t),e},f.prototype.applyMaskRow=function(e){var t=e;if(this.columnLoop<4){var i=2;2<this.element.getElementsByClassName("e-timeline-header-container")[0].offsetWidth/300&&(i=this.element.getElementsByClassName("e-timeline-header-container")[0].offsetWidth/300);for(var n=0;n<i;n++)t.appendChild(this.createElement("td",{className:"e-masked-cell e-rowcell"}))}else t.appendChild(this.createElement("td",{className:"e-masked-cell e-rowcell"}));for(var a=[].slice.call(t.childNodes),n=0;n<a.length;n++){var r=a[parseInt(n.toString(),10)];switch(this.columnLoop){case 1:0===n?this.enableRtl?(r.innerHTML='<span class="e-mask e-skeleton e-skeleton-text e-shimmer-wave e-maskcell01"></span>',r.children[0].style.left="-14px"):r.innerHTML='<span class="e-mask e-skeleton e-skeleton-text e-shimmer-wave e-maskcell01"></span>':r.innerHTML='<span class="e-mask e-skeleton e-skeleton-text e-shimmer-wave e-maskcell02"></span>';break;case 2:0===n?this.enableRtl?(r.innerHTML='<span class="e-mask e-skeleton e-skeleton-text e-shimmer-wave e-maskcell03"></span>',r.children[0].style.left="-14px"):r.innerHTML='<span class="e-mask e-skeleton e-skeleton-text e-shimmer-wave e-maskcell03"></span>':r.innerHTML='<span class="e-mask e-skeleton e-skeleton-text e-shimmer-wave e-maskcell04"></span>';break;case 3:0===n?this.enableRtl?(r.innerHTML='<span class="e-mask e-skeleton e-skeleton-text e-shimmer-wave e-maskcell05"></span>',r.children[0].style.left="-64px"):r.innerHTML='<span class="e-mask e-skeleton e-skeleton-text e-shimmer-wave e-maskcell05"></span>':this.enableRtl?(r.innerHTML='<span class="e-mask e-skeleton e-skeleton-text e-shimmer-wave e-maskcell06"></span>',r.children[0].style.left="-192px"):r.innerHTML='<span class="e-mask e-skeleton e-skeleton-text e-shimmer-wave e-maskcell06"></span>';break;case 4:this.enableRtl?(r.innerHTML='<span class="e-mask e-skeleton e-skeleton-text e-shimmer-wave e-maskcell07"></span>',r.children[0].style.left="-388px"):r.innerHTML='<span class="e-mask e-skeleton e-skeleton-text e-shimmer-wave e-maskcell07"></span>'}}return t},f.prototype.showSpinner=function(){U.showSpinner(this.element)},f.prototype.hideSpinner=function(){U.hideSpinner(this.element)},f.prototype.processTimeline=function(){this.timelineModule.processTimelineUnit(),this.timelineModule.calculateZoomingLevelsPerDayWidth()},f.prototype.renderGantt=function(e){e&&(this.isFromOnPropertyChange=e),this.enableValidation&&(this.dataOperation.calculateProjectDates(),this.timelineModule.validateTimelineProp());var t=this.flatData,i=new Map;if(null!=t)for(var n=0,a=t;n<a.length;n++){var r=a[n];i.set(r.ganttProperties.rowUniqueID.toString(),r)}this.allowParentDependency&&this.predecessorModule.updateParentPredecessor(i),this.predecessorModule&&this.taskFields.dependency&&(this.predecessorModule.parentIds=[],this.predecessorModule.parentRecord=[],this.predecessorModule.updatePredecessors(i),this.isInPredecessorValidation)&&this.enableValidation&&this.autoCalculateDateScheduling&&(!this.isLoad||this.treeGrid.loadChildOnDemand||!this.taskFields.hasChildMapping)&&this.predecessorModule.updatedRecordsDateByPredecessor(i),this.enableValidation&&(this.dataOperation.calculateProjectDates(),this.timelineModule.validateTimelineProp(),this.dataOperation.updateGanttData()),e?(this.dataSource instanceof Object&&j(this)?(t=oe.getValue("count",this.dataSource),this.treeGrid.dataSource={result:this.flatData,count:t}):this.treeGrid.setProperties({dataSource:this.flatData},!1),oe.isNullOrUndefined(this.selectionModule)||this.treeGrid.setProperties({selectedRowIndex:this.selectedRowIndex},!1)):(this.treeGridPane.classList.remove("e-temp-content"),oe.isNullOrUndefined(this.treeGridPane.querySelector(".e-gantt-temp-header"))||oe.remove(this.treeGridPane.querySelector(".e-gantt-temp-header")),this.notify("dataReady",{}),this.enableContextMenu&&this.notify("initiate-contextMenu",{}),e=!oe.isNullOrUndefined(document.body.className)&&document.body.className.includes("e-bigger")&&36===this.rowHeight?46:this.rowHeight,this.rowHeight=oe.isNullOrUndefined(this.rowHeight)?36:e,this.renderTreeGrid(),this.wireEvents(),this.notify("initPredessorDialog",{})),this.isFromOnPropertyChange||this.splitterModule.updateSplitterPosition(),"Vertical"!==this.gridLines&&"Both"!==this.gridLines||this.dayMarkersModule||this.renderChartVerticalLines()},f.prototype.removeCriticalPathStyles=function(){var e=this.ganttChartModule.chartElement;oe.removeClass(e.querySelectorAll(".e-gantt-child-taskbar-inner-div"),ve),oe.removeClass(e.querySelectorAll(".e-gantt-child-progressbar-inner-div"),Pe),oe.removeClass(e.querySelectorAll(".e-critical-milestone"),Se),oe.removeClass(this.element.querySelectorAll(".e-connector-line"),it),oe.removeClass(this.element.querySelectorAll(".e-connector-line-arrow"),nt)},f.prototype.wireEvents=function(){this.allowKeyboard&&(this.keyboardModule=new oe.KeyboardEvents(this.element,{keyAction:this.keyActionHandler.bind(this),keyConfigs:this.keyConfig,eventName:"keydown"})),oe.EventHandler.add(window,"resize",this.windowResize,this),oe.EventHandler.add(document.body,"keydown",this.keyDownHandler,this)},f.prototype.unwireEvents=function(){this.keyboardModule&&(this.keyboardModule.destroy(),this.keyboardModule=null),oe.EventHandler.remove(window,"resize",this.windowResize),oe.EventHandler.remove(document.body,"keydown",this.keyDownHandler)},f.prototype.keyDownHandler=function(e){e.altKey&&74===e.keyCode&&(this.ganttChartModule.manageFocus(this.treeGrid.element.childNodes[1],"remove",!1),this.ganttChartModule.manageFocus(this.element,"add",!1))},f.prototype.windowResize=function(){var e,t,i=this;oe.isNullOrUndefined(this.element)||(this.updateContentHeight(),this.ganttChartModule.updateWidthAndHeight(),this.treeGridModule.ensureScrollBar(),this.predecessorModule&&this.taskFields.dependency&&(this.updateRowHeightInConnectorLine(this.updatedConnectorLineCollection),this.connectorLineModule.renderConnectorLines(this.updatedConnectorLineCollection)),e=this.criticalPathModule,this.enableCriticalPath&&e&&e.criticalPathCollection&&this.criticalPathModule.criticalConnectorLine(e.criticalPathCollection,e.detailPredecessorCollection,!0,e.predecessorCollectionTaskIds),this.calculateDimensions(),e=this.splitterModule.splitterObject.element.querySelectorAll(".e-pane")[0],t=this.splitterModule.splitterObject.element.querySelectorAll(".e-pane")[1],this.splitterModule.splitterPreviousPositionGrid=e.scrollWidth+1+"px",this.splitterModule.splitterPreviousPositionChart=t.scrollWidth+1+"px",this.timelineModule.isZoomedToFit&&setTimeout(function(){i.timelineModule.processZoomToFit()},0)),this.dayMarkersModule&&this.dayMarkersModule.eventMarkerRender&&this.dayMarkersModule.eventMarkerRender.updateContainerHeight(),this.enableTimelineVirtualization&&this.timelineModule.refreshTimeline()},f.prototype.keyActionHandler=function(e){var t;this.enableContextMenu&&this.contextMenuModule&&("downArrow"===e.action||"upArrow"===e.action)&&document.getElementById(this.element.id+"_contextmenu")&&this.args&&(t=this.args,oe.isNullOrUndefined(t)||t.focus()),e.target&&("downArrow"===e.action||"upArrow"===e.action)&&e.target===this.element.querySelector(".e-rowcell")||e.target&&"escape"===e.action&&this.treeGrid.grid.columnMenuModule&&"block"===this.treeGrid.grid.columnMenuModule.columnMenu.element.style.display?this.treeGrid.grid.notify("key-pressed",e):this.focusModule.onKeyPress(e)},f.prototype.updateRowHeightInConnectorLine=function(e){if(e&&e.length){var t=!oe.isNullOrUndefined(this.ganttChartModule)&&this.ganttChartModule.getChartRows()[0]&&this.ganttChartModule.getChartRows()[0].getBoundingClientRect().height;if(t&&!isNaN(t))for(var i=0;i<e.length;i++)e[i].rowHeight=t}},f.prototype.renderToolbar=function(){oe.isNullOrUndefined(this.toolbarModule)||(this.toolbarModule.renderToolbar(),this.toolbarModule.refreshToolbarItems())},f.prototype.renderTreeGrid=function(){this.treeGridModule.renderTreeGrid()},f.prototype.updateCurrentViewData=function(){var t=this;if(this.currentViewData=this.treeGrid.getCurrentViewRecords().slice(),0<this.currentViewData.length&&this.loadChildOnDemand&&this.taskFields.hasChildMapping){this.isLoad=!0,this.flatData=[],this.dataOperation.taskIds=[],this.ids=[],this.dataOperation.recordIndex=0,this.dataOperation.dataArray=this.currentViewData,this.dataOperation.cloneDataSource(),this.predecessorModule&&this.taskFields.dependency&&(this.predecessorModule.parentIds=[],this.predecessorModule.parentRecord=[],this.predecessorModule.updatePredecessors());for(var e=this.treeGrid.grid.contentModule.rows.filter(function(e){if(e.data[t.taskFields.id]===t.flatData[0].ganttProperties.taskId)return e})[0].index,i=0;i<this.flatData.length;i++)this.flatData[i].index=e,e++;this.currentViewData=this.flatData,this.treeGrid.grid.currentViewData=this.flatData,oe.isNullOrUndefined(this.treeGrid.virtualScrollModule)||(this.treeGrid.virtualScrollModule.visualData=this.flatData,this.updatedRecords=this.flatData)}},f.prototype.getRecordFromFlatdata=function(e){for(var t=[],i=0;i<e.length;i++)t.push(this.getTaskByUniqueID(e[i].uniqueID));return t},f.prototype.updateContentHeight=function(e){var t,i;(this.allowTaskbarOverlap||this.ganttChartModule.isCollapseAll||this.ganttChartModule.isExpandAll||this.isLoad)&&(this.virtualScrollModule&&this.enableVirtualization&&!oe.isNullOrUndefined(e)?(e=oe.getValue("result.length",e),this.contentHeight=e*this.rowHeight):(e=this.virtualScrollModule&&this.enableVirtualization?this.currentViewData:this.getExpandedRecords(this.currentViewData),i=void(this.expandedRecords=e),t=oe.isNullOrUndefined(this.ganttChartModule)||oe.isNullOrUndefined(this.ganttChartModule.getChartRows())?null:this.ganttChartModule.getChartRows()[0],i=!oe.isNullOrUndefined(t)&&0<t.offsetHeight?t.offsetHeight:this.rowHeight,this.contentHeight=e.length*i))},f.prototype.getExpandStatus=function(e){e=this.getParentTask(e.parentItem);return!!oe.isNullOrUndefined(e)||!1!==e.expanded&&(!e.parentItem||!1!==this.getParentTask(e.parentItem).expanded&&this.getExpandStatus(this.getParentTask(e.parentItem)))},f.prototype.getExpandedRecords=function(e){var t=this;return oe.isNullOrUndefined(e)?[]:(e=e.filter(function(e){return!0===t.getExpandStatus(e)}),this.expandedRecords=e)},f.prototype.getZoomingLevels=function(){var e=this.timelineSettings.weekStartDay;return[{topTier:{unit:"Year",format:"yyyy",count:50},bottomTier:{unit:"Year",format:"yyyy",count:10},timelineUnitSize:99,level:0,timelineViewMode:"Year",weekStartDay:e,updateTimescaleView:!0,weekendBackground:null,showTooltip:!0},{topTier:{unit:"Year",format:"yyyy",count:20},bottomTier:{unit:"Year",format:"yyyy",count:5},timelineUnitSize:99,level:1,timelineViewMode:"Year",weekStartDay:e,updateTimescaleView:!0,weekendBackground:null,showTooltip:!0},{topTier:{unit:"Year",format:"yyyy",count:5},bottomTier:{unit:"Year",format:"yyyy",count:1},timelineUnitSize:99,level:2,timelineViewMode:"Year",weekStartDay:e,updateTimescaleView:!0,weekendBackground:null,showTooltip:!0},{topTier:{unit:"Year",format:"MMM, yy",count:1},bottomTier:{unit:"Month",formatter:this.displayHalfValue,count:6},timelineUnitSize:66,level:3,timelineViewMode:"Year",weekStartDay:e,updateTimescaleView:!0,weekendBackground:null,showTooltip:!0},{topTier:{unit:"Year",format:"MMM, yy",count:1},bottomTier:{unit:"Month",formatter:this.displayHalfValue,count:6},timelineUnitSize:99,level:4,timelineViewMode:"Year",weekStartDay:e,updateTimescaleView:!0,weekendBackground:null,showTooltip:!0},{topTier:{unit:"Year",format:"MMM, yy",count:1},bottomTier:{unit:"Month",formatter:this.displayQuarterValue,count:3},timelineUnitSize:66,level:5,timelineViewMode:"Year",weekStartDay:e,updateTimescaleView:!0,weekendBackground:null,showTooltip:!0},{topTier:{unit:"Year",format:"yyyy",count:1},bottomTier:{unit:"Month",formatter:this.displayQuarterValue,count:3},timelineUnitSize:99,level:6,timelineViewMode:"Year",weekStartDay:e,updateTimescaleView:!0,weekendBackground:null,showTooltip:!0},{topTier:{unit:"Year",format:"yyyy",count:1},bottomTier:{unit:"Month",format:"MMM yyyy",count:1},timelineUnitSize:99,level:7,timelineViewMode:"Year",weekStartDay:e,updateTimescaleView:!0,weekendBackground:null,showTooltip:!0},{topTier:{unit:"Month",format:"MMM, yy",count:1},bottomTier:{unit:"Week",format:"dd",count:1},timelineUnitSize:33,level:8,timelineViewMode:"Month",weekStartDay:e,updateTimescaleView:!0,weekendBackground:null,showTooltip:!0},{topTier:{unit:"Month",format:"MMM, yyyy",count:1},bottomTier:{unit:"Week",format:"dd MMM",count:1},timelineUnitSize:66,level:9,timelineViewMode:"Month",weekStartDay:e,updateTimescaleView:!0,weekendBackground:null,showTooltip:!0},{topTier:{unit:"Month",format:"MMM, yyyy",count:1},bottomTier:{unit:"Week",format:"dd MMM",count:1},timelineUnitSize:99,level:10,timelineViewMode:"Month",weekStartDay:e,updateTimescaleView:!0,weekendBackground:null,showTooltip:!0},{topTier:{unit:"Week",format:"MMM dd, yyyy",count:1},bottomTier:{unit:"Day",format:"d",count:1},timelineUnitSize:33,level:11,timelineViewMode:"Week",weekStartDay:e,updateTimescaleView:!0,weekendBackground:null,showTooltip:!0},{topTier:{unit:"Week",format:"MMM dd, yyyy",count:1},bottomTier:{unit:"Day",format:"d",count:1},timelineUnitSize:66,level:12,timelineViewMode:"Week",weekStartDay:e,updateTimescaleView:!0,weekendBackground:null,showTooltip:!0},{topTier:{unit:"Week",format:"MMM dd, yyyy",count:1},bottomTier:{unit:"Day",format:"d",count:1},timelineUnitSize:99,level:13,timelineViewMode:"Week",weekStartDay:e,updateTimescaleView:!0,weekendBackground:null,showTooltip:!0},{topTier:{unit:"Day",format:"E dd yyyy",count:1},bottomTier:{unit:"Hour",format:"hh a",count:12},timelineUnitSize:66,level:14,timelineViewMode:"Day",weekStartDay:e,updateTimescaleView:!0,weekendBackground:null,showTooltip:!0},{topTier:{unit:"Day",format:"E dd yyyy",count:1},bottomTier:{unit:"Hour",format:"hh a",count:12},timelineUnitSize:99,level:15,timelineViewMode:"Day",weekStartDay:e,updateTimescaleView:!0,weekendBackground:null,showTooltip:!0},{topTier:{unit:"Day",format:"E dd yyyy",count:1},bottomTier:{unit:"Hour",format:"hh a",count:6},timelineUnitSize:66,level:16,timelineViewMode:"Day",weekStartDay:e,updateTimescaleView:!0,weekendBackground:null,showTooltip:!0},{topTier:{unit:"Day",format:"E dd yyyy",count:1},bottomTier:{unit:"Hour",format:"hh a",count:6},timelineUnitSize:99,level:17,timelineViewMode:"Day",weekStartDay:e,updateTimescaleView:!0,weekendBackground:null,showTooltip:!0},{topTier:{unit:"Day",format:"E dd yyyy",count:1},bottomTier:{unit:"Hour",format:"hh a",count:2},timelineUnitSize:66,level:18,timelineViewMode:"Day",weekStartDay:e,updateTimescaleView:!0,weekendBackground:null,showTooltip:!0},{topTier:{unit:"Day",format:"E dd yyyy",count:1},bottomTier:{unit:"Hour",format:"hh a",count:2},timelineUnitSize:99,level:19,timelineViewMode:"Day",weekStartDay:e,updateTimescaleView:!0,weekendBackground:null,showTooltip:!0},{topTier:{unit:"Day",format:"E dd yyyy",count:1},bottomTier:{unit:"Hour",format:"hh a",count:1},timelineUnitSize:66,level:20,timelineViewMode:"Day",weekStartDay:e,updateTimescaleView:!0,weekendBackground:null,showTooltip:!0},{topTier:{unit:"Day",format:"E dd yyyy",count:1},bottomTier:{unit:"Hour",format:"hh a",count:1},timelineUnitSize:99,level:21,timelineViewMode:"Day",weekStartDay:e,updateTimescaleView:!0,weekendBackground:null,showTooltip:!0},{topTier:{unit:"Hour",format:"ddd MMM, h a",count:1},bottomTier:{unit:"Minutes",format:"mm",count:30},timelineUnitSize:66,level:22,timelineViewMode:"Hour",weekStartDay:0,updateTimescaleView:!0,weekendBackground:null,showTooltip:!0},{topTier:{unit:"Hour",format:"ddd MMM, h a",count:1},bottomTier:{unit:"Minutes",format:"mm",count:15},timelineUnitSize:66,level:23,timelineViewMode:"Hour",weekStartDay:e,updateTimescaleView:!0,weekendBackground:null,showTooltip:!0},{topTier:{unit:"Hour",format:"ddd MMM, h a",count:1},bottomTier:{unit:"Minutes",format:"mm",count:1},timelineUnitSize:66,level:24,timelineViewMode:"Hour",weekStartDay:e,updateTimescaleView:!0,weekendBackground:null,showTooltip:!0}]},f.prototype.displayQuarterValue=function(e){e=e.getMonth();return 0<=e&&e<=2?"Q1":3<=e&&e<=5?"Q2":6<=e&&e<=8?"Q3":"Q4"},f.prototype.displayHalfValue=function(e){e=e.getMonth();return 0<=e&&e<=5?"H1":"H2"},f.prototype.getFormatedDate=function(e,t){return oe.isNullOrUndefined(e)?null:(oe.isNullOrUndefined(t)&&(t=this.getDateFormat()),this.globalize.formatDate(e,{format:t}))},f.prototype.getDurationString=function(e,t){return this.dateValidationModule.getDurationString(e,t)},f.prototype.getWorkString=function(e,t){return this.dateValidationModule.getWorkString(e,t)},f.prototype.updateTreeColumns=function(){var e,t=this.treeGrid.grid.getColumns();-1!==this.treeColumnIndex&&this.columns[this.treeColumnIndex]&&!oe.isNullOrUndefined(this.columns[this.treeColumnIndex].template)&&(e=this.columns[this.treeColumnIndex].template);for(var i=0;i<t.length;i++)for(var n={},a=0;a<this.columns.length;a++)if(this.columns[a].field===t[i].field){for(var r=0,s=Object.keys(this.columns[a]);r<s.length;r++){var o=s[r];oe.isUndefined(this.columns[a][o])||(n[o]=t[i][o]),n.visible=t[i].visible,n.width=t[i].width}this.columns[a]=n,"checkbox"===this.columns[a].type||oe.isNullOrUndefined(e)||""===e||(this.columns[a].template=e)}0<this.columns.length&&this.treeGrid.setProperties({columns:this.columns},!0)},f.prototype.treeDataBound=function(e){var r=this;this.isLoad&&this.undoRedoModule&&(0<this.sortSettings.columns.length?this.undoRedoModule.previousSortedColumns=this.sortSettings.columns:""!==this.searchSettings.key&&(this.undoRedoModule.searchString=this.searchSettings.key)),this.element.getElementsByClassName("e-chart-root-container")[0].style.height="100%",this.element.getElementsByClassName("e-gridcontent")[0].childNodes[0].setAttribute("tabindex","0");this.element.getElementsByClassName("e-gridcontent")[0].childNodes[0].childNodes[0].setAttribute("role","treegrid");var t=this.element.getElementsByClassName("e-timeline-header-container")[0].offsetHeight,i=this.element.getElementsByClassName("e-chart-scroll-container e-content")[0];i.style.height="calc(100% - "+t+"px)",i.setAttribute("tabindex","0"),oe.isNullOrUndefined(this.toolbarModule)||oe.isNullOrUndefined(this.toolbarModule.element)?this.splitterElement.style.height="100%":this.splitterElement.style.height="calc(100% - "+this.toolbarModule.element.offsetHeight+"px)",this.filterSettings&&this.filterSettings.properties&&this.filterSettings.properties.columns&&this.filterSettings.properties.columns.forEach(function(e){for(var t=e.properties.field,i=null,n=0;n<r.treeGrid.columns.length;n++){var a=r.treeGrid.columns[n];if(a.field===t){i=a;break}}i&&e.properties.uid!==i.uid&&(e.properties.uid=i.uid)}),this.isLoad?(this.enablePersistence&&this.updateTreeColumns(),this.updateCurrentViewData(),this.enableVirtualization?this.virtualScrollModule&&this.enableVirtualization&&(this.ganttChartModule.virtualRender.adjustTable(),this.ganttChartModule.scrollObject.updateTopPosition()):this.updateContentHeight(),this.isTreeGridRendered||(this.isTreeGridRendered=!0,this.timelineModule.isSingleTier?this.element.classList.add(ae):this.element.classList.remove(ae),t=this.element.getElementsByClassName("e-timeline-header-container")[0].offsetHeight,i.style.height="calc(100% - "+t+"px)",this.treeGrid.setProperties({height:"100%"},!1),this.notify("tree-grid-created",{}),this.createGanttPopUpElement(),oe.isNullOrUndefined(this.loadingIndicator)||"Shimmer"!==this.loadingIndicator.indicatorType?this.hideSpinner():this.hideMaskRow(),oe.setValue("isGanttCreated",!0,e),this.renderComplete())):this.getCurrentRecords(e),this.loadChildOnDemand&&this.taskFields.hasChildMapping&&this.updateContentHeight(),this.enableCriticalPath&&this.criticalPathModule&&this.criticalPathModule.showCriticalPath(this.enableCriticalPath),this.notify("recordsUpdated",{});for(var n=0;n<document.getElementsByClassName("e-timeline-header-table-container").length;n++)for(var a=0;a<document.getElementsByClassName("e-timeline-header-table-container")[n].children[0].children[0].children.length;a++){var s=document.getElementsByClassName("e-timeline-header-table-container")[n].children[0].children[0].children[a].children[0];s&&s.setAttribute("tabindex","-1")}i=this.criticalPathModule;this.enableCriticalPath&&i&&i.criticalPathCollection&&this.criticalPathModule.criticalConnectorLine(i.criticalPathCollection,i.detailPredecessorCollection,!0,i.predecessorCollectionTaskIds),this.initialChartRowElements=this.ganttChartModule.getChartRows(),this.isLoad=!1,this.isExpandPerformed=!!this.enableVirtualization&&this.isExpandPerformed,this.isExpandPerformed||(this.previousFlatData=oe.extend([],this.flatData,[],!0)),this.trigger("dataBound",e)},f.prototype.getCurrentRecords=function(e){this.predecessorModule&&this.taskFields.dependency&&this.connectorLineModule.removePreviousConnectorLines(this.currentViewData),this.updateCurrentViewData(),this.enableVirtualization||this.updateContentHeight(),this.virtualScrollModule&&this.enableVirtualization&&(this.ganttChartModule.virtualRender.adjustTable(),this.ganttChartModule.scrollObject.updateTopPosition())},f.prototype.onPropertyChanged=function(e,t){for(var i=!1,n=0,a=Object.keys(e);n<a.length;n++){var r,s=a[n];switch(s){case"allowSelection":case"allowRowDragAndDrop":case"allowFiltering":case"showColumnMenu":case"allowResizing":case"allowReordering":case"allowSorting":case"enableImmutableMode":this.treeGrid[s]=this[s],this.treeGrid.dataBind();break;case"workWeek":this.dataOperation.getNonWorkingDayIndex(),this.dataOperation.reUpdateGanttData(),this.chartRowsModule.initiateTemplates(),this.taskFields.dependency&&this.predecessorModule.updatedRecordsDateByPredecessor(),this.chartRowsModule.refreshGanttRows(),this.treeGrid.refreshColumns(),this.timelineModule.refreshTimeline();break;case"toolbar":this.notify("ui-toolbarupdate",{module:"toolbar",properties:e});break;case"columnMenuItems":this.treeGrid.grid.columnMenuItems=b.getActualProperties(this.columnMenuItems);break;case"eventMarkers":case"highlightWeekends":this.notify("ui-update",{module:"day-markers",properties:e});break;case"sortSettings":this.treeGrid.sortSettings=b.getActualProperties(this.sortSettings),this.treeGrid.dataBind();break;case"timelineSettings":this.timelineModule.refreshTimeline();break;case"rowHeight":case"taskbarHeight":this.treeGrid.rowHeight=this.rowHeight,this.treeGrid.dataBind(),this.chartRowsModule.initiateTemplates(),this.timelineModule.updateChartByNewTimeline(),this.taskFields.dependency&&this.ganttChartModule.reRenderConnectorLines();break;case"timezone":this.dataOperation.checkDataBinding(!0);break;case"enableCriticalPath":oe.isNullOrUndefined(this.loadingIndicator)||"Shimmer"!==this.loadingIndicator.indicatorType?this.hideSpinner():this.hideMaskRow(),this.enableCriticalPath&&this.criticalPathModule?(this.criticalPathModule.showCriticalPath(this.enableCriticalPath),(r=this.criticalPathModule).criticalPathCollection&&this.criticalPathModule.criticalConnectorLine(r.criticalPathCollection,r.detailPredecessorCollection,!0,r.predecessorCollectionTaskIds)):this.removeCriticalPathStyles();break;case"filterSettings":oe.isNullOrUndefined(e.filterSettings)&&(this.filterSettings.columns=[]),this.treeGrid.filterSettings=b.getActualProperties(this.filterSettings),this.treeGrid.dataBind();break;case"gridLines":this.treeGrid.gridLines=this.gridLines,this.treeGrid.dataBind(),this.renderChartGridLines();break;case"tooltipSettings":this.tooltipModule.toolTipObj&&this.tooltipModule.toolTipObj.destroy(),this.tooltipModule.createTooltip();break;case"splitterSettings":this.splitterModule.updateSplitterPosition();break;case"selectionSettings":this.treeGrid.selectionSettings=b.getActualProperties(this.selectionSettings),this.treeGrid.grid.selectionSettings.enableToggle=this.selectionSettings.enableToggle,this.treeGrid.dataBind();break;case"searchSettings":void 0!==e.searchSettings.key&&(this.treeGrid.grid.searchSettings=b.getActualProperties(this.searchSettings),this.treeGrid.grid.dataBind()),this.treeGrid.searchSettings=b.getActualProperties(this.searchSettings),this.treeGrid.dataBind(),this.toolbarModule&&this.toolbarModule.updateSearchTextBox();break;case"labelSettings":case"renderBaseline":case"baselineColor":this.isFromRenderBaseline=!0,this.chartRowsModule.initiateTemplates(),this.chartRowsModule.refreshGanttRows(),this.isFromRenderBaseline=!1;break;case"resourceIDMapping":case"resourceNameMapping":case"resources":this.dataOperation.reUpdateResources(),this.treeGrid.refreshColumns(),this.chartRowsModule.initiateTemplates(),this.chartRowsModule.refreshGanttRows();break;case"includeWeekend":case"allowUnscheduledTasks":case"holidays":this.isLoad=!0,"holidays"===s&&(this.totalHolidayDates=this.dataOperation.getHolidayDates(),this.notify("ui-update",{module:"day-markers",properties:e})),this.dataOperation.reUpdateGanttData(),this.treeGrid.refreshColumns(),this.chartRowsModule.initiateTemplates(),this.chartRowsModule.refreshGanttRows(),this.isLoad=!1,this.taskFields.dependency&&(this.predecessorModule.updatedRecordsDateByPredecessor(),this.treeGrid.refreshColumns(),this.chartRowsModule.refreshGanttRows());break;case"dayWorkingTime":case"weekWorkingTime":i=!0;break;case"addDialogFields":case"editDialogFields":this.editModule&&this.editModule.dialogModule&&this.editModule.dialogModule.processDialogFields();break;case"columns":this.treeGridModule.treeGridColumns=[],this.treeGridModule.validateGanttColumns(),this.treeGrid.columns=this.treeGridModule.treeGridColumns,this.treeGrid.refreshColumns(),this.chartRowsModule.initiateTemplates(),this.timelineModule.updateChartByNewTimeline();break;case"width":case"height":this.reUpdateDimention(s);break;case"editSettings":this.treeGrid.editSettings.allowAdding=this.editSettings.allowAdding,this.treeGrid.editSettings.allowDeleting=this.editSettings.allowDeleting,this.treeGrid.editSettings.showDeleteConfirmDialog=this.editSettings.showDeleteConfirmDialog,this.treeGrid.editSettings.allowEditing=this.editSettings.allowEditing,this.treeGrid.editSettings.allowNextRowEdit=this.editSettings.allowNextRowEdit,oe.isNullOrUndefined(this.editModule)||this.editModule.reUpdateEditModules(),oe.isNullOrUndefined(this.toolbarModule)||this.toolbarModule.refreshToolbarItems();break;case"connectorLineBackground":case"connectorLineWidth":this.taskFields.dependency&&(this.connectorLineModule.initPublicProp(),this.ganttChartModule.reRenderConnectorLines());break;case"treeColumnIndex":this.treeGrid.treeColumnIndex=this.treeColumnIndex;break;case"projectStartDate":case"projectEndDate":this.timelineModule.isZoomToFit=!1,this.dataOperation.calculateProjectDates(),this.updateProjectDates(this.cloneProjectStartDate,this.cloneProjectEndDate,this.isTimelineRoundOff);break;case"selectedRowIndex":oe.isNullOrUndefined(this.selectionModule)||this.selectionModule.selectRowByIndex();break;case"dataSource":this.isLoad=!0,this.isReact&&this.clearTemplate(["TaskbarTemplate","ParentTaskbarTemplate","MilestoneTemplate","TaskLabelTemplate","RightLabelTemplate","LeftLabelTemplate"]),this.closeGanttActions(),this.dataSource instanceof Object&&j(this)?(this.treeGrid.hasChildMapping="isParent",r=oe.getValue("count",this.dataSource),this.treeGrid.dataSource={result:this.flatData,count:r}):this.treeGrid.hasChildMapping=null,this.dataOperation.checkDataBinding(!0),this.isLoad=!1;break;case"enableContextMenu":case"contextMenuItems":this.enableContextMenu||"contextMenuItems"===s?this.notify("reRender-contextMenu",{module:"contextMenu",enable:!0}):this.treeGrid.contextMenuItems=[],this.treeGrid.dataBind();break;case"currencyCode":case"locale":case"enableRtl":case"readOnly":case"viewType":case"taskFields":case"allowTaskbarDragAndDrop":case"allowTaskbarOverlap":case"allowParentDependency":case"enableMultiTaskbar":if("locale"===s&&(this.isLocaleChanged=!0),"taskFields"===s&&!oe.isNullOrUndefined(e.taskFields.child))return;"allowTaskbarDragAndDrop"!==s&&(i=!0);break;case"validateManualTasksOnLinking":this.validateManualTasksOnLinking=e.validateManualTasksOnLinking;break;case"showOverAllocation":this.updateOverAllocationCotainer()}}i&&(this.isLoad&&this.contentMaskTable&&(this.contentMaskTable=null),this.refresh())},f.prototype.updateOverAllocationCotainer=function(){var e;this.showOverAllocation?this.ganttChartModule.renderOverAllocationContainer():(e=this.element.querySelector("."+kt))&&(e.innerHTML="")},f.prototype.getPersistData=function(){for(var e=["sortSettings","filterSettings","columns","searchSettings","selectedRowIndex","treeColumnIndex","currentZoomingLevel","cloneProjectStartDate","cloneProjectEndDate","splitterSettings"],t={filterSettings:["type","mode","showFilterBarStatus","immediateModeDelay","ignoreAccent","hierarchyMode"],searchSettings:["fields","operator","ignoreCase"],sortSettings:[],columns:[],selectedRowIndex:[]},i=0;i<e.length;i++)for(var n=this[e[i]],a=0,r=t[e[i]];!oe.isNullOrUndefined(r)&&a<r.length;a++)delete n[r[a]];return this.ignoreInArrays(["filter","edit","filterBarTemplate","headerTemplate","template","commandTemplate","commands","dataSource"],this.columns),this.addOnPersist(e)},f.prototype.ignoreInArrays=function(e,t){for(var i=0;i<t.length;i++)this.ignoreInColumn(e,t[i])},f.prototype.ignoreInColumn=function(e,t){for(var i=0;i<e.length;i++)delete t[e[i]],t.filter={}},f.prototype.destroy=function(){this.notify("destroy",{}),this.unwireEvents(),oe.isNullOrUndefined(this.validationDialogElement)||this.validationDialogElement.isDestroyed||this.validationDialogElement.destroy();for(var e=["ganttChartModule","timelineModule","chartRowsModule","treeGridModule","ganttDataUpdatesModule","dateValidationModule","tooltipModule"],t=0;t<e.length;t++)this[e[t]]&&(this[e[t]]=null);this.keyboardModule&&this.keyboardModule.destroy(),this.editModule&&this.editModule.dialogModule&&this.editModule.dialogModule.destroy(),this.splitterModule&&this.splitterModule.destroy(),this.toolbarModule&&this.toolbarModule.toolbar&&this.toolbarModule.toolbar.destroy(),oe.isNullOrUndefined(this.dayMarkersModule)||(oe.isNullOrUndefined(this.dayMarkersModule.eventMarkerRender)||oe.isNullOrUndefined(this.dayMarkersModule.eventMarkerRender.eventMarkersContainer)||(this.dayMarkersModule.eventMarkerRender.eventMarkersContainer=null),oe.isNullOrUndefined(this.dayMarkersModule.nonworkingDayRender))||(oe.isNullOrUndefined(this.dayMarkersModule.nonworkingDayRender.nonworkingContainer)||(this.dayMarkersModule.nonworkingDayRender.nonworkingContainer=null),oe.isNullOrUndefined(this.dayMarkersModule.nonworkingDayRender.weekendContainer)||(this.dayMarkersModule.nonworkingDayRender.weekendContainer=null),oe.isNullOrUndefined(this.dayMarkersModule.nonworkingDayRender.holidayContainer))||(this.dayMarkersModule.nonworkingDayRender.holidayContainer=null),this.connectorLineModule&&(this.connectorLineModule.dependencyViewContainer=null,this.connectorLineModule.svgObject=null,this.connectorLineModule.renderer=null,this.connectorLineModule.tooltipTable=null),this.treeGridPane=null,this.chartPane=null,this.initialChartRowElements=null,pn.prototype.destroy.call(this),this.chartVerticalLineContainer=null,this.element.innerHTML="",oe.removeClass([this.element],ne),this.element.innerHTML="",this.isTreeGridRendered=!1,this.resetTemplates(),this.dataOperation.uid=null},f.prototype.getTaskbarHeight=function(){return this.chartRowsModule.taskBarHeight},f.prototype.requiredModules=function(){var e=[];return this.isDestroyed||(this.allowSorting&&e.push({member:"sort",args:[this]}),(this.allowFiltering||this.toolbar&&-1!==this.toolbar.indexOf("Search"))&&e.push({member:"filter",args:[this]}),this.allowReordering&&e.push({member:"reorder",args:[this]}),this.allowExcelExport&&e.push({member:"excelExport",args:[this]}),(this.allowRowDragAndDrop||this.allowTaskbarDragAndDrop)&&e.push({member:"rowDragAndDrop",args:[this]}),this.enableCriticalPath&&e.push({member:"criticalPath",args:[this]}),this.enableUndoRedo&&e.push({member:"undoRedo",args:[this]}),this.allowResizing&&e.push({member:"resize",args:[this]}),this.toolbar&&0<this.toolbar.length&&e.push({member:"toolbar",args:[this]}),(this.editSettings.allowAdding||this.editSettings.allowEditing||this.editSettings.allowDeleting||this.editSettings.allowTaskbarEditing||this.allowRowDragAndDrop)&&e.push({member:"edit",args:[this]}),this.allowSelection&&e.push({member:"selection",args:[this]}),this.tooltipSettings.showTooltip&&e.push({member:"tooltip",args:[this]}),(this.highlightWeekends||this.holidays&&0<this.holidays.length||this.eventMarkers&&0<this.eventMarkers.length)&&e.push({member:"dayMarkers",args:[this]}),this.enableContextMenu&&e.push({member:"contextMenu",args:[this]}),this.showColumnMenu&&e.push({member:"columnMenu",args:[this]}),this.allowPdfExport&&e.push({member:"pdfExport",args:[this]}),this.enableVirtualization&&e.push({member:"virtualScroll",args:[this]})),e},f.prototype.sortColumn=function(e,t,i){this.sortModule&&this.allowSorting&&this.sortModule.sortColumn(e,t,i)},f.prototype.mergePersistGanttData=function(){this.treeGrid||(this.treeGrid=new T.TreeGrid);this.treeGrid.grid.mergePersistGridData.apply(this)},f.prototype.mergeColumns=function(e,t){this.treeGrid.grid.mergeColumns.apply(this,[e,t])},f.prototype.setFrozenCount=function(){this.treeGrid.grid.setFrozenCount.apply(this)},f.prototype.splitFrozenCount=function(e){this.treeGrid.grid.splitFrozenCount.apply(this,[e])},f.prototype.isFrozenGrid=function(){return this.treeGrid.grid.isFrozenGrid()},f.prototype.clearSorting=function(){this.sortModule.clearSorting()},f.prototype.renderChartGridLines=function(){var e="e-chart-row-border",t=this.chartVerticalLineContainer,i=document.getElementById(this.element.id+"GanttTaskTableBody").querySelectorAll("td");if("Vertical"===this.gridLines){if(oe.isNullOrUndefined(t)?this.renderChartVerticalLines():"none"===window.getComputedStyle(t).display&&(t.style.display="block"),i&&0<i.length&&i[0].classList.contains(e))for(var n=0;n<i.length;n++)oe.removeClass([i[n]],e)}else if("Horizontal"===this.gridLines){if(oe.isNullOrUndefined(t)||(t.style.display="none"),i&&0<i.length&&!i[0].classList.contains(e))for(n=0;n<i.length;n++)oe.addClass([i[n]],e)}else if("Both"===this.gridLines){if(oe.isNullOrUndefined(t)?this.renderChartVerticalLines():"none"===window.getComputedStyle(t).display&&(t.style.display="block"),i&&0<i.length&&!i[0].classList.contains(e))for(n=0;n<i.length;n++)oe.addClass([i[n]],e)}else if("None"===this.gridLines&&(oe.isNullOrUndefined(t)||"none"===window.getComputedStyle(t).display||(t.style.display="none"),i)&&0<i.length&&i[0].classList.contains(e))for(n=0;n<i.length;n++)oe.removeClass([i[n]],e)},f.prototype.updateGridLineContainerHeight=function(){this.chartVerticalLineContainer&&(this.chartVerticalLineContainer.style.height=oe.formatUnit(this.getContentHeight()))},f.prototype.getContentHeight=function(){var e=this.ganttChartModule.scrollElement.offsetHeight-16,t=this.ganttChartModule.chartBodyContent.offsetHeight;return t<e?t:e},f.prototype.reUpdateDimention=function(e){var t,i,n,a=0;this.calculateDimensions(),oe.isNullOrUndefined(this.toolbarModule)||oe.isNullOrUndefined(this.toolbarModule.element)||(this.toolbarModule.toolbar.refresh(),this.toolbarModule.refreshToolbarItems(),a=this.toolbarModule.element.offsetHeight),this.treeGrid.height=this.ganttHeight-a-this.treeGrid.grid.getHeaderContent().offsetHeight,this.splitterModule.splitterObject.height=(this.ganttHeight-a).toString(),oe.isNullOrUndefined(this.chartVerticalLineContainer)||(this.chartVerticalLineContainer.style.height=this.ganttHeight+"px"),oe.isNullOrUndefined(this.dayMarkersModule)||(t=oe.getValue("nonworkingDayRender.holidayContainer",this.dayMarkersModule),i=oe.getValue("nonworkingDayRender.weekendContainer",this.dayMarkersModule),n=oe.getValue("eventMarkerRender.eventMarkersContainer",this.dayMarkersModule),t&&(t.style.height=this.ganttHeight+"px"),i&&(i.style.height=this.ganttHeight+"px"),n&&(n.style.height=this.ganttHeight+"px")),"width"===e&&(this.splitterModule.splitterObject.width=this.ganttWidth.toString()),this.ganttChartModule.scrollObject.setHeight(this.ganttHeight-this.ganttChartModule.chartTimelineContainer.offsetHeight-a)},f.prototype.renderChartVerticalLines=function(){this.element.contains(this.chartVerticalLineContainer)||(this.chartVerticalLineContainer=oe.createElement("div",{id:this.element.id+"line-container",styles:"position:absolute;height:100%;"}),this.ganttChartModule.chartBodyContent.insertBefore(this.chartVerticalLineContainer,this.ganttChartModule.chartBodyContent.lastChild)),this.chartVerticalLineContainer.innerHTML="";for(var e=this.element.getElementsByClassName("e-timeline-header-table-container")[1],t=(e=oe.isNullOrUndefined(e)?this.element.getElementsByClassName("e-timeline-header-table-container")[0]:e).getElementsByTagName("th"),i=t.length,n=0,a=oe.createElement("div"),r=0;r<i;r++){var n=0===r?-1:n+parseFloat(s),s=t[r].style.width,o=oe.createElement("div",{className:"e-line-container-cell",styles:(this.enableRtl?"right:"+(n+1):"left:"+(-1!==n?n+.3:n))+"px"});a.appendChild(o)}for(;a.firstChild;)this.chartVerticalLineContainer.appendChild(a.firstChild)},f.prototype.getDefaultLocale=function(){return{emptyRecord:"No records to display",id:"ID",name:"Name",startDate:"Start Date",endDate:"End Date",duration:"Duration",progress:"Progress",dependency:"Dependency",notes:"Notes",criticalPath:"Critical Path",undo:"Undo",redo:"Redo",baselineStartDate:"Baseline Start Date",baselineEndDate:"Baseline End Date",taskMode:"Task Mode",changeScheduleMode:"Change Schedule Mode",subTasksStartDate:"SubTasks Start Date",subTasksEndDate:"SubTasks End Date",scheduleStartDate:"Schedule Start Date",scheduleEndDate:"Schedule End Date",auto:"Auto",manual:"Manual",type:"Type",offset:"Offset",resourceName:"Resources",resourceID:"Resource ID",day:"day",hour:"hour",minute:"minute",days:"days",hours:"hours",minutes:"minutes",generalTab:"General",customTab:"Custom Columns",writeNotes:"Write Notes",addDialogTitle:"New Task",editDialogTitle:"Task Information",add:"Add",edit:"Edit",update:"Update",delete:"Delete",cancel:"Cancel",search:"Search",task:" task",tasks:" tasks",zoomIn:"Zoom in",zoomOut:"Zoom out",zoomToFit:"Zoom to fit",excelExport:"Excel export",csvExport:"CSV export",pdfExport:"PDF export",expandAll:"Expand all",collapseAll:"Collapse all",nextTimeSpan:"Next timespan",prevTimeSpan:"Previous timespan",saveButton:"Save",taskBeforePredecessorFS:'You moved "{0}" to start before "{1}" finishes and the two tasks are linked.As the result, the links cannot be honored. Select one action below to perform',taskAfterPredecessorFS:'You moved "{0}" away from "{1}" and the two tasks are linked.As the result, the links cannot be honored. Select one action below to perform',taskBeforePredecessorSS:'You moved "{0}" to start before "{1}" starts and the two tasks are linked.As the result, the links cannot be honored. Select one action below to perform',taskAfterPredecessorSS:'You moved "{0}" to start after "{1}" starts and the two tasks are linked.As the result, the links cannot be honored. Select one action below to perform',taskBeforePredecessorFF:'You moved "{0}" to finish before "{1}" finishes and the two tasks are linked.As the result, the links cannot be honored. Select one action below to perform',taskAfterPredecessorFF:'You moved "{0}" to finish after "{1}" finishes and the two tasks are linked.As the result, the links cannot be honored. Select one action below to perform',taskBeforePredecessorSF:'You moved "{0}" away from "{1}" to starts and the two tasks are linked.As the result, the links cannot be honored. Select one action below to perform',taskAfterPredecessorSF:'You moved "{0}" to finish after "{1}" starts and the two tasks are linked.As the result, the links cannot be honored. Select one action below to perform',okText:"Ok",confirmDelete:"Are you sure you want to Delete Record?",from:"From",to:"To",taskLink:"Task Link",lag:"Lag",start:"Start",finish:"Finish",enterValue:"Enter the value",taskInformation:"Task Information",deleteTask:"Delete Task",deleteDependency:"Delete Dependency",convert:"Convert",save:"Save",above:"Above",below:"Below",child:"Child",milestone:"Milestone",toTask:"To Task",toMilestone:"To Milestone",eventMarkers:"Event markers",leftTaskLabel:"Left task label",rightTaskLabel:"Right task label",timelineCell:"Timeline cell",confirmPredecessorDelete:"Are you sure you want to remove dependency link?",unit:"Unit",work:"Work",taskType:"Task Type",unassignedTask:"Unassigned Task",group:"Group",indent:"Indent",outdent:"Outdent",segments:"Segments",splitTask:"Split Task",mergeTask:"Merge Task",left:"Left",right:"Right",FF:"FF",FS:"FS",SF:"SF",SS:"SS"}},f.prototype.removeSortColumn=function(e){this.sortModule.removeSortColumn(e)},f.prototype.actionBeginTask=function(e){this.trigger("actionBegin",e),oe.getValue("cancel",e)||(oe.isNullOrUndefined(this.loadingIndicator)||"Shimmer"!==this.loadingIndicator.indicatorType?this.showSpinner():this.showMaskRow())},f.prototype.scrollToDate=function(e){e=this.dateValidationModule.getDateFromFormat(e),e=this.dataOperation.getTaskLeft(e,!1);this.ganttChartModule.updateScrollLeft(e)},f.prototype.scrollToTask=function(e){-1!==this.ids.indexOf(e)&&(e=this.flatData[this.ids.indexOf(e)].ganttProperties.left,this.ganttChartModule.updateScrollLeft(e))},f.prototype.updateChartScrollOffset=function(e,t){oe.isNullOrUndefined(e)||(e=this.ganttChartModule.scrollElement.scrollWidth<=e?this.ganttChartModule.scrollElement.scrollWidth:e,this.ganttChartModule.scrollObject.setScrollLeft(e,this.enableRtl?-1:0)),oe.isNullOrUndefined(t)||(t=this.ganttChartModule.scrollElement.scrollHeight<=t?this.ganttChartModule.scrollElement.scrollHeight:t,this.ganttChartModule.scrollObject.setScrollTop(t))},f.prototype.getParentTask=function(t){if(!oe.isNullOrUndefined(t))if(!this.autoCalculateDateScheduling&&this.dataMap&&0<this.dataMap.size&&!this.taskFields.hasChildMapping&&this.isLoad){var e=this.dataMap.get(t.uniqueID);if(e)return e}else{e=this.flatData.find(function(e){return t.uniqueID===e.uniqueID});if(e)return e}return null},f.prototype.getRootParent=function(e,t){return e.level===t?e:this.getRootParent(this.getParentTask(e.parentItem),t)},f.prototype.filterByColumn=function(e,t,i,n,a,r){this.treeGrid.filterByColumn(e,t,i,n,a,r)},f.prototype.excelExport=function(e,t,i,n){return this.excelExportModule?this.treeGrid.excelExport(e,t,i,n):null},f.prototype.csvExport=function(e,t,i,n){return this.excelExportModule?this.treeGrid.csvExport(e,t,i,n):null},f.prototype.pdfExport=function(e,t,i,n){return this.pdfExportModule?this.pdfExportModule.export(e,t,i,n):null},f.prototype.clearFiltering=function(e){this.treeGrid.grid.clearFiltering(e)},f.prototype.removeFilteredColsByField=function(e){this.treeGrid.removeFilteredColsByField(e,!1)},f.prototype.renderWorkingDayCell=function(e){var t=!1,i=!1,t="Auto"!==this.taskMode&&"Custom"!==this.taskMode||!(!this.includeWeekend&&this.autoCalculateDateScheduling),n=("Custom"===this.taskMode&&this.taskFields.manual&&((n=this.editModule)&&n.cellEditModule&&n.cellEditModule.isCellEdit?i=n.cellEditModule.currentEditedRowData[this.taskFields.manual]:n&&n.dialogModule&&n.dialogModule.isEdit&&(i=n.dialogModule.editedRecord[this.taskFields.manual]),t=i||this.includeWeekend||!this.autoCalculateDateScheduling),t?[]:this.nonWorkingDayIndex),i=this.totalHolidayDates;0<n.length&&-1!==n.indexOf(e.date.getDay())?e.isDisabled=!0:0<i.length&&((t=new Date(e.date.getTime())).setHours(0,0,0),-1!==i.indexOf(t.getTime()))&&(!this.autoCalculateDateScheduling||this.isLoad&&!this.treeGrid.loadChildOnDemand&&this.taskFields.hasChildMapping?e.isDisabled=!1:e.isDisabled=!0)},f.prototype.previousTimeSpan=function(e){var t;this.isReact&&this.clearTemplate(["TaskbarTemplate","ParentTaskbarTemplate","MilestoneTemplate","TaskLabelTemplate","RightLabelTemplate","LeftLabelTemplate"]),this.undoRedoModule&&this.isUndoRedoItemPresent("PreviousTimeSpan")&&(this.undoRedoModule.redoEnabled&&this.undoRedoModule.disableRedo(),this.undoRedoModule.createUndoCollection(),(t={action:"PreviousTimeSpan"}).previousTimelineStartDate=oe.extend([],[],[this.timelineModule.timelineStartDate],!0)[0],t.previousTimelineEndDate=oe.extend([],[],[this.timelineModule.timelineEndDate],!0)[0],this.undoRedoModule.getUndoCollection[this.undoRedoModule.getUndoCollection.length-1]=t),this.timelineModule.performTimeSpanAction("prevTimeSpan","publicMethod",new Date(this.timelineModule.timelineStartDate.getTime()),new Date(this.timelineModule.timelineEndDate.getTime()),e)},f.prototype.nextTimeSpan=function(e){var t;this.isReact&&this.clearTemplate(["TaskbarTemplate","ParentTaskbarTemplate","MilestoneTemplate","TaskLabelTemplate","RightLabelTemplate","LeftLabelTemplate"]),this.undoRedoModule&&this.isUndoRedoItemPresent("NextTimeSpan")&&(this.undoRedoModule.redoEnabled&&this.undoRedoModule.disableRedo(),this.undoRedoModule.createUndoCollection(),(t={action:"NextTimeSpan"}).previousTimelineStartDate=oe.extend([],[],[this.timelineModule.timelineStartDate],!0)[0],t.previousTimelineEndDate=oe.extend([],[],[this.timelineModule.timelineEndDate],!0)[0],this.undoRedoModule.getUndoCollection[this.undoRedoModule.getUndoCollection.length-1]=t),this.timelineModule.performTimeSpanAction("nextTimeSpan","publicMethod",new Date(this.timelineModule.timelineStartDate.getTime()),new Date(this.timelineModule.timelineEndDate.getTime()),e)},f.prototype.updateProjectDates=function(e,t,i,n){this.timelineModule.totalTimelineWidth=0,this.cloneProjectStartDate=e,this.cloneProjectEndDate=t,this.isTimelineRoundOff=i,this.timelineModule.refreshTimelineByTimeSpan(),this.dataOperation.reUpdateGanttDataPosition(),(!this.pdfExportModule||this.pdfExportModule&&!this.pdfExportModule.isPdfExport||this.pdfExportModule&&this.pdfExportModule.isPdfExport&&this.pdfExportModule.helper.exportProps&&this.pdfExportModule.helper.exportProps.fitToWidthSettings&&!this.pdfExportModule.helper.exportProps.fitToWidthSettings.isFitToWidth)&&(this.timelineModule.updateChartByNewTimeline(),e=window.outerWidth/window.innerWidth,this.timelineModule.isZoomToFit&&!this.enableTimelineVirtualization&&e<1?(t=void 0,t=this.enableVirtualization?Math.abs(this.timelineModule.totalTimelineWidth-this.element.getElementsByClassName("e-chart-scroll-container e-content")[0].clientWidth)+1:Math.abs(this.timelineModule.totalTimelineWidth-this.ganttChartModule.chartBodyContent.parentElement.clientWidth),this.ganttChartModule.chartBodyContent.style.width=oe.formatUnit(this.timelineModule.totalTimelineWidth-t)):this.ganttChartModule.chartBodyContent.style.width=oe.formatUnit(this.timelineModule.totalTimelineWidth),this.ganttChartModule.updateLastRowBottomWidth(),this.taskFields.dependency&&this.ganttChartModule.reRenderConnectorLines(),"beforeAdd"!==n)&&this.notify("selectRowByIndex",{})},f.prototype.splitTask=function(e,t){this.isEdit=!0,this.chartRowsModule.splitTask(e,t)},f.prototype.mergeTask=function(e,t){this.chartRowsModule.mergeTask(e,t)},f.prototype.reorderColumns=function(e,t){this.treeGrid.reorderColumns(e,t)},f.prototype.initiateEditAction=function(e){this.isOnEdit=e,this.previousRecords={},this.editedRecords=[]},f.prototype.setRecordValue=function(e,t,i,n){var a,r;t=oe.isUndefined(t)?null:t,!(!this.isOnEdit&&!this.isOnDelete)&&(this.makeCloneData(e,i,n),r=(n=n?i:i.ganttProperties).rowUniqueID,a=this.getRecordByID(r),r=!1,r=!(!oe.isNullOrUndefined(t)&&(oe.isNullOrUndefined(t)||oe.isNullOrUndefined(i[""+e])||(t instanceof Date?t.getTime()===i[""+e].getTime():i[""+e]===t))),a)&&(-1===this.editedRecords.indexOf(a)&&r||0===this.editedRecords.length)&&(this.editModule.draggedRecord&&this.editModule.draggedRecord.ganttProperties.taskId===n.taskId?this.editedRecords.splice(0,0,a):this.editedRecords.push(a),this.undoRedoModule&&(-1===this.undoRedoModule.changedRecords.indexOf(a)&&this.undoRedoModule.changedRecords.push(oe.extend({},{},a,!0)),r=0<this.undoRedoModule.getUndoCollection.length?this.undoRedoModule.getUndoCollection[this.undoRedoModule.getUndoCollection.length-1].action:null,!this.editModule||!this.editSettings.allowEditing||this.undoRedoModule.isUndoRedoPerformed||this.isOnDelete||this.isOnAdded||"outdent"===r||"indent"===r||"RowDragAndDrop"===r||"TaskbarDragAndDrop"===r||(n=this.previousFlatData.filter(function(e){return e.ganttProperties.taskId===a.ganttProperties.taskId})[0])&&this.undoRedoModule.getUndoCollection[this.undoRedoModule.getUndoCollection.length-1]&&this.undoRedoModule.getUndoCollection[this.undoRedoModule.getUndoCollection.length-1].modifiedRecords&&this.undoRedoModule.getUndoCollection[this.undoRedoModule.getUndoCollection.length-1].modifiedRecords.push(n)),this.enableImmutableMode)&&this.modifiedRecords.push(a),oe.setValue(e,t,i)},f.prototype.makeCloneData=function(e,t,i){var n=oe.getValue(e,t);i&&(e="ganttProperties."+e),oe.isNullOrUndefined(this.previousRecords[t.uniqueID])&&(this.previousRecords[t.uniqueID]={}),i=this.previousRecords[t.uniqueID],t=oe.getValue(e,i),oe.isUndefined(t)&&(t=n instanceof Date?new Date(n.getTime()):oe.isObjectArray(n)?oe.extend([],n,[],!0):oe.isObject(n)?oe.extend({},{},n,!0):n,oe.isUndefined(t)?oe.setValue(e,null,i):oe.setValue(e,t,i))},f.prototype.closeGanttActions=function(){this.editModule&&(this.editModule.cellEditModule&&this.editModule.cellEditModule.isCellEdit?(this.treeGrid.closeEdit(),this.editModule.cellEditModule.isCellEdit=!1,oe.isNullOrUndefined(this.toolbarModule)||this.toolbarModule.refreshToolbarItems()):this.editModule.dialogModule&&this.editModule.dialogModule.dialogObj&&this.editModule.dialogModule.dialogObj.visible&&(this.editModule.dialogModule.dialogObj.hide(),this.editModule.dialogModule.dialogClose()))},f.prototype.getTaskByUniqueID=function(t){var e=this.flatData.filter(function(e){return e.uniqueID===t});return 0<e.length?e[0]:null},f.prototype.getRecordByID=function(e){return oe.isNullOrUndefined(e)?null:this.flatData[this.ids.indexOf(e.toString())]},f.prototype.setSplitterPosition=function(e,t){var i={},e=(i[t]=e,this.splitterModule.calculateSplitterPosition(i));switch(t){case"view":this.splitterSettings.view=i[t];break;case"columnIndex":this.splitterModule.isSplitterResized=!0,this.splitterSettings.columnIndex=i[t];break;case"position":this.splitterModule.isSplitterResized=!0,this.splitterSettings.position=i[t]}var n=this.splitterModule.splitterObject.element.querySelectorAll(".e-pane")[0],a=this.splitterModule.splitterObject.element.querySelectorAll(".e-pane")[1];this.splitterModule.splitterPreviousPositionGrid=n.scrollWidth+1+"px",this.splitterModule.splitterPreviousPositionChart=a.scrollWidth+1+"px",this.splitterModule.splitterObject.paneSettings[0].size=e,this.splitterModule.splitterObject.paneSettings[1].size=parseFloat("99.75%")-parseFloat(e)+"%",this.splitterModule.triggerCustomResizedEvent()},f.prototype.expandByIndex=function(e){if("number"==typeof e){var t=this.contructExpandCollapseArgs(null,e);this.ganttChartModule.isExpandCollapseFromChart=!0,this.ganttChartModule.expandGanttRow(t)}else for(var i,n=0;n<e.length;n++)"number"==typeof e[n]&&(i=e[n],t=this.contructExpandCollapseArgs(null,i),this.ganttChartModule.isExpandCollapseFromChart=!0,this.ganttChartModule.expandGanttRow(t))},f.prototype.expandByID=function(e){this.enableVirtualization&&(this.isExpandPerformed=!0);e=this.contructExpandCollapseArgs(e);this.ganttChartModule.isExpandCollapseFromChart=!0,this.ganttChartModule.expandGanttRow(e)},f.prototype.collapseByIndex=function(e){e=this.contructExpandCollapseArgs(null,e);this.ganttChartModule.isExpandCollapseFromChart=!0,this.ganttChartModule.collapseGanttRow(e)},f.prototype.collapseByID=function(e){e=this.contructExpandCollapseArgs(e);this.ganttChartModule.isExpandCollapseFromChart=!0,this.ganttChartModule.collapseGanttRow(e)},f.prototype.addRecord=function(e,t,i){if(this.editModule&&this.editSettings.allowAdding){if("ResourceView"===this.viewType){this.editModule.addRowPosition=t,this.editModule.addRowIndex=i;var n=void 0,a=(oe.isNullOrUndefined(e)||(n=this.undoRedoModule&&this.undoRedoModule.isUndoRedoPerformed?e.ganttProperties.resourceInfo:e[this.taskFields.resourceInfo]),void 0),r=void 0;if(!oe.isNullOrUndefined(n)&&n.length){for(var s,o,l=0;l<n.length&&(a="object"==typeof n[l]?n[l][this.resourceFields.id]:n[0],!(r=this.flatData[this.getTaskIds().indexOf("R"+a)]));l++);r&&(0===r.level||r.childRecords.length)?(s=r.childRecords[i],"ResourceView"===this.viewType&&this.undoRedoModule&&this.undoRedoModule.isUndoRedoPerformed?this.editModule.addRecord(e,t,i):s?"Child"===(o="Above"===t||"Below"===t?t:"Child")?this.editModule.addRecord(e,o,this.getTaskIds().indexOf("R"+a)):this.editModule.addRecord(e,o,this.flatData.indexOf(s)):this.editModule.addRecord(e,"Child",this.getTaskIds().indexOf("R"+a))):this.editModule.addRecord(e,"Bottom")}else this.undoRedoModule&&this.undoRedoModule.isUndoRedoPerformed?this.editModule.addRecord(e,t,i):this.editModule.addRecord(e,"Bottom");this.editModule.addRowPosition=null,this.editModule.addRowIndex=null}else this.editModule.addRecord(e,t,i),"Bottom"===t&&(this.selectedRowIndex=i);"Above"!==t&&"Below"!==t&&"Child"!==t||(this.currentSelection=oe.isNullOrUndefined(e)?this.currentSelection:e)}},f.prototype.updateRecordByID=function(e){this.editModule&&this.editSettings.allowEditing&&(this.updateDuration=!0,this.editModule.updateRecordByID(e),this.updateDuration=!1)},f.prototype.updateTaskId=function(e,t){this.editModule&&this.editSettings.allowEditing&&this.editModule.updateTaskId(e,t)},f.prototype.expandAtLevel=function(e){this.enableVirtualization&&(this.isExpandCollapseLevelMethod=!0),this.ganttChartModule.expandAtLevel(e)},f.prototype.indent=function(){this.editModule&&this.editSettings.allowEditing&&this.editModule.indent()},f.prototype.outdent=function(){this.editModule&&this.editSettings.allowEditing&&this.editModule.outdent()},f.prototype.getUndoActions=function(){return this.undoRedoModule?this.undoRedoModule.getUndoCollection:[]},f.prototype.getRedoActions=function(){return this.undoRedoModule?this.undoRedoModule.getRedoCollection:[]},f.prototype.clearUndoCollection=function(){this.undoRedoModule&&(this.undoRedoModule.getUndoCollection=[],this.toolbarModule)&&this.toolbarModule.enableItems([this.controlId+"_undo"],!1)},f.prototype.clearRedoCollection=function(){this.undoRedoModule&&(this.undoRedoModule.getRedoCollection=[],this.toolbarModule)&&this.toolbarModule.enableItems([this.controlId+"_redo"],!1)},f.prototype.undo=function(){this.undoRedoModule&&this.undoRedoModule.undoAction()},f.prototype.redo=function(){this.undoRedoModule&&this.undoRedoModule.redoAction()},f.prototype.showCriticalPath=function(e){this.criticalPathModule&&(this.criticalPathModule.showCriticalPath(e),e=this.criticalPathModule,this.criticalPathModule.criticalConnectorLine(e.criticalPathCollection,e.detailPredecessorCollection,!0,e.predecessorCollectionTaskIds))},f.prototype.getCriticalTasks=function(){return!oe.isNullOrUndefined(this.criticalPathModule)&&this.enableCriticalPath?this.criticalPathModule.getCriticalTasks():null},f.prototype.zoomIn=function(){this.timelineModule.processZooming(!0)},f.prototype.zoomOut=function(){this.timelineModule.processZooming(!1)},f.prototype.fitToProject=function(){this.timelineModule.processZoomToFit(),this.ganttChartModule.updateScrollLeft(0)},f.prototype.reorderRows=function(e,t,i){this.rowDragAndDropModule.reorderRows(e,t,i)},f.prototype.updateRecordByIndex=function(e,t){var i;this.editModule&&this.editSettings.allowEditing&&(i=this.taskFields,e=!(0<this.updatedRecords.length)||oe.isNullOrUndefined(this.updatedRecords[e])?null:this.updatedRecords[e],oe.isNullOrUndefined(e)||(t[i.id]=e[i.id],this.editModule.updateRecordByID(t)))},f.prototype.addPredecessor=function(e,t){this.connectorLineModule&&(e=this.connectorLineModule.getRecordByID(e.toString()),this.editModule)&&!oe.isNullOrUndefined(e)&&this.editSettings.allowTaskbarEditing&&this.connectorLineEditModule.addPredecessor(e,t)},f.prototype.removePredecessor=function(e){this.connectorLineModule&&(e=this.connectorLineModule.getRecordByID(e.toString()),this.editModule)&&!oe.isNullOrUndefined(e)&&this.editSettings.allowTaskbarEditing&&this.connectorLineEditModule.removePredecessor(e)},f.prototype.updatePredecessor=function(e,t){this.connectorLineModule&&(e=this.connectorLineModule.getRecordByID(e.toString()),this.editModule)&&!oe.isNullOrUndefined(e)&&this.editSettings.allowTaskbarEditing&&this.connectorLineEditModule.updatePredecessor(e,t)},f.prototype.openAddDialog=function(){this.editModule&&this.editModule.dialogModule&&this.editSettings.allowAdding&&this.editModule.dialogModule.openAddDialog()},f.prototype.openEditDialog=function(e){this.editModule&&this.editModule.dialogModule&&this.editSettings.allowEditing&&this.editModule.dialogModule.openEditDialog(e)},f.prototype.contructExpandCollapseArgs=function(e,t){oe.isNullOrUndefined(t)&&e?(a=this.getRecordByID(e.toString()),i=this.getRowByID(e),oe.isNullOrUndefined(i)||(n=oe.getValue("rowIndex",i))):oe.isNullOrUndefined(t)||(i=this.getRowByIndex(t),n=(e=this.focusModule.isFromKeyboardAction)?oe.getValue("rowIndex",i):t,a=(e?this.currentViewData:this.flatData)[n]);var i,n,a,t=this.treeGrid.getRows()[n];return{data:a,gridRow:t,chartRow:i,cancel:!1}},f.prototype.getRowByIndex=function(e){try{var t=this.element.querySelectorAll(".e-chart-row");return oe.isNullOrUndefined(e)?null:t[e]}catch(e){return null}},f.prototype.getRowByID=function(e){var t=this,e=this.getRecordByID(e.toString()),e=this.loadChildOnDemand&&this.taskFields.hasChildMapping?this.updatedRecords.map(function(e){return e[t.taskFields.id]}).indexOf(e.ganttProperties.taskId):(this.enableVirtualization?this.currentViewData:this.updatedRecords).indexOf(e);return-1!==e?this.getRowByIndex(e):null},f.prototype.getUnscheduledTaskClass=function(e){return oe.isNullOrUndefined(e.startDate)&&oe.isNullOrUndefined(e.endDate)&&oe.isNullOrUndefined(e.duration)||oe.isNullOrUndefined(e.startDate)||oe.isNullOrUndefined(e.endDate)||oe.isNullOrUndefined(e.duration)?" "+Xe:""},f.prototype.isUnscheduledTask=function(e){return!!(oe.isNullOrUndefined(e.startDate)||oe.isNullOrUndefined(e.endDate)||oe.isNullOrUndefined(e.duration))},f.prototype.createGanttPopUpElement=function(){var e=this.createElement("div",{className:"e-ganttpopup",styles:"display:none;"}),t=this.createElement("div",{className:"e-content",attrs:{tabIndex:"-1"}});oe.append([t,this.createElement("div",{className:"e-uptail e-tail"})],e),t.appendChild(this.createElement("span")),oe.append([t,this.createElement("div",{className:"e-downtail e-tail"})],e),document.getElementById(this.element.id+"GanttChart").appendChild(e)},f.prototype.getPredecessorTextValue=function(e){var t;switch(e){case"SS":t=this.localeObj.getConstant("start")+"-"+this.localeObj.getConstant("start");break;case"FF":t=this.localeObj.getConstant("finish")+"-"+this.localeObj.getConstant("finish");break;case"SF":t=this.localeObj.getConstant("start")+"-"+this.localeObj.getConstant("finish");break;case"FS":t=this.localeObj.getConstant("finish")+"-"+this.localeObj.getConstant("start")}return t},f.prototype.search=function(e){this.filterModule&&(this.searchSettings.key=e,this.dataBind())},f.prototype.getOffsetRect=function(e){var e=e.getBoundingClientRect(),t=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop,i=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft,n=document.documentElement.clientTop||document.body.clientTop||0,a=document.documentElement.clientLeft||document.body.clientLeft||0,t=e.top+t-n,n=this.enableRtl?e.right+i-a:e.left+i-a;return{top:Math.round(t),left:Math.round(n),width:e.width,height:e.height}},f.prototype.expandAll=function(){this.ganttChartModule.expandCollapseAll("expand")},f.prototype.updateDataSource=function(e,t){if(this.isDynamicData=!0,!oe.isNullOrUndefined(t))for(var i=0,n=Object.keys(t);i<n.length;i++){var a=n[i];switch(a){case"projectStartDate":this.setProperties({projectStartDate:t[a]},!0);break;case"projectEndDate":this.setProperties({projectEndDate:t[a]},!0)}}this.dataSource=e},f.prototype.collapseAll=function(){this.ganttChartModule.expandCollapseAll("collapse")},f.prototype.getGridColumns=function(){return this.treeGrid.getColumns()},f.prototype.getColumnByField=function(t,e){e=e.filter(function(e){return e.field===t});return 0<e.length?e[0]:null},f.prototype.getGanttColumns=function(){return this.ganttColumns},f.prototype.showColumn=function(e,t){this.treeGrid.showColumns(e,t),this.updateTreeColumns()},f.prototype.hideColumn=function(e,t){this.treeGrid.hideColumns(e,t),this.updateTreeColumns()},f.prototype.setScrollTop=function(e){this.ganttChartModule.scrollObject.setScrollTop(e)},f.prototype.cancelEdit=function(){this.isCancelled=!0,this.closeGanttActions()},f.prototype.selectCell=function(e,t){this.selectionModule&&this.selectionModule.selectCell(e,t)},f.prototype.selectCells=function(e){this.selectionModule&&this.selectionModule.selectCells(e)},f.prototype.selectRow=function(e,t){this.selectionModule&&this.selectionModule.selectRow(e,t)},f.prototype.selectRows=function(e){this.selectionModule&&this.selectionModule.selectRows(e)},f.prototype.deleteRecord=function(e){this.editModule&&this.editModule.deleteRecord(e)},f.prototype.enableItems=function(e,t){this.toolbarModule&&this.toolbarModule.enableItems(e,t)},f.prototype.clearSelection=function(){this.selectionModule&&this.selectionModule.clearSelection()},f.prototype.updateDataArgs=function(e){var t;return Array.isArray(e.data)||((t=[]).push(e.data),oe.setValue("data",t,e)),e},f.prototype.convertToMilestone=function(e){var t,i,e=this.getRecordByID(e);oe.isNullOrUndefined(e)||((t=oe.extend({},{},e.taskData,!0))[(i=this.taskFields).startDate]&&this.setRecordValue(i.startDate,e.ganttProperties.startDate,t,!0),oe.isNullOrUndefined(i.duration)?(t[i.startDate]=new Date(e.ganttProperties.startDate),t[i.endDate]=new Date(e.ganttProperties.endDate)):t[i.duration]=0,oe.isNullOrUndefined(i.milestone)||!1===t[i.milestone]&&(t[i.milestone]=!0),oe.isNullOrUndefined(i.progress)||(t[i.progress]=0),!oe.isNullOrUndefined(i.child)&&t[i.child]&&(t[i.child]=[]),!oe.isNullOrUndefined(i.parentID)&&t[i.parentID]&&(t[i.parentID]=null),oe.isNullOrUndefined(i.segments)||(t[i.segments]=null),"FixedWork"===(oe.isNullOrUndefined(e.ganttProperties.taskType)?this:e.ganttProperties).taskType&&(oe.isNullOrUndefined(t[i.work])?e.ganttProperties.work=0:t[i.work]=0),!oe.isNullOrUndefined(this.contextMenuModule)&&this.contextMenuModule.isOpen&&"Milestone"===this.contextMenuModule.item?(oe.isNullOrUndefined(i.dependency)||(t[i.dependency]=null),i=this.editSettings.newRowPosition,this.addRecord(t,i,this.selectedRowIndex)):e.hasChildRecords||e.ganttProperties.isMilestone||(this.isConvertedMilestone=!0,this.updateRecordByID(t),this.isConvertedMilestone=!1))},f.prototype.changeTaskMode=function(e){this.undoRedoModule&&!this.undoRedoModule.isUndoRedoPerformed&&(this.undoRedoModule.redoEnabled&&this.undoRedoModule.disableRedo(),this.undoRedoModule.createUndoCollection(),(t={action:"TaskMode"}).modifiedRecords=oe.extend([],[e],[],!0),this.undoRedoModule.getUndoCollection[this.undoRedoModule.getUndoCollection.length-1]=t);var t=this.taskFields,e=this.getRecordByID(e[t.id]),i=e.ganttProperties,t=(this.isOnEdit=!0,this.setRecordValue("isAutoSchedule",!i.isAutoSchedule,i,!0),oe.isNullOrUndefined(this.taskFields.manual)||(this.setRecordValue("taskData."+t.manual,!i.isAutoSchedule,e),this.setRecordValue(t.manual,!i.isAutoSchedule,e)),this.editModule.updateTaskScheduleModes(e),{data:e});this.editModule.initiateUpdateAction(t)},f.prototype.getTaskIds=function(){return this.taskIds},f.prototype.setTaskIds=function(e){var t;"ProjectView"!==this.viewType&&(t=e.ganttProperties.taskId,t=0===e.level?"R"+t:"T"+t,this.taskIds.push(t))},f.prototype.renderTemplates=function(){this.isReact&&this.renderReactTemplates()},f.prototype.resetTemplates=function(){this.isReact&&this.clearTemplate()},g([oe.Property(!0)],f.prototype,"allowKeyboard",void 0),g([oe.Property(!1)],f.prototype,"enableImmutableMode",void 0),g([oe.Property(!0)],f.prototype,"allowParentDependency",void 0),g([oe.Property(!0)],f.prototype,"enableHtmlSanitizer",void 0),g([oe.Property(!0)],f.prototype,"disableHtmlEncode",void 0),g([oe.Complex({},ji)],f.prototype,"loadingIndicator",void 0),g([oe.Property(!0)],f.prototype,"enableVirtualMaskRow",void 0),g([oe.Property(!0)],f.prototype,"loadChildOnDemand",void 0),g([oe.Property(!0)],f.prototype,"updateOffsetOnTaskbarEdit",void 0),g([oe.Property(!0)],f.prototype,"UpdateOffsetOnTaskbarEdit",void 0),g([oe.Property(!0)],f.prototype,"autoCalculateDateScheduling",void 0),g([oe.Property(!0)],f.prototype,"autoFocusTasks",void 0),g([oe.Property(!1)],f.prototype,"enableAdaptiveUI",void 0),g([oe.Property(!0)],f.prototype,"allowSelection",void 0),g([oe.Property(!1)],f.prototype,"allowSorting",void 0),g([oe.Property(!0)],f.prototype,"enablePredecessorValidation",void 0),g([oe.Property(!1)],f.prototype,"showColumnMenu",void 0),g([oe.Property()],f.prototype,"columnMenuItems",void 0),g([oe.Property(["Sorting","Add","ColumnReorder","ColumnResize","ColumnState","Delete","Edit","Filtering","Indent","Outdent","NextTimeSpan","PreviousTimeSpan","RowDragAndDrop","TaskbarDragAndDrop","Search","ZoomIn","ZoomOut","ZoomToFit"])],f.prototype,"undoRedoActions",void 0),g([oe.Property()],f.prototype,"timezone",void 0),g([oe.Property(!1)],f.prototype,"collapseAllParentTasks",void 0),g([oe.Property(!1)],f.prototype,"highlightWeekends",void 0),g([oe.Property(0)],f.prototype,"treeColumnIndex",void 0),g([oe.Property([])],f.prototype,"dataSource",void 0),g([oe.Property("day")],f.prototype,"durationUnit",void 0),g([oe.Property(null)],f.prototype,"query",void 0),g([oe.Property(null)],f.prototype,"dateFormat",void 0),g([oe.Property("auto")],f.prototype,"height",void 0),g([oe.Property(!1)],f.prototype,"renderBaseline",void 0),g([oe.Property(!1)],f.prototype,"allowTaskbarDragAndDrop",void 0),g([oe.Property(!0)],f.prototype,"allowTaskbarOverlap",void 0),g([oe.Property("Horizontal")],f.prototype,"gridLines",void 0),g([oe.Complex({},si)],f.prototype,"labelSettings",void 0),g([oe.Property(null)],f.prototype,"taskbarTemplate",void 0),g([oe.Property(null)],f.prototype,"parentTaskbarTemplate",void 0),g([oe.Property(null)],f.prototype,"timelineTemplate",void 0),g([oe.Property(null)],f.prototype,"milestoneTemplate",void 0),g([oe.Property()],f.prototype,"baselineColor",void 0),g([oe.Property("auto")],f.prototype,"width",void 0),g([oe.Property(!1)],f.prototype,"enableVirtualization",void 0),g([oe.Property(!1)],f.prototype,"enableTimelineVirtualization",void 0),g([oe.Property()],f.prototype,"toolbar",void 0),g([oe.Property(["Monday","Tuesday","Wednesday","Thursday","Friday"])],f.prototype,"workWeek",void 0),g([oe.Property(!1)],f.prototype,"includeWeekend",void 0),g([oe.Property(!1)],f.prototype,"allowUnscheduledTasks",void 0),g([oe.Property(!1)],f.prototype,"showInlineNotes",void 0),g([oe.Property(36)],f.prototype,"rowHeight",void 0),g([oe.Property(null)],f.prototype,"taskbarHeight",void 0),g([oe.Property(null)],f.prototype,"projectStartDate",void 0),g([oe.Property(null)],f.prototype,"projectEndDate",void 0),g([oe.Property(null)],f.prototype,"resourceIDMapping",void 0),g([oe.Property(null)],f.prototype,"resourceNameMapping",void 0),g([oe.Property([])],f.prototype,"resources",void 0),g([oe.Property([])],f.prototype,"segmentData",void 0),g([oe.Property(null)],f.prototype,"connectorLineBackground",void 0),g([oe.Property(1)],f.prototype,"connectorLineWidth",void 0),g([oe.Property([])],f.prototype,"columns",void 0),g([oe.Property([])],f.prototype,"addDialogFields",void 0),g([oe.Property([])],f.prototype,"editDialogFields",void 0),g([oe.Property(-1)],f.prototype,"selectedRowIndex",void 0),g([oe.Property("hour")],f.prototype,"workUnit",void 0),g([oe.Property("FixedUnit")],f.prototype,"taskType",void 0),g([oe.Property("ProjectView")],f.prototype,"viewType",void 0),g([oe.Collection([{from:8,to:12},{from:13,to:17}],It)],f.prototype,"dayWorkingTime",void 0),g([oe.Collection([],_i)],f.prototype,"weekWorkingTime",void 0),g([oe.Collection([],ii)],f.prototype,"holidays",void 0),g([oe.Collection([],zt)],f.prototype,"eventMarkers",void 0),g([oe.Complex({},Di)],f.prototype,"taskFields",void 0),g([oe.Complex({},Ni)],f.prototype,"resourceFields",void 0),g([oe.Complex({},s)],f.prototype,"timelineSettings",void 0),g([oe.Property([])],f.prototype,"zoomingLevels",void 0),g([oe.Complex({},Ii)],f.prototype,"sortSettings",void 0),g([oe.Complex({},Wt)],f.prototype,"editSettings",void 0),g([oe.Complex({},Pi)],f.prototype,"tooltipSettings",void 0),g([oe.Complex({},hi)],f.prototype,"selectionSettings",void 0),g([oe.Property(!1)],f.prototype,"allowFiltering",void 0),g([oe.Property(!1)],f.prototype,"allowExcelExport",void 0),g([oe.Property(!1)],f.prototype,"allowRowDragAndDrop",void 0),g([oe.Property(!1)],f.prototype,"allowReordering",void 0),g([oe.Property(!1)],f.prototype,"readOnly",void 0),g([oe.Property(!1)],f.prototype,"allowResizing",void 0),g([oe.Property(!1)],f.prototype,"enableContextMenu",void 0),g([oe.Property(!1)],f.prototype,"enableCriticalPath",void 0),g([oe.Property(!1)],f.prototype,"enableUndoRedo",void 0),g([oe.Property(10)],f.prototype,"undoRedoStepsCount",void 0),g([oe.Property()],f.prototype,"contextMenuItems",void 0),g([oe.Property(!1)],f.prototype,"allowPdfExport",void 0),g([oe.Property(!1)],f.prototype,"validateManualTasksOnLinking",void 0),g([oe.Property(!1)],f.prototype,"enableMultiTaskbar",void 0),g([oe.Property(!1)],f.prototype,"showOverAllocation",void 0),g([oe.Property("Auto")],f.prototype,"taskMode",void 0),g([oe.Complex({},Zt)],f.prototype,"filterSettings",void 0),g([oe.Complex({},Jt)],f.prototype,"searchSettings",void 0),g([oe.Complex({},gi)],f.prototype,"splitterSettings",void 0),g([oe.Event()],f.prototype,"queryTaskbarInfo",void 0),g([oe.Event()],f.prototype,"beforeExcelExport",void 0),g([oe.Event()],f.prototype,"excelExportComplete",void 0),g([oe.Event()],f.prototype,"excelQueryCellInfo",void 0),g([oe.Event()],f.prototype,"excelHeaderQueryCellInfo",void 0),g([oe.Event()],f.prototype,"rowDrag",void 0),g([oe.Event()],f.prototype,"rowDragStart",void 0),g([oe.Event()],f.prototype,"rowDragStartHelper",void 0),g([oe.Event()],f.prototype,"rowDrop",void 0),g([oe.Event()],f.prototype,"collapsing",void 0),g([oe.Event()],f.prototype,"collapsed",void 0),g([oe.Event()],f.prototype,"expanding",void 0),g([oe.Event()],f.prototype,"expanded",void 0),g([oe.Event()],f.prototype,"actionBegin",void 0),g([oe.Event()],f.prototype,"actionComplete",void 0),g([oe.Event()],f.prototype,"actionFailure",void 0),g([oe.Event()],f.prototype,"dataStateChange",void 0),g([oe.Event()],f.prototype,"taskbarEdited",void 0),g([oe.Event()],f.prototype,"endEdit",void 0),g([oe.Event()],f.prototype,"cellEdit",void 0),g([oe.Event()],f.prototype,"load",void 0),g([oe.Event()],f.prototype,"created",void 0),g([oe.Event()],f.prototype,"destroyed",void 0),g([oe.Event()],f.prototype,"taskbarEditing",void 0),g([oe.Event()],f.prototype,"dataBound",void 0),g([oe.Event()],f.prototype,"resizeStart",void 0),g([oe.Event()],f.prototype,"resizing",void 0),g([oe.Event()],f.prototype,"resizeStop",void 0),g([oe.Event()],f.prototype,"splitterResizeStart",void 0),g([oe.Event()],f.prototype,"splitterResizing",void 0),g([oe.Event()],f.prototype,"splitterResized",void 0),g([oe.Event()],f.prototype,"columnDragStart",void 0),g([oe.Event()],f.prototype,"columnDrag",void 0),g([oe.Event()],f.prototype,"columnDrop",void 0),g([oe.Event()],f.prototype,"beforeTooltipRender",void 0),g([oe.Event()],f.prototype,"rowSelecting",void 0),g([oe.Event()],f.prototype,"rowSelected",void 0),g([oe.Event()],f.prototype,"rowDeselecting",void 0),g([oe.Event()],f.prototype,"rowDeselected",void 0),g([oe.Event()],f.prototype,"cellSelecting",void 0),g([oe.Event()],f.prototype,"cellSelected",void 0),g([oe.Event()],f.prototype,"cellDeselecting",void 0),g([oe.Event()],f.prototype,"cellDeselected",void 0),g([oe.Event()],f.prototype,"queryCellInfo",void 0),g([oe.Event()],f.prototype,"headerCellInfo",void 0),g([oe.Event()],f.prototype,"rowDataBound",void 0),g([oe.Event()],f.prototype,"columnMenuOpen",void 0),g([oe.Event()],f.prototype,"toolbarClick",void 0),g([oe.Event()],f.prototype,"columnMenuClick",void 0),g([oe.Event()],f.prototype,"contextMenuOpen",void 0),g([oe.Event()],f.prototype,"contextMenuClick",void 0),g([oe.Event()],f.prototype,"onTaskbarClick",void 0),g([oe.Event()],f.prototype,"recordDoubleClick",void 0),g([oe.Event()],f.prototype,"onMouseMove",void 0),g([oe.Event()],f.prototype,"beforePdfExport",void 0),g([oe.Event()],f.prototype,"pdfExportComplete",void 0),g([oe.Event()],f.prototype,"pdfQueryCellInfo",void 0),g([oe.Event()],f.prototype,"pdfQueryTaskbarInfo",void 0),g([oe.Event()],f.prototype,"pdfQueryTimelineCellInfo",void 0),g([oe.Event()],f.prototype,"pdfColumnHeaderQueryCellInfo",void 0),g([oe.NotifyPropertyChanges],f));function f(e,t){e=pn.call(this,e,t)||this;return e.isRowSelected=!1,e.showIndicator=!0,e.singleTier=0,e.expandedRecords=[],e.isLocaleChanged=!1,e.triggeredColumnName="",e.totalUndoAction=0,e.previousFlatData=[],e.isExpandPerformed=!1,e.oldRecords=[],e.updateDuration=!1,e.isConvertedMilestone=!1,e.isCancelled=!1,e.isCollapseAll=!1,e.previousRecords={},e.editedRecords=[],e.modifiedRecords=[],e.isOnEdit=!1,e.isOnDelete=!1,e.isOnAdded=!1,e.isExpandCollapseLevelMethod=!1,e.isFromEventMarker=!1,e.isDynamicData=!1,e.isConnectorLineUpdate=!1,e.staticSelectedRowIndex=-1,e.needsID=!0,e.showActiveElement=!0,e.addDeleteRecord=!1,e.enableHeaderFocus=!0,e.enableValidation=!0,e.isTreeGridRendered=!1,e.isFromOnPropertyChange=!1,e.isFromRenderBaseline=!1,e.isGanttChartRendered=!1,e.isEdit=!1,e.eventMarkerColloction=[],oe.setValue("mergePersistData",e.mergePersistGanttData,e),e}(g=k.PdfHorizontalOverflowType||(k.PdfHorizontalOverflowType={}))[g.NextPage=0]="NextPage",g[g.LastPage=1]="LastPage";var un="toolbarClick",cn=(m.prototype.bindTreeGridProperties=function(){this.parent.treeGrid.editSettings.allowEditing=this.parent.editSettings.allowEditing,this.parent.treeGrid.editSettings.allowNextRowEdit=this.parent.editSettings.allowNextRowEdit,this.parent.treeGrid.editSettings.mode="Cell",this.parent.treeGrid.cellEdit=this.ensureEditCell.bind(this),this.parent.editSettings.allowEditing&&T.TreeGrid.Inject(T.Edit)},m.prototype.ensureEditCell=function(e){var t,i,n=this,a=e.rowData,r=e.columnName,s=(this.editedColumn=this.parent.getColumnByField(r,this.parent.ganttColumns),this.parent.taskFields);if(!this.parent.readOnly&&"Dialog"!==this.parent.editSettings.mode)return!a.hasChildRecords||this.parent.allowParentDependency||(r!==s.endDate||(oe.isNullOrUndefined(a[s.manual])||!1!==a[s.manual])&&"Auto"!==this.parent.taskMode)&&r!==s.duration&&r!==s.dependency&&r!==s.progress&&r!==s.work&&r!==s.type&&"taskType"!==r?(t=new y.Deferred,i=this.parent,this.currentEditedRowData=e.rowData,this.parent.trigger("cellEdit",e,function(e){e.columnName===i.taskFields.progress&&e.rowData.hasChildRecords&&(e.cancel=!0),0===a.level&&"ResourceView"===n.parent.viewType&&(e.cancel=!0),t.resolve(e),e.cancel||(e.columnName===n.parent.taskFields.notes?n.openNotesEditor(e):(n.isCellEdit=!0,oe.isNullOrUndefined(n.parent.toolbarModule)||n.parent.toolbarModule.refreshToolbarItems()))}),t):void((r!==s.dependency||this.parent.allowParentDependency)&&r===s.dependency||(e.cancel=!0));e.cancel=!0},m.prototype.openNotesEditor=function(e){var t=this.parent.taskFields,i=e.rowData,n=e.columnName;n!==t.notes||this.parent.showInlineNotes||(e.cancel=!0,-1!==(e=this.parent.editModule.dialogModule.updatedEditFields.map(function(e){return e.type}).indexOf("Notes"))&&(this.parent.editModule.dialogModule.openEditDialog(i.ganttProperties.rowUniqueID),document.getElementById(this.parent.element.id+"_Tab").ej2_instances[0].selectedItem=e)),n===t.notes&&!0===this.parent.showInlineNotes&&(this.isCellEdit=!0)},m.prototype.initiateCellEdit=function(e,t){var i,n=!0,n=("actionComplete"===e.name&&e.previousData===e.data[e.column.field]&&(n=!1),this.parent.undoRedoModule&&this.parent.isUndoRedoItemPresent("Edit")&&n&&(this.parent.undoRedoModule.redoEnabled&&this.parent.undoRedoModule.disableRedo(),this.parent.undoRedoModule.createUndoCollection(),(n={action:"CellEditing"}).editedColumn=e.column.field,n.modifiedRecords=[],this.parent.undoRedoModule.getUndoCollection[this.parent.undoRedoModule.getUndoCollection.length-1]=n),oe.getValue("column",e)),a=oe.getValue("data",e),r={action:"CellEditing"},s=(r.data=this.parent.getTaskByUniqueID(a.uniqueID),oe.getValue("previousData",e)),o=this.parent.allowUnscheduledTasks||!oe.isNullOrUndefined(a[n.field])&&""!==a[n.field]||this.parent.taskFields.duration!==n.field&&this.parent.taskFields.startDate!==n.field&&this.parent.taskFields.endDate!==n.field?a[n.field]:s;oe.isNullOrUndefined(a)?this.parent.editModule.endEditAction(e):(a[n.field]=s,r.data[n.field]=s,this.parent.initiateEditAction(!0),0<this.parent.weekWorkingTime.length&&o&&(n.field===this.parent.taskFields.startDate||n.field===this.parent.taskFields.baselineStartDate)&&(i=n.field===this.parent.taskFields.startDate?a.ganttProperties.startDate:a.ganttProperties.baselineStartDate,this.parent.getStartTime(i)/3600===i.getHours())&&(i=this.parent.getStartTime(o),this.parent.dataOperation.setTime(i,o)),this.parent.setRecordValue(n.field,o,r.data),n.field===this.parent.taskFields.name?this.taskNameEdited(r):n.field===this.parent.taskFields.startDate?this.startDateEdited(r):n.field===this.parent.taskFields.endDate?this.endDateEdited(r,e.previousData):n.field===this.parent.taskFields.duration?this.durationEdited(r):n.field===this.parent.taskFields.resourceInfo?this.resourceEdited(r,t,a):n.field===this.parent.taskFields.progress?this.progressEdited(r):n.field===this.parent.taskFields.baselineStartDate||n.field===this.parent.taskFields.baselineEndDate?this.baselineEdited(r):n.field===this.parent.taskFields.dependency?this.dependencyEdited(r,s):n.field===this.parent.taskFields.notes?this.notedEdited(r):n.field===this.parent.taskFields.work?this.workEdited(r):n.field!==this.parent.taskFields.type&&"taskType"!==n.field||oe.isNullOrUndefined(this.parent.taskFields.work)?n.field===this.parent.taskFields.manual?this.taskmodeEdited(r):(this.parent.setRecordValue("taskData."+n.field,r.data[n.field],r.data),this.parent.editModule.initiateSaveAction(r)):this.typeEdited(r,t)),this.isCellEdit=!1,oe.isNullOrUndefined(this.parent.editModule.cellEditModule.editedColumn)||(this.parent.editModule.cellEditModule.editedColumn=null),oe.isNullOrUndefined(this.parent.toolbarModule)||this.parent.toolbarModule.refreshToolbarItems()},m.prototype.taskNameEdited=function(e){this.parent.setRecordValue("taskData."+this.parent.taskFields.name,e.data[this.parent.taskFields.name],e.data),this.parent.setRecordValue("taskName",e.data[this.parent.taskFields.name],e.data.ganttProperties,!0),this.updateEditedRecord(e)},m.prototype.notedEdited=function(e){this.parent.setRecordValue("taskData."+this.parent.taskFields.notes,e.data[this.parent.taskFields.notes],e.data),this.parent.setRecordValue("notes",e.data[this.parent.taskFields.notes],e.data.ganttProperties,!0),this.updateEditedRecord(e)},m.prototype.taskmodeEdited=function(e){this.parent.setRecordValue("isAutoSchedule",!e.data[this.parent.taskFields.manual],e.data.ganttProperties,!0),this.parent.editModule.updateTaskScheduleModes(e.data),this.updateEditedRecord(e)},m.prototype.startDateEdited=function(e){var t=e.data,i=e.data.ganttProperties,n=(n=e.data[this.parent.taskFields.startDate])?new Date(n.getTime()):null;n=this.parent.dateValidationModule.checkStartDate(n,t.ganttProperties,t.ganttProperties.isMilestone),oe.isNullOrUndefined(n)?t.hasChildRecords||(this.parent.setRecordValue("startDate",null,i,!0),null===i.startDate&&null===i.endDate&&null!==i.duration||this.parent.setRecordValue("duration",null,i,!0),this.parent.setRecordValue("isMilestone",!1,i,!0)):i.endDate||!oe.isNullOrUndefined(i.duration)?(this.parent.setRecordValue("startDate",new Date(n.getTime()),i,!0),this.parent.dateValidationModule.calculateEndDate(t)):oe.isNullOrUndefined(i.endDate)&&oe.isNullOrUndefined(i.duration)&&this.parent.setRecordValue("startDate",new Date(n.getTime()),i,!0),this.parent.setRecordValue("isMilestone",0===i.duration,i,!0),this.parent.dataOperation.updateWidthLeft(e.data),this.parent.dataOperation.updateMappingData(t,"startDate"),this.parent.dataOperation.updateMappingData(t,"endDate"),this.parent.dataOperation.updateMappingData(t,"duration"),this.updateEditedRecord(e)},m.prototype.validateEndDateWithSegments=function(e){for(var t=[],i=e.segments,n=0;n<i.length;n++){var a=i[parseInt(n.toString(),10)],r=a.endDate,r=!oe.isNullOrUndefined(e.endDate)&&r.getTime()<e.endDate.getTime()&&n!==i.length-1?r:e.endDate;a.duration=this.parent.dataOperation.getDuration(a.startDate,r,e.durationUnit,e.isAutoSchedule,e.isMilestone),0<i.length&&r.getTime()<a.startDate.getTime()&&r.getTime()<=e.endDate.getTime()?i[n-1].duration=this.parent.dataOperation.getDuration(i[n-1].startDate,e.endDate,e.durationUnit,e.isAutoSchedule,e.isMilestone):t.push(a)}return t},m.prototype.endDateEdited=function(e,t){var i,n=e.data.ganttProperties,a=(a=e.data[this.parent.taskFields.endDate])?new Date(a.getTime()):null;oe.isNullOrUndefined(a)?(this.parent.setRecordValue("endDate",a,n,!0),null===n.startDate&&null===n.endDate&&null!==n.duration||this.parent.setRecordValue("duration",null,n,!0),this.parent.setRecordValue("isMilestone",!1,n,!0)):(i=this.parent.getCurrentDayEndTime(a),(0===a.getHours()||t&&a.toTimeString().slice(0,5)===t.toTimeString().slice(0,5))&&86400!==i&&this.parent.dateValidationModule.setTime(i,a),a=this.parent.dateValidationModule.checkEndDate(a,n,n.isMilestone),this.parent.setRecordValue("endDate",a,n,!0),!oe.isNullOrUndefined(n.startDate)&&oe.isNullOrUndefined(n.duration)?-1===this.parent.dateValidationModule.compareDates(n.endDate,n.startDate)&&(this.parent.setRecordValue("endDate",new Date(n.startDate.getTime()),n,!0),i=this.parent.getCurrentDayEndTime(n.endDate),this.parent.dateValidationModule.setTime(i,n.endDate)):!oe.isNullOrUndefined(n.duration)&&oe.isNullOrUndefined(n.startDate)&&this.parent.setRecordValue("startDate",this.parent.dateValidationModule.getStartDate(n.endDate,n.duration,n.durationUnit,n),n,!0),oe.isNullOrUndefined(n.segments)||(n.segments=this.validateEndDateWithSegments(n)),this.compareDatesFromRecord(n)<=0?this.parent.dateValidationModule.calculateDuration(e.data):this.parent.editModule.revertCellEdit(e),this.updateDates(e),this.parent.setRecordValue("isMilestone",0===n.duration,n,!0),n.isMilestone&&this.parent.setRecordValue("startDate",this.parent.dateValidationModule.checkStartDate(n.startDate,n),n,!0)),!oe.isNullOrUndefined(e.data.ganttProperties.segments)&&0<e.data.ganttProperties.segments.length&&(this.parent.setRecordValue("segments",this.parent.dataOperation.setSegmentsInfo(e.data,!1),e.data.ganttProperties,!0),this.parent.dataOperation.updateMappingData(e.data,"segments")),this.parent.dataOperation.updateWidthLeft(e.data),this.parent.dataOperation.updateMappingData(e.data,"startDate"),this.parent.dataOperation.updateMappingData(e.data,"endDate"),this.parent.dataOperation.updateMappingData(e.data,"duration"),this.parent.editModule.updateResourceRelatedFields(e.data,"endDate"),this.updateEditedRecord(e)},m.prototype.durationEdited=function(e){/^[^\d.-]+$/.test(e.data[this.parent.taskFields.duration])&&(t="The provided value for the "+this.parent.taskFields.duration+" field is invalid. Please ensure the "+this.parent.taskFields.duration+" field contains only valid numeric values.",this.parent.trigger("actionFailure",{error:t})),parseInt(e.data[this.parent.taskFields.duration],10)<0&&(e.data[this.parent.taskFields.duration]=0);var t=e.data.ganttProperties,i=e.data[this.parent.taskFields.duration];this.parent.dataOperation.updateDurationValue(i,t),this.updateDates(e),this.parent.editModule.updateResourceRelatedFields(e.data,"duration"),this.updateEditedRecord(e)},m.prototype.updateDates=function(e){var t=e.data.ganttProperties,i=this.parent.dateValidationModule.getDateFromFormat(t.endDate),n=this.parent.dateValidationModule.getDateFromFormat(t.startDate),a=t.duration;oe.isNullOrUndefined(a)?(this.parent.setRecordValue("isMilestone",!1,t,!0),null!==e.data[this.parent.taskFields.duration]&&this.parent.setRecordValue("endDate",null,t,!0)):(oe.isNullOrUndefined(n)&&!oe.isNullOrUndefined(i)&&this.parent.setRecordValue("startDate",this.parent.dateValidationModule.getStartDate(i,a,t.durationUnit,t),t,!0),0!==a&&t.isMilestone&&(this.parent.setRecordValue("isMilestone",!1,t,!0),oe.isNullOrUndefined(this.parent.taskFields.milestone)||this.parent.setRecordValue(this.parent.taskFields.milestone,!1,e.data,!0),this.parent.setRecordValue("startDate",this.parent.dateValidationModule.checkStartDate(t.startDate,t),t,!0)),!oe.isNullOrUndefined(t.segments)&&0<t.segments.length&&(this.parent.setRecordValue("segments",this.parent.dataOperation.setSegmentsInfo(e.data,!1),t,!0),this.parent.dataOperation.updateMappingData(e.data,"segments")),this.parent.setRecordValue("isMilestone",0===t.duration,t,!0),this.parent.dateValidationModule.calculateEndDate(e.data)),this.parent.dataOperation.updateWidthLeft(e.data),this.parent.dataOperation.updateMappingData(e.data,"endDate"),this.parent.dataOperation.updateMappingData(e.data,"startDate"),this.parent.dataOperation.updateMappingData(e.data,"duration")},m.prototype.progressEdited=function(e){var t,i=e.data;this.parent.setRecordValue("progress",100<i[this.parent.taskFields.progress]?100:i[this.parent.taskFields.progress],i.ganttProperties,!0),this.parent.setRecordValue("taskData."+this.parent.taskFields.progress,100<i[this.parent.taskFields.progress]?100:i[this.parent.taskFields.progress],e.data),i.ganttProperties.isAutoSchedule||this.parent.setRecordValue("autoWidth",this.parent.dataOperation.calculateWidth(i,!1),i.ganttProperties,!0),!oe.isNullOrUndefined(e.data.ganttProperties.segments)&&0<e.data.ganttProperties.segments.length&&!oe.isNullOrUndefined(this.parent.editModule.taskbarEditModule)&&this.parent.editModule.taskbarEditModule.updateSegmentProgress(e.data.ganttProperties),e.data.hasChildRecords||(t=i.ganttProperties.isAutoSchedule?i.ganttProperties.width:i.ganttProperties.autoWidth,this.parent.setRecordValue("progressWidth",this.parent.dataOperation.getProgressWidth(t,i.ganttProperties.progress),i.ganttProperties,!0)),this.updateEditedRecord(e)},m.prototype.baselineEdited=function(e){var t=e.data.ganttProperties,i=e.data[this.parent.taskFields.baselineStartDate],n=e.data[this.parent.taskFields.baselineEndDate],a=this.parent.getCurrentDayEndTime(n);n&&0===n.getHours()&&86400!==a&&this.parent.dateValidationModule.setTime(a,n),this.parent.setRecordValue("baselineStartDate",this.parent.dateValidationModule.checkBaselineStartDate(i,t),t,!0),this.parent.setRecordValue("baselineEndDate",this.parent.dateValidationModule.checkBaselineEndDate(n),t,!0),t.baselineStartDate&&t.baselineEndDate&&(this.parent.setRecordValue("baselineLeft",this.parent.dataOperation.calculateBaselineLeft(t),t,!0),this.parent.setRecordValue("baselineWidth",this.parent.dataOperation.calculateBaselineWidth(t),t,!0)),this.updateEditedRecord(e)},m.prototype.resourceEdited=function(e,t,i){var n=this.parent.resourceFields,a=t[this.parent.taskFields.resourceInfo];if(a){this.isResourceCellEdited=!0;for(var r=this.parent.dataOperation.setResourceInfo(t).length,s=i.ganttProperties.resourceInfo,o=void 0,l=[],d=this.parent.resources,h=void 0,p=0;p<r;p++)!function(t){if(s){var e=s.length;for(h=0;h<e;h++){if(s[h][n.id]===a[t]){o=h;break}o=-1}}var i;oe.isNullOrUndefined(o)||-1===o?(i=d.filter(function(e){return a[t]===e[n.id]}),(i=oe.extend({},i[0]))[n.unit]=100,l.push(i)):l.push(s[parseInt(o.toString(),10)])}(p);e.data.ganttProperties.resourceInfo=l,this.parent.dataOperation.updateMappingData(e.data,"resourceInfo"),this.parent.editModule.updateResourceRelatedFields(e.data,"resource"),"ResourceView"===this.parent.viewType&&(this.parent.editModule.dialogModule.isResourceUpdate=!0,this.parent.editModule.dialogModule.previousResource=s),this.updateDates(e),this.updateEditedRecord(e)}},m.prototype.dependencyEdited=function(e,t){/[!@#$%^&*()_=[\]{};:<>|./?-]/.test(e.data[this.parent.taskFields.dependency])&&(i="The provided value for the "+this.parent.taskFields.dependency+" field is invalid. Please ensure that the "+this.parent.taskFields.dependency+" field does not contain any special characters.",this.parent.trigger("actionFailure",{error:i})),this.parent.predecessorModule.updateUnscheduledDependency(e.data);var i,n,a=this.parent.localeObj.getConstant("FF"),r=this.parent.localeObj.getConstant("FS"),s=this.parent.localeObj.getConstant("SS"),o=this.parent.localeObj.getConstant("SF"),l="";oe.isNullOrUndefined(e.data[this.parent.taskFields.dependency])||(n=e.data[this.parent.taskFields.dependency].split(",")).map(function(e,t){l=e.includes(a)?(l+=e.replace(a,"FF"))+(n.length!==t+1?",":""):e.includes(r)?(l+=e.replace(r,"FS"))+(n.length!==t+1?",":""):e.includes(s)?(l+=e.replace(s,"SS"))+(n.length!==t+1?",":""):e.includes(o)?(l+=e.replace(o,"SF"))+(n.length!==t+1?",":""):(l+=e)+(n.length!==t+1?",":"")}),this.parent.connectorLineEditModule.updatePredecessor(e.data,l,e)||this.parent.editModule.revertCellEdit(t)},m.prototype.workEdited=function(e){var t=e.data.ganttProperties,i=((e.data[this.parent.taskFields.work]<0||oe.isNullOrUndefined(e.data[this.parent.taskFields.work]))&&(e.data[this.parent.taskFields.work]=0),this.parent.updateDuration=!0,e.data[this.parent.taskFields.work]);this.parent.setRecordValue("work",i,t,!0),this.parent.editModule.updateResourceRelatedFields(e.data,"work"),this.updateDates(e),this.updateEditedRecord(e),this.parent.updateDuration=!1},m.prototype.typeEdited=function(e,t){var i=this.parent.taskFields.type||"taskType",n=e.data.ganttProperties,t=t[""+i];this.parent.setRecordValue("taskType",t,n,!0),"FixedDuration"===n.taskType&&0===n.duration&&this.parent.editModule.updateResourceRelatedFields(e.data,"work"),this.updateEditedRecord(e)},m.prototype.compareDatesFromRecord=function(e){var t=this.parent.dateValidationModule.getValidStartDate(e),e=this.parent.dateValidationModule.getValidEndDate(e);return this.parent.dateValidationModule.compareDates(t,e)},m.prototype.updateEditedRecord=function(e){this.parent.editModule.initiateUpdateAction(e)},m.prototype.destroy=function(){this.parent.editModule.cellEditModule=void 0},m);function m(e){this.isCellEdit=!1,this.isResourceCellEdited=!1,this.parent=e,this.bindTreeGridProperties()}fn.prototype.createTooltip=function(e,t,i){var n=this;this.toolTipObj=new U.Tooltip({opensOn:e,position:"TopRight",enableRtl:this.parent.enableRtl,mouseTrail:t,cssClass:ut,windowCollision:!0,target:i||null,animation:{open:{effect:"None"},close:{effect:"None"}}}),this.toolTipObj.target=".e-connectorpoint-left, .e-connectorpoint-right",this.toolTipObj.beforeRender=function(e){e={data:n.taskbarEdit.taskBarEditRecord,args:e,content:n.toolTipObj.content};n.parent.trigger("beforeTooltipRender",e)},this.toolTipObj.afterOpen=function(e){n.updateTooltipPosition(e)},this.toolTipObj.isStringTemplate=!0,this.toolTipObj.appendTo(this.parent.chartPane)},fn.prototype.updateTooltipPosition=function(e){e.element.style.visibility="visible";var t,i=this.parent.element.closest('[style*="zoom"]');oe.isNullOrUndefined(i)&&((i=this.parent.getOffsetRect(this.parent.chartPane).left+this.parent.chartPane.offsetWidth)<(t=e.element.offsetLeft)+e.element.offsetWidth&&(t+=i-(t+e.element.offsetWidth)),e.element.style.left=t+"px",e.element.style.visibility="visible",e.target)&&this.parent.tooltipSettings.editing&&(i=e.target.getBoundingClientRect().top+window.scrollY,t=void 0,t=e.target.classList.contains("e-connectorpoint-left")||e.target.classList.contains("e-connectorpoint-right")?i-e.element.offsetHeight-14:i-e.element.offsetHeight-8,this.toolTipHeight=e.element.style.top=t+"px")},fn.prototype.showHideTaskbarEditTooltip=function(e,t){e&&this.parent.tooltipSettings.showTooltip?(this.createTooltip("Custom",!1),this.parent.tooltipModule.toolTipObj.close(),this.updateTooltip(t),this.parent.tooltipSettings.editing&&(this.toolTipObj.openDelay=500),"ConnectorPointLeftDrag"===this.taskbarEdit.connectorSecondAction?this.toolTipObj.open(this.taskbarEdit.connectorSecondElement.querySelector("."+st)):"ConnectorPointRightDrag"===this.taskbarEdit.connectorSecondAction?this.toolTipObj.open(this.taskbarEdit.connectorSecondElement.querySelector("."+ot)):this.toolTipObj.open(this.taskbarEdit.taskBarEditElement)):oe.isNullOrUndefined(this.toolTipObj)||(this.toolTipObj.destroy(),this.toolTipObj=null)},fn.prototype.updateTooltip=function(e){var t=this.taskbarEdit.taskBarEditRecord.ganttProperties,i=(oe.isNullOrUndefined(e)||-1===e?t:t.segments[e]).width,n=(oe.isNullOrUndefined(e)||-1===e?t:t.segments[e]).progressWidth,a=oe.isNullOrUndefined(e)||-1===e?t.left:t.left+t.segments[e].left;oe.isNullOrUndefined(this.toolTipObj)||("ConnectorPointLeftDrag"===this.taskbarEdit.taskBarEditAction||"ConnectorPointRightDrag"===this.taskbarEdit.taskBarEditAction?(this.toolTipObj.content=this.getTooltipText(e),this.parent.tooltipSettings.editing&&(this.toolTipObj.openDelay=500),this.toolTipObj.offsetY=-3):(this.parent.tooltipSettings.editing&&(this.toolTipObj.openDelay=500),this.toolTipObj.content=this.getTooltipText(e),t.segments&&0<t.segments.length&&this.taskbarEdit.mainElement&&"ProgressResizing"===this.taskbarEdit.taskBarEditAction?(t=this.taskbarEdit.mainElement.querySelectorAll(".e-segmented-taskbar"),this.toolTipObj.refresh(t[e])):this.toolTipObj.refresh(this.taskbarEdit.taskBarEditElement),"LeftResizing"===this.taskbarEdit.taskBarEditAction?this.parent.enableRtl?this.toolTipObj.offsetX=0:this.toolTipObj.offsetX=-i:"RightResizing"===this.taskbarEdit.taskBarEditAction||"ParentResizing"===this.taskbarEdit.taskBarEditAction?this.parent.enableRtl?this.toolTipObj.offsetX=-i:this.toolTipObj.offsetX=0:"ProgressResizing"===this.taskbarEdit.taskBarEditAction?this.parent.enableRtl?this.toolTipObj.offsetX=-n:this.toolTipObj.offsetX=-(i-n):"MilestoneDrag"===this.taskbarEdit.taskBarEditAction?this.toolTipObj.offsetX=-this.parent.chartRowsModule.milestoneHeight/2:5<i&&(this.toolTipObj.offsetX=-(i+a-this.taskbarEdit.tooltipPositionX)),this.parent.tooltipSettings.editing&&document.getElementsByClassName("e-gantt-tooltip")[0]&&this.toolTipHeight&&(document.getElementsByClassName("e-gantt-tooltip")[0].style.top=this.toolTipHeight)))},fn.prototype.getTooltipText=function(e){var t="",i=this.parent.globalize,n=this.taskbarEdit.taskBarEditRecord.ganttProperties;if(!oe.isNullOrUndefined(n.segments)&&0<n.segments.length&&-1!==e&&"ProgressResizing"!==this.taskbarEdit.taskBarEditAction&&(n=n.segments[e]),this.parent.tooltipSettings.editing){e=this.parent.tooltipModule.templateCompiler(this.parent.tooltipSettings.editing,this.parent,this.taskbarEdit.taskBarEditRecord,"TooltipEditingTemplate");oe.getValue("tooltipEle",this.toolTipObj)&&this.parent.renderTemplates(),t=e[0]}else{var a=void 0,r=void 0,s=void 0;switch(oe.isNullOrUndefined(n)||oe.isNullOrUndefined(n.startDate)||(a='<tr><td class = "e-gantt-tooltip-label">'+this.parent.localeObj.getConstant("startDate")+"</td><td class="+Qe+'>:</td><td class = "e-gantt-tooltip-value">'+i.formatDate(n.startDate,{format:this.parent.getDateFormat()})+"</td></tr>"),oe.isNullOrUndefined(n)||oe.isNullOrUndefined(n.endDate)||(r='<tr><td class = "e-gantt-tooltip-label">'+this.parent.localeObj.getConstant("endDate")+"</td><td class="+Qe+'>:</td><td class = "e-gantt-tooltip-value">'+i.formatDate(n.endDate,{format:this.parent.getDateFormat()})+"</td></tr>"),oe.isNullOrUndefined(n)||oe.isNullOrUndefined(n.duration)||(s='<tr><td class = "e-gantt-tooltip-label">'+this.parent.localeObj.getConstant("duration")+"</td><td class="+Qe+'>:</td><td class = "e-gantt-tooltip-value">'+this.parent.getDurationString(n.duration,n.durationUnit)+"</td></tr>"),this.taskbarEdit.taskBarEditAction){case"ProgressResizing":t='<table class = "e-gantt-tooltiptable"><tbody>'+('<tr><td class = "e-gantt-tooltip-label">'+this.parent.localeObj.getConstant("progress")+"</td><td class="+Qe+'>:</td><td class = "e-gantt-tooltip-value">'+n.progress+"</td></tr>")+"</tbody></table>";break;case"LeftResizing":t='<table class = "e-gantt-tooltiptable"><tbody>'+a+s+"</tbody></table>";break;case"RightResizing":case"ParentResizing":t='<table class = "e-gantt-tooltiptable"><tbody>'+r+s+"</tbody></table>";break;case"ChildDrag":case"ParentDrag":case"MilestoneDrag":case"ManualParentDrag":var o="",l="";oe.isNullOrUndefined(this.taskbarEdit.taskBarEditRecord.ganttProperties.startDate)||(o=a),oe.isNullOrUndefined(this.taskbarEdit.taskBarEditRecord.ganttProperties.endDate)||(l=r),t='<table class = "e-gantt-tooltiptable"><tbody>'+o+l+"</tbody></table>";break;case"ConnectorPointLeftDrag":case"ConnectorPointRightDrag":t=this.parent.connectorLineModule.tooltipTable,oe.isNullOrUndefined(this.toolTipObj)&&(this.parent.connectorLineModule.tooltipTable.innerHTML="",this.parent.connectorLineModule.tooltipTable.appendChild(this.parent.connectorLineModule.getConnectorLineTooltipInnerTd(this.parent.editModule.taskbarEditModule.taskBarEditRecord.ganttProperties.taskName,this.parent.editModule.taskbarEditModule.fromPredecessorText,"","")))}}return"string"==typeof t?oe.initializeCSPTemplate(function(){return t}):t};var gn=fn;function fn(e,t){this.parent=e,this.taskbarEdit=t}mn=function(e,t){return(mn=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])}))(e,t)};var mn,yn,Dn=function(){return(Dn=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var a in t=arguments[i])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},kn=(function(e,t){function i(){this.constructor=e}mn(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}(D,yn=$),D.prototype.wireEvents=function(){this.parent.on("chartMouseDown",this.mouseDownHandler,this),this.parent.on("chartMouseUp",this.mouseUpHandler,this),this.parent.on("chartMouseLeave",this.mouseLeaveHandler,this),this.parent.on("chartMouseMove",this.mouseMoveAction,this),this.parent.on("chartMouseClick",this.mouseClickHandler,this)},D.prototype.initPublicProp=function(){this.taskBarEditElement=null,this.taskBarEditRecord=null,this.taskBarEditAction=null,this.connectorSecondElement=null,this.connectorSecondRecord=null,this.connectorSecondAction=null,this.highlightedSecondElement=null,this.fromPredecessorText=null,this.toPredecessorText=null,this.finalPredecessor=null,this.drawPredecessor=!1,this.roundOffDuration=!0,this.dragMouseLeave=!1,this.isMouseDragged=!1,this.previousItemProperty=["left","progress","duration","isMilestone","startDate","endDate","width","progressWidth","autoLeft","autoDuration","autoStartDate","autoEndDate","autoWidth","segments"],this.tapPointOnFocus=!1,this.touchEdit=!1},D.prototype.mouseDownHandler=function(e){var t;this.parent.editSettings.allowTaskbarEditing&&!this.parent.readOnly&&(this.canDrag=!1,this.taskBarEditElement?((t=P(this.getElementByPosition(e),S))&&t.innerHTML===this.taskBarEditElement.innerHTML||this.taskBarEditElement.classList.contains("e-segmented-taskbar")||this.taskBarEditElement.classList.contains("collpse-parent-border"))&&(this.updateTaskBarEditElement(e),this.canDrag=!0,e.preventDefault()):this.parent.isAdaptive||this.updateTaskBarEditElement(e))},D.prototype.mouseClickHandler=function(e){var t,i;this.parent.editSettings.allowTaskbarEditing&&(i=P(t=this.getElementByPosition(e),S),this.parent.selectionModule&&this.parent.selectionModule.enableSelectMultiTouch?this.tapPointOnFocus&&this.updateTaskBarEditElement(e):this.tapPointOnFocus&&!oe.isNullOrUndefined(this.taskBarEditElement)&&i&&i.innerHTML!==this.taskBarEditElement.innerHTML?(this.connectorSecondRecord=this.parent.ganttChartModule.getRecordByTaskBar(i),this.connectorSecondAction="ConnectorPointLeftDrag",this.connectorSecondElement=i,this.fromPredecessorText="Finish",this.validateConnectorPoint()&&this.taskBarEditingAction(e,!0),this.showHideActivePredecessors(!1),this.initPublicProp()):t.classList.contains(lt)?(this.canDrag=!1,this.multipleSelectionEnabled(),this.showHideTaskBarEditingElements(t,this.taskBarEditElement),this.tapPointOnFocus=!0,this.taskBarEditAction="ConnectorPointLeftDrag",this.connectorSecondRecord=this.taskBarEditRecord,this.taskBarEditingAction(e,!1)):t.classList.contains(dt)?(this.canDrag=!1,this.multipleSelectionEnabled(),this.showHideTaskBarEditingElements(t,this.taskBarEditElement),this.tapPointOnFocus=!0,this.taskBarEditAction="ConnectorPointRightDrag",this.connectorSecondRecord=this.taskBarEditRecord,this.taskBarEditingAction(e,!1)):(this.tapPointOnFocus&&(this.showHideActivePredecessors(!1),this.showHideTaskBarEditingElements(i,this.taskBarEditElement)),this.updateTaskBarEditElement(e)))},D.prototype.showHideActivePredecessors=function(e){var t=this.taskBarEditRecord.ganttProperties,i=t.predecessor,n="ResourceView"===this.parent.viewType?t.taskId:t.rowUniqueID;if(i)for(var a=0;a<i.length;a++){var r=i[a];n.toString()!==r.from&&n.toString()!==r.to||this.applyActiveColor(r.from,r.to,e)}t=this.parent.ganttChartModule.chartBodyContainer;e?(oe.addClass([this.taskBarEditElement],[mt]),oe.addClass([t],[Dt])):(oe.removeClass([this.taskBarEditElement],[mt]),oe.removeClass([t],[Dt])),this.touchEdit=e,oe.isNullOrUndefined(this.parent.toolbarModule)||this.parent.toolbarModule.refreshToolbarItems()},D.prototype.applyActiveColor=function(e,t,i){var n=("ProjectView"===this.parent.viewType?this.taskBarEditRecord.ganttProperties.taskId:this.taskBarEditRecord.ganttProperties.rowUniqueID).toString()===e?this.parent.connectorLineModule.getRecordByID(t):this.parent.connectorLineModule.getRecordByID(e),n=this.parent.ganttChartModule.getChartRows()[this.parent.currentViewData.indexOf(n)];oe.isNullOrUndefined(n)||(n=n.querySelector("."+S),e=this.parent.element.querySelector("#ConnectorLineparent"+e+"child"+t),i?(oe.addClass([n],[yt]),e&&oe.addClass([e],[yt])):(oe.removeClass([n],[yt]),e&&oe.removeClass([e],[yt])))},D.prototype.validateConnectorPoint=function(){var e=this.taskBarEditRecord.ganttProperties,t=this.connectorSecondRecord.ganttProperties,i=!0,n="ResourceView"===this.parent.viewType?e.taskId:e.rowUniqueID,a="ResourceView"===this.parent.viewType?t.taskId:t.rowUniqueID;if(this.connectorSecondRecord.hasChildRecords)i=!1;else if(t.predecessor)for(var r=0;r<t.predecessor.length;r++){var s=t.predecessor[r];if(s.from===n.toString()&&s.to===a.toString()){this.parent.connectorLineEditModule.childRecord=this.connectorSecondRecord,this.parent.connectorLineEditModule.predecessorIndex=r,this.parent.connectorLineEditModule.renderPredecessorDeleteConfirmDialog(),i=!1;break}if(s.from===a.toString()&&s.to===n.toString()){this.parent.connectorLineEditModule.childRecord=this.taskBarEditRecord,this.parent.connectorLineEditModule.predecessorIndex=r,this.parent.connectorLineEditModule.renderPredecessorDeleteConfirmDialog(),i=!1;break}}return i},D.prototype.mouseLeaveHandler=function(e){"ChildDrag"===this.taskBarEditAction||"ParentDrag"===this.taskBarEditAction||"ProgressResizing"===this.taskBarEditAction||"LeftResizing"===this.taskBarEditAction||"RightResizing"===this.taskBarEditAction?this.dragMouseLeave=!1:this.dragMouseLeave=!0},D.prototype.updateTaskBarEditElement=function(e){var t,i,n,a,r,s,o=this.getElementByPosition(e);if(o.classList.contains(ze)||o.classList.contains(We)||o.classList.contains(He))t=P(o,We);else if(o.classList.contains(je))t=P(o,je);else if(t=P(o,S),!oe.isNullOrUndefined(t)&&!o.classList.contains("e-connectorpoint-left")&&!o.classList.contains("e-connectorpoint-right")){var l=this.parent.ganttChartModule.getRecordByTaskBar(t);if(!oe.isNullOrUndefined(l.ganttProperties.segments)&&0<l.ganttProperties.segments.length)if(o.classList.contains("e-progressbar-handler-after")){for(var d=0;d<l.ganttProperties.segments.length;d++)if(l.ganttProperties.segments[d].showProgress){t=t.querySelectorAll(".e-segmented-taskbar")[d];break}}else t=P(o,be)}this.parent.editSettings.allowTaskbarEditing&&t?(this.showHideTaskBarEditingElements(t,this.editElement),this.editElement=t,this.realTaskbarElement=this.editElement,o=this.editElement.getAttribute("data-segment-index"),oe.isNullOrUndefined(o)?this.segmentIndex=-1:this.segmentIndex=Number(o),this.taskBarEditRecord=this.parent.ganttChartModule.getRecordByTaskBar(this.editElement),"mousedown"!==e.type&&"touchstart"!==e.type&&"click"!==e.type||(this.taskBarEditAction=this.getTaskBarAction(e),o=this.editElement.getAttribute("data-segment-index"),a=(l=this.parent.ganttChartModule.getRecordByTaskBar(t)).ganttProperties,i=this.editElement.parentElement.offsetLeft,this.currentData=l,n=oe.createElement("div",{styles:"height:100%;border-style:dashed;border-bottom:none;border-top:none;border-width:1px;position:absolute;z-index:10000"}),oe.addClass([n],"e-taskbar-resize-div"),n.style.setProperty("width",a.width+"px"),s=this.editElement.getAttribute("data-segment-index"),!oe.isNullOrUndefined(a.segments)&&this.parent.allowTaskbarDragAndDrop&&"LeftResizing"!==this.taskBarEditAction&&"RightResizing"!==this.taskBarEditAction&&"ProgressResizing"!==this.taskBarEditAction?n.style.setProperty("left",oe.isNullOrUndefined(a.segments)?a.left+"px":i+"px"):n.style.setProperty("left",!oe.isNullOrUndefined(a.segments)&&1<a.segments.length?i+a.segments[Number(s)].left+"px":a.left+"px"),i=this.parent.createElement("table"),(s=this.parent.createElement("tbody")).appendChild(n),i.appendChild(s),a=this.parent.ganttChartModule.chartBodyContainer.querySelector(".e-clone-taskbar"),n=null,s=(!("ChildDrag"!==this.taskBarEditAction&&"LeftResizing"!==this.taskBarEditAction||oe.isNullOrUndefined(o)||oe.isNullOrUndefined(o)||0!==Number(o))||-1!==this.segmentIndex&&this.parent.allowTaskbarDragAndDrop&&"LeftResizing"!==this.taskBarEditAction&&"RightResizing"!==this.taskBarEditAction&&"ProgressResizing"!==this.taskBarEditAction?this.editElement.parentElement:this.editElement).cloneNode(!0),a||(oe.addClass([s],"e-clone-taskbar"),s.style.setProperty("position","absolute"),l.hasChildRecords&&!l.ganttProperties.isAutoSchedule&&(a=this.parent.getOffsetRect(this.parent.ganttChartModule.chartBodyContainer),r=this.parent.getOffsetRect(this.editElement),this.editElement.classList.contains("e-manualparent-main-container")?s.style.setProperty("left",l.ganttProperties.left-l.ganttProperties.autoLeft+"px"):s.style.setProperty(this.parent.enableRtl?"right":"left",Math.abs(r.left-a.left+Math.abs(this.parent.ganttChartModule.scrollElement.scrollLeft))+"px")),s.style.setProperty("top","0px"),n=this.parent.createElement("table"),(r=this.parent.createElement("tbody")).appendChild(s),n.appendChild(r)),"ChildDrag"!==this.taskBarEditAction&&"LeftResizing"!==this.taskBarEditAction||oe.isNullOrUndefined(o)||oe.isNullOrUndefined(o)||0!==Number(o)?this.cloneTaskbarElement=s:(a=s.getElementsByClassName("e-segmented-taskbar"),this.cloneTaskbarElement=a[Number(o)]),this.taskBarEditElement=this.cloneTaskbarElement,this.taskbarElement=n,this.taskbarResizer=i,this.currentIndex=o,this.roundOffDuration=!0,"ConnectorPointLeftDrag"!==this.taskBarEditAction&&"ConnectorPointRightDrag"!==this.taskBarEditAction||!oe.isNullOrUndefined(this.parent.taskFields.dependency)||(this.taskBarEditAction=null),this.updateMouseDownProperties(e),"ResourceView"!==this.parent.viewType&&"ProjectView"!==this.parent.viewType)||0!==this.taskBarEditRecord.level&&this.parent.enableMultiTaskbar&&(r=this.parent.getTaskByUniqueID(this.taskBarEditRecord.parentItem.uniqueID),oe.isNullOrUndefined(r)||r.expanded||(this.prevZIndex=this.taskBarEditElement.style.zIndex,this.taskBarEditElement.style.zIndex="1000",this.taskBarEditElement.querySelector(".e-gantt-child-taskbar")&&oe.addClass([this.taskBarEditElement.querySelector(".e-gantt-child-taskbar")],"e-collapsed-taskbar-drag")))):this.parent.isAdaptive?(this.taskBarEditElement&&this.showHideTaskBarEditingElements(t,this.editElement),this.initPublicProp()):this.showHideTaskBarEditingElements(t,this.editElement)},D.prototype.showHideTaskBarEditingElements=function(e,t,i){t=t||this.editElement;var n,a,r,s,o=!!this.parent.taskFields.progress,l=!0;this.parent.readOnly||(n=e?this.parent.ganttChartModule.getRecordByTaskBar(e):t?this.parent.ganttChartModule.getRecordByTaskBar(t):null,this.parent.enableMultiTaskbar&&e&&(r=this.parent.getParentTask(n.parentItem),oe.isNullOrUndefined(r)||r.expanded||(l=!1,oe.addClass([e],["e-gantt-multi-taskbar"]))),e?(e.querySelector("."+Oe)?(oe.addClass([e.querySelector("."+Oe)],[Ze]),oe.addClass([e.querySelector("."+Ie)],[Ye]),o&&(a=n&&n.ganttProperties.segments&&0<n.ganttProperties.segments.length?this.parent.getRowByIndex(this.parent.currentViewData.indexOf(n)).querySelectorAll("."+Ee)[0]:e.querySelector("."+Ee),oe.isNullOrUndefined(a)||(oe.addClass([a],[Ke]),a.style.top="3px"))):this.parent.isAdaptive&&o&&this.parent.ganttChartModule.getRecordByTaskBar(e).hasChildRecords&&oe.addClass([e],[ft]),oe.addClass(this.parent.ganttChartModule.scrollElement.querySelectorAll("."+et),[rt]),!oe.isNullOrUndefined(this.parent.taskFields.dependency)&&(e.querySelector("."+st)||e.parentElement.querySelector("."+st))&&l&&(s=oe.isNullOrUndefined(e.querySelector("."+st))?e.parentElement:e,oe.isNullOrUndefined(s.querySelector("."+st))||oe.addClass([s.querySelector("."+st)],[lt]),oe.isNullOrUndefined(s.querySelector("."+ot))||oe.addClass([s.querySelector("."+ot)],[dt]))):i||oe.removeClass(this.parent.ganttChartModule.scrollElement.querySelectorAll("."+et),[rt]),t&&e!==t&&(t.querySelector("."+Oe)&&(oe.removeClass([t.querySelector("."+Oe)],[Ze]),oe.removeClass([t.querySelector("."+Ie)],[Ye]),a=n&&n.ganttProperties.segments&&0<n.ganttProperties.segments.length?this.parent.getRowByIndex(this.parent.currentViewData.indexOf(n)):t)&&a.querySelector("."+Ee)&&oe.removeClass([a.querySelector("."+Ee)],[Ke]),oe.isNullOrUndefined(this.parent.taskFields.dependency)||!t.querySelector("."+st)&&!t.parentElement.querySelector("."+st)?this.parent.isAdaptive&&(r=this.parent.ganttChartModule.getRecordByTaskBar(t))&&r.hasChildRecords&&oe.removeClass([t],[ft]):(o=(s=oe.isNullOrUndefined(t.querySelector("."+st))?t.parentElement:t).querySelector("."+st),l=s.querySelector("."+ot),o&&oe.removeClass([o],[lt]),l&&oe.removeClass([l],[dt])),this.editElement=null))},D.prototype.getTaskBarAction=function(e){var e=this.getElementByPosition(e),t=this.taskBarEditRecord,i="";return e.classList.contains(Oe)?i="LeftResizing":e.classList.contains(Ie)?i="RightResizing":(e.classList.contains(Ee)||oe.closest(e,"."+Ee))&&this.parent.taskFields.progress?i="ProgressResizing":e.classList.contains(st)?i="ConnectorPointLeftDrag":e.classList.contains(ot)?i="ConnectorPointRightDrag":e.classList.contains(ze)?i="ParentResizing":e.classList.contains(He)||e.classList.contains(We)||e.classList.contains(je)?i="ManualParentDrag":t&&(i=t.hasChildRecords?t[this.parent.taskFields.manual]?"":"ParentDrag":t.ganttProperties.isMilestone?"MilestoneDrag":"ChildDrag"),i},D.prototype.updateMouseDownProperties=function(e){var e=this.getCoordinate(e),t=this.parent.element.closest('[style*="zoom"]');t&&(t=parseFloat(getComputedStyle(t).zoom),e.pageX=e.pageX/t,e.pageY=e.pageY/t),(e.pageX||e.pageY)&&(t=this.parent.getOffsetRect(this.parent.ganttChartModule.chartBodyContainer),this.parent.enableRtl?this.mouseDownX=Math.abs(e.pageX-(t.left+Math.abs(this.parent.ganttChartModule.scrollObject.previousScroll.left))):this.mouseDownX=e.pageX-t.left+this.parent.ganttChartModule.scrollObject.previousScroll.left,this.tooltipPositionX=this.mouseDownX,this.mouseDownY=this.dragMoveY=e.pageY-t.top+this.parent.ganttChartModule.scrollObject.previousScroll.top),"ConnectorPointLeftDrag"!==this.taskBarEditAction&&"ConnectorPointRightDrag"!==this.taskBarEditAction||(this.fromPredecessorText="ConnectorPointLeftDrag"===this.taskBarEditAction?"start":"finish",this.parent.connectorLineModule.tooltipTable.innerHTML="",this.parent.connectorLineModule.tooltipTable.appendChild(this.parent.connectorLineModule.getConnectorLineTooltipInnerTd(this.taskBarEditRecord.ganttProperties.taskName,this.fromPredecessorText,"","")))},D.prototype.isMouseDragCheck=function(){var e;!this.isMouseDragged&&this.taskBarEditAction&&(this.mouseDownX!==this.mouseMoveX&&(this.mouseDownX+3<this.mouseMoveX||this.mouseDownX-3>this.mouseMoveX)||this.mouseDownY!==this.mouseMoveY&&(this.mouseDownY+3<this.mouseMoveY||this.mouseDownY-3>this.mouseMoveY))&&(this.isMouseDragged=!0,this.parent.initiateEditAction(!0),e=this.taskBarEditRecord.ganttProperties,this.previousItem=this.parent.timelineModule.extendFunction(e,this.previousItemProperty),"ConnectorPointLeftDrag"===this.taskBarEditAction||"ConnectorPointRightDrag"===this.taskBarEditAction||"ResourceView"===this.parent.viewType&&"ParentDrag"===this.taskBarEditAction||this.editTooltip.showHideTaskbarEditTooltip(!0,this.segmentIndex),this.taskBarEditElement.setAttribute("aria-grabbed","true"))},D.prototype.removeFirstBorder=function(e){var t="bottomSegment"===this.parent.rowDragAndDropModule.dropPosition;0<this.parent.element.getElementsByClassName("e-firstrow-border").length&&e&&(e.getAttribute("aria-rowindex")-1!=0||t)&&this.parent.element.getElementsByClassName("e-firstrow-border")[0].remove()},D.prototype.removeLastBorder=function(e){var t=e&&(e.classList.contains("e-emptyrow")||e.classList.contains("e-columnheader")||e.classList.contains("e-detailrow")),t=this.parent.enableVirtualization?e&&!t&&this.parent.treeGrid.getRows()[this.parent.treeGrid.getCurrentViewRecords().length-1].getAttribute("data-uid")!==e.getAttribute("data-uid"):e&&!t&&this.parent.treeGrid.getRowByIndex(this.parent.treeGrid.getCurrentViewRecords().length-1).getAttribute("data-uid")!==e.getAttribute("data-uid"),i=t||"topSegment"===this.parent.rowDragAndDropModule.dropPosition;0<this.parent.element.getElementsByClassName("e-lastrow-border").length&&e&&(t||i)&&this.parent.element.getElementsByClassName("e-lastrow-border")[0].remove()},D.prototype.removetopOrBottomBorder=function(){var e=[].slice.call(this.parent.element.querySelectorAll(".e-dropbottom, .e-droptop"));e.length&&(this.addRemoveClasses(e,!1,"e-dropbottom"),this.addRemoveClasses(e,!1,"e-droptop"))},D.prototype.topOrBottomBorder=function(t){var e;(e=(this.parent.enableVirtualization?(e=this.parent.treeGrid.getRows().filter(function(e){return parseInt(e.getAttribute("aria-rowindex"),10)-1==parseInt(t.getAttribute("aria-rowindex"),10)-1})[0],e=this.parent.treeGrid.getRows().indexOf(e),this.parent.getRowByIndex(e)):this.parent.getRowByIndex(parseInt(t.getAttribute("aria-rowindex"),10)-1)).children)&&("above"===this.parent.rowDragAndDropModule.dropPosition&&(this.addRemoveClasses(e,!0,"e-droptop"),0<this.parent.element.getElementsByClassName("e-lastrow-dragborder").length)&&this.parent.element.getElementsByClassName("e-lastrow-dragborder")[0].remove(),"below"===this.parent.rowDragAndDropModule.dropPosition)&&this.addRemoveClasses(e,!0,"e-dropbottom")},D.prototype.removeChildBorder=function(){var e=[].slice.call(this.parent.element.querySelectorAll(".e-childborder"));0<e.length&&this.addRemoveClasses(e,!1,"e-childborder")},D.prototype.addRemoveClasses=function(e,t,i){for(var n=0,a=e.length;n<a;n++)t?e[parseInt(n.toString(),10)].classList.add(i):e[parseInt(n.toString(),10)].classList.remove(i)},D.prototype.addErrorElem=function(){var e,t=document.getElementsByClassName("e-clone-taskbar")[0];document.querySelectorAll(".e-errorelem").length||(e=document.createElement("div"),oe.classList(e,["e-errorcontainer"],[]),oe.classList(e,["e-icons","e-errorelem"],[]),this.taskBarEditRecord.ganttProperties.segments&&0<this.taskBarEditRecord.ganttProperties.segments.length&&(e.style.paddingTop=this.parent.taskbarHeight+"px"),t.appendChild(e))},D.prototype.removeErrorElem=function(){var e=document.querySelector(".e-errorelem");e&&e.remove()},D.prototype.ensurePosition=function(e,t){var i=this;e.filter(function(e){e.hasChildRecords&&!oe.isNullOrUndefined(e.childRecords)&&(-1===e.childRecords.indexOf(t)?i.ensurePosition(e.childRecords,t):(i.parent.rowDragAndDropModule.dropPosition="Invalid",i.addErrorElem()))})},D.prototype.mouseMoveAction=function(i){var n=this;if(this.parent.isAdaptive){if(!this.canDrag)return;this.multipleSelectionEnabled()}var e=this.parent.getOffsetRect(this.parent.ganttChartModule.chartBodyContainer),t=this.getCoordinate(i),t=(this.parent.enableRtl?this.mouseMoveX=Math.abs(t.pageX-(e.left+Math.abs(this.parent.ganttChartModule.scrollObject.previousScroll.left))):this.mouseMoveX=t.pageX-e.left+this.parent.ganttChartModule.scrollObject.previousScroll.left,this.mouseMoveY=t.pageY-e.top+this.parent.ganttChartModule.scrollObject.previousScroll.top,this.dragMouseLeave=!1);if("ChildDrag"!==this.taskBarEditAction&&"ParentDrag"!==this.taskBarEditAction&&"ManualParentDrag"!==this.taskBarEditAction&&"MilestoneDrag"!==this.taskBarEditAction||(e=void 0,e=this.parent.enableVirtualization?(s=this.parent.currentViewData.indexOf(this.taskBarEditRecord),this.parent.getRowByIndex(s)):this.parent.getRowByIndex(this.taskBarEditRecord.index),e={cancel:t,cloneElement:this.taskbarElement,data:this.taskBarEditRecord,target:i.target,rows:e},this.parent.trigger("rowDrag",e),t=e.cancel),t||this.isMouseDragCheck(),this.isMouseDragged&&this.taskBarEditAction){if(i.preventDefault(),oe.isNullOrUndefined(this.taskbarElement)||oe.isNullOrUndefined(this.editElement)||"ConnectorPointRightDrag"===this.taskBarEditAction||"ConnectorPointLeftDrag"===this.taskBarEditAction||"ResourceView"===this.parent.viewType&&this.currentData.hasChildRecords||(h=this.editElement.parentElement,this.parent.enableTimelineVirtualization&&this.parent.timelineModule.wholeTimelineWidth>3*this.parent.element.offsetWidth?h.style.setProperty("position","relative"):h.style.setProperty("position","absolute"),("ChildDrag"!==this.taskBarEditAction&&"LeftResizing"!==this.taskBarEditAction||oe.isNullOrUndefined(this.currentIndex)||oe.isNullOrUndefined(this.currentIndex)||0!==Number(this.currentIndex)?this.parent.allowTaskbarDragAndDrop&&"LeftResizing"!==this.taskBarEditAction&&"RightResizing"!==this.taskBarEditAction&&"ProgressResizing"!==this.taskBarEditAction?this.parent.chartPane.getElementsByClassName("e-gantt-chart")[0]:h:(this.taskbarElement.childNodes[0].childNodes[0].style.setProperty("top",h.parentElement.offsetTop+"px"),this.parent.allowTaskbarDragAndDrop&&"LeftResizing"!==this.taskBarEditAction&&"RightResizing"!==this.taskBarEditAction&&"ProgressResizing"!==this.taskBarEditAction?this.parent.chartPane.getElementsByClassName("e-gantt-chart")[0]:h.parentElement)).appendChild(this.taskbarElement),"ProgressResizing"!==this.taskBarEditAction&&(this.parent.enableTimelineVirtualization&&this.parent.timelineModule.wholeTimelineWidth>3*this.parent.element.offsetWidth?this.parent.ganttChartModule.chartBodyContainer.querySelectorAll(".e-chart-scroll-container"):this.parent.ganttChartModule.chartBodyContainer.querySelectorAll(".e-chart-rows-container"))[0].appendChild(this.taskbarResizer)),this.parent.allowTaskbarDragAndDrop&&("ChildDrag"===this.taskBarEditAction||"ParentDrag"===this.taskBarEditAction||"MilestoneDrag"===this.taskBarEditAction||"ManualParentDrag"===this.taskBarEditAction)){var a,r,s,e=this.parent.getOffsetRect(this.taskBarEditElement),t=!oe.isNullOrUndefined(document.body.className)&&document.body.className.includes("e-bigger")?12:0,t=3+this.parent.chartRowsModule.connectorPointWidth+t,o=void 0,o=this.parent.enableRtl?Math.abs(e.left+t+1):Math.abs(e.left-t-1),e=(this.isClonedElement||this.parent.enableRtl||(o-=this.parent.ganttChartModule.scrollElement.scrollLeft,this.isClonedElement=!0),0),t=this.parent.rowDragAndDropModule.dropPosition=void 0,l=void 0,l="touchmove"===i.type||"touchstart"===i.type||"touchend"===i.type?i.changedTouches[0].pageY:i.y,o=(this.parent.enableRtl?(t=document.elementFromPoint(this.parent.ganttChartModule.chartBodyContainer.offsetWidth,l)).classList.contains("e-taskbar-resize-div")&&(t=document.elementFromPoint(this.parent.ganttChartModule.chartBodyContainer.offsetWidth-t.offsetWidth,l)):t=document.elementFromPoint(o,l),void 0);if(this.parent.enableVirtualization)this.draggedTreeGridRowElement||(o=(h=this.editElement.parentElement).parentElement,this.draggedTreeGridRowElement=o,this.draggedTreeGridRowHeight=this.draggedTreeGridRowElement.offsetHeight);else if(o=this.parent.treeGrid.getRows()[this.parent.flatData.indexOf(this.taskBarEditRecord)],this.draggedTreeGridRowElement=o,this.parent.enableMultiTaskbar)if(this.taskBarEditRecord.parentItem&&!oe.isNullOrUndefined(this.parent.getRowByID(this.taskBarEditRecord.parentItem.taskId))){if(this.draggedTreeGridRowHeight=this.parent.getRowByID(this.taskBarEditRecord.parentItem.taskId).offsetHeight,"ProjectView"===this.parent.viewType&&0===this.draggedTreeGridRowHeight)for(var d=this.parent.getRecordByID(this.taskBarEditRecord.parentItem.taskId);d.parentItem;)d=this.parent.getRecordByID(d.parentItem.taskId),this.draggedTreeGridRowHeight=this.parent.getRowByID(d.TaskID).offsetHeight}else{var h=this.editElement.parentElement;this.draggedTreeGridRowElement=h.parentElement,this.draggedTreeGridRowHeight=this.draggedTreeGridRowElement.offsetHeight}else this.draggedTreeGridRowHeight=this.draggedTreeGridRowElement.offsetHeight;(a=t?oe.closest(t,"tr."+xe):a)&&(l=void 0,l=this.parent.enableVirtualization?this.parent.treeGrid.getRows().filter(function(e){return parseInt(e.getAttribute("aria-rowindex"),10)-1==parseInt(a.getAttribute("aria-rowindex"),10)-1})[0]:this.parent.treeGrid.getRows()[parseInt(a.getAttribute("aria-rowindex"),10)-1],this.removeFirstBorder(l),this.removeLastBorder(l),(oe.isNullOrUndefined(l)||l.getAttribute("data-uid")!==this.draggedTreeGridRowElement.getAttribute("data-uid"))&&P(t,"e-chart-rows-container")||(this.parent.rowDragAndDropModule.dropPosition="Invalid",this.addErrorElem()),o=0,t=(h=this.parent).toolbarModule?this.parent.toolbarModule.element.offsetHeight:0,r=this.parent.getOffsetRect(h.element),r=h.treeGrid.getHeaderContent().offsetHeight+r.top+t,t=h.treeGrid.getContent().firstElementChild.scrollTop,oe.isNullOrUndefined(l)||(e=l.offsetTop-t),h=((o=this.parent.enableVirtualization?this.parent.getOffsetRect(l).top:e+r)+this.draggedTreeGridRowHeight-o)/3,r=(e=(t=o+h)+h)+h,h=t<(o="mousemove"===i.type?i.pageY:oe.isNullOrUndefined(i.changedTouches)?null:i.changedTouches[0].pageY)&&o<=e,e=e<o&&o<=r,(r=o<=t)||h||e)&&(o=void 0,o=this.parent.enableVirtualization?(s=this.parent.treeGrid.getRows().indexOf(l),this.parent.getRowByIndex(s)):this.parent.getRowByIndex(parseInt(l.getAttribute("aria-rowindex"),10)-1),t=oe.getValue("rowIndex",o),s=this.parent.flatData[t],t=!0,"ResourceView"!==this.parent.viewType||this.taskBarEditRecord.hasChildRecords||s.hasChildRecords||oe.isNullOrUndefined(s.parentItem)||this.taskBarEditRecord.parentItem.taskId!==s.parentItem.taskId||(t=!1),s&&this.ensurePosition([this.taskBarEditRecord],s),t)&&(r&&"Invalid"!==this.parent.rowDragAndDropModule.dropPosition&&(this.parent.rowDragAndDropModule.dropPosition="above",this.removeChildBorder(),this.removeErrorElem(),this.removetopOrBottomBorder(),this.topOrBottomBorder(o)),h&&"Invalid"!==this.parent.rowDragAndDropModule.dropPosition&&(this.parent.rowDragAndDropModule.dropPosition="child",this.removetopOrBottomBorder(),this.addRemoveClasses(o.children,!0,"e-childborder")),e)&&"Invalid"!==this.parent.rowDragAndDropModule.dropPosition&&(this.parent.rowDragAndDropModule.dropPosition="below",this.removetopOrBottomBorder(),this.removeErrorElem(),this.removeChildBorder(),this.removeFirstBorder(l),this.topOrBottomBorder(l))}var p={cancel:!1,requestType:"taskbarediting",taskBarEditAction:this.taskBarEditAction,data:this.taskBarEditRecord};-1!==this.segmentIndex&&(p.requestType="mergeSegment"),this.parent.trigger("actionBegin",p,function(e){var t;"ConnectorPointRightDrag"!==p.taskBarEditAction&&"ConnectorPointLeftDrag"!==p.taskBarEditAction&&"LeftResizing"!==p.taskBarEditAction&&"RightResizing"!==p.taskBarEditAction&&"ProgressResizing"!==p.taskBarEditAction&&"ChildDrag"!==p.taskBarEditAction&&"ParentDrag"!==p.taskBarEditAction&&"MilestoneDrag"!==p.taskBarEditAction&&"ManualParentDrag"!==p.taskBarEditAction&&"ParentResizing"!==p.taskBarEditAction||(n.parent.showIndicator=!1,n.parent.undoRedoModule&&n.parent.isUndoRedoItemPresent("Edit")&&(n.parent.undoRedoModule.redoEnabled&&n.parent.undoRedoModule.disableRedo(),t={},0===n.parent.undoRedoModule.getUndoCollection.length||n.parent.editModule.createArray)&&(n.isDragged=!0,t.modifiedRecords=[],t.action=p.taskBarEditAction,n.parent.undoRedoModule.createUndoCollection(),n.parent.undoRedoModule.getUndoCollection[n.parent.undoRedoModule.getUndoCollection.length-1]=t,n.parent.editModule.createArray=!1,n.parent.undoRedoModule.changedRecords=[])),!1===e.cancel?(!oe.isNullOrUndefined(n.parent.loadingIndicator)&&"Shimmer"===n.parent.loadingIndicator.indicatorType&&n.parent.showIndicator?n.parent.showMaskRow():n.parent.showIndicator&&n.parent.showSpinner(),n.taskBarEditingAction(i,!1)):n.editTooltip.updateTooltip(n.segmentIndex)})}else this.parent.isAdaptive||this.taskBarEditAction||this.updateTaskBarEditElement(i)},D.prototype.taskBarEditingAction=function(e,t){var i=this,n={},a=this.parent.ganttChartModule.getIndexByTaskBar(this.taskBarEditElement);if(null!==this.taskBarEditRecord&&(n.editingFields=this.taskBarEditRecord.ganttProperties,n.data=this.taskBarEditRecord,"ResourceView"!==this.parent.viewType||0!==n.data.level)){n.recordIndex=a,n.taskBarEditAction=this.taskBarEditAction,n.roundOffDuration=this.roundOffDuration,n.cancel=!1,n.previousData=this.previousItem,n.segmentIndex=this.segmentIndex,this.roundOffDuration=n.roundOffDuration,this.targetElement=n.target=oe.closest(e.target,".e-gantt-child-taskbar"),this.updateMouseMoveProperties(e),this.oldData||(this.oldData=oe.extend([],[],[this.taskBarEditRecord],!0)[0]);var r=-1!==this.segmentIndex?this.segmentIndex:null;if("ProgressResizing"===this.taskBarEditAction){if(this.mainElement=P(this.taskBarEditElement,S),this.taskBarEditRecord.ganttProperties.segments&&0<this.taskBarEditRecord.ganttProperties.segments.length)for(var r=-1,s=0;s<this.taskBarEditRecord.ganttProperties.segments.length;s++){var o=document.getElementsByClassName("e-child-progress-resizer e-progress-resize-gripper")[0].style,o=this.parent.enableRtl?parseInt(o.right,10)-8:parseInt(o.left,10)+8;o<this.taskBarEditRecord.ganttProperties.segments[s].width&&0===s&&(r=s),this.taskBarEditRecord.ganttProperties.segments[s+1]&&o<this.taskBarEditRecord.ganttProperties.segments[s+1].width+this.taskBarEditRecord.ganttProperties.segments[s+1].left&&o>this.taskBarEditRecord.ganttProperties.segments[s+1].left&&(r=s+1)}this.performProgressResize(e,r)}else"LeftResizing"===this.taskBarEditAction?this.enableLeftResizing(e):"RightResizing"===this.taskBarEditAction||"ParentResizing"===this.taskBarEditAction?this.enableRightResizing(e):"ParentDrag"===this.taskBarEditAction||"ChildDrag"===this.taskBarEditAction||"MilestoneDrag"===this.taskBarEditAction||"ManualParentDrag"===this.taskBarEditAction?this.enableDragging(e):"ConnectorPointLeftDrag"!==this.taskBarEditAction&&"ConnectorPointRightDrag"!==this.taskBarEditAction||(this.updateConnectorLineSecondProperties(e),this.triggerDependencyEvent(e),this.drawFalseLine());if(this.parent.allowTaskbarDragAndDrop&&"LeftResizing"!==this.taskBarEditAction&&"RightResizing"!==this.taskBarEditAction&&"ProgressResizing"!==this.taskBarEditAction){var a=this.parent.getOffsetRect(this.parent.chartPane),l=this.getCoordinate(e),d=l.pageY,l=l.pageX,l={left:Math.abs(l-a.left),top:d-a.top};if("ResourceView"===this.parent.viewType&&this.parent.enableMultiTaskbar){var h=this.parent.getRecordByID(this.taskBarEditRecord.parentItem.taskId);if(!this.parent.allowTaskbarOverlap&&this.taskBarEditRecord.parentItem&&!h.expanded){var p=0;if(parseInt(this.editElement.style.marginTop,10)>this.parent.rowHeight){for(s=0;s<h.childRecords.length&&h.childRecords[s].ganttProperties.taskId!==this.taskBarEditRecord.ganttProperties.taskId;s++)p+=this.parent.rowHeight;l.top=l.top-p}}}this.topValue=l.top;d=void 0,d=("touchmove"===e.type||"touchstart"===e.type||"touchend"===e.type?e.changedTouches[0]:e).pageX;this.parent.enableRtl?this.leftValue=l.left-Math.abs(d-this.parent.getOffsetRect(this.taskBarEditElement).left)-(0!==this.previousLeftValue?d-this.previousLeftValue:0):this.leftValue=l.left-(d-this.parent.getOffsetRect(this.taskBarEditElement).left)+(0!==this.previousLeftValue?d-this.previousLeftValue:0),0===this.previousLeftValue&&(this.parent.enableRtl?(this.leftValue=this.leftValue-this.parent.ganttChartModule.scrollObject.previousScroll.left,0===this.parent.ganttChartModule.scrollObject.previousScroll.left&&(this.leftValue=this.leftValue-60)):this.leftValue=this.leftValue-this.parent.ganttChartModule.scrollObject.previousScroll.left),this.previousLeftValue=d}else this.leftValue=this.taskBarEditRecord.ganttProperties.left;this.currentSegmentIndex=r,this.setItemPosition(),this.updateEditedItem(),this.tooltipValue=("touchmove"===e.type||"touchstart"===e.type||"touchend"===e.type?e.changedTouches[0]:e).pageX,this.taskBarEditRecord.ganttProperties.segments&&-1===r||this.editTooltip.updateTooltip(r),t&&this.taskBarEditedAction(e),this.parent.trigger("taskbarEditing",n,function(e){e.cancel&&null!==i.taskBarEditRecord&&(i.tapPointOnFocus=!1,oe.merge(i.taskBarEditRecord.ganttProperties,e.previousData))})}},D.prototype.updateMouseMoveProperties=function(e){var t=this.parent.getOffsetRect(this.parent.ganttChartModule.chartBodyContainer),e=this.getCoordinate(e),i=this.parent.element.closest('[style*="zoom"]'),i=(i&&(i=parseFloat(getComputedStyle(i).zoom),e.pageX=e.pageX/i,e.pageY=e.pageY/i),(e.pageX||e.pageY)&&(this.parent.enableRtl?this.mouseMoveX=Math.abs(e.pageX-(t.left+Math.abs(this.parent.ganttChartModule.scrollObject.previousScroll.left))):this.mouseMoveX=e.pageX-t.left+this.parent.ganttChartModule.scrollObject.previousScroll.left,this.tooltipPositionX=this.mouseMoveX,this.mouseMoveY=e.pageY-t.top+this.parent.ganttChartModule.scrollObject.previousScroll.top),"ConnectorPointLeftDrag"===this.taskBarEditAction||"ConnectorPointRightDrag"===this.taskBarEditAction);(3<this.taskBarEditRecord.ganttProperties.width||this.taskBarEditRecord.ganttProperties.isMilestone)&&("ProgressResizing"!==this.taskBarEditAction||0!==this.taskBarEditRecord.ganttProperties.progress&&100!==this.taskBarEditRecord.ganttProperties.progress)||i?(e=0,e=this.parent.enableRtl?Math.abs(Math.abs(this.mouseMoveX)-Math.abs(this.parent.ganttChartModule.scrollObject.previousScroll.left)+t.left):this.mouseMoveX-this.parent.ganttChartModule.scrollObject.previousScroll.left+t.left,i=this.mouseMoveY-this.parent.ganttChartModule.scrollObject.previousScroll.top+t.top,e+20>t.left+this.parent.ganttChartModule.chartBodyContainer.offsetWidth?(this.timerCount=this.parent.ganttChartModule.scrollObject.previousScroll.left,this.startScrollTimer("right")):e+40>t.left+this.parent.ganttChartModule.chartBodyContainer.offsetWidth&&this.parent.enableRtl&&0===this.parent.ganttChartModule.scrollObject.previousScroll.left?(this.parent.ganttChartModule.scrollObject.previousScroll.left=-1,this.timerCount=this.parent.ganttChartModule.scrollObject.previousScroll.left,this.startScrollTimer("right")):e-20<t.left?(this.timerCount=this.parent.ganttChartModule.scrollObject.previousScroll.left,this.startScrollTimer("left")):i+80>t.top+this.parent.ganttChartModule.chartBodyContainer.offsetHeight?(this.timerCount=this.parent.ganttChartModule.scrollObject.previousScroll.top,this.startScrollTimer("bottom")):i-20<t.top?(this.timerCount=this.parent.ganttChartModule.scrollObject.previousScroll.top,this.startScrollTimer("top")):this.stopScrollTimer()):this.stopScrollTimer()},D.prototype.startScrollTimer=function(t){var i=this,n=(this.stopScrollTimer(),0);this.scrollTimer=window.setInterval(function(){var e;-1===Math.sign(i.timerCount)&&(n=-1,i.timerCount=Math.abs(i.timerCount)),"right"===t?(e=i.parent.enableTimelineVirtualization?i.parent.timelineModule.wholeTimelineWidth:i.parent.timelineModule.totalTimelineWidth,i.timerCount=i.timerCount+1>=e?e:i.timerCount+1):i.timerCount="bottom"===t?i.timerCount+1:i.timerCount-1<0?0:i.timerCount-1,"bottom"===t||"top"===t?i.parent.ganttChartModule.scrollObject.setScrollTop(i.timerCount):i.parent.ganttChartModule.scrollObject.setScrollLeft(i.timerCount,n),"ConnectorPointLeftDrag"!==i.taskBarEditAction&&"ConnectorPointRightDrag"!==i.taskBarEditAction||i.drawFalseLine()},0)},D.prototype.stopScrollTimer=function(){window.clearInterval(this.scrollTimer),this.scrollTimer=null},D.prototype.enableDragging=function(e){var t,i,n,a,r,s=this.taskBarEditRecord.ganttProperties,o=this.parent.enableTimelineVirtualization?this.parent.timelineModule.wholeTimelineWidth:this.parent.timelineModule.totalTimelineWidth,l=0;this.taskBarEditElement.classList.contains("e-segmented-taskbar")&&!this.taskBarEditElement.classList.contains("e-segment-first")?(i=(t=this.taskBarEditRecord.ganttProperties.segments.map(function(e){return Dn({},e)}))[this.segmentIndex],this.mouseDownX>this.mouseMoveX?(l=oe.isNullOrUndefined(this.previousMouseMove)?this.mouseDownX-this.mouseMoveX:this.previousMouseMove-this.mouseMoveX,this.previousMouseMove=this.mouseMoveX,i.left=i.left-l):(l=oe.isNullOrUndefined(this.previousMouseMove)?this.mouseMoveX-this.mouseDownX:this.mouseMoveX-this.previousMouseMove,this.previousMouseMove=this.mouseMoveX,i.left=i.left+l),n=t[this.segmentIndex-1],a=t[this.segmentIndex+1],r=void 0,r=this.taskBarEditElement.classList.contains("e-segment-inprogress")?i.left<n.left+n.width?n.left+n.width:i.width+i.left>a.left?a.left-i.width:i.left:i.left<n.left+n.width?n.left+n.width:s.left+i.width+i.left>=o?o-i.width:i.left,i.left=r,this.parent.setRecordValue("segments",t,s,!0),this.parent.dataOperation.updateMappingData(this.taskBarEditRecord,"segments")):(this.mouseDownX>this.mouseMoveX?0<(l=this.mouseDownX-this.mouseMoveX)&&this.parent.setRecordValue("left",this.previousItem.left-l,s,!0):(l=this.mouseMoveX-this.mouseDownX,this.parent.setRecordValue("left",this.previousItem.left+l,s,!0)),r=s.left<0?0:s.left+s.width>=o?o-s.width:s.left,this.parent.setRecordValue("left",r,s,!0))},D.prototype.validateProgressWidth=function(e,t,i){if(-1!==this.currentSegmentIndex&&e.segments){var n=this.currentSegmentIndex>=this.segmentIndex?0:0!==this.currentSegmentIndex?this.currentSegmentIndex:-1,a=this.currentSegmentIndex>=this.segmentIndex?this.currentSegmentIndex:this.segmentIndex;if(-1!==n)for(var r=n;r<a;r++)t-=e.segments[r+1].left-(e.segments[r].left+e.segments[r].width)}return e.segments&&0<e.segments.length&&(i=this.splitTasksDuration(e.segments)*this.parent.perDayWidth,i=e.segments.reduce(function(e,t){return e+t.width},0)),{progressWidth:t=i<t?i:t,totalTaskWidth:i}},D.prototype.performProgressResize=function(e,t){var i=this.taskBarEditRecord.ganttProperties,n=0,a=i.progressWidth,n=(this.mouseDownX>this.mouseMoveX?this.mouseMoveX>i.left&&this.mouseMoveX<i.left+i.width&&0<i.left?(n=this.mouseMoveX-i.left,this.parent.setRecordValue("progressWidth",n,i,!0)):this.mouseMoveX>=i.left+i.width?this.parent.setRecordValue("progressWidth",i.width,i,!0):this.parent.setRecordValue("progressWidth",0,i,!0):this.mouseMoveX>i.left&&this.mouseMoveX<i.left+i.width?(n=this.mouseMoveX-i.left,this.parent.setRecordValue("progressWidth",n,i,!0)):this.mouseMoveX<=i.left?this.parent.setRecordValue("progressWidth",0,i,!0):this.parent.setRecordValue("progressWidth",i.width,i,!0),i.progressWidth>i.width?i.width:i.progressWidth,i.progressWidth<0?0:i.progressWidth),t=(-1===t&&t?this.parent.setRecordValue("progressWidth",a,i,!0):this.parent.setRecordValue("progressWidth",n,i,!0),this.progressValue=n,i.width-i.progressWidth);this.progressBorderRadius=t<=4?4-t:0},D.prototype.enableLeftResizing=function(e){var t=this.taskBarEditRecord.ganttProperties,i=0;this.taskBarEditElement.classList.contains("e-segmented-taskbar")&&1<t.segments.length?this.enableSplitTaskLeftResize(t):(this.mouseDownX>this.mouseMoveX?this.mouseMoveX<t.left+t.width?(i=this.mouseDownX-this.mouseMoveX,0<t.left&&(this.parent.setRecordValue("left",this.previousItem.left-i,t,!0),this.parent.setRecordValue("width",this.previousItem.width+i,t,!0))):this.mouseMoveX>t.left+t.width&&(i=this.mouseDownX-this.mouseMoveX,this.parent.setRecordValue("left",this.previousItem.left-i,t,!0),this.parent.setRecordValue("width",3,t,!0)):this.mouseMoveX<t.left+t.width?(i=this.mouseMoveX-this.mouseDownX,t.left<t.left+t.width&&this.previousItem.left+i<=this.previousItem.left+this.previousItem.width&&(this.parent.setRecordValue("left",this.previousItem.left+i,t,!0),this.parent.setRecordValue("width",this.previousItem.width-i,t,!0))):(i=this.mouseMoveX-this.mouseDownX,this.parent.setRecordValue("left",this.previousItem.left+i,t,!0),this.parent.setRecordValue("width",3,t,!0)),t.segments&&1===t.segments.length&&(t.segments[0].width=t.width),this.updateEditPosition(e,t),this.parent.setRecordValue("left",this.previousItem.left+this.previousItem.width-t.width,t,!0))},D.prototype.enableSplitTaskLeftResize=function(e){var t=this.taskBarEditRecord.ganttProperties.segments.map(function(e){return Dn({},e)}),i=t[this.segmentIndex],n=0;if(this.mouseDownX>this.mouseMoveX)if(this.mouseMoveX<e.left+i.width+i.left){var a,n=oe.isNullOrUndefined(this.previousMouseMove)?this.mouseDownX-this.mouseMoveX:this.previousMouseMove-this.mouseMoveX;if(this.previousMouseMove=this.mouseMoveX,0<i.left)i.left=i.left-n,i.width=i.width+n,0!==this.segmentIndex&&(a=t[this.segmentIndex-1],e.left+i.left<e.left+a.left+a.width)&&(a=e.left+a.left+a.width-(e.left+i.left),i.width-=a,i.left=i.left+a);else if(i.left<=0&&0===this.segmentIndex){this.parent.setRecordValue("left",e.left-n,e,!0),this.parent.setRecordValue("width",e.width+n,e,!0),i.width=i.width+n;for(var r=1;r<e.segments.length;r++){var s=t[r];s.left=s.left+n}}}else this.mouseMoveX>e.left+i.width+i.left&&(n=oe.isNullOrUndefined(this.previousMouseMove)?this.mouseDownX-this.mouseMoveX:this.previousMouseMove-this.mouseMoveX,this.previousMouseMove=this.mouseMoveX,i.left=i.left-n,i.width=this.parent.perDayWidth);else if(this.mouseMoveX<e.left+i.width+i.left-this.parent.perDayWidth)if(n=oe.isNullOrUndefined(this.previousMouseMove)?this.mouseMoveX-this.mouseDownX:this.mouseMoveX-this.previousMouseMove,this.previousMouseMove=this.mouseMoveX,0===this.segmentIndex&&i.left<=0){this.parent.setRecordValue("left",e.left+n,e,!0),this.parent.setRecordValue("width",e.width-n,e,!0),i.width=i.width-n;for(r=1;r<e.segments.length;r++){var o=t[r];o.left=o.left-n}}else i.left<i.left+i.width&&i.left+n<=i.left+i.width&&(i.left=i.left+n,i.width=i.width-n);else if(this.mouseMoveX<e.left+i.left+i.width&&i.width>this.parent.perDayWidth)if(n=oe.isNullOrUndefined(this.previousMouseMove)?this.mouseMoveX-this.mouseDownX:this.mouseMoveX-this.previousMouseMove,this.previousMouseMove=this.mouseMoveX,n-=i.width-n<this.parent.perDayWidth?this.parent.perDayWidth>i.width?this.parent.perDayWidth-i.width:i.width-this.parent.perDayWidth:0,0===this.segmentIndex){this.parent.setRecordValue("width",e.width-n,e,!0),this.parent.setRecordValue("left",e.left+n,e,!0),i.width=i.width-n;for(r=1;r<e.segments.length;r++){var l=t[r];l.left=l.left-n}}else i.left=i.left+n,i.width=i.width-n;this.parent.setRecordValue("segments",t,e,!0),this.parent.dataOperation.updateMappingData(this.taskBarEditRecord,"segments")},D.prototype.updateEditPosition=function(e,t){this.updateIsMilestone(t),this.parent.setRecordValue("progressWidth",this.parent.dataOperation.getProgressWidth(t.width,t.progress),t,!0)},D.prototype.updateIsMilestone=function(e){e.width<=3?(this.parent.setRecordValue("width",3,e,!0),this.parent.setRecordValue("isMilestone",!0,e,!0),oe.isNullOrUndefined(this.taskBarEditRecord[this.parent.taskFields.milestone])||this.parent.setRecordValue(this.parent.taskFields.milestone,!0,this.taskBarEditRecord,!0)):(this.parent.setRecordValue("width",e.width,e,!0),this.parent.setRecordValue("isMilestone",!1,e,!0),oe.isNullOrUndefined(this.taskBarEditRecord[this.parent.taskFields.milestone])||this.parent.setRecordValue(this.parent.taskFields.milestone,!1,this.taskBarEditRecord,!0))},D.prototype.enableRightResizing=function(e){var t,i,n,a,r=this.taskBarEditRecord.ganttProperties,s=0;this.taskBarEditElement.classList.contains("e-segmented-taskbar")&&1<r.segments.length?(i=(t=this.taskBarEditRecord.ganttProperties.segments.map(function(e){return Dn({},e)}))[this.segmentIndex],n=void(this.mouseDownX>this.mouseMoveX?this.mouseMoveX>r.left+i.left&&3<this.mouseDownX-this.mouseMoveX?(s=oe.isNullOrUndefined(this.previousMouseMove)?this.mouseDownX-this.mouseMoveX:this.previousMouseMove-this.mouseMoveX,this.previousMouseMove=this.mouseMoveX,i.width=i.width-s):this.mouseMoveX<r.left+i.left&&(n=this.parent.timelineModule.isSingleTier&&("Hour"===this.parent.timelineModule.customTimelineSettings.bottomTier.unit||"Hour"===this.parent.timelineModule.customTimelineSettings.topTier.unit||"Minutes"===this.parent.timelineModule.customTimelineSettings.bottomTier.unit||"Minutes"===this.parent.timelineModule.customTimelineSettings.topTier.unit)||"Hour"===this.parent.timelineModule.customTimelineSettings.bottomTier.unit||"Minutes"===this.parent.timelineModule.customTimelineSettings.bottomTier.unit?this.parent.timelineModule.customTimelineSettings.timelineUnitSize:this.parent.perDayWidth,i.width=n):this.mouseMoveX>i.left&&(s=oe.isNullOrUndefined(this.previousMouseMove)?this.mouseMoveX-this.mouseDownX:this.mouseMoveX-this.previousMouseMove,this.previousMouseMove=this.mouseMoveX,i.width=i.width+s)),a=this.segmentIndex!==t.length-1?t[this.segmentIndex+1]:null,oe.isNullOrUndefined(a)||(this.taskBarEditElement.classList.contains("e-segment-last")||(n=i.left+i.width>a.left?a.left-i.left:i.width),i.width=n),this.segmentIndex===r.segments.length-1&&0===this.segmentIndex&&this.parent.setRecordValue("width",i.width,r,!0),this.parent.setRecordValue("segments",t,r,!0),this.parent.dataOperation.updateMappingData(this.taskBarEditRecord,"segments")):(this.mouseDownX>this.mouseMoveX?this.mouseMoveX>r.left&&3<this.mouseDownX-this.mouseMoveX?(s=this.mouseDownX-this.mouseMoveX,this.parent.setRecordValue("width",this.previousItem.width-s,r,!0)):this.mouseMoveX<r.left&&this.parent.setRecordValue("width",3,r,!0):this.mouseMoveX>r.left&&(s=this.mouseMoveX-this.mouseDownX,this.parent.setRecordValue("width",this.previousItem.width+s,r,!0)),r.segments&&1===r.segments.length&&(r.segments[0].width=r.width),this.updateEditPosition(e,r))},D.prototype.updateEditedItem=function(){var e,t,i,n=this.taskBarEditRecord.ganttProperties;switch(this.taskBarEditAction){case"ProgressResizing":var a=n.progressWidth,r=n.width,a=this.validateProgressWidth(n,a,r);this.parent.setRecordValue("progress",this.getProgressPercent(a.totalTaskWidth,a.progressWidth),n,!0);break;case"LeftResizing":-1===this.segmentIndex?(t=this.getRoundOffStartLeft(n,this.roundOffDuration),r=this.getDateByLeft(t),oe.isNullOrUndefined(n.endDate)&&(i=this.parent.dateValidationModule.getValidEndDate(n),this.parent.setRecordValue("endDate",i,n,!0)),e=this.parent.dateValidationModule.checkStartDate(r,n,null),this.parent.setRecordValue("startDate",new Date(e.getTime()),n,!0),0===this.parent.dateValidationModule.compareDates(n.startDate,n.endDate)&&oe.isNullOrUndefined(n.isMilestone)&&!1===n.isMilestone&&0===n.duration&&this.parent.setRecordValue("duration",1,n,!0),n.isMilestone&&this.parent.setRecordValue("endDate",new Date(e.getTime()),n,!0),this.parent.dateValidationModule.calculateDuration(this.taskBarEditRecord),this.parent.editModule.updateResourceRelatedFields(this.taskBarEditRecord,"duration")):this.updateSplitLeftResize(n);break;case"RightResizing":case"ParentResizing":-1===this.segmentIndex?(t=this.getRoundOffEndLeft(n,this.roundOffDuration),a=this.getDateByLeft(t),oe.isNullOrUndefined(n.startDate)&&(e=this.parent.dateValidationModule.getValidStartDate(n),this.parent.setRecordValue("startDate",e,n,!0)),r=oe.isNullOrUndefined(n.startDate)?e:n.startDate,i=n.isMilestone?r:this.parent.dateValidationModule.checkEndDate(a,this.taskBarEditRecord.ganttProperties),this.parent.setRecordValue("endDate",new Date(i.getTime()),n,!0),this.parent.dateValidationModule.calculateDuration(this.taskBarEditRecord),this.parent.editModule.updateResourceRelatedFields(this.taskBarEditRecord,"duration")):this.updateSplitRightResizing(n);break;case"ParentDrag":case"ChildDrag":case"MilestoneDrag":case"ManualParentDrag":-1===this.segmentIndex||0===this.segmentIndex||-1!==this.segmentIndex&&this.parent.allowTaskbarDragAndDrop?this.updateChildDrag(n):this.setSplitTaskDrag(n)}oe.isNullOrUndefined(this.taskBarEditRecord.ganttProperties.segments)||this.parent.chartRowsModule.updateSegment(this.taskBarEditRecord.ganttProperties.segments,this.taskBarEditRecord.ganttProperties.taskId)},D.prototype.updateChildDrag=function(e){var t,i=this.getRoundOffStartLeft(e,this.roundOffDuration),i=this.getDateByLeft(i,e.isMilestone,e);0===this.segmentIndex?(this.parent.setRecordValue("startDate",this.parent.dateValidationModule.checkStartDate(i,e,null),e,!0),e.segments[0].startDate=i,e.segments[0].endDate=this.parent.dataOperation.getEndDate(e.segments[0].startDate,e.segments[0].duration,e.durationUnit,e,!1),this.parent.setRecordValue("segments",e.segments,e,!0),this.parent.dataOperation.updateMappingData(this.taskBarEditRecord,"segments"),this.parent.chartRowsModule.incrementSegments(e.segments,0,this.taskBarEditRecord),this.parent.setRecordValue("endDate",e.segments[e.segments.length-1].endDate,e,!0),this.parent.setRecordValue("taskData."+this.parent.taskFields.segments,e.segments,this.taskBarEditRecord,!0)):!oe.isNullOrUndefined(e.endDate)&&oe.isNullOrUndefined(e.startDate)?(t=this.parent.dateValidationModule.checkStartDate(i,e,null),t=this.parent.dateValidationModule.checkEndDate(t,this.taskBarEditRecord.ganttProperties),this.parent.setRecordValue("endDate",t,e,!0)):(this.parent.setRecordValue("startDate",this.parent.dateValidationModule.checkStartDate(i,e,null),e,!0),oe.isNullOrUndefined(e.duration)||this.parent.dateValidationModule.calculateEndDate(this.taskBarEditRecord))},D.prototype.updateSplitLeftResize=function(e){var t=e.segments[this.segmentIndex],i=0===this.segmentIndex?this.getRoundOffStartLeft(e,this.roundOffDuration):this.getRoundOffStartLeft(t,this.roundOffDuration),i=this.getDateByLeft(i),i=this.parent.dataOperation.checkStartDate(i,e,!1),n=this.parent.dataOperation.getDuration(i,t.endDate,e.durationUnit,e.isAutoSchedule,e.isMilestone);t.startDate=new Date(i.getTime()),t.duration=n,this.parent.setRecordValue("duration",this.sumOfDuration(e.segments),e,!0),0===this.segmentIndex&&this.parent.setRecordValue("startDate",t.startDate,e,!0),this.parent.editModule.updateResourceRelatedFields(this.taskBarEditRecord,"duration"),oe.isNullOrUndefined(e.segments[this.segmentIndex-1])||(i=this.parent.dataOperation.getDuration(e.segments[this.segmentIndex-1].endDate,e.segments[this.segmentIndex].startDate,e.durationUnit,e.isAutoSchedule,e.isMilestone),t.offsetDuration=i),this.parent.setRecordValue("segments",e.segments,e,!0),this.parent.dataOperation.updateMappingData(this.taskBarEditRecord,"segments")},D.prototype.updateSplitRightResizing=function(e){var t=e.segments[this.segmentIndex],i=this.getRoundOffEndLeft(e,this.roundOffDuration),i=this.getDateByLeft(i),i=this.parent.dataOperation.checkEndDate(i,e,!1),n=this.parent.dataOperation.getDuration(t.startDate,i,e.durationUnit,e.isAutoSchedule,e.isMilestone);t.endDate=new Date(i.getTime()),t.duration=n,oe.isNullOrUndefined(e.segments[this.segmentIndex+1])||(i=e.segments[this.segmentIndex+1],n=this.parent.dataOperation.getDuration(e.segments[this.segmentIndex].endDate,i.startDate,e.durationUnit,e.isAutoSchedule,e.isMilestone),t.offsetDuration=n),this.parent.setRecordValue("segments",e.segments,e,!0),this.parent.dataOperation.updateMappingData(this.taskBarEditRecord,"segments"),this.parent.setRecordValue("duration",this.sumOfDuration(e.segments),e,!0),this.parent.setRecordValue("endDate",e.segments[e.segments.length-1].endDate,e,!0),this.parent.editModule.updateResourceRelatedFields(this.taskBarEditRecord,"duration")},D.prototype.sumOfDuration=function(e){for(var t=0,i=0;i<e.length;i++)t+=e[i].duration;return t},D.prototype.setSplitTaskDrag=function(e){var t,i=e.segments[this.segmentIndex],n=this.parent.taskFields,a=this.getRoundOffStartLeft(i,this.roundOffDuration),a=this.getDateByLeft(a),a=this.parent.dateValidationModule.checkStartDate(a,e,null),a=(i.startDate=a,this.parent.dataOperation.getEndDate(i.startDate,i.duration,e.durationUnit,e,!1));e.segments[this.segmentIndex+1]&&a.getTime()>e.segments[this.segmentIndex+1].startDate.getTime()?i.endDate=e.segments[this.segmentIndex+1].startDate:i.endDate=a,i.duration=this.parent.dataOperation.getDuration(i.startDate,i.endDate,e.durationUnit,e.isAutoSchedule,e.isMilestone),this.parent.setRecordValue("duration",this.sumOfDuration(e.segments),e,!0),this.parent.setRecordValue("endDate",e.segments[e.segments.length-1].endDate,e,!0),oe.isNullOrUndefined(this.parent.taskFields.endDate)||this.parent.dataOperation.updateMappingData(this.taskBarEditRecord,"endDate"),oe.isNullOrUndefined(e.segments[this.segmentIndex-1])||(t=this.parent.dataOperation.getDuration(e.segments[this.segmentIndex-1].endDate,e.segments[this.segmentIndex].startDate,e.durationUnit,e.isAutoSchedule,e.isMilestone),1!==i.startDate.getDay()||0!==t||this.parent.includeWeekend||(t=1),i.offsetDuration=t),oe.isNullOrUndefined(e.segments[this.segmentIndex+1])||(a=e.segments[this.segmentIndex+1],t=this.parent.dataOperation.getDuration(e.segments[this.segmentIndex].endDate,a.startDate,e.durationUnit,e.isAutoSchedule,e.isMilestone),1!==a.startDate.getDay()||0!==t||this.parent.includeWeekend||(t=1),a.offsetDuration=t),this.parent.setRecordValue("segments",e.segments,e,!0),this.taskBarEditRecord[n.segments][this.segmentIndex]=this.parent.dataOperation.setSegmentTaskData(i,this.taskBarEditRecord[n.segments][this.segmentIndex]),this.parent.dataOperation.updateMappingData(this.taskBarEditRecord,"segments")},D.prototype.getRoundOffEndLeft=function(e,t){var i="None"!==this.parent.timelineModule.bottomTier?this.parent.timelineModule.bottomTier:this.parent.timelineModule.topTier,n=e.width+e.left,e=(-1!==this.segmentIndex&&1<e.segments.length&&(a=e.segments[this.segmentIndex],n=n-e.width+a.width+a.left),1/(this.parent.timelineModule.getIncrement(this.getDateByLeft(n),1,"Day")/864e5)),a=this.parent.perDayWidth-this.parent.perDayWidth/e,r=a/this.parent.perDayWidth;return(t=void 0===t?!1:t)?"Hour"===i?(t=this.parent.perDayWidth/24,e=1/(this.parent.timelineModule.getIncrement(this.getDateByLeft(n),1,"Hour")/36e5),0!==(a=this.parent.perDayWidth/24-this.parent.perDayWidth/24/e)&&(n=n-a+t)):"Minutes"===i?(t=this.parent.perDayWidth/1440,e=1/(this.parent.timelineModule.getIncrement(this.getDateByLeft(n),1,"Minutes")/6e4),0!==(a=this.parent.perDayWidth/1440-this.parent.perDayWidth/1440/e)&&(n=n-a+t)):0!==a&&(n=n-a+this.parent.perDayWidth):"Hour"!==i&&"Minutes"!==i&&(.5<r?n=n-a+this.parent.perDayWidth:r<.5&&(n=n-a+this.parent.perDayWidth/2)),n},D.prototype.getRoundOffStartLeft=function(e,t){oe.isNullOrUndefined(e);var i=e.left,n=(-1!==this.segmentIndex&&oe.isNullOrUndefined(e.segments)&&(i=e.left+this.taskBarEditRecord.ganttProperties.left),"None"!==this.parent.timelineModule.bottomTier?this.parent.timelineModule.bottomTier:this.parent.timelineModule.topTier),e=1/(this.parent.timelineModule.getIncrement(this.getDateByLeft(i,oe.isNullOrUndefined(e)?e.isMilestone:null,e),1,"Day")/864e5),a=this.parent.perDayWidth-this.parent.perDayWidth/e,r=a/this.parent.perDayWidth;return(t=void 0===t?!1:t)?"Hour"===n?(e=1/(this.parent.timelineModule.getIncrement(this.getDateByLeft(i),1,"Hour")/36e5),i-=a=this.parent.perDayWidth/24-this.parent.perDayWidth/24/e):"Minutes"===n?(e=1/(this.parent.timelineModule.getIncrement(this.getDateByLeft(i),1,"Minutes")/6e4),i-=a=this.parent.perDayWidth/1440-this.parent.perDayWidth/1440/e):i-=a:"Hour"!==n&&"Minutes"!==n&&(r<=.5?i-=a:.5<r&&(i=i-a+this.parent.perDayWidth/2)),i},D.prototype.getDateByLeft=function(e,t,i){var n=new Date(this.parent.timelineModule.timelineStartDate.toString()),a=864e5/this.parent.perDayWidth,r=new Date(n),a=(this.parent.timelineSettings.showWeekend?r.setTime(r.getTime()+e*a):n=r=this.parent.timelineModule.calculateDateExcludingNonWorkingDays(e,n),this.parent.isInDst(r)?n.setTime(n.getTime()+(e-this.parent.perDayWidth/24)*a):this.parent.timelineSettings.showWeekend?n.setTime(n.getTime()+e*a):n=r,t&&!oe.isNullOrUndefined(i.predecessorsName)&&""!==i.predecessorsName&&(e=this.parent.getCurrentDayEndTime(i.isAutoSchedule?i.autoEndDate:i.endDate),this.parent.dateValidationModule.setTime(e,n),n=this.parent.dateValidationModule.checkStartDate(n,i,!0)),"None"!==this.parent.timelineModule.bottomTier?this.parent.timelineModule.topTier:this.parent.timelineModule.bottomTier);return"Hour"!==a&&"Minutes"!==a&&this.parent.isInDst(new Date(this.parent.timelineModule.timelineStartDate.toString()))&&!this.parent.isInDst(n)&&n.setTime(n.getTime()+36e5),n},D.prototype.setItemPosition=function(){oe.isNullOrUndefined(this.editElement)||(n=this.editElement.parentElement,this.parent.allowTaskbarDragAndDrop&&"ChildDrag"===this.taskBarEditAction?n.style.position=null:this.parent.enableTimelineVirtualization&&this.parent.timelineModule.wholeTimelineWidth>3*this.parent.element.offsetWidth?n.style.setProperty("position","relative"):n.style.setProperty("position","absolute"));var e,t=this.taskBarEditRecord.ganttProperties,i=this.parent.enableRtl?"right":"left",n=oe.isNullOrUndefined(t.segments)?null:t.segments[this.segmentIndex],a="MilestoneDrag"===this.taskBarEditAction||t.isMilestone?this.parent.chartRowsModule.milestoneHeight:t.width,r=this.parent.isAdaptive?a-2:a-10,s=(oe.isNullOrUndefined(n)||(r=this.parent.isAdaptive?n.width-2:n.width-10),this.taskBarEditElement.style.setProperty("opacity",".75"),e=this.parent.allowTaskbarDragAndDrop&&!t.isAutoSchedule&&this.taskBarEditRecord.hasChildRecords||this.taskBarEditElement.classList.contains(S)?this.taskBarEditElement:"ChildDrag"!==this.taskBarEditAction&&"LeftResizing"!==this.taskBarEditAction||0!==this.segmentIndex?oe.closest(this.taskBarEditElement,"tr."+xe).querySelector("."+S):this.taskBarEditElement.parentElement,!(!this.taskBarEditElement.classList.contains("e-segmented-taskbar")&&!this.taskBarEditElement.querySelector(".e-segmented-taskbar"))),o=this.taskBarEditElement.querySelector("."+Ae),l=this.taskBarEditElement.querySelector("."+Be),d=(s?P(this.taskBarEditElement,S):this.taskBarEditElement).querySelector("."+Ee),h=this.taskBarEditElement.querySelector("."+Ie),p=this.taskBarEditElement.querySelector("."+qe),u=this.taskBarEditElement.querySelector("."+_e),c=this.taskBarEditElement.querySelector("."+ht),g=e.querySelector("."+ht),f=this.taskBarEditElement,m=this.taskBarEditElement.querySelector("."+He),y=(this.taskBarEditElement.querySelector("."+ze),this.taskBarEditElement.querySelector(".e-gantt-manualparenttaskbar-left"),this.parent.ganttChartModule.chartBodyContainer.querySelector(".e-taskbar-resize-div"));if(this.parent.allowTaskbarDragAndDrop&&!this.updatePosition&&(this.leftValue=this.leftValue+30,this.updatePosition=!0),"ConnectorPointRightDrag"!==this.taskBarEditAction&&"ConnectorPointLeftDrag"!==this.taskBarEditAction){if("ParentResizing"!==this.taskBarEditAction&&"ManualParentDrag"!==this.taskBarEditAction){if(!s||oe.isNullOrUndefined(t.segments)||"RightResizing"!==this.taskBarEditAction&&0===this.segmentIndex||(oe.isNullOrUndefined(y)||(!this.parent.allowTaskbarDragAndDrop||this.parent.allowTaskbarDragAndDrop&&this.parent.rowDragAndDropModule&&"ChildDrag"!==this.taskBarEditAction&&"ParentDrag"!==this.taskBarEditAction)&&(y.style.width=n.width+"px"),this.taskBarEditElement.style.width=n.width+"px",this.parent.enableRtl?this.taskBarEditElement.style.right=n.left+"px":(this.taskBarEditElement.style.left=n.left+"px",oe.isNullOrUndefined(y)||(!this.parent.allowTaskbarDragAndDrop||this.parent.allowTaskbarDragAndDrop&&this.parent.rowDragAndDropModule&&"ChildDrag"!==this.taskBarEditAction&&"ParentDrag"!==this.taskBarEditAction)&&(y.style.left=n.left+this.editElement.parentElement.offsetLeft+"px"))),e.style.setProperty(i,(this.parent.allowTaskbarDragAndDrop?this.leftValue:t.left)+"px"),e.style.width=a+"px",s&&g&&(g.style.left=(this.parent.isAdaptive?a+10:a+2)+"px"),this.parent.allowTaskbarDragAndDrop&&this.parent.rowDragAndDropModule&&"LeftResizing"!==this.taskBarEditAction&&"RightResizing"!==this.taskBarEditAction&&"ProgressResizing"!==this.taskBarEditAction&&(g=this.parent.taskbarHeight/2,e.style.setProperty("top",this.topValue+g+"px"),e.style.zIndex="4"),"LeftResizing"===this.taskBarEditAction&&0===this.segmentIndex){this.taskBarEditElement.style.setProperty("opacity",".75");for(var D=this.taskBarEditElement.parentElement.getElementsByClassName("e-segmented-taskbar"),k=0;k<t.segments.length;k++){var w=t.segments[k],b=D[k];b.style.width=w.width+"px",1===t.segments.length?(y.style.width=w.width+"px",y.style.setProperty(i,t.left+"px")):(0===k&&(y.style.width=w.width+"px",y.style.setProperty(i,w.left+t.left+"px")),this.parent.enableRtl?b.style.right=w.left+"px":b.style.left=w.left+"px")}}"ChildDrag"===this.taskBarEditAction&&(0===this.segmentIndex||-1!==this.segmentIndex&&this.parent.allowTaskbarDragAndDrop)&&(y.style.width=a+"px",y.style.setProperty(i,t.left+"px"),e.style.setProperty("opacity",".75"))}if(c&&(this.parent.enableRtl?c.style.left=(this.parent.isAdaptive?a+10:a-2)+"px":c.style.left=(this.parent.isAdaptive?a+10:a+2)+"px"),c&&"LeftResizing"===this.taskBarEditAction&&(c.style.left=a-2+"px"),d&&o&&("LeftResizing"===this.taskBarEditAction||"RightResizing"===this.taskBarEditAction||"ChildDrag"===this.taskBarEditAction||"ParentDrag"===this.taskBarEditAction)&&(d.style.display="none",o.style.display="none"),c&&"ProgressResizing"===this.taskBarEditAction&&(c.style.display="none"),"MilestoneDrag"===this.taskBarEditAction||t.isMilestone)e.style.setProperty(i,(this.parent.allowTaskbarDragAndDrop?this.leftValue:t.left-a/2)+"px"),y.style.setProperty(i,t.left-a/2+"px"),y.style.width=a+"px";else if("ProgressResizing"===this.taskBarEditAction)if(-1===this.segmentIndex)l.style.setProperty(i,t.left+t.progressWidth-10+"px"),oe.isNullOrUndefined(o)||(o.style.width=t.progressWidth+"px",o.style.borderBottomRightRadius=this.progressBorderRadius+"px",o.style.borderTopRightRadius=this.progressBorderRadius+"px",g=this.parent.enableRtl?t.progressWidth+8:t.progressWidth-8,d.style.setProperty(i,g+"px"));else{this.updateSegmentProgress(this.taskBarEditRecord.ganttProperties);for(var T=e.querySelectorAll(".e-gantt-child-progressbar"),v=0;v<T.length;v++)t.segments[v]&&t.segments[v].progressWidth&&this.segmentIndex!==v&&(T[v].style.display="block",T[v].style.width=t.segments[v].progressWidth+"px");o.style.width=t.segments[this.segmentIndex].progressWidth+"px",o.style.borderBottomRightRadius=this.progressBorderRadius+"px",o.style.borderTopRightRadius=this.progressBorderRadius+"px";c=this.parent.enableRtl?this.progressValue+8:this.progressValue-8;d.style.setProperty(i,c+"px")}else"RightResizing"!==this.taskBarEditAction||oe.isNullOrUndefined(l)?"ParentDrag"===this.taskBarEditAction?(y.style.setProperty(i,t.left+"px"),y.style.width=a+"px",y.style.width=t.width+"px",oe.isNullOrUndefined(p)||(p.style.width=a+"px",y.style.width=t.width+"px"),oe.isNullOrUndefined(o)||oe.isNullOrUndefined(u)||(u.style.width=t.progressWidth+"px")):"ParentResizing"===this.taskBarEditAction?(y.style.width=t.width+"px",y.style.setProperty(i,t.left+"px"),f.style.setProperty("width",t.width+"px"),m.style.setProperty("width",t.width+"px"),this.editElement.parentElement.style.setProperty("width",t.width+"px")):"ManualParentDrag"===this.taskBarEditAction?(y.style.width=t.width+"px",y.style.setProperty(i,t.left+"px"),f.style.setProperty(i,t.left-t.autoLeft+"px"),this.parent.allowTaskbarDragAndDrop&&(f.style.setProperty(i,this.leftValue+"px"),f.style.setProperty("top",this.topValue+"px"),f.style.zIndex="4")):(oe.isNullOrUndefined(l)||s||(l.style.width=t.width+"px",l.style.left=t.left+"px",this.taskBarEditElement.style.width=t.width+"px",this.taskBarEditElement.style.left=(this.parent.allowTaskbarDragAndDrop?this.leftValue:t.left)+"px",y.style.setProperty(i,t.left+"px"),y.style.width=t.width+"px"),oe.isNullOrUndefined(o)||(h.style.setProperty(i,r+"px"),o.style.width=t.progressWidth+"px",oe.isNullOrUndefined(d))||d.style.setProperty(i,t.progressWidth-10+"px"),s&&(h.style.setProperty(i,r+"px"),o.style.width=n.width+"px",oe.isNullOrUndefined(d)||d.style.setProperty(i,n.width-10+"px"))):(y.style.width=a+"px",l.style.width=a+"px",oe.isNullOrUndefined(o)||(o.style.width=t.progressWidth+"px",h.style.setProperty(i,r+"px"),oe.isNullOrUndefined(d))||d.style.setProperty(i,t.progressWidth-10+"px"))}!this.parent.allowTaskbarDragAndDrop||"ChildDrag"!==this.taskBarEditAction&&"ParentDrag"!==this.taskBarEditAction&&"ManualParentDrag"!==this.taskBarEditAction&&"MilestoneDrag"!==this.taskBarEditAction||(g=this.parent.enableRtl?parseInt(y.style.right,10):parseInt(y.style.left,10),this.parent.enableRtl?y.style.right=g-30+"px":y.style.left=g+30+"px")},D.prototype.mouseUpHandler=function(e){var t,i,n,a=this.isMouseDragged;this.previousMouseMove=null,this.leftValue=0,this.previousLeftValue=0,this.editTooltip.showHideTaskbarEditTooltip(!1,this.segmentIndex),this.taskBarEditAction&&this.isMouseDragged&&(!this.dragMouseLeave&&this.taskBarEditedAction||this.parent.allowTaskbarDragAndDrop?("touchmove"===e.type||"touchstart"===e.type||"touchend"===e.type?(n=this.getCoordinate(e),this.droppedTarget=document.elementFromPoint(n.pageX,n.pageY)):(this.taskBarEditRecord.hasChildRecords&&!this.taskBarEditRecord.ganttProperties.isAutoSchedule?(n=this.parent.getOffsetRect(this.taskBarEditElement),t=!oe.isNullOrUndefined(document.body.className)&&document.body.className.includes("e-bigger")?12:0,t=3+this.parent.chartRowsModule.connectorPointWidth+t,i=void 0,i=this.parent.enableRtl?Math.abs(n.left+t+1):Math.abs(Math.abs(n.left-t-1)-this.parent.ganttChartModule.scrollElement.scrollLeft),this.droppedTarget=document.elementFromPoint(i,e.y)):this.droppedTarget=document.elementFromPoint(e.x,e.y),this.droppedTarget&&this.droppedTarget.classList.contains("e-span-label")&&(this.droppedTarget=document.elementFromPoint(e.x+this.droppedTarget.offsetWidth,e.y))),this.previousIds=this.parent.ids.slice(),this.previousFlatData=this.parent.flatData.slice(),this.taskBarEditedAction(e),this.isMouseDragged=!1):(this.parent.isOnEdit=!1,this.cancelTaskbarEditActionInMouseLeave(),n=this.parent.criticalPathModule,this.parent.enableCriticalPath&&n&&n.criticalPathCollection&&n.criticalConnectorLine(n.criticalPathCollection,n.detailPredecessorCollection,!0,n.predecessorCollectionTaskIds))),!this.parent.enableMultiTaskbar||oe.isNullOrUndefined(this.taskBarEditElement)||oe.isNullOrUndefined(this.taskBarEditElement.querySelector(".e-gantt-child-taskbar"))||this.taskBarEditElement.querySelector(".e-gantt-child-taskbar").classList.contains("e-collapsed-taskbar-drag")&&(oe.removeClass([this.taskBarEditElement.querySelector(".e-gantt-child-taskbar")],"e-collapsed-taskbar-drag"),this.taskBarEditElement.style.zIndex=this.prevZIndex,this.prevZIndex=""),this.parent.isAdaptive&&!a||this.initPublicProp(),this.stopScrollTimer()},D.prototype.taskBarEditedAction=function(e){var t={},i=this.mouseDownX,n=this.mouseDownY,a=this.taskBarEditRecord,r=this.parent.ganttChartModule.getIndexByTaskBar(this.taskBarEditElement),s=this.mouseMoveX,e=this.getCoordinate(e).pageY-this.parent.ganttChartModule.chartBodyContainer.offsetTop,o=("ConnectorPointLeftDrag"!==this.taskBarEditAction&&"ConnectorPointRightDrag"!==this.taskBarEditAction||this.drawPredecessor||(this.dependencyCancel=!0),[]);("ConnectorPointLeftDrag"===this.taskBarEditAction||"ConnectorPointRightDrag"===this.taskBarEditAction)&&this.drawPredecessor&&(!this.connectorSecondRecord.hasChildRecords||this.connectorSecondRecord.hasChildRecords&&this.parent.allowParentDependency)?(o.push(oe.extend([],[],[this.taskBarEditRecord],!0)[0]),this.parent.undoRedoModule&&(this.parent.undoRedoModule.getUndoCollection[this.parent.undoRedoModule.getUndoCollection.length-1].connectedRecords=o,this.parent.toolbarModule)&&this.parent.toolbarModule.enableItems([this.parent.controlId+"_undo"],!0),this.parent.connectorLineEditModule.updatePredecessor(this.connectorSecondRecord,this.finalPredecessor)):("ConnectorPointLeftDrag"===this.taskBarEditAction||"ConnectorPointRightDrag"===this.taskBarEditAction||this.oldData&&JSON.stringify(a.ganttProperties)===JSON.stringify(this.oldData.ganttProperties)?this.parent.undoRedoModule&&0<this.parent.undoRedoModule.getUndoCollection.length&&(this.parent.totalUndoAction--,this.parent.undoRedoModule.getUndoCollection.splice(this.parent.undoRedoModule.getUndoCollection.length-1,1),this.parent.toolbarModule)&&this.parent.toolbarModule.enableItems([this.parent.controlId+"_undo"],!1):this.parent.undoRedoModule&&this.parent.toolbarModule&&0<this.parent.undoRedoModule.getUndoCollection.length&&this.parent.toolbarModule.enableItems([this.parent.controlId+"_undo"],!0),(i!==s||Math.abs(n-e)>=(this.parent.rowHeight-this.parent.taskbarHeight)/2)&&null!==a&&(t.editingFields=a.ganttProperties,t.data=a,t.recordIndex=r,t.previousData=this.previousItem,t.taskBarEditAction=this.taskBarEditAction,t.action="TaskbarEditing",t.roundOffDuration=this.roundOffDuration,t.target=this.targetElement,this.taskbarEditedArgs=t,this.taskbarEdited(t))),this.parent.isProjectDateUpdated=!1},D.prototype.cancelTaskbarEditActionInMouseLeave=function(){this.parent.editModule.reUpdatePreviousRecords(!0)},D.prototype.updateSegmentProgress=function(e){for(var t=e.segments,i=!0,n=this.splitTasksDuration(t)*this.parent.perDayWidth,a=s=n*Math.ceil(e.progressWidth/n*100)/100,r=0;r<t.length;r++){var s,o=t[r];0!==r&&(s=o.left<=a?a-o.left:0),delete o.progressWidth,0<s&&s>o.width?(s-=o.width,o.progressWidth=o.width,o.showProgress=!1):i&&(o.progressWidth=s,o.showProgress=!0,s-=o.width,i=!1)}},D.prototype.taskbarEdited=function(e){var e=oe.extend({},e),t=e.data,i=t.ganttProperties,n=this.parent.flatData.indexOf(t);if((this.parent.allowTaskbarDragAndDrop&&"ChildDrag"===this.taskBarEditAction||"ParentDrag"===this.taskBarEditAction||"MilestoneDrag"===this.taskBarEditAction||"ManualParentDrag"===this.taskBarEditAction)&&0<this.dragMoveY&&("ResourceView"===this.parent.viewType&&!t.hasChildRecords||"ProjectView"===this.parent.viewType)&&(this.parent.rowDragAndDropModule&&(o=this.parent.currentViewData,this.taskBarEditRecord.parentItem&&o[this.taskBarEditRecord.parentItem.index]&&-1===this.parent.editedRecords.indexOf(o[this.taskBarEditRecord.parentItem.index])&&this.parent.editedRecords.push(o[this.taskBarEditRecord.parentItem.index]),this.removeChildBorder(),this.removeErrorElem(),h=void this.removetopOrBottomBorder(),this.updatePosition=!1,l=void(this.draggedRecordMarginTop=this.taskBarEditElement.style.marginTop),(l=oe.isNullOrUndefined(this.droppedTarget)?l:oe.closest(this.droppedTarget,"tr."+xe))&&(h=o[o=Array.from(this.parent.ganttChartModule.getChartRows()).indexOf(l)],l=this.parent.getRootParent(h,0).index,d=this.parent.getRootParent(this.taskBarEditRecord,0).index,s={cancel:!1,data:this.taskBarEditRecord,fromIndex:this.taskBarEditRecord.index,dropIndex:h.index,dropPosition:this.parent.rowDragAndDropModule.dropPosition,dropRecord:h},this.parent.trigger("rowDrop",s),!s.cancel)&&h&&o!==n&&(l!==d||this.taskBarEditRecord.hasChildRecords&&h.hasChildRecords||!this.taskBarEditRecord.hasChildRecords)&&(s=this.parent.flatData.indexOf(h),o=void 0,o=("ProjectView"!==this.parent.viewType||oe.isNullOrUndefined(this.parent.rowDragAndDropModule.dropPosition))&&(h.hasChildRecords||!h.parentItem&&0===h.childRecords.length)?"child":this.parent.rowDragAndDropModule.dropPosition,this.parent.rowDragAndDropModule&&("ResourceView"!==this.parent.viewType||"child"!==o||h.hasChildRecords||oe.isNullOrUndefined(h.parentItem)||(this.parent.rowDragAndDropModule.dropPosition=o="Invalid"),o)&&this.parent.rowDragAndDropModule.reorderRows([n],s,o),this.dragMoveY=0),this.isClonedElement=!1),this.parent.showOverAllocation)&&this.parent.ganttChartModule.renderOverAllocationContainer(),"ProgressResizing"===e.taskBarEditAction)e.previousData.progress!==i.progress&&(l=e.data.ganttProperties.progressWidth,d=e.data.ganttProperties.width,h=this.validateProgressWidth(e.data.ganttProperties,l,d),this.parent.setRecordValue("progress",this.getProgressPercent(h.totalTaskWidth,h.progressWidth),i,!0),t.parentItem&&this.parent.editModule.updateParentProgress(t.parentItem),oe.isNullOrUndefined(i.segments)||this.updateSegmentProgress(i));else{var a=e.data.ganttProperties.segments;if(!oe.isNullOrUndefined(a)&&0<a.length&&("LeftResizing"===this.taskBarEditAction&&0!==this.segmentIndex||"ChildDrag"===this.taskBarEditAction&&0!==this.segmentIndex||"RightResizing"===this.taskBarEditAction)){var n=a[this.segmentIndex],r=this.taskBarEditRecord.ganttProperties,s=0===this.segmentIndex?null:a[this.segmentIndex-1],o=this.segmentIndex===a.length-1?null:a[this.segmentIndex+1],l=oe.isNullOrUndefined(o)?this.parent.cloneProjectEndDate:new Date(o.startDate.getTime()),d=oe.isNullOrUndefined(s)?this.parent.cloneProjectStartDate:new Date(s.endDate.getTime()),h=new Date(n.startDate.getTime()),p=new Date(n.endDate.getTime());if("Day"===this.parent.timelineModule.topTier&&"Hour"===this.parent.timelineModule.bottomTier?(h.setHours(h.getHours()-1),p.setHours(p.getHours()+1)):(h.setDate(h.getDate()),p.setDate(p.getDate())),this.parent.includeWeekend){if(l.setHours(0,0,0,0),d.setHours(0,0,0,0),h.setDate(h.getDate()-1),p.setDate(p.getDate()+1),h.setHours(0,0,0,0),p.setHours(0,0,0,0),h.getTime()<=d.getTime()&&!oe.isNullOrUndefined(s)&&!oe.isNullOrUndefined(n)){var u=[{firstSegmentIndex:s.segmentIndex,secondSegmentIndex:n.segmentIndex}];this.parent.chartRowsModule.mergeTask(r.taskId,u)}else if(p.getTime()>=l.getTime()&&this.segmentIndex!==a.length-1){var u=[{firstSegmentIndex:n.segmentIndex,secondSegmentIndex:o.segmentIndex}];this.parent.chartRowsModule.mergeTask(r.taskId,u)}else if(p.getTime()>=l.getTime()){n.endDate.setDate(this.parent.cloneProjectEndDate.getDate()-1),n.startDate=this.parent.dataOperation.getStartDate(n.endDate,n.duration,r.durationUnit,r);for(var c=a.length-2;0<=c;c--){var g,f=Dn({},a[c]);oe.isNullOrUndefined(f)||((g=new Date(f.endDate)).setDate(g.getDate()-f.offsetDuration),f.endDate=g,f.startDate=this.parent.dataOperation.getStartDate(f.endDate,f.duration,r.durationUnit,r))}}}else p.getTime()<=l.getTime()&&this.segmentIndex!==a.length-1&&!this.parent.includeWeekend&&0===this.parent.dataOperation.getDuration(this.parent.dataOperation.checkStartDate(p,i,!1),l,i.durationUnit,!1,!1)?(u=[{firstSegmentIndex:n.segmentIndex,secondSegmentIndex:o.segmentIndex}],this.parent.chartRowsModule.mergeTask(r.taskId,u)):h.getTime()>=d.getTime()&&!oe.isNullOrUndefined(s)&&!oe.isNullOrUndefined(n)&&!this.parent.includeWeekend&&0===this.parent.dataOperation.getDuration(this.parent.dataOperation.checkEndDate(h,i,!1),d,i.durationUnit,!1,!1)&&(u=[{firstSegmentIndex:s.segmentIndex,secondSegmentIndex:n.segmentIndex}],this.parent.chartRowsModule.mergeTask(r.taskId,u))}this.parent.dataOperation.updateWidthLeft(e.data)}this.isDragged=!1,this.parent.dataOperation.updateTaskData(t),this.parent.editModule.initiateUpdateAction(e)},D.prototype.getProgressPercent=function(e,t){return Math.ceil(t/e*100)},D.prototype.drawFalseLine=function(){var e,t=this.mouseDownX,i=this.mouseDownY,n=this.mouseMoveX,a=this.mouseMoveY,r=Math.sqrt((t-n)*(t-n)+(i-a)*(i-a)),a=180*Math.atan2(a-i,n-t)/Math.PI,i="rotate("+(this.parent.enableRtl?-a:a)+"deg)",n=0,t=(oe.isNullOrUndefined(document.querySelectorAll(".e-chart-row")[0])||(n=document.querySelectorAll(".e-chart-row")[0].offsetWidth),"ConnectorPointLeftDrag"===this.taskBarEditAction&&(e=this.parent.enableRtl?n-(this.elementOffsetLeft+this.parent.chartRowsModule.connectorPointWidth/2)-Math.abs(this.parent.ganttChartModule.scrollObject.previousScroll.left):this.elementOffsetLeft-this.parent.chartRowsModule.connectorPointWidth/2-this.parent.ganttChartModule.scrollObject.previousScroll.left),"ConnectorPointRightDrag"===this.taskBarEditAction&&(e=this.parent.enableRtl?n-(this.elementOffsetLeft+this.elementOffsetWidth+this.parent.chartRowsModule.connectorPointWidth/2)-Math.abs(this.parent.ganttChartModule.scrollObject.previousScroll.left):this.elementOffsetLeft+this.elementOffsetWidth+this.parent.chartRowsModule.connectorPointWidth/2-Math.abs(this.parent.ganttChartModule.scrollObject.previousScroll.left)),this.elementOffsetTop+this.elementOffsetHeight/2+this.parent.ganttChartModule.chartBodyContainer.offsetTop-this.parent.ganttChartModule.scrollObject.previousScroll.top);this.removeFalseLine(!1),this.falseLine=oe.createElement("div",{className:"e-gantt-false-line",id:"ganttfalseline"+this.parent.element.id,styles:"position: absolute;transform:"+i+";border-top-width: 1px;border-top-style: dashed;z-index: 5;width:"+(r-3)+"px;top:"+t+"px;"}),this.parent.enableRtl?(this.falseLine.style.left="auto",this.falseLine.style.right=e+"px",this.falseLine.style.transformOrigin="100% 0%"):(this.falseLine.style.right="auto",this.falseLine.style.left=e+"px",this.falseLine.style.transformOrigin="0% 100%"),this.parent.ganttChartModule.chartBodyContainer.appendChild(this.falseLine)},D.prototype.removeFalseLine=function(e){this.falseLine&&(oe.remove(this.falseLine),this.falseLine=null,e)&&(this.elementOffsetLeft=0,this.elementOffsetTop=0,this.elementOffsetWidth=0,this.elementOffsetHeight=0,oe.removeClass(this.parent.ganttChartModule.scrollElement.querySelectorAll("."+et),[rt]))},D.prototype.updateConnectorLineSecondProperties=function(e){var e=this.getElementByPosition(e),t=P(e,S),i=document.body.className.includes("e-bigger"),n=(this.connectorSecondAction=null,0);P(e,st)?(this.connectorSecondAction="ConnectorPointLeftDrag",this.toPredecessorText="Start"):P(e,ot)?(this.connectorSecondAction="ConnectorPointRightDrag",this.toPredecessorText="Finish"):(this.connectorSecondAction=null,this.toPredecessorText=null),this.taskBarEditElement!==t&&this.taskBarEditElement!==this.highlightedSecondElement&&(this.parent.virtualScrollModule&&this.parent.enableVirtualization&&(n=this.parent.virtualScrollModule.getTopPosition()),(this.parent.virtualScrollModule&&this.parent.enableVirtualization&&!this.elementOffsetLeft||!this.parent.enableVirtualization)&&(this.parent.allowParentDependency&&this.taskBarEditElement.children[0].classList.contains("e-manualparent-main-container")?(this.elementOffsetLeft=this.realTaskbarElement.children[0].offsetLeft+this.realTaskbarElement.offsetLeft-(i?10:0),this.elementOffsetTop=this.realTaskbarElement.parentElement.offsetTop+this.realTaskbarElement.offsetHeight/3-5+this.taskBarEditElement.children[0].offsetTop+n):(this.elementOffsetLeft=this.realTaskbarElement.offsetLeft-(i?10:0),this.elementOffsetTop=this.realTaskbarElement.parentElement.offsetTop+this.realTaskbarElement.offsetHeight/3+n),this.elementOffsetWidth=this.realTaskbarElement.offsetWidth+(i?20:0),this.elementOffsetHeight=this.realTaskbarElement.offsetHeight),this.showHideTaskBarEditingElements(t,this.highlightedSecondElement,!0)),oe.isNullOrUndefined(this.connectorSecondAction)&&!oe.isNullOrUndefined(this.connectorSecondElement)&&(!this.connectorSecondRecord.hasChildRecords||this.connectorSecondRecord.hasChildRecords&&this.parent.allowParentDependency)&&(this.editTooltip.showHideTaskbarEditTooltip(!1,this.segmentIndex),oe.removeClass([this.connectorSecondElement.querySelector("."+st)],[pt]),oe.removeClass([this.connectorSecondElement.querySelector("."+ot)],[pt])),this.connectorSecondElement=this.connectorSecondAction?t:null,this.highlightedSecondElement=t,this.connectorSecondRecord=oe.isNullOrUndefined(this.connectorSecondElement)?null:this.parent.ganttChartModule.getRecordByTaskBar(this.connectorSecondElement)},D.prototype.triggerDependencyEvent=function(e,t){var i,n,a,r,s=this.parent.element.closest('[style*="zoom"]'),s=(s&&(s=parseFloat(getComputedStyle(s).zoom),i=e.pageY/s),this.taskBarEditRecord.ganttProperties),o=this.connectorSecondRecord?this.connectorSecondRecord.ganttProperties:null,l=this.getElementByPosition(e),d=l,h="ResourceView"===this.parent.viewType?s.taskId:s.rowUniqueID;"ConnectorPointLeftDrag"===this.taskBarEditAction?r=h+(this.parent.enableRtl?"F":"S"):"ConnectorPointRightDrag"===this.taskBarEditAction&&(r=h+(this.parent.enableRtl?"S":"F")),this.connectorSecondAction&&("ConnectorPointLeftDrag"===this.connectorSecondAction?(r+=this.parent.enableRtl?"F":"S",n=this.parent.enableRtl?"finish":"start"):"ConnectorPointRightDrag"===this.connectorSecondAction&&(r+=this.parent.enableRtl?"S":"F",n=this.parent.enableRtl?"start":"finish")),oe.isNullOrUndefined(o)?this.drawPredecessor=!1:(o.predecessorsName?this.finalPredecessor=o.predecessorsName+","+r:this.finalPredecessor=r,h=this.parent.connectorLineEditModule.validatePredecessorRelation(this.connectorSecondRecord,this.finalPredecessor),r=this.parent.predecessorModule.calculatePredecessor(r,this.connectorSecondRecord),(a={}).fromItem=s,a.toItem=o,a.newPredecessorString=this.finalPredecessor,a.predecessor=r&&r[0],a.isValidLink=h,a.requestType="ValidateDependency",this.parent.trigger("actionBegin",a),oe.isNullOrUndefined(this.parent.loadingIndicator)||"Shimmer"!==this.parent.loadingIndicator.indicatorType||"ValidateDependency"===a.requestType?"ValidateDependency"!==a.requestType&&this.parent.showSpinner():this.parent.showMaskRow(),a.isValidLink=!(!h&&a.isValidLink)&&a.isValidLink,a.isValidLink?(this.editTooltip.toolTipObj||this.parent.isAdaptive||this.editTooltip.showHideTaskbarEditTooltip(!0,this.segmentIndex),oe.isNullOrUndefined(this.editTooltip.toolTipObj)||(this.parent.connectorLineModule.tooltipTable.innerHTML="",this.parent.connectorLineModule.tooltipTable.appendChild(this.parent.connectorLineModule.getConnectorLineTooltipInnerTd(this.parent.editModule.taskbarEditModule.taskBarEditRecord.ganttProperties.taskName,this.parent.editModule.taskbarEditModule.fromPredecessorText,"","")),(s=this.parent.connectorLineModule.tooltipTable.querySelector("#toPredecessor").querySelectorAll("td"))[1].innerText=o.taskName,s[2].innerText=this.parent.localeObj.getConstant(n),oe.isNullOrUndefined(this.parent.connectorLineModule.tooltipTable.parentElement))||oe.isNullOrUndefined(this.parent.connectorLineModule.tooltipTable.parentElement.parentElement)||(r=this.parent.connectorLineModule.tooltipTable.parentElement.parentElement).offsetTop+r.offsetHeight>i&&(r.style.top=e.pageY-r.offsetHeight-20+"px"),this.drawPredecessor=!0):(this.parent.isAdaptive?(l.classList.contains(st)||l.classList.contains(ot))&&this.showHideActivePredecessors(!0):oe.addClass([d],[pt]),this.drawPredecessor=!1))},D.prototype.getCoordinate=function(e){var t={},i=e;return t.pageX=i.pageX,t.pageY=i.pageY,!e||"click"===e.type||"touchmove"!==(i=e).type&&"touchstart"!==i.type&&"touchend"!==i.type||(t.pageX=i.changedTouches[0].pageX,t.pageY=i.changedTouches[0].pageY),t},D.prototype.getElementByPosition=function(e){var t;return this.parent.isAdaptive?(t=this.getCoordinate(e),document.elementFromPoint(t.pageX-window.pageXOffset,t.pageY-window.pageYOffset)):e.target},D.prototype.multipleSelectionEnabled=function(){this.parent.selectionModule&&"Cell"!==this.parent.selectionSettings.mode&&"Multiple"===this.parent.selectionSettings.type&&this.parent.selectionModule.hidePopUp()},D.prototype.unWireEvents=function(){this.parent.isDestroyed||(this.parent.off("chartMouseDown",this.mouseDownHandler),this.parent.off("chartMouseUp",this.mouseUpHandler),this.parent.off("chartMouseLeave",this.mouseLeaveHandler),this.parent.off("chartMouseMove",this.mouseMoveAction),this.parent.off("chartMouseClick",this.mouseClickHandler))},D.prototype.destroy=function(){this.unWireEvents(),this.stopScrollTimer(),this.parent.editModule.taskbarEditModule=void 0},D);function D(e){var t=yn.call(this,e)||this;return t.leftValue=0,t.previousLeftValue=0,t.isMouseDragged=!1,t.dependencyCancel=!1,t.isDragged=!1,t.editElement=null,t.elementOffsetLeft=0,t.elementOffsetTop=0,t.elementOffsetWidth=0,t.elementOffsetHeight=0,t.segmentIndex=-1,t.currentItemTop=0,t.currentItemPrevTop=0,t.topValue=0,t.draggedRecordMarginTop="0px",t.isClonedElement=!1,t.updatePosition=!1,t.tooltipValue=0,t.parent=e,t.initPublicProp(),t.wireEvents(),t.editTooltip=new gn(t.parent,t),t}var wn=function(){return(wn=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var a in t=arguments[i])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},bn=(w.prototype.wireEvents=function(){this.parent.on("chartDblClick",this.dblClickHandler,this)},w.prototype.dblClickHandler=function(e){e=this.parent.ganttChartModule.getRecordByTarget(e);!oe.isNullOrUndefined(e)&&this.parent.editModule&&this.parent.editSettings.allowEditing&&this.openEditDialog(e)},w.prototype.processDialogFields=function(){oe.isNullOrUndefined(this.parent.editDialogFields)||this.parent.editDialogFields&&0===this.parent.editDialogFields.length?(this.updatedEditFields=this.getDefaultDialogFields(),this.updatedEditFields=this.validateDialogFields(this.updatedEditFields)):this.updatedEditFields=this.validateDialogFields(this.parent.editDialogFields),oe.isNullOrUndefined(this.parent.addDialogFields)||this.parent.addDialogFields&&0===this.parent.addDialogFields.length?(this.updatedAddFields=this.getDefaultDialogFields(),this.updatedAddFields=this.validateDialogFields(this.updatedAddFields)):this.updatedAddFields=this.validateDialogFields(this.parent.addDialogFields)},w.prototype.validateDialogFields=function(e){for(var t=[],i=0,n=0;n<e.length;n++){var a=b.getActualProperties(e[n]);"General"!==a.type||!oe.isNullOrUndefined(a.fields)&&0!==a.fields.length||(a.fields=this.getGeneralColumnFields()),"Dependency"===a.type&&oe.isNullOrUndefined(this.parent.taskFields.dependency)||"Resources"===a.type&&oe.isNullOrUndefined(this.parent.taskFields.resourceInfo)||"Notes"===a.type&&oe.isNullOrUndefined(this.parent.taskFields.notes)||("Custom"!==a.type||!oe.isNullOrUndefined(a.fields)&&0!==a.fields.length||(i+=1,a.fields=this.getCustomColumnFields()),1<i)||t.push(a)}return t},w.prototype.getGeneralColumnFields=function(){for(var e=[],t=0,i=Object.keys(this.parent.columnMapping);t<i.length;t++){var n=i[t];"dependency"!==n&&"resourceInfo"!==n&&"notes"!==n&&e.push(this.parent.columnMapping[n])}return e},w.prototype.getCustomColumnFields=function(){for(var e=[],t=0;t<this.parent.customColumns.length;t++)e.push(this.parent.customColumns[t]);return e},w.prototype.getDefaultDialogFields=function(){var e=[],t={},i=this.parent.taskFields,n=this.parent.columnMapping;return 0!==Object.keys(n).length&&(t.type="General",e.push(t)),oe.isNullOrUndefined(oe.getValue("dependency",n))||(!(t={})!==this.parent.columnByField[n.dependency.valueOf()].visible&&(t.type="Dependency"),e.push(t)),oe.isNullOrUndefined(oe.getValue("resourceInfo",n))||(!(t={})!==this.parent.columnByField[n.resourceInfo.valueOf()].visible&&(t.type="Resources"),e.push(t)),oe.isNullOrUndefined(oe.getValue("notes",n))||(!(t={})!==this.parent.columnByField[n.notes.valueOf()].visible&&(t.type="Notes"),e.push(t)),oe.isNullOrUndefined(oe.getValue("segments",i))||e.push(t={type:"Segments"}),0<this.parent.customColumns.length&&e.push(t={type:"Custom"}),e},w.prototype.openAddDialog=function(){this.isEdit=!1,this.editedRecord=this.composeAddRecord(),this.isFromAddDialog=!0,this.createDialog()},w.prototype.getMinimumStartDate=function(){var e=y.DataUtil.aggregates.min(this.parent.flatData,"ganttProperties.startDate"),e=oe.isNullOrUndefined(e)?new Date(this.parent.timelineModule.timelineStartDate.getTime()):new Date(e.getTime());return e=this.parent.dateValidationModule.checkStartDate(e),new Date(e.getTime())},w.prototype.composeAddRecord=function(){for(var e={ganttProperties:{}},t=this.parent.ganttColumns,i=this.parent.taskFields,n=this.parent.editModule.getNewTaskId(),a=0;a<t.length;a++){var r=t[a].field;r===i.id?(e[r]=n,e.ganttProperties.rowUniqueID=e[r]):t[a].field===i.startDate?(oe.isNullOrUndefined(e[i.endDate])?e[r]=this.getMinimumStartDate():e[r]=new Date(e[i.endDate]),this.parent.timezone&&(e[r]=this.parent.dateValidationModule.remove(e[r],this.parent.timezone)),e.ganttProperties.startDate=new Date(e[r])):t[a].field===i.endDate?(oe.isNullOrUndefined(e[i.startDate])?e[r]=this.getMinimumStartDate():e[r]=new Date(e[i.startDate]),this.parent.timezone&&(e[r]=this.parent.dateValidationModule.remove(e[r],this.parent.timezone)),e.ganttProperties.endDate=new Date(e[r])):t[a].field===i.duration?(e[r]=1,e.ganttProperties.duration=e[r],e.ganttProperties.durationUnit=this.parent.durationUnit.toLocaleLowerCase()):t[a].field===i.name?(e[r]=this.localeObj.getConstant("addDialogTitle")+" "+n,e.ganttProperties.taskName=e[r]):t[a].field===i.progress?(e[r]=0,e.ganttProperties.progress=e[r]):t[a].field===i.work?(e[r]=0,e.ganttProperties.work=e[r]):t[a].field===i.type?(e[r]=this.parent.taskType,e.ganttProperties.taskType=e[r]):e[this.parent.ganttColumns[a].field]=""}return e.ganttProperties.isAutoSchedule="Auto"===this.parent.taskMode||"Manual"!==this.parent.taskMode&&!0!==e[i.manual],e},w.prototype.openToolbarEditDialog=function(){var e=this.parent;e.editModule&&e.editSettings.allowEditing&&(-1<this.parent.ganttChartModule.focusedRowIndex&&e.selectionModule&&e.selectionModule.selectRow(this.parent.ganttChartModule.focusedRowIndex,!1,!1),e=e.selectionModule?"Row"!==e.selectionSettings.mode&&"Both"!==e.selectionSettings.mode||1!==e.selectionModule.selectedRowIndexes.length?"Cell"===e.selectionSettings.mode&&1===e.selectionModule.getSelectedRowCellIndexes().length?e.updatedRecords[e.selectionModule.getSelectedRowCellIndexes()[0].rowIndex].ganttProperties.rowUniqueID:null:e.updatedRecords[e.selectionModule.selectedRowIndexes[0]].ganttProperties.rowUniqueID:null,oe.isNullOrUndefined(e)||this.openEditDialog(e))},w.prototype.openEditDialog=function(e){var t=this.parent;oe.isNullOrUndefined(e)||(oe.isNullOrUndefined(e.ganttProperties)||("string"==typeof e.ganttProperties.taskId?this.numericOrString="stringedit":this.numericOrString="numericedit"),oe.isNullOrUndefined(e.ganttProperties)&&!oe.isNullOrUndefined(e)&&(isNaN(Number(e))||"stringedit"===this.parent.columnByField[this.parent.taskFields.id].editType?this.numericOrString="stringedit":this.numericOrString="numericedit")),"object"!=typeof e||oe.isNullOrUndefined(e)?oe.isNullOrUndefined(e)?-1<t.selectedRowIndex&&(this.rowData=t.currentViewData[t.selectedRowIndex],this.rowIndex=t.selectedRowIndex):(this.rowIndex=t.ids.indexOf(e.toString()),-1<this.rowIndex&&(this.rowData=t.flatData[this.rowIndex])):(this.rowIndex=this.parent.currentViewData.indexOf(e),-1<this.rowIndex&&(this.rowData=e)),this.isEdit=!0,"ResourceView"===this.parent.viewType&&0===this.rowData.level||0!==Object.keys(this.rowData).length&&(this.editedRecord=oe.extend({},{},this.rowData,!0),this.isFromEditDialog=!0,this.createDialog())},w.prototype.createDialog=function(){var i=this,e=this.parent,t={},n=(this.beforeOpenArgs.dialogModel=t,this.beforeOpenArgs.rowData=this.editedRecord,this.beforeOpenArgs.rowIndex=this.rowIndex,this.parent.isAdaptive?"":"600px"),n=this.parent.createElement("div",{id:e.element.id+"_dialog",styles:"max-width:"+n}),e=(n.classList.add("e-gantt-dialog"),e.element.appendChild(n),t.animationSettings={effect:"None"},t.header=this.localeObj.getConstant(this.isEdit?"editDialogTitle":"addDialogTitle"),t.isModal=!0,t.enableRtl=this.parent.enableRtl,t.allowDragging=!this.parent.isAdaptive&&!this.parent.enableAdaptiveUI,t.showCloseIcon=!0,this.parent.isAdaptive?{X:"top",Y:"left"}:{X:"center",Y:"center"});t.position=e,t.height=this.parent.isAdaptive?"100%":"auto",t.target=document.body,t.close=this.dialogClose.bind(this),t.closeOnEscape=!0,t.beforeClose=function(e){"escape"===e.closedBy&&"key-pressed"===e.event.name&&"INPUT"===e.event.target.nodeName&&(e.cancel=!0)},t.open=function(e){var e=oe.getValue("element",e),t=e.querySelector("#"+i.parent.element.id+"GeneralTabContainer");t&&t.scrollHeight>t.offsetHeight&&t.classList.add("e-scroll"),0===i.tabObj.selectedItem&&i.tabObj.select(0),i.parent.isAdaptive&&(e.style.maxHeight="none"),i.parent.focusModule&&i.parent.focusModule.setActiveElement(e)},t.locale=this.parent.locale,t.buttons=[{buttonModel:{content:this.localeObj.getConstant("saveButton"),cssClass:"e-primary"},click:this.buttonClick.bind(this)},{buttonModel:{cssClass:"e-flat",content:this.localeObj.getConstant("cancel")},click:this.buttonClick.bind(this)}],this.createTab(t,n)},w.prototype.buttonClick=function(e){var t=e.target;if(t.style.pointerEvents="none",this.localeObj.getConstant("cancel").toLowerCase()===e.target.innerText.trim().toLowerCase())this.dialog&&!this.dialogObj.isDestroyed&&(this.CustomformObj=null,this.formObj=null,this.storeValidTab=null,this.customFieldColumn=[],this.taskFieldColumn=[],this.dialogObj.hide(),this.dialogClose());else if(this.CustomformObj&&!this.CustomformObj.validate())t.style.pointerEvents="";else{if(this.formObj)if(!this.formObj.validate())return void(t.style.pointerEvents="");if(this.storeDependencyTab||"Dependency"===this.firstOccuringTab){var i=void 0;if(i=("Dependency"===this.firstOccuringTab?e.target.closest("#"+this.parent.element.id+"_dialog"):this.storeDependencyTab).querySelector(".e-gridform"))if(!i.ej2_instances[0].validate())return void(t.style.pointerEvents="")}if(this.storeResourceTab||"Resources"===this.firstOccuringTab){i=void 0;if(i=("Resources"===this.firstOccuringTab?e.target.closest("#"+this.parent.element.id+"_dialog"):this.storeResourceTab).querySelector(".e-gridform"))if(!i.ej2_instances[0].validate())return void(t.style.pointerEvents="")}this.initiateDialogSave(),this.parent.updateDuration=!1,this.CustomformObj=null,this.formObj=null,this.storeValidTab=null,this.customFieldColumn=[],this.taskFieldColumn=[],t.style.pointerEvents="auto"}},w.prototype.dialogClose=function(){this.dialog&&this.resetValues(),oe.isNullOrUndefined(this.parent.focusModule)||oe.isNullOrUndefined(this.parent.focusModule.getActiveElement(!0))||this.parent.focusModule.getActiveElement(!0).focus()},w.prototype.resetValues=function(){this.isEdit=!1,this.isAddNewResource=!1,this.editedRecord={},this.parent.triggeredColumnName="",this.rowData={},this.rowIndex=-1,this.addedRecord=null,this.ganttResources=[],this.dialogEditValidationFlag=!1,this.isFromAddDialog=!1,this.isFromEditDialog=!1,this.parent.dataOperation.isDurationValueUpdated=!1,this.dialog&&!this.dialogObj.isDestroyed&&(this.destroyDialogInnerElements(),this.dialogObj.destroy(),oe.remove(this.dialog))},w.prototype.destroyDialogInnerElements=function(){for(var e=this.parent,t=this.beforeOpenArgs.tabModel.items,i=0;i<t.length;i++){var n=t[i].content,a=n.getAttribute("id");oe.isNullOrUndefined(a)&&""===a||("General"===(a=(a=a.replace(e.element.id,"")).replace("TabContainer",""))?this.destroyCustomField(n):"Dependency"===a||"Notes"===a||"Resources"===a?n.ej2_instances[0].destroy():-1!==a.indexOf("Custom")&&this.destroyCustomField(n))}},w.prototype.destroyCustomField=function(e){for(var t=e.childNodes,i=this.parent,n=0;n<t.length;n++){var a=t[n],r=a.querySelector('input[id^="'+i.element.id+'"]');r&&(r=r.id.replace(i.element.id,""),a=a.querySelector("#"+i.element.id+r).ej2_instances[0],oe.isNullOrUndefined(a)||(r=i.columnByField[r],oe.isNullOrUndefined(r)||oe.isNullOrUndefined(r.edit)||!oe.isNullOrUndefined(r.edit.params)?a.destroy():"string"==typeof(a=r.edit.destroy)?(a=b.getObject(a,window))():r.edit.destroy()))}},w.prototype.destroy=function(){this.resetValues(),this.parent.isDestroyed||(this.parent.off("chartDblClick",this.dblClickHandler),this.parent.editModule.dialogModule=void 0)},w.prototype.getEditFields=function(){return this.isEdit?this.updatedEditFields:this.updatedAddFields},w.prototype.createTab=function(t,i){var n,a=this,r=this.parent,s={},e=[],o=this.getEditFields(),l=r.taskFields,d=o.length,h=(s.items=e,s.locale=this.parent.locale,s.enableRtl=this.parent.enableRtl,this.beforeOpenArgs.tabModel=s,0);if(0<d)for(var p=0;p<d;p++){var u=o[p],c={};if("General"===u.type){if(0===Object.keys(r.columnMapping).length)continue;oe.isNullOrUndefined(u.headerText)&&(u.headerText=this.localeObj.getConstant("generalTab")),c.content="General",this.beforeOpenArgs[c.content]=this.getFieldsModel(u.fields)}else if("Segments"===u.type){if(oe.isNullOrUndefined(l.segments))continue;oe.isNullOrUndefined(u.headerText)&&(u.headerText=this.localeObj.getConstant("segments")),c.content="Segments",this.beforeOpenArgs[c.content]=this.getSegmentsModel(u.fields)}else if("Dependency"===u.type){if(oe.isNullOrUndefined(l.dependency))continue;oe.isNullOrUndefined(u.headerText)&&(u.headerText=this.localeObj.getConstant("dependency")),c.content="Dependency",this.beforeOpenArgs[c.content]=this.getPredecessorModel(u.fields)}else if("Resources"===u.type){if(oe.isNullOrUndefined(l.resourceInfo))continue;oe.isNullOrUndefined(u.headerText)&&(u.headerText=this.localeObj.getConstant("resourceName")),c.content="Resources",this.beforeOpenArgs[c.content]=this.getResourcesModel(u.fields)}else if("Notes"===u.type){if(oe.isNullOrUndefined(l.notes))continue;oe.isNullOrUndefined(u.headerText)&&(u.headerText=this.localeObj.getConstant("notes")),c.content="Notes",this.beforeOpenArgs[c.content]=this.getNotesModel(u.fields)}else{if(oe.isNullOrUndefined(u.fields)||0===u.fields.length)continue;oe.isNullOrUndefined(u.headerText)&&(u.headerText=this.localeObj.getConstant("customTab")),c.content="Custom"+h++,this.beforeOpenArgs[c.content]=this.getFieldsModel(u.fields)}c.header={text:u.headerText},e.push(c)}this.beforeOpenArgs.requestType=this.isEdit?"beforeOpenEditDialog":"beforeOpenAddDialog",this.parent.trigger("actionBegin",this.beforeOpenArgs,function(e){e.cancel?(e.cancel=!1,oe.isNullOrUndefined(a.parent.loadingIndicator)||"Shimmer"!==a.parent.loadingIndicator.indicatorType?a.parent.hideSpinner():a.parent.hideMaskRow()):(oe.isNullOrUndefined(a.parent.loadingIndicator)||"Shimmer"!==a.parent.loadingIndicator.indicatorType?a.parent.showSpinner():a.parent.showMaskRow(),a.renderTabItems(),s.selected=a.tabSelectedEvent.bind(a),s.height=a.parent.isAdaptive?"100%":"auto",s.overflowMode="Scrollable",a.tabObj=new V.Tab(s),a.tabObj.isStringTemplate=!0,n=a.parent.createElement("div",{id:r.element.id+"_Tab"}),a.tabObj.appendTo(n),t.content=n,a.dialog=i,a.dialogObj=new U.Dialog(t),a.dialogObj.isStringTemplate=!0,a.dialogObj.appendTo(a.dialog),e={action:"OpenDialog",requestType:a.isEdit?"openEditDialog":"openAddDialog",data:a.beforeOpenArgs.rowData,element:a.dialog,cancel:!1},a.parent.treeGrid.grid.getColumns().some(function(e){return e.validationRules})&&(a.CustomformObj=null,a.formObj=null,a.storeValidTab=null,a.customFieldColumn=[],a.taskFieldColumn=[],a.changeFormObj(e.element)),a.parent.trigger("actionComplete",e,function(e){oe.isNullOrUndefined(a.parent.loadingIndicator)||"Shimmer"!==a.parent.loadingIndicator.indicatorType?a.parent.hideSpinner():a.parent.hideMaskRow(),e.cancel&&a.resetValues()}))})},w.prototype.changeFormObj=function(e){var t;if(this.storeColumn||(this.storeColumn=this.parent.treeGrid.grid.getColumns()),this.taskfields||(this.taskfields=this.parent.taskFields.properties),this.storeValidTab||(this.storeValidTab=this.getFilteredDialogFields()),0!==this.customFieldColumn.length&&0!==this.taskFieldColumn.length||this.validateColumn(this.storeColumn,this.taskfields,this.storeValidTab),this.isFromAddDialog&&this.parent.addDialogFields&&0<this.parent.addDialogFields.length?"Resources"!==(t=this.parent.addDialogFields[0].type)&&"Dependency"!==t||(this.firstOccuringTab=t):this.isFromEditDialog&&this.parent.editDialogFields&&0<this.parent.editDialogFields.length&&("Resources"!==(t=this.parent.editDialogFields[0].type)&&"Dependency"!==t||(this.firstOccuringTab=t)),!this.CustomformObj||!this.formObj){var i=this.customFieldColumn,n=this.taskFieldColumn;if(!this.CustomformObj&&i&&0<i.length){for(var a={},r=0;r<i.length;r++){var s=i[r];s.visible&&s.validationRules&&(a[s.field]=s.validationRules)}0<Object.keys(a).length&&(this.CustomformObj=e.querySelector("#"+this.parent.element.id+"Custom0TabContainer"),this.CustomformObj)&&(this.CustomformObj=this.createFormObj(this.CustomformObj,a))}if(!this.formObj&&n&&0<n.length){for(a={},r=0;r<n.length;r++){var o=n[r];o.visible&&o.validationRules&&(a[o.field]=o.validationRules)}0<Object.keys(a).length&&(this.formObj=e.querySelector("#"+this.parent.element.id+"GeneralTabContainer"),this.formObj)&&(this.formObj=this.createFormObj(this.formObj,a))}}this.isFromAddDialog=!1,this.isFromEditDialog=!1},w.prototype.getFilteredDialogFields=function(){var e=this.isFromAddDialog?this.parent.addDialogFields:this.parent.editDialogFields;return 0!==e.length?e.filter(function(e){return"General"===e.type||"Custom"===e.type}):null},w.prototype.validateColumn=function(n,e,t){var a=this;t?t.forEach(function(e){var i="General"===e.type?a.taskFieldColumn:a.customFieldColumn;e.fields.forEach(function(e){var t=a.parent.getColumnByField(e,n);null!==t?i.push(t):i.push(a.parent.columnByField[e])})}):n.forEach(function(e){(-1!==a.parent.customColumns.indexOf(e.field)?a.customFieldColumn:a.taskFieldColumn).push(e)})},w.prototype.createFormObj=function(e,t){var n=this;return new B.FormValidator(e,{rules:t,locale:this.parent.locale,validationComplete:function(e){n.validationComplete(e)},customPlacement:function(e,t){var i=e.getAttribute("name");i&&n.valErrorPlacement(e,t,i)}})},w.prototype.valErrorPlacement=function(e,t,i){var i=i+"-tooltip",n=this.getElemTable(e);n?(n=n.querySelector(".e-tip-content"))&&(n.innerHTML=t.outerHTML):this.createTooltip(e,t,i)},w.prototype.createTooltip=function(e,t,i,n){void 0===n&&(n="block");var a=document.getElementById(i),a=(a&&a.remove(),e.parentElement),e=(a&&(a.style.position="relative"),document.createElement("div")),n=(e.className="e-tooltip-wrap e-lib e-control e-popup e-griderror",e.style.display=n,e.style.zIndex="1000",i+"-label"),i=document.createElement("div"),r=(i.id=n,i.className="sr-only",document.createElement("div")),s=(r.className="e-tip-content",document.createElement("div")),t=(s.className="error-message",s.appendChild(t.cloneNode(!0)),document.createElement("div"));t.className="e-arrow-tip e-tip-top",t.appendChild(document.createElement("div")).className="e-arrow-tip-outer e-tip-top",t.appendChild(document.createElement("div")).className="e-arrow-tip-inner e-tip-top",e.setAttribute("aria-labelledby",n),r.appendChild(s),e.appendChild(r),e.appendChild(t),e.style.top="125%",e.style.left="50%",e.style.transform="translateX(-50%)",a&&(a.appendChild(i),a.appendChild(e))},w.prototype.getElemTable=function(e){e=e.parentElement;return e?e.querySelector(".e-tooltip-wrap"):null},w.prototype.validationComplete=function(e){var t=this.getElemTable(e.element);t&&("failure"===e.status?t.style.display="":t.style.display="none")},w.prototype.tabSelectedEvent=function(e){var t=this.parent,i=e.selectedContent.childNodes[0].id,n=this.parent.editModule.dialogModule,a=n.dialog,r=0<a.getElementsByClassName("e-editedbatchcell").length,a=0<a.getElementsByClassName("e-editedrow").length||0<a.getElementsByClassName("e-addedrow").length;n.storeResourceTab&&r?document.querySelector("#"+t.element.id+"ResourcesTabContainer_gridcontrol").ej2_instances[0].saveCell():n.storeDependencyTab&&a&&document.querySelector("#"+t.element.id+"DependencyTabContainer").ej2_instances[0].editModule.batchSave(),i===t.element.id+"DependencyTabContainer"&&(this.storeDependencyTab=e.selectedContent),i===t.element.id+"ResourcesTabContainer"&&(this.storeResourceTab=e.selectedContent),i===t.element.id+"Custom0TabContainer"&&this.parent.treeGrid.grid.getColumns().some(function(e){return e.validationRules})&&this.changeFormObj(e.selectedContent),i===t.element.id+"GeneralTabContainer"&&this.parent.treeGrid.grid.getColumns().some(function(e){return e.validationRules})&&this.changeFormObj(e.selectedContent),(this.parent.isAdaptive||this.parent.enableAdaptiveUI)&&this.responsiveTabContent(i,t),i===t.element.id+"ResourcesTabContainer"?this.resourceSelection(i):i===t.element.id+"NotesTabContainer"?document.getElementById(i).ej2_instances[0].refresh():i===t.element.id+"SegmentsTabContainer"&&(oe.isNullOrUndefined(this.beforeOpenArgs.rowData.ganttProperties.startDate)?document.getElementById(i).ej2_instances[0].enableToolbarItems([this.parent.element.id+"SegmentsTabContainer_add"],!1):document.getElementById(i).ej2_instances[0].enableToolbarItems([this.parent.element.id+"SegmentsTabContainer_add"],!0))},w.prototype.responsiveTabContent=function(e,t){var t=document.getElementById(t.element.id+"_dialog_dialog-content"),i=t.clientHeight,t=(i-=t.querySelector(".e-tab-header").offsetHeight,document.querySelector("#"+e));t.classList.contains("e-grid")&&(i-=t.ej2_instances[0].getHeaderContent().offsetHeight,e=t.querySelector(".e-toolbar"))&&(i-=e.offsetHeight),t.parentElement.style.height=i+"px"},w.prototype.getFieldsModel=function(e){for(var t,i={},n=this.parent.columnByField,a=0;a<e.length;a++)e[a]===this.parent.taskFields.dependency||e[a]===this.parent.taskFields.resourceInfo||e[a]===this.parent.taskFields.notes||oe.isNullOrUndefined(n[e[a]])||(t=e[a],this.createInputModel(n[t],i));return i},w.prototype.createInputModel=function(t,e){var i=this,n=this.parent,a=this.parent.locale,r=this.parent.taskFields,s={placeholder:t.headerText,floatLabelType:"Auto"};switch(oe.isNullOrUndefined(this.parent.taskFields.id)||oe.isNullOrUndefined(this.parent.columnMapping.id)||oe.isNullOrUndefined(this.numericOrString)||r.id===t.field&&(t.editType=this.numericOrString),t.editType){case"booleanedit":var o={label:t.headerText,locale:a,enableRtl:this.parent.enableRtl};e[t.field]=o;break;case"defaultedit":case"stringedit":var o=s;o.enableRtl=this.parent.enableRtl,t.field!==n.columnMapping.duration&&t.field!==n.columnMapping.id&&t.field!==n.columnMapping.startDate&&t.field!==n.columnMapping.endDate||(o.change=function(e){i.isTriggered?i.parent.triggeredColumnName="":(t.field!==i.parent.taskFields.duration&&t.field!==i.parent.taskFields.work||i.isTriggered||(i.isTriggered=!0,i.parent.triggeredColumnName=t.field),i.validateScheduleFields(e,t,n))}),e[t.field]=s;break;case"numericedit":o=s;o.enableRtl=this.parent.enableRtl,r.progress===t.field&&(o.min=0,o.max=100),o.change=function(e){i.isTriggered?i.parent.triggeredColumnName="":(t.field!==i.parent.taskFields.duration&&t.field!==i.parent.taskFields.work||i.isTriggered||(i.isTriggered=!0,i.parent.triggeredColumnName=t.field),i.validateScheduleFields(e,t,n))},e[t.field]=o;break;case"datepickeredit":o=s;o.format=this.parent.getDateFormat(),o.enableRtl=this.parent.enableRtl,o.strictMode=!0,o.firstDayOfWeek=n.timelineModule.customTimelineSettings.weekStartDay,t.field!==n.columnMapping.startDate&&t.field!==n.columnMapping.endDate||(o.renderDayCell=this.parent.renderWorkingDayCell.bind(this.parent),o.change=function(e){i.validateScheduleFields(e,t,n)}),e[t.field]=o;break;case"datetimepickeredit":o=s;o.format=this.parent.getDateFormat(),o.enableRtl=this.parent.enableRtl,o.strictMode=!0,o.firstDayOfWeek=n.timelineModule.customTimelineSettings.weekStartDay,t.field!==n.columnMapping.startDate&&t.field!==n.columnMapping.endDate||(o.renderDayCell=this.parent.renderWorkingDayCell.bind(this.parent),o.change=function(e){i.validateScheduleFields(e,t,n)}),e[t.field]=o;break;case"dropdownedit":t.field!==n.columnMapping.type&&t.field!==n.columnMapping.manual||(s.dataSource=[{ID:1,Value:"FixedUnit"},{ID:2,Value:"FixedWork"},{ID:3,Value:"FixedDuration"}],s.fields={value:"Value"},(o=s).enableRtl=this.parent.enableRtl,o.change=function(e){t.field===r.manual&&(i.editedRecord.ganttProperties.isAutoSchedule=!e.value),i.validateScheduleFields(e,t,n)}),e[t.field]=s;break;case"maskededit":e[t.field]=s}return oe.isNullOrUndefined(t.edit)||oe.isNullOrUndefined(t.edit.params)||oe.extend(e[t.field],t.edit.params),e},w.prototype.validateScheduleFields=function(e,t,i){oe.isNullOrUndefined(i.editModule.dialogModule.dialog)||(n=i.editModule.dialogModule.dialog);var n,a,r=null,s=i.editModule.dialogModule.editedRecord,o=null,l=null,d="ResourceView"===this.parent.viewType?this.parent.getTaskIds():this.parent.ids,h=this.parent.viewType;return oe.isNullOrUndefined(e.element)?oe.isNullOrUndefined(e.container)?oe.isNullOrUndefined(e.event)||oe.isNullOrUndefined(e.event.path)||oe.isNullOrUndefined(e.event.path)[1]||(r=(a=e.event.path[1]).querySelector("input").getAttribute("id"),a=a.querySelector("#"+r)):(r=(a=e.container).querySelector("input").getAttribute("id"),a=a.querySelector("#"+r)):r=(a=e.element).getAttribute("id"),oe.isNullOrUndefined(a)?(o=e.value,l=t.field):(o=a.value,l=r.replace(i.element.id,""),"stringedit"===this.parent.columnByField[this.parent.taskFields.id].editType&&(a={rules:((t={})[this.parent.taskFields.id]={required:!0,minLength:[function(e){return"ResourceView"===h?-1===d.indexOf("T"+e.value)&&-1===d.indexOf("R"+e.value):-1===d.indexOf(e.value)},"ID is already present, please enter new value"]},t)},new B.FormValidator("#"+this.parent.element.id+"GeneralTabContainer",a))),0===l.search("Segments")?(l=l.replace("SegmentsTabContainer",""),this.validateSegmentFields(i,l,o,e)):(this.validateScheduleValuesByCurrentField(l,o,this.editedRecord),r=s.ganttProperties,t=i.taskFields,oe.isNullOrUndefined(t.startDate)||t.startDate===l||this.updateScheduleFields(n,r,"startDate"),t.endDate===l&&!oe.isNullOrUndefined(r.startDate)&&!oe.isNullOrUndefined(e.value)&&r.startDate.getTime()>e.value&&this.updateScheduleFields(n,r,"endDate"),oe.isNullOrUndefined(t.endDate)||t.endDate===l||this.updateScheduleFields(n,r,"endDate"),(!oe.isNullOrUndefined(t.duration)&&t.duration!==l||0<=r.duration)&&this.updateScheduleFields(n,r,"duration"),oe.isNullOrUndefined(t.work)||t.work===l&&"FixedWork"===r.taskType||this.updateScheduleFields(n,r,"work"),this.dialogEditValidationFlag=!1),!(this.isTriggered=!1)},w.prototype.updateScheduleFields=function(e,t,i){var n,a,r,s=this.parent,o=s.element.id,l=oe.getValue(i,s.columnMapping),d=s.columnByField[l],h=this.parent.taskFields;"stringedit"===d.editType?(a=e.querySelector("#"+o+l))&&(n=a.ej2_instances[0])&&(r=oe.isNullOrUndefined(d.edit)||oe.isNullOrUndefined(d.edit.read)?oe.isNullOrUndefined(d.valueAccessor)?this.parent.dataOperation.getDurationString(t.duration,t.durationUnit):d.valueAccessor(l,s.editModule.dialogModule.editedRecord,d):d.edit.read(),n.value!==r.toString()&&h.duration===l?(n.value=r,n.dataBind()):h.startDate!==l&&h.endDate!==l||(n.value=(h.startDate===l?t.startDate:t.endDate).toString(),n.dataBind())):"datepickeredit"===d.editType||"datetimepickeredit"===d.editType?(a=e.querySelector("#"+o+l))&&(d.editType,s=a.ej2_instances[0])&&(r=t[i],oe.isNullOrUndefined(s.value)&&!oe.isNullOrUndefined(r)||oe.isNullOrUndefined(r)&&!oe.isNullOrUndefined(s.value)||s.value!==r&&!oe.isNullOrUndefined(s.value)&&!oe.isNullOrUndefined(r)&&s.value.toString()!==r.toString())&&(s.value=r,s.dataBind()):"numericedit"===d.editType&&(h=e.querySelector("#"+o+l).ej2_instances[0],r=t[i],oe.isNullOrUndefined(r)||h.value===r||(h.value=r,h.dataBind()))},w.prototype.validateDuration=function(e){var t,i=e.ganttProperties;this.dialogEditValidationFlag||(oe.isNullOrUndefined(i.startDate)||H(i)||!oe.isNullOrUndefined(i.duration)?H(i)||!oe.isNullOrUndefined(i.startDate)?(e.ganttProperties.isMilestone&&0!==e.ganttProperties.duration&&(t=this.parent.dateValidationModule.checkStartDate(i.startDate),this.parent.setRecordValue("startDate",t,i,!0),this.parent.taskFields.startDate)&&this.parent.dataOperation.updateMappingData(e,"startDate"),this.parent.dateValidationModule.calculateEndDate(e)):H(i)||oe.isNullOrUndefined(i.endDate)||this.parent.dateValidationModule.calculateStartDate(e):(this.parent.setRecordValue("endDate",null,i,!0),this.parent.setRecordValue("isMilestone",!1,i,!0)),t=0===i.duration,this.parent.setRecordValue("isMilestone",t,i,!0),this.dialogEditValidationFlag=!0)},w.prototype.validateStartDate=function(e){var t=e.ganttProperties,i=this.parent.taskFields;this.dialogEditValidationFlag||(oe.isNullOrUndefined(t.startDate)?(this.parent.setRecordValue("duration",null,t,!0),this.parent.setRecordValue("isMilestone",!1,t,!0),this.parent.allowUnscheduledTasks&&oe.isNullOrUndefined(i.endDate)&&this.parent.setRecordValue("endDate",null,t,!0)):H(t)?oe.isNullOrUndefined(i.duration)?this.parent.dateValidationModule.calculateDuration(e):(oe.isNullOrUndefined(i.endDate),this.parent.dateValidationModule.calculateEndDate(e)):oe.isNullOrUndefined(t.endDate)?oe.isNullOrUndefined(t.duration)||this.parent.dateValidationModule.calculateEndDate(e):this.parent.dateValidationModule.calculateDuration(e),this.dialogEditValidationFlag=!0)},w.prototype.validateEndDate=function(e){var t=e.ganttProperties,i=this.parent.taskFields;this.dialogEditValidationFlag||(oe.isNullOrUndefined(t.endDate)?(this.parent.setRecordValue("duration",null,t,!0),this.parent.setRecordValue("isMilestone",!1,t,!0)):H(t)?oe.isNullOrUndefined(i.duration)?this.parent.dateValidationModule.calculateDuration(e):oe.isNullOrUndefined(t.startDate)?this.parent.dateValidationModule.calculateStartDate(e):(!oe.isNullOrUndefined(t.segments)&&0<t.segments.length&&(t.segments=this.parent.editModule.cellEditModule.validateEndDateWithSegments(t)),this.parent.dateValidationModule.calculateDuration(e)):oe.isNullOrUndefined(t.duration)?oe.isNullOrUndefined(t.startDate)||this.parent.dateValidationModule.calculateDuration(e):this.parent.dateValidationModule.calculateStartDate(e),this.dialogEditValidationFlag=!0)},w.prototype.validateScheduleValuesByCurrentField=function(e,t,i){var n,a,r,s=this.parent,o=i.ganttProperties,l=s.taskFields;return l.duration===e&&(!oe.isNullOrUndefined(t)&&""!==t&&(0<=parseInt(t,10)||0<=parseFloat(t))?(s.dataOperation.updateDurationValue(t,o),this.parent.setRecordValue(l.duration,t,i),this.parent.setRecordValue("taskData."+l.duration,o.duration,i),o.isMilestone&&!oe.isNullOrUndefined(this.parent.editModule.cellEditModule)&&((r={}).data=i,this.parent.editModule.cellEditModule.updateDates(r)),this.validateDuration(i)):s.allowUnscheduledTasks&&(o.startDate&&o.endDate&&o.startDate.getTime()>o.endDate.getTime()||-1!==t.indexOf("-")?(this.parent.setRecordValue("duration",0,o,!0),o.endDate&&this.parent.setRecordValue("startDate",o.endDate,o,!0)):""===t?(this.parent.setRecordValue("duration",null,o,!0),o.endDate&&o.startDate&&this.parent.setRecordValue("endDate",null,o,!0)):(/^[^\d.-]+$/.test(t)&&(n="The provided value for the "+l.duration+" field is invalid. Please ensure the "+l.duration+" field contains only valid numeric values.",this.parent.trigger("actionFailure",{error:n})),this.parent.setRecordValue("duration",o.duration,o,!0))),this.parent.editModule.updateResourceRelatedFields(i,"duration")),l.startDate===e&&(""!==t?(n=this.parent.dateValidationModule.getDateFromFormat(t),n=this.parent.dateValidationModule.checkStartDate(n,o),this.parent.setRecordValue("startDate",n,o,!0),this.validateStartDate(i)):s.allowUnscheduledTasks&&!i.hasChildRecords&&(this.parent.setRecordValue("startDate",null,o,!0),this.parent.setRecordValue("duration",null,o,!0),this.parent.setRecordValue("isMilestone",!1,o,!0))),l.endDate===e&&(""!==t?(n=this.parent.dateValidationModule.getDateFromFormat(t),a=this.parent.getCurrentDayEndTime(n),0===n.getHours()&&86400!==a&&this.parent.dateValidationModule.setTime(a,n),!oe.isNullOrUndefined(o.startDate)&&!oe.isNullOrUndefined(o.endDate)&&!oe.isNullOrUndefined(n)&&o.startDate.getTime()>n.getTime()&&(n=o.endDate),n=this.parent.dateValidationModule.checkEndDate(n,o),(oe.isNullOrUndefined(o.startDate)||n.getTime()>=o.startDate.getTime())&&this.parent.setRecordValue("endDate",n,o,!0),this.validateEndDate(i),o.isMilestone&&!oe.isNullOrUndefined(this.parent.editModule.cellEditModule)&&((r={}).data=i,this.parent.editModule.cellEditModule.updateDates(r))):s.allowUnscheduledTasks&&(this.parent.setRecordValue("endDate",null,o,!0),this.parent.setRecordValue("duration",null,o,!0),this.parent.setRecordValue("isMilestone",!1,o,!0))),l.work!==e||oe.isNullOrUndefined(t)||""===t||(this.parent.setRecordValue("work",t,o,!0),this.parent.editModule.updateResourceRelatedFields(i,"work"),this.validateDuration(i)),e===l.type&&(this.parent.setRecordValue("taskType",t,o,!0),t)&&"FixedDuration"===t&&0===o.duration&&this.parent.editModule.updateResourceRelatedFields(i,"work"),l.manual===e&&this.parent.editModule.updateTaskScheduleModes(i),!0},w.prototype.getSegmentsModel=function(r){for(var s=this,e=this.parent.taskFields,e=(!oe.isNullOrUndefined(r)&&0!==r.length||(r=[],oe.isNullOrUndefined(e.startDate)||r.push(this.parent.taskFields.startDate),oe.isNullOrUndefined(e.endDate)||r.push(this.parent.taskFields.endDate),oe.isNullOrUndefined(e.duration)||r.push(this.parent.taskFields.duration),oe.isNullOrUndefined(e.id))||r.push(this.parent.taskFields.id),{}),t=(e.editSettings={allowEditing:!0,allowAdding:!0,allowDeleting:!0,mode:"Normal",newRowPosition:"Bottom"},e.locale=this.parent.locale,e.dataSource=[],e.rowHeight=this.parent.isAdaptive?48:null,e.toolbar=[{id:this.parent.element.id+"SegmentsTabContainer_add",prefixIcon:"e-add",tooltipText:this.localeObj.getConstant("add"),align:"Right",text:this.parent.isAdaptive?"":this.localeObj.getConstant("add")},{id:this.parent.element.id+"SegmentsTabContainer_delete",prefixIcon:"e-delete",tooltipText:this.localeObj.getConstant("delete"),align:"Right",text:this.parent.isAdaptive?"":this.localeObj.getConstant("delete")}],[]),i=this,n=0;n<r.length;n++)!function(n){var e={},a="General";switch(r[n]){case i.parent.taskFields.id:e={field:r[n],visible:!1,isPrimaryKey:!0},t.push(e);break;case i.parent.taskFields.startDate:case i.parent.taskFields.endDate:e={field:r[n],headerText:i.localeObj.getConstant(r[n]===i.parent.taskFields.startDate?"startDate":"endDate"),editType:"stringedit",width:"200px",edit:{write:function(e){t=(oe.isNullOrUndefined(s.beforeOpenArgs[a])||oe.isNullOrUndefined(s.beforeOpenArgs[a][r[n]])?(t=s.getGeneralColumnFields(),s.getFieldsModel(t)):s.beforeOpenArgs[a])[r[n]];var t,i=e.rowData[e.column.field];oe.setValue("value",i,t),new s.inputs[s.parent.columnByField[r[n]].editType](t).appendTo(e.element)},read:function(e){return e.ej2_instances[0].value}},format:i.parent.getDateFormat()},r[n]===i.parent.taskFields.startDate&&(e.validationRules={required:!0}),t.push(e);break;case i.parent.taskFields.duration:e={field:r[n],headerText:i.localeObj.getConstant(r[n].toLocaleLowerCase()),editType:"stringedit",width:"100px",edit:{write:function(e){(t=(oe.isNullOrUndefined(s.beforeOpenArgs[a])||oe.isNullOrUndefined(s.beforeOpenArgs[a][r[n]])?(t=s.getGeneralColumnFields(),s.getFieldsModel(t)):s.beforeOpenArgs[a])[r[n]]).floatLabelType="Never";var t,i=e.rowData[e.column.field];oe.isNullOrUndefined(i)?oe.setValue("value",null,t):oe.setValue("value",i,t),oe.setValue("value",i,t),new B.TextBox(t).appendTo(e.element)},read:function(e){return e.ej2_instances[0].value.toString()}}},t.push(e)}}(n);return e.columns=t,e.height=this.parent.isAdaptive||this.parent.enableAdaptiveUI?"100%":"153px",e},w.prototype.getGridColumnByField=function(e,t){for(var i,n=0;n<t.length;n++)t[n].field===e&&(i=t[n]);return i},w.prototype.updateSegmentField=function(e,t,i){var n,a=this.parent.editModule.dialogModule.dialog,r=oe.getValue("Segments",this.beforeOpenArgs),r=this.getGridColumnByField(e,r.columns),s=this.parent.element.id,i=i[e];"stringedit"!==r.editType&&"datepickeredit"!==r.editType||(n=a.querySelector("#"+s+"SegmentsTabContainer"+e).ej2_instances[0]),oe.isNullOrUndefined(n.value)||oe.isNullOrUndefined(i)||n.value.toString()===i.toString()||(n.value=i,n.dataBind())},w.prototype.validateSegmentFields=function(e,t,i,n){var a,r=this.parent.taskFields;oe.isNullOrUndefined(r.duration)||r.duration.toLowerCase()!==t.toLowerCase()||oe.isNullOrUndefined(i)||""===i||(this.selectedSegment[r.duration]=Number(i),a=e.dataOperation.getEndDate(this.selectedSegment[r.startDate],Number(i),this.editedRecord.ganttProperties.durationUnit,this.editedRecord.ganttProperties,!1),a=e.dataOperation.checkEndDate(a,this.editedRecord.ganttProperties,!1),this.selectedSegment[r.endDate]=a),oe.isNullOrUndefined(r.startDate)||r.startDate.toLowerCase()!==t.toLowerCase()||""!==i&&(e=this.parent.dateValidationModule.getDateFromFormat(i),e=this.parent.dateValidationModule.checkStartDate(e),this.selectedSegment[r.startDate]=e,oe.isNullOrUndefined(r.endDate)||(this.selectedSegment.endDate=this.parent.dataOperation.getEndDate(e,this.selectedSegment[r.duration],this.editedRecord.ganttProperties.durationUnit,this.editedRecord.ganttProperties,!1))),oe.isNullOrUndefined(r.endDate)||r.endDate.toLowerCase()!==t.toLowerCase()||""!==i&&(a=this.parent.dateValidationModule.getDateFromFormat(i),e=this.parent.getCurrentDayEndTime(a),0===a.getHours()&&86400!==e&&this.parent.dateValidationModule.setTime(e,a),a=this.parent.dateValidationModule.checkEndDate(a,this.editedRecord.ganttProperties),this.selectedSegment[r.endDate]=a,this.selectedSegment[r.duration]=this.parent.dataOperation.getDuration(this.selectedSegment[r.startDate],this.selectedSegment[r.endDate],this.editedRecord.ganttProperties.durationUnit,!0,!1,!0)),oe.isNullOrUndefined(r.startDate)||this.updateSegmentField(r.startDate,n,this.selectedSegment),oe.isNullOrUndefined(r.endDate)||this.updateSegmentField(r.endDate,n,this.selectedSegment),oe.isNullOrUndefined(r.duration)||this.updateSegmentField(r.duration,n,this.selectedSegment)},w.prototype.getPredecessorModel=function(e){!oe.isNullOrUndefined(e)&&0!==e.length||(e=["ID","Name","Type","Offset","UniqueId"]);var t={editSettings:{allowEditing:!0,allowAdding:!0,allowDeleting:!0,mode:"Normal"}};t.locale=this.parent.locale,t.dataSource=[],t.rowHeight=this.parent.isAdaptive?48:null,t.toolbar=[{id:this.parent.element.id+"DependencyTabContainer_add",prefixIcon:"e-add",tooltipText:this.localeObj.getConstant("add"),align:"Right",text:this.parent.isAdaptive?"":this.localeObj.getConstant("add")},{id:this.parent.element.id+"DependencyTabContainer_delete",prefixIcon:"e-delete",tooltipText:this.localeObj.getConstant("delete"),align:"Right",text:this.parent.isAdaptive?"":this.localeObj.getConstant("delete")}];for(var i=[],n=0;n<e.length;n++){var a={};"id"===e[n].toLowerCase()?(a={field:"id",headerText:this.localeObj.getConstant("id"),allowEditing:!1,width:"70px"},i.push(a)):"name"===e[n].toLowerCase()?(a={field:"name",headerText:this.localeObj.getConstant("name"),editType:"stringedit",width:"250px",validationRules:{required:!0}},i.push(a)):"type"===e[n].toLowerCase()?(a={field:"type",headerText:this.localeObj.getConstant("type"),editType:"dropdownedit",dataSource:this.types,foreignKeyField:"id",foreignKeyValue:"text",defaultValue:"FS",validationRules:{required:!0},width:"150px"},i.push(a)):"offset"===e[n].toLowerCase()?(a={field:"offset",headerText:this.localeObj.getConstant("offset"),editType:"stringedit",defaultValue:this.parent.dataOperation.getDurationString(0,this.beforeOpenArgs.rowData.ganttProperties.durationUnit),validationRules:{required:!0},width:"100px"},i.push(a)):"uniqueid"===e[n].toLowerCase()&&(a={field:"uniqueId",isPrimaryKey:!0,visible:!1,defaultValue:(Q++).toString()},i.push(a))}return t.columns=i,t.height=this.parent.isAdaptive||this.parent.enableAdaptiveUI?"100%":"153px",t},w.prototype.getResourcesModel=function(e){for(var t=this.parent.resourceFields,i=(!oe.isNullOrUndefined(e)&&0!==e.length||(e=[t.id,t.name,t.unit,t.group]),{allowFiltering:!0,treeColumnIndex:-1,childMapping:"",editSettings:{allowEditing:!0,mode:"Cell"},locale:this.parent.locale,allowSelection:!0,rowHeight:this.parent.isAdaptive?48:null,filterSettings:{type:"Menu"},selectionSettings:{checkboxOnly:!0,checkboxMode:"Default",persistSelection:!0,type:"Multiple"}}),n=[{type:"checkbox",allowEditing:!1,allowSorting:!1,allowFiltering:!1,width:60}],a=0;a<e.length;a++){var r={};e[a]===t.id?(r={field:t.id,headerText:this.localeObj.getConstant("id"),isPrimaryKey:!0,width:"100px",allowEditing:!1},n.push(r)):e[a]===t.name?(r={field:t.name,headerText:this.localeObj.getConstant("name"),allowEditing:!1},n.push(r)):e[a]===t.unit?(r={field:t.unit,headerText:this.localeObj.getConstant("unit"),editType:"numericedit",edit:{params:{min:0}}},n.push(r)):e[a]!==t.group||oe.isNullOrUndefined(t.group)||(r={field:t.group,headerText:this.localeObj.getConstant("group"),allowEditing:!1},n.push(r))}return i.columns=n,i.height=this.parent.isAdaptive||this.parent.enableAdaptiveUI?"100%":"196px",i},w.prototype.getNotesModel=function(e){return!oe.isNullOrUndefined(e)&&0!==e.length||(e=["Bold","Italic","Underline","StrikeThrough","FontName","FontSize","FontColor","BackgroundColor","LowerCase","UpperCase","|","Alignments","OrderedList","UnorderedList","Outdent","Indent","|","CreateTable","CreateLink","|","ClearFormat","Print","|","Undo","Redo"]),{placeholder:this.localeObj.getConstant("writeNotes"),toolbarSettings:{items:e},height:this.parent.isAdaptive||this.parent.enableAdaptiveUI?"100%":"auto",locale:this.parent.locale}},w.prototype.createDivElement=function(e,t){return oe.createElement("div",{className:e,id:t})},w.prototype.createFormElement=function(e,t){return oe.createElement("form",{className:e,id:t})},w.prototype.createInputElement=function(e,t,i,n){return oe.createElement(n||"input",{className:e,attrs:{type:"text",id:t,name:i,title:i}})},w.prototype.renderTabItems=function(){for(var e=this.beforeOpenArgs.tabModel.items,t=0,i=0;i<e.length;i++){var n=e[i];n.content instanceof HTMLElement||("General"===n.content?n.content=this.renderGeneralTab(n.content):"Dependency"===n.content?(this.editedRecord.hasChildRecords&&!this.parent.allowParentDependency&&(n.disabled=!0),n.content=this.renderPredecessorTab(n.content)):"Resources"===n.content?n.content=this.renderResourceTab(n.content):n.content==="Custom"+t?(n.content=this.renderCustomTab(n.content,!0),t++):"Notes"===n.content?n.content=this.renderNotesTab(n.content):"Segments"===n.content&&(this.editedRecord.hasChildRecords&&(n.disabled=!0),n.content=this.renderSegmentsTab(n.content)))}},w.prototype.segmentGridActionBegin=function(e){var t=this.parent.taskFields,i=this.beforeOpenArgs.Segments;if("add"===e.requestType||"beginEdit"===e.requestType||"save"===e.requestType){var n,a,r,s=i.dataSource,o=oe.getValue("rowData",e),l=this.beforeOpenArgs.rowData.ganttProperties.startDate;if(oe.isNullOrUndefined(l)||"add"===e.requestType&&(l={},n=oe.getValue(this.parent.taskFields.startDate,o),a=this.parent.taskFields.endDate?oe.getValue(this.parent.taskFields.endDate,o):null,r=void 0,oe.isNullOrUndefined(this.parent.taskFields.duration)||(r=oe.getValue(this.parent.taskFields.duration,o)),(o=!oe.isNullOrUndefined(s)&&0<s.length?oe.isNullOrUndefined(t.endDate)||oe.isNullOrUndefined(s[0][t.endDate])?new Date(oe.getValue(t.startDate,s[0]).getTime()):new Date(oe.getValue(t.endDate,s[0]).getTime()):!oe.isNullOrUndefined(this.beforeOpenArgs.rowData.ganttProperties.startDate)&&new Date(this.beforeOpenArgs.rowData.ganttProperties.startDate.getTime())).setHours(0,0,0,0),!oe.isNullOrUndefined(s)&&0<s.length&&o.setDate(o.getDate()+2),n=this.parent.dataOperation.checkStartDate(o),a=this.parent.dateValidationModule.getDateFromFormat(n),o=this.parent.getCurrentDayEndTime(a),0===a.getHours()&&86400!==o&&this.parent.dateValidationModule.setTime(o,a),a=!oe.isNullOrUndefined(t.endDate)&&!oe.isNullOrUndefined(s)&&s.length<=0?this.beforeOpenArgs.rowData.ganttProperties.endDate:a,o=this.beforeOpenArgs.rowData.ganttProperties,r=n.getTime()===a.getTime()?1:this.parent.dataOperation.getDuration(n,a,o.durationUnit,!0,!1,!0),l=oe.isNullOrUndefined(t.duration)?((s={})[t.startDate]=n,s[t.endDate]=a,s):((o={})[t.startDate]=n,o[t.endDate]=a,o[t.duration]=r,o),e.rowData=l),"save"===e.requestType){for(var d=i.dataSource,h=this.parent.taskFields.id,p=d.length;d.some(function(e){return e[h]===p});)p++;oe.isNullOrUndefined(e.data[h])&&(e.data[h]=p,e.rowData[h]=p)}this.selectedSegment=e.rowData}},w.prototype.getDialogTabIndex=function(i){var n;return this.isEdit?this.parent.editDialogFields.map(function(e,t){e.type===i&&(n=t)}):this.parent.addDialogFields.map(function(e,t){e.type===i&&(n=t)}),n},w.prototype.setInjected=function(e,t,i,n,a,r,s){if(!oe.isNullOrUndefined(e)&&!oe.isNullOrUndefined(e.additionalParams))for(var o in t=e.additionalParams)if(Object.prototype.hasOwnProperty.call(t,o))switch(o){case"allowFiltering":i.Inject(b.Filter);break;case"allowSorting":i.Inject(b.Sort);break;case"allowPaging":i.Inject(b.Page);break;case"allowGrouping":i.Inject(b.Group);break;case"editSettings":i.Inject(b.Edit);break;case"aggregates":i.Inject(b.Aggregate);break;case"showColumnChooser":i.Inject(b.ColumnChooser);break;case"showColumnMenu":i.Inject(b.ColumnMenu);break;case"contextMenuItems":i.Inject(b.ContextMenu);break;case"allowResizing":i.Inject(b.Resize);break;case"allowReordering":i.Inject(b.Reorder);break;case"detailTemplate":i.Inject(b.DetailRow);break;case"allowRowDragAndDrop":i.Inject(b.RowDD);break;case"searchSettings":i.Inject(b.Search);break;case"selectionSettings":i.Inject(Selection);break;case"enableVirtualization":i.Inject(T.VirtualScroll);break;case"toolbar":t.toolbar.map(function(e){switch(e){case"Search":i.Inject(b.Search);break;case"Print":i.Inject(b.Print);break;case"PdfExport":i.Inject(b.PdfExport);break;case"ExcelExport":i.Inject(b.ExcelExport)}}),r.toolbar,i.Inject(b.Toolbar);break;case"columns":r.columns}},w.prototype.renderSegmentsTab=function(e){var i=this,t=this.parent,n=this.beforeOpenArgs[e],a=(n.enableAdaptiveUI=this.parent.enableAdaptiveUI,this.beforeOpenArgs.rowData),r=[],a=((r=this.isEdit?oe.isNullOrUndefined(a.taskData[this.parent.taskFields.segments])?[]:a.taskData[this.parent.taskFields.segments]:r).map(function(e,t){oe.isNullOrUndefined(e[i.parent.taskFields.id])&&(e[i.parent.taskFields.id]=t)}),n.dataSource=r,n.actionBegin=this.segmentGridActionBegin.bind(this),this.getDialogTabIndex("Segments")),r=(this.isEdit?this.isEdit&&(s=this.parent.editDialogFields[a]):s=this.parent.addDialogFields[a],[]),a=[],s=(oe.isNullOrUndefined(s)||oe.isNullOrUndefined(s.additionalParams)||(o=s.additionalParams),this.setInjected(s,o,b.Grid,void 0,r,n,a),b.Grid.Inject(b.Edit,b.Page,b.Toolbar,b.ForeignKey),(n=wn({},n,o)).toolbar=r.concat(n.toolbar),this.updateColumns(a,n.columns)),o=(n.columns=s,new b.Grid(n)),r=this.createDivElement("",t.element.id+""+e+"TabContainer");return o.appendTo(r),r},w.prototype.renderGeneralTab=function(e,t){var i,n=this.parent,a=[],r=this.beforeOpenArgs[e],s=t?this.createDivElement("e-edit-form-row",n.element.id+""+e+"TabContainer"):this.createFormElement("e-edit-form-row",n.element.id+""+e+"TabContainer");this.parent.enableAdaptiveUI&&(s.style.height="100%",(u=oe.createElement("table",{className:"e-table"})).style.width="100%",i=oe.createElement("tbody"));for(var t=s.id,o=0,l=Object.keys(r);o<l.length;o++){var d,h,p=l[o];!1!==this.parent.columnByField[p].visible&&(d=this.parent.columnByField[p],h=r[p],(this.parent.enableAdaptiveUI?i:s).appendChild(this.renderInputElements(h,d)),a.push(p))}this.parent.enableAdaptiveUI&&(u.appendChild(i),s.appendChild(u)),t!==s.id&&(s.id=t);n=this.getDialogTabIndex("General"),e=[];if(this.isEdit||oe.isNullOrUndefined(this.parent.addDialogFields[n])||oe.isNullOrUndefined(this.parent.addDialogFields[n].fields)?!this.isEdit||oe.isNullOrUndefined(this.parent.editDialogFields[n])||oe.isNullOrUndefined(this.parent.editDialogFields[n].fields)||(e=this.parent.editDialogFields[n].fields):e=this.parent.addDialogFields[n].fields,!oe.isNullOrUndefined(e)){var u=e.filter(function(e){return!a.includes(e)});if(!oe.isNullOrUndefined(u))for(var c=u,g=0;g<=c.length-1;g++){var f,m=document.getElementById(c[g]);oe.isNullOrUndefined(m)||(m=m.innerHTML,(f=oe.createElement("div")).innerHTML=m,s.appendChild(f.children[0]))}}return s},w.prototype.isCheckIsDisabled=function(e){var t,i=!1;if(!1===e.allowEditing||e.isPrimaryKey||this.parent.readOnly)if(-1!==this.parent.customColumns.indexOf(e.field))i=!0;else if(e.field===this.parent.taskFields.baselineStartDate||e.field===this.parent.taskFields.baselineEndDate||e.field===this.parent.taskFields.work||e.field===this.parent.taskFields.type||e.field===this.parent.taskFields.id||e.field===this.parent.taskFields.name||e.field===this.parent.taskFields.duration||e.field===this.parent.taskFields.progress||e.field===this.parent.taskFields.startDate||e.field===this.parent.taskFields.endDate){for(var n=0;n<this.parent.currentViewData.length;n++)if(!oe.isNullOrUndefined(this.parent.currentViewData[n].ganttProperties.taskId)){t=this.parent.currentViewData[n].ganttProperties.taskId;break}i="string"!=typeof t}return i=this.isEdit&&(e.field===this.parent.taskFields.id&&(i=!0),this.editedRecord.hasChildRecords)&&(e.field===this.parent.taskFields.endDate&&(!oe.isNullOrUndefined(this.editedRecord[this.parent.taskFields.manual])&&!1===this.editedRecord[this.parent.taskFields.manual]||"Auto"===this.parent.taskMode)||e.field===this.parent.taskFields.duration||e.field===this.parent.taskFields.progress||e.field===this.parent.taskFields.work||e.field===this.parent.taskFields.type)?!0:i},w.prototype.isParentValid=function(e){if(0<e.length)for(var t=0;t<e.length;t++){if(e[t].uniqueID===this.beforeOpenArgs.rowData.uniqueID){this.isValidData=!1;break}if(e[t].hasChildRecords&&this.isParentValid(e[t].childRecords),!this.isValidData)break}return this.isValidData},w.prototype.renderPredecessorTab=function(e){var i=this,t=this.parent,n=this.beforeOpenArgs[e],a=this.parent.columnByField[this.parent.taskFields.dependency],a=((!1===a.allowEditing||a.isPrimaryKey||this.parent.readOnly)&&(n.editSettings.allowEditing=!1,n.editSettings.allowAdding=!1,n.editSettings.allowDeleting=!1),this.beforeOpenArgs.rowData),r=[];this.taskNameCollection(),this.isEdit&&(r=this.predecessorEditCollection(a),this.updatePredecessorDropDownData(a)),a[this.parent.taskFields.dependency]&&(s=a[this.parent.taskFields.dependency].split(",").length),0!==this.preTableCollection.length&&this.preTableCollection.length!==s||(n.editSettings.allowAdding=!1),n.actionComplete=this.gridActionComplete.bind(this),n.dataSource=r,n.enableAdaptiveUI=this.parent.enableAdaptiveUI,n.actionBegin=this.gridActionBegin.bind(this);n.columns[1].edit={write:function(e){"add"===oe.getValue("requestType",e)&&oe.setValue("rowData.uniqueId",Q++,e);new F.ComboBox({dataSource:new y.DataManager(i.idCollection),popupHeight:"180px",allowCustom:!1,enableRtl:i.parent.enableRtl,fields:{value:"text"},value:e.rowData.name,change:function(e){var t=oe.closest(e.element,"tr").querySelector("#"+i.parent.element.id+"DependencyTabContainerid");t&&(oe.isNullOrUndefined(e.itemData)||oe.isNullOrUndefined(e.item)?t.value="":t.value=e.itemData.id)},autofill:!0}).appendTo(e.element)},read:function(e){return e.ej2_instances[0].value}};var a=this.getDialogTabIndex("Dependency"),s=(this.isEdit?this.isEdit&&(o=this.parent.editDialogFields[a]):o=this.parent.addDialogFields[a],[]),r=[],a=(oe.isNullOrUndefined(o)||oe.isNullOrUndefined(o.additionalParams)||(l=o.additionalParams),this.setInjected(o,l,b.Grid,void 0,s,n,r),b.Grid.Inject(b.Edit,b.Page,b.Toolbar,b.ForeignKey),(n=wn({},n,l)).toolbar=n.toolbar.concat(s),this.updateColumns(r,n.columns)),o=(n.columns=a,new b.Grid(n)),l=this.createDivElement("e-dependent-div",t.element.id+""+e+"TabContainer");return o.appendTo(l),l},w.prototype.updateColumns=function(i,e){var n={};return i.forEach(function(e){"object"==typeof e&&(n[e.field]=e)}),e.forEach(function(e){var t;"object"==typeof e&&(t=e.field,n[t]?Object.assign(n[t],e):i.push(e))}),i},w.prototype.gridActionBegin=function(a){var r=this,e=this.beforeOpenArgs.Dependency;if("add"===a.requestType||"beginEdit"===a.requestType)for(var s="add"!==a.requestType,o=(this.idCollection=oe.extend([],[],this.preTableCollection,!0),e.dataSource),t=this,i=0;i<=o.length;i++)!function(n){t.idCollection.forEach(function(e,t){var i;e.id===oe.getValue("id",o[n])&&(i=oe.getValue("rowData",a),s&&oe.getValue("id",i)===e.id||r.idCollection.splice(r.idCollection.indexOf(e),1))})}(i)},w.prototype.gridActionComplete=function(e){var t;"save"===e.requestType&&(t=this.parent.editModule.dialogModule.dialog.querySelector("#"+this.parent.element.id+"DependencyTabContainer"),oe.isNullOrUndefined(t)||oe.isNullOrUndefined(e.rows)||e.rows.length!==this.preTableCollection.length||(e=t.ej2_instances[0])&&(e.editSettings.allowAdding=!1))},w.prototype.updateResourceCollection=function(e,t){if(!oe.isNullOrUndefined(e.data)&&Object.keys(e.data).length){t=document.querySelector("#"+t).ej2_instances[0];if(!oe.isNullOrUndefined(t)&&0<t.getSelectedRecords().length){for(var i=t.getSelectedRecords(),n=void 0,a=[],n=0;n<i.length;n++){var r=i[n];oe.isNullOrUndefined(r.taskData)||oe.isNullOrUndefined(r.taskData[this.parent.resourceFields.unit])||oe.isNullOrUndefined(e.data[this.parent.resourceFields.unit])||r.taskData[this.parent.resourceFields.id]!==e.data[this.parent.resourceFields.id]||(r.taskData[this.parent.resourceFields.unit]=e.data[this.parent.resourceFields.unit]),a.push(i[n].taskData)}this.ganttResources=oe.extend([],a)}else this.ganttResources=[]}else this.ganttResources=[]},w.prototype.renderResourceTab=function(e){var i=this,t=this.parent,n=t.resourceFields,a=this.beforeOpenArgs.rowData,r=(("beforeOpenEditDialog"===this.beforeOpenArgs.requestType&&!oe.isNullOrUndefined(this.editedRecord[this.parent.taskFields.resourceInfo])||"beforeOpenAddDialog"===this.beforeOpenArgs.requestType&&!oe.isNullOrUndefined(this.editedRecord[this.parent.taskFields.resourceInfo]))&&"object"==typeof this.editedRecord[this.parent.taskFields.resourceInfo]&&this.parent.setRecordValue("resourceInfo",this.parent.dataOperation.setResourceInfo(this.editedRecord),a.ganttProperties,!0),a.ganttProperties.resourceInfo),s=((D=this.beforeOpenArgs[e]).enableAdaptiveUI=this.parent.enableAdaptiveUI,t.element.id+""+e+"TabContainer"),o=[],o=oe.extend([],[],t.resources,!0);if(this.parent.dataOperation.updateResourceUnit(o),!oe.isNullOrUndefined(r))for(var l=void 0,d=r.length,h=void 0,p=o.length,l=0;l<d;l++)for(h=0;h<p;h++)r[l][n.id]===o[h][n.id]&&(o[h][n.unit]=r[l][n.unit]);D.dataSource=o;var u=a.ganttProperties.resourceInfo;if(this.isEdit&&!oe.isNullOrUndefined(u))for(var c=0;c<u.length;c++)this.ganttResources.push(u[c]);else if(!this.isEdit&&!oe.isNullOrUndefined(u))for(c=0;c<u.length;c++)this.ganttResources.push(u[c]);D.actionBegin=function(e){if(e.rowData&&e.columnName===i.parent.resourceFields.unit&&i.editedRecord.ganttProperties.resourceInfo)for(var t=0;t<i.editedRecord.ganttProperties.resourceInfo.length;t++)i.editedRecord.ganttProperties.resourceInfo[t][i.parent.resourceFields.id]===e.rowData[i.parent.resourceFields.id]&&(i.editedRecord.ganttProperties.resourceInfo[t][i.parent.resourceFields.unit]=e.value)},D.rowSelected=function(e){i.updateResourceCollection(e,s),i.currentResources=i.ganttResources},D.rowDeselected=function(e){i.updateResourceCollection(e,s),i.currentResources=i.ganttResources};var g,f,m,e=this.createDivElement("e-resource-div",s),t=this.getDialogTabIndex("Resources"),y=(this.isEdit?this.isEdit&&(g=this.parent.editDialogFields[t]):g=this.parent.addDialogFields[t],[]);if(!oe.isNullOrUndefined(g)&&!oe.isNullOrUndefined(g.additionalParams))for(var c in f=g.additionalParams)if(Object.prototype.hasOwnProperty.call(f,c))switch(c){case"allowFiltering":T.TreeGrid.Inject(T.Filter);break;case"allowSorting":T.TreeGrid.Inject(T.Sort);break;case"allowPaging":T.TreeGrid.Inject(T.Page);break;case"editSettings":T.TreeGrid.Inject(T.Edit);break;case"aggregates":case"showColumnChooser":T.TreeGrid.Inject(T.Aggregate);break;case"showColumnMenu":T.TreeGrid.Inject(b.ColumnMenu);break;case"contextMenuItems":T.TreeGrid.Inject(b.ContextMenu);break;case"allowResizing":T.TreeGrid.Inject(T.Resize);break;case"allowReordering":T.TreeGrid.Inject(T.Reorder);break;case"detailTemplate":T.TreeGrid.Inject(b.DetailRow);break;case"allowRowDragAndDrop":T.TreeGrid.Inject(T.RowDD);break;case"searchSettings":T.TreeGrid.Inject(b.Search);break;case"selectionSettings":T.TreeGrid.Inject(T.Selection);break;case"toolbar":(m=f.toolbar).map(function(e){switch(e){case"Search":T.TreeGrid.Inject(b.Search);break;case"Print":T.TreeGrid.Inject(b.Print);break;case"PdfExport":T.TreeGrid.Inject(b.PdfExport);break;case"ExcelExport":T.TreeGrid.Inject(b.ExcelExport)}}),oe.isNullOrUndefined(m)||(D.toolbar=[],D.toolbar=D.toolbar.concat(m)),T.TreeGrid.Inject(T.Toolbar);break;case"enableVirtualization":T.TreeGrid.Inject(T.VirtualScroll);break;case"columns":y=D.columns}T.TreeGrid.Inject(T.Selection,T.Filter,T.Edit,T.VirtualScroll,T.Toolbar);var D=wn({},D,f),a=this.updateColumns(y,D.columns),k=(D.columns=a,!1),w=(D.showColumnMenu&&(k=D.showColumnMenu,D.showColumnMenu=!1),new T.TreeGrid(D)),t=this.parent.columnByField[this.parent.taskFields.resourceInfo];return(!1===t.allowEditing||t.isPrimaryKey||this.parent.readOnly)&&(w.allowSelection=!1,w.allowFiltering=!1,w.editSettings.allowEditing=!1),w.dataBound=function(){var e;k&&(w.showColumnMenu=!0),1<=i.parent.editDialogFields.length&&"Resources"===i.parent.editDialogFields[0].type&&(e=i.parent.element.id+"ResourcesTabContainer",i.resourceSelection(e))},w.appendTo(e),e},w.prototype.resourceSelection=function(e){var n=this,a=document.querySelector("#"+e).ej2_instances[0],e=(this.parent.triggeredColumnName="",a.getCurrentViewRecords()),r=this.ganttResources;r&&0<r.length&&e.forEach(function(e,t){for(var i=0;i<r.length;i++)e.taskData[n.parent.resourceFields.id]!==r[i][n.parent.resourceFields.id]||oe.isNullOrUndefined(a.selectionModule)||-1!==a.getSelectedRowIndexes().indexOf(t)||a.selectRow(t)})},w.prototype.renderCustomTab=function(e,t){return this.renderGeneralTab(e,t)},w.prototype.renderNotesTab=function(e){var t,i,n=this.parent,a=this.beforeOpenArgs[e],r=(a.enableHtmlSanitizer=this.parent.enableHtmlSanitizer,this.editedRecord.ganttProperties),n=this.createDivElement("",n.element.id+""+e+"TabContainer"),e=this.getDialogTabIndex("Notes"),s=[];if(this.isEdit?this.isEdit&&(t=this.parent.editDialogFields[e]):t=this.parent.addDialogFields[e],!oe.isNullOrUndefined(t)&&!oe.isNullOrUndefined(t.additionalParams))for(var o in i=t.additionalParams)if(Object.prototype.hasOwnProperty.call(i,o))switch(o){case"toolbarSettings":for(var l=0;l<i.toolbarSettings.items.length;l++){var d=i.toolbarSettings.items[l];if(d)switch(d){case"Image":h.RichTextEditor.Inject(h.Image);break;case"CreateTable":h.RichTextEditor.Inject(h.Table);break;case"EmojiPicker":h.RichTextEditor.Inject(h.EmojiPicker);break;case"FileManager":h.RichTextEditor.Inject(h.FileManager);break;case"FormatPainter":h.RichTextEditor.Inject(h.FormatPainter)}}oe.isNullOrUndefined(i.toolbarSettings.items)||(s=a.toolbarSettings.items),h.RichTextEditor.Inject(h.Toolbar);break;case"editorMode":h.RichTextEditor.Inject(h.MarkdownEditor)}h.RichTextEditor.Inject(h.Toolbar,h.Link,h.HtmlEditor,h.QuickToolbar,h.Count,h.Table),a.value=r.notes;e=this.parent.columnByField[this.parent.taskFields.notes];return(!1===e.allowEditing||e.isPrimaryKey||this.parent.readOnly)&&(a.enabled=!1),(a=wn({},a,i)).toolbarSettings.items=s.concat(a.toolbarSettings.items),new h.RichTextEditor(a).appendTo(n),n},w.prototype.renderInputElements=function(e,t){var i,n,a,r,s=this,o=this.parent.element.id,l=this.editedRecord,d=this.createDivElement("e-edit-form-column"),h=(this.parent.enableAdaptiveUI&&(i=oe.createElement("tr"),n=oe.createElement("td"),d.style.width="100%"),{column:t,data:l});return!oe.isNullOrUndefined(t.edit)&&oe.isNullOrUndefined(t.edit.params)?((a="string"==typeof(a=t.edit.create)?(a=b.getObject(a,window))(h):t.edit.create(h)).className="",a.setAttribute("type","text"),a.setAttribute("id",o+""+t.field),a.setAttribute("name",t.field),a.setAttribute("title",t.field)):a=this.createInputElement("",o+""+t.field,t.field),d.appendChild(a),e.enabled=oe.isNullOrUndefined(e.enabled)?!this.isCheckIsDisabled(t):e.enabled,t.field===this.parent.taskFields.duration?oe.isNullOrUndefined(t.valueAccessor)?oe.isNullOrUndefined(t.edit)&&(h=l.ganttProperties,e.value=this.parent.dataOperation.getDurationString(h.duration,h.durationUnit)):"string"==typeof t.valueAccessor?(o=b.getObject(t.valueAccessor,window),e.value=o(t.field,l,t)):e.value=t.valueAccessor(t.field,l,t):"booleanedit"===t.editType?!0===l[t.field]?e.checked=!0:e.checked=!1:this.parent.taskFields[t.field]||"numericedit"!==t.editType||""!==l[t.field]&&0!==l[t.field]?e.value=l[t.field]:e.value=0,!oe.isNullOrUndefined(t.edit)&&oe.isNullOrUndefined(t.edit.params)?(r=void 0,r="string"==typeof(h=t.edit.write)?(h=b.getObject(h,window))({column:t,rowData:l,element:a}):t.edit.write({column:t,rowData:l,element:a}),t.field===this.parent.taskFields.duration&&(r.change=function(e){s.validateScheduleFields(e,t,s.parent)})):(r=new this.inputs[t.editType](e)).appendTo(a),this.parent.enableAdaptiveUI?(n.appendChild(d),i.appendChild(n),i):d},w.prototype.taskNameCollection=function(){var e=this.parent.flatData;this.preTaskIds=[],this.preTableCollection=[];for(var t=0;t<e.length;t++){var i=e[t];if(this.parent.allowParentDependency){var n=i;if(i.parentUniqueID===this.beforeOpenArgs.rowData.uniqueID)this.isValidData=!1;else do{if(n.parentItem&&(n=this.parent.flatData[this.parent.ids.indexOf(n.parentItem.taskId)]).uniqueID===this.beforeOpenArgs.rowData.uniqueID){this.isValidData=!1;break}}while(n.parentItem);if(i.hasChildRecords&&this.isValidData&&(this.isValidData=this.isParentValid(i.childRecords)),!this.isValidData){this.isValidData=!0;continue}}else if(i.hasChildRecords)continue;var a=("ResourceView"===this.parent.viewType?i.ganttProperties.taskId:i.ganttProperties.rowUniqueID).toString(),i={id:a,text:a+"-"+i.ganttProperties.taskName,value:a};this.preTaskIds.push(i.id),this.preTableCollection.push(i)}},w.prototype.predecessorEditCollection=function(e){var t=[],i=e.ganttProperties;if(this.isEdit&&!oe.isNullOrUndefined(this.parent.taskFields.dependency)&&!oe.isNullOrUndefined(e)&&!oe.isNullOrUndefined(i.predecessor))for(var n=i.predecessor,a=this.preTableCollection,r=0;r<n.length;r++){var s=n[r].from.toString(),o={};if(("ResourceView"===this.parent.viewType?i.taskId:i.rowUniqueID).toString()!==s){o.id=s;for(var l=0;l<a.length;l++)if(a[l].value===s){o.name=a[l].text;break}o.type=n[r].type;var d=n[r].offset,h=n[r].offsetUnit;o.offset=this.parent.dataOperation.getDurationString(d,h),o.uniqueId=Q++,t.push(o)}}return t},w.prototype.updatePredecessorDropDownData=function(e){var t=("ResourceView"===this.parent.viewType?e.ganttProperties.taskId:e.ganttProperties.rowUniqueID).toString(),t=this.preTaskIds.indexOf(t);this.preTableCollection.splice(t,1),this.preTaskIds.splice(t,1),this.validSuccessorTasks(e,this.preTaskIds,this.preTableCollection)},w.prototype.validSuccessorTasks=function(e,d,h){var t,p,u=this,e=e.ganttProperties;e.predecessor&&0<e.predecessor.length&&(t=e.predecessor,p=("ResourceView"===this.parent.viewType?e.taskId:e.rowUniqueID).toString(),t.forEach(function(e){if(e.from.toString()===p){var t,e=e.to;-1<(t=d.indexOf(e))&&(d.splice(t,1),h.splice(t,1));for(var i=u.parent.connectorLineModule.getRecordByID(e),n=!0,a=0,r=u.processedId;a<r.length;a++){var s=r[a];if(s.id===i.ganttProperties.taskId&&Array.isArray(s.value)&&Array.isArray(i.ganttProperties.predecessor)&&s.value.length===i.ganttProperties.predecessor.length){for(var o=!0,l=0;l<s.value.length;l++)if(s.value[l]!==i.ganttProperties.predecessor[l]){o=!1;break}if(o){n=!1;break}}}n&&(u.processedId.push({id:i.ganttProperties.taskId,value:i.ganttProperties.predecessor}),u.validSuccessorTasks(i,d,h))}}))},w.prototype.getPredecessorType=function(){var e=[this.parent.getPredecessorTextValue("SS"),this.parent.getPredecessorTextValue("SF"),this.parent.getPredecessorTextValue("FS"),this.parent.getPredecessorTextValue("FF")];return[{id:"FS",text:e[2],value:e[2]},{id:"FF",text:e[3],value:e[3]},{id:"SS",text:e[0],value:e[0]},{id:"SF",text:e[1],value:e[1]}]},w.prototype.initiateDialogSave=function(){if(this.isEdit?this.parent.initiateEditAction(!0):this.addedRecord={},this.currentResources&&(this.currentResources=null),this.parent.undoRedoModule&&this.parent.isUndoRedoItemPresent("Edit")&&(this.parent.undoRedoModule.redoEnabled&&this.parent.undoRedoModule.disableRedo(),this.isEdit)){this.parent.undoRedoModule.createUndoCollection();var e={action:"DialogEdit",modifiedRecords:[]};if(this.parent.undoRedoModule.getUndoCollection[this.parent.undoRedoModule.getUndoCollection.length-1]=e,"ResourceView"===this.parent.viewType){var a,r,t=!1;if(this.rowData.ganttProperties.resourceInfo){if(this.ganttResources.length!==this.rowData.ganttProperties.resourceInfo.length)t=!0;else for(var i=0;i<this.rowData.ganttProperties.resourceInfo.length;i++)if(this.ganttResources[i][this.parent.resourceFields.id]!==this.rowData.ganttProperties.resourceInfo[i][this.parent.resourceFields.id]){t=!0;break}}else 0<this.ganttResources.length&&(t=!0);t&&(e={deletedIndexes:[]},a="T"+this.rowData.ganttProperties.taskId,r=[],this.parent.taskIds.reduce(function(e,t){if(t===a)if(0===this.ganttResources.length)r.push(this.parent.flatData[this.parent.taskIds.indexOf(t)]);else for(var i=this.parent.getTaskByUniqueID(this.parent.flatData[this.parent.taskIds.indexOf(t)].parentUniqueID),n=0;n<this.ganttResources.length;n++)i.ganttProperties.taskId!==this.ganttResources[n][this.parent.resourceFields.id]&&-1===r.indexOf(this.parent.flatData[this.parent.taskIds.indexOf(t)])&&r.push(this.parent.flatData[this.parent.taskIds.indexOf(t)])}.bind(this),[]),this.parent.undoRedoModule.findPosition(oe.extend([],[],r,!0),e,"deletedIndexes"),this.indexes?this.indexes.deletedIndexes[this.indexes.deletedIndexes.length]=e.deletedIndexes[0]:this.indexes=e)}}this.parent.updateDuration=!0;for(var n=this.parent,s=this.beforeOpenArgs.tabModel.items,i=0;i<s.length;i++){var o=s[i].content,l=o.getAttribute("id");oe.isNullOrUndefined(l)&&""===l||("General"===(l=(l=l.replace(n.element.id,"")).replace("TabContainer",""))?this.updateGeneralTab(o,!1):"Dependency"===l?(this.isFromDialogPredecessor=!0,this.updatePredecessorTab(o),this.isFromDialogPredecessor=!1):"Notes"===l?this.updateNotesTab(o):"Resources"===l?(this.updateResourceTab(o),this.dialogEditValidationFlag=!1):-1!==l.indexOf("Custom")?this.updateCustomTab(o):"Segments"===l&&this.updateSegmentsData(o))}if(!this.disableUndo&&this.parent.undoRedoModule&&(this.parent.undoRedoModule.getUndoCollection.splice(this.parent.undoRedoModule.getUndoCollection.length-1,1),this.parent.toolbarModule&&0===this.parent.undoRedoModule.getUndoCollection.length&&this.parent.toolbarModule.enableItems([this.parent.controlId+"_undo"],!1),this.parent.totalUndoAction--),this.isEdit){this.parent.editModule.editedRecord=this.rowData,this.parent.dataOperation.updateWidthLeft(this.rowData);e={data:this.rowData,action:"DialogEditing"};this.parent.editModule.initiateUpdateAction(e)}else if(this.parent.editModule.editedRecord=this.addedRecord,"ResourceView"===this.parent.viewType){var d=oe.extend({},this.addedRecord,!0);if(d[this.parent.taskFields.resourceInfo].length)for(i=0;i<d[this.parent.taskFields.resourceInfo].length;i++){var l=d[this.parent.taskFields.resourceInfo][i].toString(),h=this.parent.getTaskIds().indexOf("R"+l.toString());if(-1!==h){this.parent.editModule.addRecord(this.addedRecord,"Child",h);break}}else this.parent.editModule.addRecord(this.addedRecord,"Bottom")}else this.parent.editModule.addRecord(this.addedRecord,this.parent.editSettings.newRowPosition,this.parent.selectedRowIndex);return!0},w.prototype.compareObjects=function(e,r){return!oe.isNullOrUndefined(e)&&e.every(function(e,t){for(var i=r[t],n=Object.keys(e),a=0;a<n.length;a++)if("startDate"===n[a]||"endDate"===n[a]){if(e[n[a]].getTime()!==i[n[a]].getTime())return!0}else if("duration"===n[a]&&e[n[a]]!==i[n[a]])return!0;return!1})},w.prototype.updateSegmentTaskData=function(e){var t,i,n=this.parent.taskFields;this.isEdit?(t=this.rowData.ganttProperties.segments,this.parent.setRecordValue("taskData."+this.parent.taskFields.segments,e,this.rowData),i=this.parent.dataOperation.setSegmentsInfo(this.rowData,!0),(this.parent.enableUndoRedo&&t&&i&&t.length!==i.length||!t&&i||t&&!i||this.compareObjects(t,i))&&(this.disableUndo=!0),this.parent.setRecordValue("segments",i,this.rowData.ganttProperties,!0),this.parent.setRecordValue("segments",this.parent.dataOperation.setSegmentsInfo(this.rowData,!1),this.rowData.ganttProperties,!0),e.length<=0&&this.validateDuration(this.rowData)):this.addedRecord[n.segments]=e},w.prototype.updateSegmentsData=function(e){var e=e.ej2_instances[0],t=e.isEdit;e.isEdit&&e.endEdit(),t=t&&e.currentViewData.length!==e.dataSource.length?e.dataSource:e.currentViewData,this.updateSegmentTaskData(t)},w.prototype.updateGeneralTab=function(e,t){var i=this.parent,n=e.childNodes,a={};this.isEdit||(a=this.addedRecord);for(var r=0;r<n.length;r++){var s,o,l,d=n[r],h=d.querySelector('input[id^="'+i.element.id+'"]')||d.querySelector('textarea[id^="'+i.element.id+'"]'),p=Array.from(d.children).find(function(e){return e.classList.contains("e-richtexteditor")});(h=p?p:h)&&(p=h.id.replace(i.element.id,""),d=d.querySelector("#"+i.element.id+p).ej2_instances[0],"stringedit"===this.parent.columnByField[this.parent.taskFields.id].editType&&p===this.parent.taskFields.id&&(s=d.value.toString(),d.value=s),s=i.columnByField[p],(p===this.parent.taskFields.duration?parseInt(this.rowData[p],10)!==parseInt(d.value,10):this.rowData[p]!==d.value)&&(this.disableUndo=!0),oe.isNullOrUndefined(s)||oe.isNullOrUndefined(s.edit)||!oe.isNullOrUndefined(s.edit.params)?oe.isNullOrUndefined(s)||"booleanedit"!==s.editType?(p===this.parent.taskFields.duration?(o=parseFloat(String(d.value)),a[p]=o):(0<this.parent.weekWorkingTime.length&&d.value&&(p===this.parent.taskFields.startDate||p===this.parent.taskFields.baselineStartDate)&&(o=p===this.parent.taskFields.startDate?this.beforeOpenArgs.rowData.ganttProperties.startDate:this.beforeOpenArgs.rowData.ganttProperties.baselineStartDate,this.parent.getStartTime(o)/3600===o.getHours())&&(l=this.parent.getStartTime(d.value),this.parent.dataOperation.setTime(l,d.value)),a[p]=d.value),this.parent.enableHtmlSanitizer&&"string"==typeof d.value&&(d.value=oe.SanitizeHtmlHelper.sanitize(d.value),a[p]=d.value)):h instanceof HTMLInputElement&&!0===h.checked?a[p]=!0:a[p]=!1:"string"==typeof(l=s.edit.read)?(l=b.getObject(l,window),a[p]=l(h,d.value)):a[p]=s.edit.read(h,d.value))}this.isEdit&&(t||this.updateScheduleProperties(this.editedRecord,this.rowData),i.editModule.validateUpdateValues(a,this.rowData,!0))},w.prototype.updateScheduleProperties=function(e,t){this.parent.setRecordValue("startDate",e.ganttProperties.startDate,t.ganttProperties,!0),this.parent.setRecordValue("endDate",e.ganttProperties.endDate,t.ganttProperties,!0),this.parent.setRecordValue("duration",e.ganttProperties.duration,t.ganttProperties,!0),this.parent.setRecordValue("durationUnit",e.ganttProperties.durationUnit,t.ganttProperties,!0),this.parent.setRecordValue("work",e.ganttProperties.work,t.ganttProperties,!0),this.parent.setRecordValue("type",e.ganttProperties.taskType,t.ganttProperties,!0),this.parent.setRecordValue("taskType",e.ganttProperties.taskType,t.ganttProperties,!0),this.parent.setRecordValue("resourceNames",e.ganttProperties.resourceNames,t.ganttProperties,!0),this.parent.setRecordValue("resourceInfo",e.ganttProperties.resourceInfo,t.ganttProperties,!0),oe.isNullOrUndefined(this.parent.taskFields.startDate)||this.parent.dataOperation.updateMappingData(t,"startDate"),oe.isNullOrUndefined(this.parent.taskFields.endDate)||this.parent.dataOperation.updateMappingData(t,"endDate"),oe.isNullOrUndefined(this.parent.taskFields.duration)||(this.parent.dataOperation.updateMappingData(t,"duration"),this.parent.setRecordValue("durationUnit",e.ganttProperties.durationUnit,this.rowData,!0),0===this.rowData.ganttProperties.duration?this.parent.setRecordValue("isMilestone",!0,t.ganttProperties,!0):this.parent.setRecordValue("isMilestone",!1,this.rowData.ganttProperties,!0)),oe.isNullOrUndefined(this.parent.taskFields.work)||this.parent.dataOperation.updateMappingData(this.rowData,"work"),oe.isNullOrUndefined(this.parent.taskFields.manual)||this.parent.dataOperation.updateMappingData(this.rowData,"manual"),oe.isNullOrUndefined(this.parent.taskFields.type)||this.parent.dataOperation.updateMappingData(this.rowData,"type"),oe.isNullOrUndefined(this.parent.taskFields.resourceInfo)||this.parent.dataOperation.updateMappingData(this.rowData,"resourceInfo")},w.prototype.getMatchingPrefix=function(e,t){for(var i=e.name.split("-"),n="",a=0;a<i.length;a++)if(n=""===n?i[a]:n+"-"+i[a],-1!==t.indexOf(n))return[n];return[]},w.prototype.updatePredecessorTab=function(e){for(var e=e.ej2_instances[0],t=(e.isEdit&&e.endEdit(),e.dataSource),i=[],e=[],n="",a=[],r=[],s=0;s<t.length;s++){var o=t[s],l=this.getMatchingPrefix(o,this.parent.ids);(oe.isNullOrUndefined(o.id)||o.id!==l[0]&&!oe.isNullOrUndefined(l[0]))&&(o.id=l[0]),-1===a.indexOf(o.id)&&("ProjectView"===this.parent.viewType&&(l=this.parent.flatData[this.parent.ids.indexOf(o.id)]).hasChildRecords&&-1===r.indexOf(l)&&r.push(l),l=o.id+o.type,o.offset&&-1!==o.offset.indexOf("-")?l+=o.offset:l+="+"+o.offset,i.push(l),a.push(o.id))}this.isEdit?(n=0<i.length?(e=this.parent.predecessorModule.calculatePredecessor(i.join(","),this.rowData),this.parent.setRecordValue("predecessor",e,this.rowData.ganttProperties,!0),this.parent.predecessorModule.getPredecessorStringValue(this.rowData)):(this.parent.setRecordValue("predecessor",e=[],this.rowData.ganttProperties,!0),""),this.parent.undoRedoModule&&0<this.parent.undoRedoModule.getUndoCollection.length&&(this.parent.undoRedoModule.getUndoCollection[this.parent.undoRedoModule.getUndoCollection.length-1].connectedRecords=r,""===n&&(oe.isNullOrUndefined(this.rowData.ganttProperties.predecessorsName)||this.rowData.ganttProperties.predecessorsName===n||this.disableUndo)||(this.disableUndo=!0)),this.parent.setRecordValue("predecessorsName",n,this.rowData.ganttProperties,!0),this.parent.setRecordValue("taskData."+this.parent.taskFields.dependency,n,this.rowData),this.parent.setRecordValue(this.parent.taskFields.dependency,n,this.rowData),this.parent.predecessorModule.updateUnscheduledDependency(this.rowData)):this.addedRecord[this.parent.taskFields.dependency]=0<i.length?i.join(","):""},w.prototype.updateResourceTab=function(e){var t=this,e=e.ej2_instances[0],i=(e&&e.grid.endEdit(),this.ganttResources),n=(i.forEach(function(e){null===e[t.parent.resourceFields.unit]&&(e[t.parent.resourceFields.unit]=0)}),"ResourceView"!==this.parent.viewType||oe.isNullOrUndefined(this.rowData.ganttProperties)||(JSON.stringify(this.ganttResources)!==JSON.stringify(this.rowData.ganttProperties.resourceInfo)?(this.isResourceUpdate=!0,this.previousResource=oe.isNullOrUndefined(this.rowData.ganttProperties.resourceInfo)?[]:this.rowData.ganttProperties.resourceInfo.slice()):this.isResourceUpdate=!1),[]);if(this.isEdit){if((this.rowData.ganttProperties.resourceInfo&&i.length!==this.rowData.ganttProperties.resourceInfo.length||oe.isNullOrUndefined(this.rowData.ganttProperties.resourceInfo)&&0<i.length)&&(this.disableUndo=!0),!this.disableUndo)for(var a=0;a<i.length;a++)if(JSON.stringify(i[a])!==JSON.stringify(this.rowData.ganttProperties.resourceInfo[a])){this.disableUndo=!0;break}this.parent.setRecordValue("resourceInfo",i,this.editedRecord.ganttProperties,!0),this.parent.dataOperation.updateMappingData(this.editedRecord,"resourceInfo"),this.parent.editModule.updateResourceRelatedFields(this.editedRecord,"resource"),this.validateDuration(this.editedRecord),this.updateScheduleProperties(this.editedRecord,this.rowData)}else{for(a=0;a<i.length;a++)n.push(i[a][this.parent.resourceFields.id]),this.isAddNewResource=!0;this.addedRecord[this.parent.taskFields.resourceInfo]=n}},w.prototype.updateNotesTab=function(e){var t=this.parent,e=e.ej2_instances[0];this.isEdit?(t.columnByField[t.taskFields.notes].disableHtmlEncode?(this.rowData.ganttProperties.notes===e.getText()||null===this.rowData.ganttProperties.notes&&""===e.getText()||this.disableUndo||(this.disableUndo=!0),e.getHtml().includes("href")?this.parent.setRecordValue("notes",e.getHtml(),this.rowData.ganttProperties,!0):this.parent.setRecordValue("notes",e.getText(),this.rowData.ganttProperties,!0)):(this.rowData.ganttProperties.notes===e.getHtml()||null===this.rowData.ganttProperties.notes&&"<p><br></p>"===e.getHtml()||this.disableUndo||(this.disableUndo=!0),this.parent.setRecordValue("notes",e.getHtml(),this.rowData.ganttProperties,!0)),t.dataOperation.updateMappingData(this.rowData,"notes")):t.columnByField[t.taskFields.notes].disableHtmlEncode?this.addedRecord[this.parent.taskFields.notes]=e.getText():this.addedRecord[this.parent.taskFields.notes]=e.getHtml()},w.prototype.updateCustomTab=function(e){this.updateGeneralTab(e,!0)},w);function w(e){this.isFromDialogPredecessor=!1,this.isTriggered=!1,this.taskFieldColumn=[],this.customFieldColumn=[],this.processedId=[],this.updatedEditFields=null,this.updatedAddFields=null,this.addedRecord=null,this.dialogEditValidationFlag=!1,this.ganttResources=[],this.isValidData=!0,this.isResourceTabUpdated=!1,this.previousResource=[],this.isResourceUpdate=!1,this.parent=e,this.localeObj=this.parent.localeObj,this.beforeOpenArgs={cancel:!1},this.types=this.getPredecessorType(),this.rowData={},this.editedRecord={},this.inputs={booleanedit:A.CheckBox,dropdownedit:F.DropDownList,datepickeredit:W.DatePicker,datetimepickeredit:W.DateTimePicker,maskededit:B.MaskedTextBox,numericedit:B.NumericTextBox,stringedit:B.TextBox,defaultedit:B.TextBox},this.processDialogFields(),this.wireEvents()}var Tn=function(){return(Tn=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var a in t=arguments[i])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},vn=(v.prototype.updateConnectorLineEditElement=function(e){e=this.getConnectorLineHoverElement(e.target);oe.getValue("editModule.taskbarEditModule.taskBarEditAction",this.parent)||this.highlightConnectorLineElements(e)},v.prototype.getConnectorLineHoverElement=function(e){var t=P(e,tt),i=P(e,at),n=P(e,it),a=P(e,nt);return t||i||n||a?P(e,et):null},v.prototype.highlightConnectorLineElements=function(e){e?e!==this.connectorLineElement&&(this.removeHighlight(),this.addHighlight(e)):this.removeHighlight()},v.prototype.addHighlight=function(e){e=(this.connectorLineElement=e).querySelector("."+tt);e&&e.setAttribute("stroke-width",(this.parent.connectorLineModule.lineStroke+1).toString())},v.prototype.removeHighlight=function(){var e;this.connectorLineElement&&((e=this.connectorLineElement.querySelector("."+tt))&&e.setAttribute("stroke-width",this.parent.connectorLineModule.lineStroke.toString()),this.connectorLineElement=null)},v.prototype.getEditedConnectorLineString=function(e){for(var t,i=new Set,n=document.createDocumentFragment(),a=0;a<e.length;a++)if(t=e[a].ganttProperties.predecessor)for(var r=0;r<t.length;r++){var s,o=t[r],l="parent"+o.from+"child"+o.to;this.parent.connectorLineModule.removeConnectorLineById(l),l=this.parent.connectorLineModule.getRecordByID(o.from),s=this.parent.connectorLineModule.getRecordByID(o.to),(!this.parent.allowParentDependency&&(l&&l.expanded||s&&s.expanded)||this.parent.allowParentDependency&&(l||s))&&(l=this.parent.predecessorModule.updateConnectorLineObject(l,s,o),oe.isNullOrUndefined(l)||i.has(l.connectorLineId)||(s=this.parent.connectorLineModule.getConnectorLineTemplate(l),i.add(l.connectorLineId),n.appendChild(s)))}return n},v.prototype.refreshEditedRecordConnectorLine=function(e){this.parent.connectorLineModule.removePreviousConnectorLines(this.parent.previousRecords),this.parent.connectorLineModule.expandedRecords=this.parent.virtualScrollModule&&this.parent.enableVirtualization?this.parent.updatedRecords:this.parent.getExpandedRecords(this.parent.updatedRecords);e=this.getEditedConnectorLineString(e);e&&this.parent.connectorLineModule.svgObject.appendChild(e)},v.prototype.idFromPredecessor=function(e){for(var t=e.split(","),i=[],n=[],a=[],r=0;r<t.length;r++){var s,o=[],l=void 0,d=!1,h=void 0,p=!1,u=t[r].split("-");6===u.length&&(u[4]=u[4]+"-"+u[5],u.pop()),5===u.length&&12<=u[4].length&&(s=t[r].substring(0,36),/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/.test(s))&&(p=!0),t[r].includes("-")&&(t[r].includes("-")&&(t[r].includes("days")||t[r].includes("day"))&&0<(s=t[r].split(/-(?=\d)/)).length&&(h=s[s.length-1]),t[r].includes("-"))&&/[A-Za-z]/.test(h)&&-1!==(h=t[r].indexOf(h))&&(l=t[r].substring(0,h-1)).includes("-")&&(d=!0),p?(p=h=void 0,1===(h=u[4].split("+")).length?n[0]=t[r]:(p=h[1].length,n[0]=t[r].slice(0,-(p+1)),n[1]=h[1]),0<=u[4].indexOf("-")&&(1===(h=u[4].split("-")).length?n[0]=t[r]:(p=h[1].length,n[0]=t[r].slice(0,-(p+1)),n[1]=h[1]))):d&&l.includes("-")?n[0]=l:(n=t[r].split("+"),0<=t[r].indexOf("-")&&(n=t[r].split("-"))),oe.isNullOrUndefined(n[0])||(-1===("ResourceView"===this.parent.viewType?this.parent.getTaskIds():this.parent.ids).indexOf(n[0])?-1!==n[0].indexOf(" ")?(1===(a=n[0].split(" ")).length&&(a=n[0].match(/(\d+|[A-z]+)/g)),o.push(a[0])):1===n[0].length||2===n[0].length?o.push(n[0]):o.push(n[0].slice(0,-2)):o.push(n[0])),i.push(o.join(""))}return i},v.prototype.predecessorValidation=function(e,t){for(var i,n=t.rowUniqueID,a=0;a<e.length;a++)for(var r=e[a],s=[],o=(e.slice(0).splice(a,1),this);null!==r;){var l=function(){var t=[];return-1===s.indexOf(r)?oe.isNullOrUndefined(o.parent.connectorLineModule.getRecordByID(r))||(i=o.parent.connectorLineModule.getRecordByID(r).ganttProperties,!oe.isNullOrUndefined(i.predecessor)&&0<i.predecessor.length&&i.predecessor.forEach(function(e){i.rowUniqueID.toString()!==e.from&&t.push(e.from.toString())}),n.toString()===i.rowUniqueID.toString())||-1!==t.indexOf(n.toString())?{value:!1}:(s.push(r),!oe.isNullOrUndefined(i.predecessor)&&0<i.predecessor.length?void(r=i.predecessor[0].from):"break"):"break"}();if("object"==typeof l)return l.value;if("break"===l)break}return!0},v.prototype.validatePredecessorRelation=function(s,e){var o,l=!0,d="ResourceView"===this.parent.viewType?s.ganttProperties.taskId:s.ganttProperties.rowUniqueID;if(!oe.isNullOrUndefined(e)&&0<e.length)for(var h=this.idFromPredecessor(e),t=function(e){if(p.parent.allowParentDependency)parseInt(h[h.length-1],10)!==s[p.parent.taskFields.id]&&(t=p.parent.ids.indexOf(h[h.length-1]),t=p.parent.currentViewData[t])&&s&&(l=p.parent.predecessorModule.validateParentPredecessor(t,s));else if(!p.checkParentRelation(s,h))return{value:!1};var t=h.slice(0),i=[],n=!0;if(t.forEach(function(e){-1===i.indexOf(e)?i.push(e):n=!1}),!n)return{value:!1};o=h[e];var r=[];for(h.slice(0).splice(e,1);null!==o;){var a=function(){var i,e,n,a=[];return-1===r.indexOf(o)?oe.isNullOrUndefined(p.parent.connectorLineModule.getRecordByID(o.toString()))||(n=p.parent.connectorLineModule.getRecordByID(o.toString()).ganttProperties,!oe.isNullOrUndefined(n.predecessor)&&0<n.predecessor.length&&n.predecessor.forEach(function(e,t){n.rowUniqueID.toString()!==e.from&&(a.push(e.from.toString()),i=t)}),d.toString()===n.rowUniqueID.toString())||-1!==a.indexOf(d.toString())?{value:!1}:(r.push(o),!oe.isNullOrUndefined(n.predecessor)&&0<n.predecessor.length?(e=void 0,1<a.length?e=p.predecessorValidation(a,s.ganttProperties):1===a.length&&(o=n.predecessor[i].from),!1===e?{value:!1}:void 0):"break"):"break"}();if("object"==typeof a)return a;if("break"===a)break}},p=this,i=0;i<h.length;i++){var n=t(i);if("object"==typeof n)return n.value}return l},v.prototype.addPredecessor=function(e,t){t=oe.isNullOrUndefined(e.ganttProperties.predecessorsName)||""===e.ganttProperties.predecessorsName?t:e.ganttProperties.predecessorsName+","+t;this.updatePredecessorHelper(e,t)},v.prototype.removePredecessor=function(e){this.isPublicDependencyDelete=!0,this.updatePredecessorHelper(e,null)},v.prototype.updatePredecessor=function(e,t,i){return this.updatePredecessorHelper(e,t,i)},v.prototype.updatePredecessorHelper=function(e,t,i){var n;return oe.isUndefined(t)||this.validatePredecessorRelation(e,t)?(this.parent.isOnEdit=!0,n=[],oe.isNullOrUndefined(t)||""===t||(n=this.parent.predecessorModule.calculatePredecessor(t,e)),this.parent.setRecordValue("predecessor",n,e.ganttProperties,!0),n=this.parent.predecessorModule.getPredecessorStringValue(e),this.parent.setRecordValue("predecessorsName",n,e.ganttProperties,!0),this.parent.setRecordValue("taskData."+this.parent.taskFields.dependency,n,e),this.parent.setRecordValue(this.parent.taskFields.dependency,n,e),(n={}).action=i&&i.action&&"CellEditing"===i.action?i.action:this.parent.contextMenuModule&&this.parent.contextMenuModule.isCntxtMenuDependencyDelete||this.isPublicDependencyDelete?"DeleteConnectorLine":"DrawConnectorLine",n.data=e,this.parent.editModule.initiateUpdateAction(n),!0):(e.taskData[this.parent.taskFields.dependency]&&(e.taskData[this.parent.taskFields.dependency]=null),i=t+" is an invalid relation for task "+this.parent.taskFields.id+". Kindly ensure the "+this.parent.taskFields.dependency+" field contains only valid predecessor relations.",this.parent.trigger("actionFailure",{error:i}),!1)},v.prototype.checkParentRelation=function(e,i){if(e&&e.parentItem&&-1!==i.indexOf(e.parentItem.taskId.toString()))return!1;for(var n=this,t=0;t<i.length;t++){var a=function(t){var e=n.parent.currentViewData.filter(function(e){return e&&e.ganttProperties.rowUniqueID.toString()===i[t].toString()});if(e[0]&&e[0].hasChildRecords)return{value:!1}}(t);if("object"==typeof a)return a.value}return!0},v.prototype.initPredecessorValidationDialog=function(){var e;this.parent.taskFields.dependency&&this.parent.isInPredecessorValidation&&(e=oe.createElement("div",{id:this.parent.element.id+"_dialogValidationRule"}),this.parent.element.appendChild(e),this.renderValidationDialog())},v.prototype.renderValidationDialog=function(){var e=new U.Dialog({header:"Validate Editing",isModal:!0,enableRtl:this.parent.enableRtl,visible:!1,width:"50%",showCloseIcon:!0,close:this.validationDialogClose.bind(this),content:"",buttons:[{click:this.validationDialogOkButton.bind(this),buttonModel:{content:this.parent.localeObj.getConstant("okText"),isPrimary:!0}},{click:this.validationDialogCancelButton.bind(this),buttonModel:{content:this.parent.localeObj.getConstant("cancel")}}],target:this.parent.element,animationSettings:{effect:"None"}});document.getElementById(this.parent.element.id+"_dialogValidationRule").innerHTML="",e.isStringTemplate=!0,e.appendTo("#"+this.parent.element.id+"_dialogValidationRule"),this.parent.validationDialogElement=e},v.prototype.validationDialogOkButton=function(){var e=this.parent.currentEditedArgs;e.validateMode.preserveLinkWithEditing=document.getElementById(this.parent.element.id+"_ValidationAddlineOffset").checked,e.validateMode.removeLink=document.getElementById(this.parent.element.id+"_ValidationRemoveline").checked,e.validateMode.respectLink=document.getElementById(this.parent.element.id+"_ValidationCancel").checked,this.applyPredecessorOption(),this.parent.validationDialogElement.hide()},v.prototype.validationDialogCancelButton=function(){this.parent.currentEditedArgs.validateMode.respectLink=!0,this.applyPredecessorOption(),this.parent.validationDialogElement.hide()},v.prototype.validationDialogClose=function(e){oe.getValue("isInteraction",e)&&(this.parent.currentEditedArgs.validateMode.respectLink=!0,this.applyPredecessorOption())},v.prototype.applyPredecessorOption=function(){var t,i,e=this.parent.currentEditedArgs,n=e.data;e.validateMode.respectLink?(this.parent.editModule.reUpdatePreviousRecords(),this.parent.chartRowsModule.refreshRecords([e.data])):e.validateMode.removeLink?(this.checkChildRecords(n),this.parent.editModule.updateEditedTask(e.editEventArgs)):e.validateMode.preserveLinkWithEditing&&(this.parent.updateOffsetOnTaskbarEdit&&(i=n.ganttProperties.taskId,n.ganttProperties.predecessor)&&n.ganttProperties.predecessor.forEach(function(e){i===e.from&&(t=e.to)}),this.parent.editModule.updateEditedTask(e.editEventArgs),this.processPredecessors(t))},v.prototype.compareArrays=function(e,t){return e.length===t.length&&JSON.stringify(e)===JSON.stringify(t)},v.prototype.processPredecessors=function(e){var t,i,n=this;e&&(t=this.parent.getRecordByID(e))&&t.ganttProperties&&t.ganttProperties.predecessor&&(this.parent.connectorLineEditModule.validatedOffsetIds=[],this.calculateOffset(t),i=!0,(e=this.validatedId.find(function(e){return e.id===t.ganttProperties.taskId}))&&(e=e.value,this.compareArrays(e,t.ganttProperties.predecessor))&&(i=!1),t.ganttProperties.predecessor.forEach(function(e){t.ganttProperties.taskId===e.from&&i&&n.processPredecessors(e.to)}))},v.prototype.checkChildRecords=function(e){var t;if(this.validationPredecessor=e.ganttProperties.predecessor,oe.isNullOrUndefined(this.validationPredecessor)||this.removePredecessors(e,this.validationPredecessor),0<e.childRecords.length)for(var i=0;i<e.childRecords.length;i++){var n=e.childRecords[i];this.validationPredecessor=n.ganttProperties.predecessor,oe.isNullOrUndefined(this.validationPredecessor)||this.removePredecessors(n,this.validationPredecessor),0<n.childRecords.length&&this.checkChildRecords(n)}else oe.isNullOrUndefined(e.parentItem)||(t=this.parent.getRecordByID(e.parentItem.taskId),this.validationPredecessor=t.ganttProperties.predecessor,this.removePredecessors(t,this.validationPredecessor))},v.prototype.compareObjects=function(t,i){var e=Object.keys(t).filter(function(e){return"offset"!==e}),n=Object.keys(i).filter(function(e){return"offset"!==e});return e.length===n.length&&e.every(function(e){return t[e]===i[e]})},v.prototype.calculateOffset=function(d,e){var i=this;if(this.parent.autoCalculateDateScheduling&&!(this.parent.isLoad&&this.parent.treeGrid.loadChildOnDemand&&this.parent.taskFields.hasChildMapping)&&d&&null!==H(d.ganttProperties)){var h=oe.extend([],d.ganttProperties.predecessor,[],!0),p=this.parent.predecessorModule.getValidPredecessor(d);if(0<p.length){this.cumulativePredecessorChanges=h;for(var u=this,t=0;t<p.length;t++)!function(t){var e=p[parseInt(t.toString(),10)],i=u.parent.connectorLineModule.getRecordByID(e.from),n=(u.parent.undoRedoModule&&u.parent.undoRedoModule.isUndoRedoPerformed&&"ProjectView"===u.parent.viewType&&0===i.ganttProperties.predecessor.filter(function(e){return e.from===p[t].from&&e.to===p[t].to}).length&&i.ganttProperties.predecessor.push(p[t]),void 0);if((i.ganttProperties.startDate||i.ganttProperties.endDate)&&(d.ganttProperties.startDate||d.ganttProperties.endDate)){var a=void 0,r=void 0,s=void 0,o=void 0;switch(e.type){case"FS":a=new Date((i.ganttProperties.endDate||i.ganttProperties.startDate).getTime()),r=new Date((d.ganttProperties.startDate||d.ganttProperties.endDate).getTime());break;case"SS":a=new Date((i.ganttProperties.startDate||i.ganttProperties.endDate).getTime()),r=new Date((d.ganttProperties.startDate||d.ganttProperties.endDate).getTime());break;case"SF":a=new Date((i.ganttProperties.startDate||i.ganttProperties.endDate).getTime()),r=new Date((d.ganttProperties.endDate||d.ganttProperties.startDate).getTime());break;case"FF":a=new Date((i.ganttProperties.endDate||i.ganttProperties.startDate).getTime()),r=new Date((d.ganttProperties.endDate||d.ganttProperties.startDate).getTime())}o=a.getTime()<r.getTime()?(a=u.dateValidateModule.checkStartDate(a),r=u.dateValidateModule.checkEndDate(r,null),!1):(l=new Date(a.getTime()),a=u.dateValidateModule.checkStartDate(r),r=u.dateValidateModule.checkEndDate(l,null),!0),n=a.getTime()<r.getTime()?(s=u.dateValidateModule.getDuration(a,r,e.offsetUnit,!0,!1),u.parent.durationUnit===e.offsetUnit&&(i.ganttProperties.startDate&&oe.isNullOrUndefined(i.ganttProperties.endDate)||oe.isNullOrUndefined(i.ganttProperties.startDate)&&i.ganttProperties.endDate)&&(s-=1),o?-1*s:s):0}else n=0;var l=K(e,"from",h,"to"),o=(-1!==l&&(h[l].offset=n),oe.extend([],i.ganttProperties.predecessor,[],!0)),s=K(e,"from",o,"to");-1!==s&&(o[s].offset=n),u.parent.setRecordValue("predecessor",o,i.ganttProperties,!0)}(t)}else{var n=d.ganttProperties.predecessor;n&&0<n.length&&n.forEach(function(e){-1===i.validatedOffsetIds.indexOf(e.to)&&("ResourceView"===i.parent.viewType?(i.validatedOffsetIds.push(e.to),i.calculateOffset(i.parent.getRecordByID(i.parent.taskIds.indexOf("T"+e.to).toString()),!0)):i.calculateOffset(i.parent.getRecordByID(e.to),!0))})}e?this.parent.setRecordValue("predecessor",h,d.ganttProperties,!0):(0===p.length&&(this.cumulativePredecessorChanges=[]),h&&0<h.length&&this.cumulativePredecessorChanges&&0<this.cumulativePredecessorChanges.length&&(n=h.map(function(t){var e=i.cumulativePredecessorChanges.find(function(e){return i.compareObjects(e,t)});return e?Tn({},e):null}).filter(function(e){return null!==e}),this.parent.setRecordValue("predecessor",n,d.ganttProperties,!0)));e=this.parent.predecessorModule.getPredecessorStringValue(d);if(this.parent.setRecordValue("taskData."+this.parent.taskFields.dependency,e,d),this.parent.setRecordValue(this.parent.taskFields.dependency,e,d),this.parent.setRecordValue("predecessorsName",e,d.ganttProperties,!0),-1===this.validatedOffsetIds.indexOf(d.ganttProperties.taskId.toString())&&this.validatedOffsetIds.push(d.ganttProperties.taskId.toString()),d.hasChildRecords)for(t=0;t<d.childRecords.length;t++)-1===this.validatedOffsetIds.indexOf(d.childRecords[t].ganttProperties.taskId.toString())&&d.childRecords[t].ganttProperties.predecessor&&0<d.childRecords[t].ganttProperties.predecessor.length&&this.calculateOffset(d.childRecords[t]);else d.parentItem&&(n=this.parent.getRecordByID(d.parentItem.taskId),-1===this.validatedOffsetIds.indexOf(n.ganttProperties.taskId.toString()))&&n.ganttProperties.predecessor&&0<n.ganttProperties.predecessor.length&&this.calculateOffset(n)}},v.prototype.removePredecessors=function(e,t){var i=oe.extend([],[],e.ganttProperties.predecessor,!0);if(!oe.isNullOrUndefined(t)){for(var n,a=t.length,r=0;r<a;r++){var s=this.parent.connectorLineModule.getRecordByID(t[r].from),o=oe.extend([],[],s.ganttProperties.predecessor,!0),l=K(t[r],"from",i,"to"),l=(i.splice(l,1),K(t[parseInt(r.toString(),10)],"from",o,"to"));o.splice(l,1),this.parent.setRecordValue("predecessor",o,s.ganttProperties,!0)}i.length!==e.ganttProperties.predecessor.length&&(this.parent.setRecordValue("predecessor",i,e.ganttProperties,!0),n=this.parent.predecessorModule.getPredecessorStringValue(e),this.parent.setRecordValue("predecessorsName",n,e.ganttProperties,!0),this.parent.setRecordValue("taskData."+this.parent.taskFields.dependency,n,e),this.parent.setRecordValue(this.parent.taskFields.dependency,n,e))}},v.prototype.openValidationDialog=function(e){e=this.validationDialogTemplate(e);this.parent.validationDialogElement.setProperties({content:e}),this.parent.validationDialogElement.show()},v.prototype.validationDialogTemplate=function(e){var t,i=this.parent.element.id,n=oe.createElement("div",{className:"e-ValidationContent"}),a=oe.getValue("task",e),r=oe.getValue("parentTask",e),e=oe.getValue("violationType",e),s=a.ganttProperties.taskName,a=this.parent.getFormatedDate(a.ganttProperties.startDate,this.parent.dateFormat),r=[s,r.ganttProperties.taskName],e=("taskBeforePredecessor_FS"===e?t=this.parent.localeObj.getConstant("taskBeforePredecessor_FS"):"taskAfterPredecessor_FS"===e?t=this.parent.localeObj.getConstant("taskAfterPredecessor_FS"):"taskBeforePredecessor_SS"===e?t=this.parent.localeObj.getConstant("taskBeforePredecessor_SS"):"taskAfterPredecessor_SS"===e?t=this.parent.localeObj.getConstant("taskAfterPredecessor_SS"):"taskBeforePredecessor_FF"===e?t=this.parent.localeObj.getConstant("taskBeforePredecessor_FF"):"taskAfterPredecessor_FF"===e?t=this.parent.localeObj.getConstant("taskAfterPredecessor_FF"):"taskBeforePredecessor_SF"===e?t=this.parent.localeObj.getConstant("taskBeforePredecessor_SF"):"taskAfterPredecessor_SF"===e&&(t=this.parent.localeObj.getConstant("taskAfterPredecessor_SF")),'<div id="'+i+'_ValidationText">'+(t=Y(t,r))+"<div>");return n.innerHTML=e+('<table><tr><td><input type="radio" id="'+i+'_ValidationCancel" name="ValidationRule" checked/><label for="'+i+'_ValidationCancel" id= "'+i+'_cancelLink">Cancel, keep the existing link</label></td></tr><tr><td><input type="radio" id="'+i+'_ValidationRemoveline" name="ValidationRule"/><label for="'+i+'_ValidationRemoveline" id="'+i+'_removeLink">Remove the link and move <b>'+s+"</b> to start on <b>"+a+'</b>.</label></td></tr><tr><td><input type="radio" id="'+i+'_ValidationAddlineOffset" name="ValidationRule"/><label for="'+i+'_ValidationAddlineOffset" id="'+i+'_preserveLink">Move the <b>'+s+"</b> to start on <b>"+a+"</b> and keep the link.</label></td></tr></table>"),n},v.prototype.validateTypes=function(e,t){for(var i,n,a=this.parent.predecessorModule.getValidPredecessor(e),r=(this.validationPredecessor=[],this.parent.predecessorModule.getPredecessorDate(e,a)),s=(t||e).ganttProperties,o=this.parent.allowUnscheduledTasks&&oe.isNullOrUndefined(r)?s.endDate:this.dateValidateModule.getEndDate(r,s.duration,s.durationUnit,s,!1),l=0;l<a.length;l++){var d,h,p=this.parent.connectorLineModule.getRecordByID(a[l].from),u=null;"FS"===a[l].type?0!==this.parent.dateValidationModule.getDuration(r,s.startDate,this.parent.durationUnit,s.isAutoSchedule,s.isMilestone,!0)&&(s.startDate<r?(this.validationPredecessor.push(a[parseInt(l.toString(),10)]),u="taskBeforePredecessor_FS"):s.startDate>r&&(this.validationPredecessor.push(a[parseInt(l.toString(),10)]),u="taskAfterPredecessor_FS")):"SS"===a[l].type?(d=new Date(s.endDate),h=new Date(r),s.startDate<r?(this.validationPredecessor.push(a[parseInt(l.toString(),10)]),u="taskBeforePredecessor_SS"):s.startDate>r?(this.validationPredecessor.push(a[parseInt(l.toString(),10)]),u="taskAfterPredecessor_SS"):this.parent.allowUnscheduledTasks&&oe.isNullOrUndefined(s.startDate)&&oe.isNullOrUndefined(s.duration)&&d.setHours(0,0,0,0)<h.setHours(0,0,0,0)?(this.validationPredecessor.push(a[parseInt(l.toString(),10)]),u="taskBeforePredecessor_SS"):this.parent.allowUnscheduledTasks&&oe.isNullOrUndefined(s.startDate)&&oe.isNullOrUndefined(s.duration)&&d.setHours(0,0,0,0)>h.setHours(0,0,0,0)&&(this.validationPredecessor.push(a[parseInt(l.toString(),10)]),u="taskAfterPredecessor_SS")):"FF"===a[l].type?0!==this.parent.dateValidationModule.getDuration(r,p.ganttProperties.endDate,this.parent.durationUnit,p.ganttProperties.isAutoSchedule,p.ganttProperties.isMilestone,!0)&&(o<=p.ganttProperties.endDate?(this.validationPredecessor.push(a[parseInt(l.toString(),10)]),u="taskBeforePredecessor_FF"):o>p.ganttProperties.endDate&&(this.validationPredecessor.push(a[parseInt(l.toString(),10)]),u="taskAfterPredecessor_FF")):"SF"===a[l].type&&0!==this.parent.dateValidationModule.getDuration(p.ganttProperties.startDate,o,this.parent.durationUnit,p.ganttProperties.isAutoSchedule,p.ganttProperties.isMilestone,!0)&&(o<p.ganttProperties.startDate?(this.validationPredecessor.push(a[parseInt(l.toString(),10)]),u="taskBeforePredecessor_SF"):o>=p.ganttProperties.startDate&&(this.validationPredecessor.push(a[parseInt(l.toString(),10)]),u="taskAfterPredecessor_SF")),!oe.isNullOrUndefined(u)&&oe.isNullOrUndefined(n)&&(i=p,n=u)}return{parentTask:i,task:e,violationType:n}},v.prototype.addRemovePredecessor=function(a){var e=this.parent.previousRecords[a.uniqueID],n=a.ganttProperties.predecessor.slice();if(e&&e.ganttProperties&&e.ganttProperties.hasOwnProperty("predecessor")){var r=e.ganttProperties.predecessor;if(!oe.isNullOrUndefined(r))for(var s=this,t=0;t<r.length;t++)!function(t){var e,i,n=s.parent.connectorLineModule.getRecordByID(r[parseInt(t.toString(),10)].from);n===a?0!==a.ganttProperties.predecessor.filter(function(e){return r[t].from===e.from&&r[t].to===e.to}).length||a.parentItem&&s.parent.taskFields.dependency&&a.ganttProperties.predecessor&&s.parent.allowParentDependency&&(r[t].from===a.parentItem.taskId||r[t].to===a.parentItem.taskId)||a.ganttProperties.predecessor.push(r[parseInt(t.toString(),10)]):(e=oe.extend([],[],n.ganttProperties.predecessor,!0),-1!==(i=K(r[parseInt(t.toString(),10)],"from",e,"to"))&&(e.splice(i,1),s.parent.setRecordValue("predecessor",e,n.ganttProperties,!0)))}(t);if(!oe.isNullOrUndefined(n))for(var o=this,i=0;i<n.length;i++)!function(t){var e=o.parent.connectorLineModule.getRecordByID(n[parseInt(t.toString(),10)].from),i=oe.extend([],[],e.ganttProperties.predecessor,!0);0===i.filter(function(e){return n[t].from===e.from&&n[t].to===e.to}).length&&(i.push(n[parseInt(t.toString(),10)]),o.parent.setRecordValue("predecessor",i,e.ganttProperties,!0))}(i)}},v.prototype.removePredecessorByIndex=function(e,t){this.parent.undoRedoModule&&!this.parent.undoRedoModule.isUndoRedoPerformed&&(this.parent.undoRedoModule.redoEnabled&&this.parent.undoRedoModule.disableRedo(),this.parent.undoRedoModule.createUndoCollection(),(i={action:"DeleteDependency"}).modifiedRecords=oe.extend([],[e],[],!0),this.parent.undoRedoModule.getUndoCollection[this.parent.undoRedoModule.getUndoCollection.length-1]=i);var i=e.ganttProperties.predecessor,t=i.splice(t,1),n=this.parent.connectorLineModule.getRecordByID(t[0].from).ganttProperties.predecessor,a=K(t[0],"from",n,"to"),n=(n.splice(a,1),this.parent.predecessorModule.getPredecessorStringValue(e));i.push(t[0]),this.parent.connectorLineEditModule.updatePredecessor(e,n)},v.prototype.renderPredecessorDeleteConfirmDialog=function(){this.confirmPredecessorDialog=new U.Dialog({width:"320px",isModal:!0,enableRtl:this.parent.enableRtl,content:this.parent.localeObj.getConstant("confirmPredecessorDelete"),buttons:[{click:this.confirmOkDeleteButton.bind(this),buttonModel:{content:this.parent.localeObj.getConstant("okText"),isPrimary:!0}},{click:this.confirmCloseDialog.bind(this),buttonModel:{content:this.parent.localeObj.getConstant("cancel")}}],target:this.parent.element,animationSettings:{effect:"None"}});var e=oe.createElement("div",{id:this.parent.element.id+"_deletePredecessorConfirmDialog"});this.parent.element.appendChild(e),this.confirmPredecessorDialog.isStringTemplate=!0,this.confirmPredecessorDialog.appendTo(e)},v.prototype.confirmCloseDialog=function(){this.confirmPredecessorDialog.destroy()},v.prototype.confirmOkDeleteButton=function(){this.removePredecessorByIndex(this.childRecord,this.predecessorIndex),this.confirmPredecessorDialog.destroy()},v);function v(e){this.validationPredecessor=null,this.confirmPredecessorDialog=null,this.predecessorIndex=null,this.childRecord=null,this.validatedId=[],this.validatedOffsetIds=[],this.isPublicDependencyDelete=!1,this.parent=e,this.dateValidateModule=this.parent.dateValidationModule,this.parent.on("initPredessorDialog",this.initPredecessorValidationDialog,this)}var Pn=function(){return(Pn=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var a in t=arguments[i])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},g=(C.prototype.getModuleName=function(){return"edit"},C.prototype.updateDefaultColumnEditors=function(){for(var e,t=[this.parent.taskFields.id,this.parent.taskFields.progress,this.parent.taskFields.resourceInfo,this.parent.taskFields.type,"taskType"],i=0;i<t.length;i++)!oe.isNullOrUndefined(t[i])&&0<t[i].length&&(e=this.parent.getColumnByField(t[parseInt(i.toString(),10)],this.parent.treeGridModule.treeGridColumns))&&(e.field===this.parent.taskFields.id?this.updateIDColumnEditParams(e):e.field===this.parent.taskFields.progress&&oe.isNullOrUndefined(e.edit)?this.updateProgessColumnEditParams(e):e.field===this.parent.taskFields.resourceInfo?this.updateResourceColumnEditor(e):e.field!==this.parent.taskFields.type&&"taskType"!==e.field||this.updateTaskTypeColumnEditor(e))},C.prototype.updateIDColumnEditParams=function(e){var t={min:0,decimals:0,enableRtl:this.parent.enableRtl,validateDecimalOnType:!0,format:"n0",showSpinButton:!1};this.updateEditParams(e,t)},C.prototype.updateProgessColumnEditParams=function(e){var t={min:0,enableRtl:this.parent.enableRtl,decimals:0,validateDecimalOnType:!0,max:100,format:"n0"};this.updateEditParams(e,t)},C.prototype.updateEditParams=function(e,t){oe.isNullOrUndefined(e.edit)?(e.edit={},e.edit.params={}):oe.isNullOrUndefined(e.edit.params)&&(e.edit.params={}),oe.extend(t,e.edit.params),e.edit.params=t,this.parent.getColumnByField(e.field,this.parent.ganttColumns).edit=e.edit},C.prototype.updateResourceColumnEditor=function(e){var t;this.parent.treeGridModule.currentEditRow={},this.parent.editSettings.allowEditing&&oe.isNullOrUndefined(e.edit)&&"Auto"===this.parent.editSettings.mode&&(e.editType="dropdownedit",e.edit=this.getResourceEditor(),(t=this.parent.getColumnByField(e.field,this.parent.ganttColumns)).editType="dropdownedit",t.edit=e.edit)},C.prototype.getResourceEditor=function(){var t,r=this,s=this.parent.resourceFields,e={};return F.MultiSelect.Inject(F.CheckBoxSelection),e.write=function(e){r.parent.treeGridModule.currentEditRow={},(t=new F.MultiSelect({dataSource:new y.DataManager(r.parent.resources),fields:{text:s.name,value:s.id},enableRtl:r.parent.enableRtl,mode:"CheckBox",showDropDownIcon:!0,popupHeight:"350px",delimiterChar:",",value:r.parent.treeGridModule.getResourceIds(e.rowData)})).appendTo(e.element)},e.read=function(e){var t=e.ej2_instances[0].value,i=[];oe.isNullOrUndefined(t)&&(t=[]);for(var n=0;n<t.length;n++)for(var a=0;a<r.parent.resources.length;a++)if(r.parent.resources[a][s.id]===t[n]){i.push(r.parent.resources[a][s.name]);break}return r.parent.treeGridModule.currentEditRow[r.parent.taskFields.resourceInfo]=t,i.join(",")},e.destroy=function(){t&&t.destroy()},e},C.prototype.updateTaskTypeColumnEditor=function(e){var t;this.parent.editSettings.allowEditing&&oe.isNullOrUndefined(e.edit)&&"Auto"===this.parent.editSettings.mode&&(e.editType="dropdownedit",e.edit=this.getTaskTypeEditor(),(t=this.parent.getColumnByField(e.field,this.parent.ganttColumns)).editType="dropdownedit",t.edit=e.edit)},C.prototype.getTaskTypeEditor=function(){var t,i=this,e={},n=[{ID:1,Value:"FixedUnit"},{ID:2,Value:"FixedWork"},{ID:3,Value:"FixedDuration"}];return e.write=function(e){i.parent.treeGridModule.currentEditRow={},(t=new F.DropDownList({dataSource:new y.DataManager(n),enableRtl:i.parent.enableRtl,fields:{value:"Value"},popupHeight:"350px",value:oe.getValue("taskType",e.rowData.ganttProperties)})).appendTo(e.element)},e.read=function(e){var e=e.ej2_instances[0].value,t=i.parent.taskFields.type||"taskType";return i.parent.treeGridModule.currentEditRow[t]=e},e.destroy=function(){t&&t.destroy()},e},C.prototype.reUpdateEditModules=function(){var e,t=this.parent.editSettings;t.allowEditing?(this.parent.editModule.cellEditModule&&"Dialog"===t.mode?(this.cellEditModule.destroy(),this.parent.treeGrid.recordDoubleClick=this.recordDoubleClick.bind(this)):oe.isNullOrUndefined(this.parent.editModule.cellEditModule)&&"Auto"===t.mode&&(this.cellEditModule=new cn(this.parent)),this.parent.editModule.dialogModule&&"Auto"===t.mode?this.parent.treeGrid.recordDoubleClick=void 0:oe.isNullOrUndefined(this.parent.editModule.dialogModule)&&(this.dialogModule=new bn(this.parent))):(this.cellEditModule&&this.cellEditModule.destroy(),this.dialogModule&&this.dialogModule.destroy()),t.allowDeleting&&t.showDeleteConfirmDialog?oe.isNullOrUndefined(this.confirmDialog)&&(e=oe.createElement("div",{id:this.parent.element.id+"_deleteConfirmDialog"}),this.parent.element.appendChild(e),this.renderDeleteConfirmDialog()):t.allowDeleting&&t.showDeleteConfirmDialog||this.confirmDialog&&!this.confirmDialog.isDestroyed&&this.confirmDialog.destroy(),t.allowTaskbarEditing?oe.isNullOrUndefined(this.parent.editModule.taskbarEditModule)&&(this.taskbarEditModule=new kn(this.parent)):this.taskbarEditModule&&this.taskbarEditModule.destroy()},C.prototype.recordDoubleClick=function(e){var t,i;this.parent.editSettings.allowEditing&&"Dialog"===this.parent.editSettings.mode&&(i=void 0,e.row&&(t=oe.getValue("rowIndex",e.row),i=this.parent.currentViewData[t]),oe.isNullOrUndefined(i)||this.dialogModule.openEditDialog(i)),this.parent.ganttChartModule.recordDoubleClick(e)},C.prototype.destroy=function(){this.cellEditModule&&this.cellEditModule.destroy(),this.taskbarEditModule&&this.taskbarEditModule.destroy(),this.dialogModule&&this.dialogModule.destroy(),this.confirmDialog&&!this.confirmDialog.isDestroyed&&this.confirmDialog.destroy()},C.prototype.updateRecordByID=function(r){var s=this;if(this.parent.enableImmutableMode&&this.parent.editSettings.allowEditing&&0<this.parent.treeGrid.element.getElementsByClassName("e-editedbatchcell").length&&this.parent.treeGrid.endEdit(),!this.parent.readOnly){var e=this.parent.taskFields;if(!oe.isNullOrUndefined(r)&&!oe.isNullOrUndefined(r[e.id])){var o="ResourceView"===this.parent.viewType?this.parent.flatData[this.parent.getTaskIds().indexOf("T"+r[e.id])]:this.parent.getRecordByID(r[e.id]);if(oe.isNullOrUndefined(o[e.milestone])||!0===o[e.milestone]&&(o[e.milestone]=!1),this.parent.undoRedoModule&&!this.parent.undoRedoModule.isUndoRedoPerformed&&this.parent.isUndoRedoItemPresent("Edit")&&o&&(this.parent.undoRedoModule.createUndoCollection(),(d={}).requestType=this.parent.contextMenuModule&&this.parent.contextMenuModule.item?this.parent.contextMenuModule.item:"methodUpdate",d.modifiedRecords=oe.extend([],[o],[],!0),this.parent.undoRedoModule.getUndoCollection[this.parent.undoRedoModule.getUndoCollection.length-1]=d),!oe.isNullOrUndefined(this.parent.editModule)&&o){if(this.parent.isOnEdit=!0,this.validateUpdateValues(r,o,!0),this.parent.undoRedoModule&&this.parent.undoRedoModule.isUndoRedoPerformed){if("ProjectView"===this.parent.viewType&&r.ganttProperties.predecessor){for(var l=this,t=0;t<r.ganttProperties.predecessor.length;t++)if("break"===function(t){var e=o.ganttProperties.predecessor.filter(function(e){return e.from===r.ganttProperties.predecessor[t].from&&e.to===r.ganttProperties.predecessor[t].to&&r.ganttProperties.predecessor[t].offset!==e.offset&&(s.parent.flatData[s.parent.ids.indexOf(e.to)].ganttProperties.predecessor.filter(function(e){return e.from===r.ganttProperties.predecessor[t].from&&e.to===r.ganttProperties.predecessor[t].to})[0].offset=r.ganttProperties.predecessor[t].offset),e.from!==r.ganttProperties.predecessor[t].from&&e.from!==r.ganttProperties.predecessor[t].to});if(0<e.length){for(var i=0;i<e.length;i++)for(var n=l.parent.flatData[l.parent.ids.indexOf(e[i].from)],a=0;a<n.ganttProperties.predecessor.length;a++)if(n.ganttProperties.predecessor[a].from===e[i].from&&n.ganttProperties.predecessor[a].to===e[i].to){n.ganttProperties.predecessor.splice(a,1);break}return"break"}}(t))break}else if(!r.ganttProperties.predecessor&&o.ganttProperties.predecessor)for(t=0;t<o.ganttProperties.predecessor.length;t++)for(var i=void 0,i=o.ganttProperties.taskId.toString()===o.ganttProperties.predecessor[t].from?o.ganttProperties.predecessor[t].to:o.ganttProperties.predecessor[t].from,n=this.parent.flatData[this.parent.ids.indexOf(i)],a=0;a<n.ganttProperties.predecessor.length;a++)n.ganttProperties.predecessor[a].from===o.ganttProperties.predecessor[t].from&&n.ganttProperties.predecessor[a].to===o.ganttProperties.predecessor[t].to&&n.ganttProperties.predecessor.splice(a,1);o.ganttProperties.resourceInfo=r.ganttProperties.resourceInfo}r[this.parent.taskFields.resourceInfo]&&(0!==o.ganttProperties.duration||"FixedWork"===o.ganttProperties.taskType&&!this.parent.isConvertedMilestone||this.parent.dataOperation.updateWorkWithDuration(o),this.parent.undoRedoModule&&this.parent.undoRedoModule.isUndoRedoPerformed||this.updateResourceRelatedFields(o,"resource"),this.parent.dateValidationModule.calculateEndDate(o));var d=Object.keys(r);-1===d.indexOf(e.startDate)&&-1===d.indexOf(e.endDate)&&-1===d.indexOf(e.duration)||this.parent.dataOperation.calculateScheduledValues(o,o.taskData,!1),this.parent.dataOperation.updateWidthLeft(o),oe.isUndefined(r[this.parent.taskFields.dependency])||r[this.parent.taskFields.dependency]===o.ganttProperties.predecessorsName?((d={}).data=o,"ResourceView"===this.parent.viewType&&(d.action="methodUpdate"),this.parent.editModule.initiateUpdateAction(d)):this.parent.connectorLineEditModule.updatePredecessor(o,r[this.parent.taskFields.dependency])}}}},C.prototype.validateUpdateValues=function(e,t,i){for(var n=this.parent,a=n.taskFields,r=G(n.columnMapping),s=[],o=!1,l=0,d=Object.keys(e);l<d.length;l++){var h=d[l];if(a.startDate===h||a.endDate===h||a.duration===h)oe.isNullOrUndefined(e[""+h])&&!n.allowUnscheduledTasks||(c=t.ganttProperties,p=a.duration===h,i?(p?(n.dataOperation.updateDurationValue(e[h],c),0<c.duration&&c.isMilestone&&this.parent.setRecordValue("isMilestone",!1,c,!0)):(p="string"==typeof e[h]?new Date(e[h]):e[h],h===a.endDate&&oe.isNullOrUndefined(c.startDate)&&(oe.isNullOrUndefined(e[a.duration])||""===e[a.duration]||Number.isNaN(e[a.duration]))&&(p=this.parent.editModule.dialogModule.isFromEditDialog?t.ganttProperties.endDate:e[a.endDate]),n.setRecordValue(r[h],p,c,!0),!t[a.startDate]||t[a.startDate]instanceof Date||(t[a.startDate]=new Date(t[a.startDate])),!t[a.endDate]||t[a.endDate]instanceof Date||(t[a.endDate]=new Date(t[a.endDate]))),n.dataOperation.updateMappingData(t,r[h])):(s.push(h),o=!0));else if(a.resourceInfo===h){var p=n.dataOperation.setResourceInfo(e);"ResourceView"===this.parent.viewType&&(JSON.stringify(p)!==JSON.stringify(t.ganttProperties.resourceInfo)?(this.parent.editModule.dialogModule.isResourceUpdate=!0,this.parent.editModule.dialogModule.previousResource=oe.isNullOrUndefined(t.ganttProperties.resourceInfo)?[]:t.ganttProperties.resourceInfo.slice()):this.parent.editModule.dialogModule.isResourceUpdate=!1),this.parent.undoRedoModule&&this.parent.undoRedoModule.isUndoRedoPerformed||(t.ganttProperties.resourceInfo=p),n.dataOperation.updateMappingData(t,"resourceInfo")}else if(a.dependency!==h)if(-1!==[a.progress,a.notes,a.durationUnit,a.expandState,a.milestone,a.name,a.baselineStartDate,a.baselineEndDate,a.id,a.segments,a.cssClass].indexOf(h)){var u,c,g,f=n.columnByField[h],m=e[h],y=(oe.isNullOrUndefined(f)||"datepickeredit"!==f.editType&&"datetimepickeredit"!==f.editType||(m=n.dataOperation.getDateFromFormat(m)),r[h]);switch(h){case a.id:y="taskId";break;case a.name:y="taskName";break;case a.cssClass:y="cssClass";break;case a.milestone:var D,k,y="isMilestone";oe.isNullOrUndefined(a.duration)||(D=t.ganttProperties,k=e[a.duration],n.setRecordValue(a.duration,k=m?0:k<=0?1:k,t,!0),n.setRecordValue("duration",k,D,!0),n.setRecordValue("taskData."+a.duration,k,t));break;case a.segments:t.ganttProperties.segments&&(y="segments",e)&&!oe.isNullOrUndefined(e[a.segments])&&0<e[a.segments].length&&e.ganttProperties&&e.ganttProperties.segments&&(this.parent.undoRedoModule&&this.parent.undoRedoModule.isUndoRedoPerformed&&(t.ganttProperties.segments=e.ganttProperties.segments),D=t.ganttProperties.segments.reduce(function(e,t){return e+t.duration},0),k=t.ganttProperties.startDate,u=this.parent.dataOperation.getEndDate(k,D,t.ganttProperties.durationUnit,t.ganttProperties,!1),n.setRecordValue("endDate",n.dataOperation.getDateFromFormat(u),t.ganttProperties,!0))}if(!oe.isNullOrUndefined(y)){var w=[];if("segments"===y&&m&&0<m.length&&!oe.isNullOrUndefined(t.ganttProperties.segments)){for(var b=0;b<m.length;b++){var T={};m[b][a.startDate]&&(T.startDate=m[b][a.startDate]),m[b][a.endDate]&&(T.endDate=m[b][a.endDate]),m[b][a.duration]&&(T.duration=parseFloat(m[b][a.duration])),m[b][a.id]&&(T.id=m[b][a.id]),w.push(T)}n.setRecordValue(y,w,t.ganttProperties,!0)}else("segments"!==y||"segments"===y&&oe.isNullOrUndefined(m))&&n.setRecordValue(y,m,t.ganttProperties,!0)}(h===a.baselineStartDate||h===a.baselineEndDate)&&t.ganttProperties.baselineStartDate&&t.ganttProperties.baselineEndDate&&(c=t.ganttProperties,n.setRecordValue("baselineStartDate",n.dataOperation.checkBaselineStartDate(c.baselineStartDate,c),c,!0),g=this.parent.getCurrentDayEndTime(c.baselineEndDate),c.baselineEndDate&&0===c.baselineEndDate.getHours()&&86400!==g&&n.dataOperation.setTime(g,c.baselineEndDate),(c.baselineStartDate&&c.baselineEndDate&&c.baselineStartDate.getTime()>c.baselineEndDate.getTime()||!oe.isNullOrUndefined(c.baselineStartDate)&&!oe.isNullOrUndefined(c.startDate)&&c.baselineStartDate.getTime()===c.startDate.getTime()&&!oe.isNullOrUndefined(c.baselineEndDate)&&!oe.isNullOrUndefined(c.endDate)&&c.baselineEndDate.toLocaleDateString()===c.endDate.toLocaleDateString()&&c.isMilestone)&&(c.baselineEndDate=c.baselineStartDate),n.setRecordValue("baselineEndDate",n.dataOperation.checkBaselineEndDate(c.baselineEndDate),c,!0),n.setRecordValue("baselineLeft",n.dataOperation.calculateBaselineLeft(c),c,!0),n.setRecordValue("baselineWidth",n.dataOperation.calculateBaselineWidth(c),c,!0),!t[a.baselineStartDate]||t[a.baselineStartDate]instanceof Date||(t[a.baselineStartDate]=new Date(t[a.baselineStartDate])),!t[a.baselineEndDate]||t[a.baselineEndDate]instanceof Date||(t[a.baselineEndDate]=new Date(t[a.baselineEndDate]))),n.setRecordValue("taskData."+h,m,t),h===a.segments&&e&&!oe.isNullOrUndefined(e[a.segments])&&0<e[a.segments].length&&(this.parent.undoRedoModule&&this.parent.undoRedoModule.isUndoRedoPerformed&&e.ganttProperties&&e.ganttProperties.segments&&(t.ganttProperties.segments=e.ganttProperties.segments),n.dataOperation.setSegmentsInfo(t,!0)),n.setRecordValue(h,m,t)}else a.indicators===h?(m=e[h],n.setRecordValue("indicators",m,t.ganttProperties,!0),n.setRecordValue("taskData."+h,m,t),n.setRecordValue(h,m,t)):a.work===h?(n.setRecordValue("work",e[h],t.ganttProperties,!0),this.parent.dataOperation.updateMappingData(t,"work"),this.parent.dataOperation.updateMappingData(t,"duration"),this.parent.dataOperation.updateMappingData(t,"endDate")):h===a.type?(m=e[h],n.setRecordValue("taskType",m,t.ganttProperties,!0),n.setRecordValue(h,m,t),n.setRecordValue("taskData."+h,m,t)):-1!==n.customColumns.indexOf(h)?(f=n.columnByField[h],m=e[h],!oe.isNullOrUndefined(f.edit)||"datepickeredit"!==f.editType&&"datetimepickeredit"!==f.editType||(m=n.dataOperation.getDateFromFormat(m)),n.setRecordValue("taskData."+h,m,t),n.setRecordValue(h,m,t)):a.manual===h&&(n.setRecordValue("isAutoSchedule",!e[h],t.ganttProperties,!0),this.parent.setRecordValue(h,e[h],t),this.updateTaskScheduleModes(t))}o&&this.validateScheduleValues(s,t,e)},C.prototype.updateResourceRelatedFields=function(e,t){var i=e.ganttProperties,n=this.parent.previousRecords,a=i.taskType||this.parent.taskType,r=i.isAutoSchedule,s=this.parent.editModule.dialogModule&&this.parent.editModule.dialogModule.currentResources?this.parent.editModule.dialogModule.currentResources:e.ganttProperties.resourceInfo;if(oe.isNullOrUndefined(s))oe.isNullOrUndefined(s)&&"FixedDuration"===a&&0===i.duration&&this.parent.dataOperation.updateWorkWithDuration(e);else switch(a){case"FixedUnit":oe.isNullOrUndefined(n[i.uniqueID])||oe.isNullOrUndefined(n[i.uniqueID].ganttProperties)||null!==n[i.uniqueID].ganttProperties.resourceNames&&""!==n[i.uniqueID].ganttProperties.resourceNames||this.parent.dataOperation.updateWorkWithDuration(e),0!==s.length&&(r&&s.length?"resource"===t||"work"===t?this.parent.dataOperation.updateDurationWithWork(e):"duration"!==t&&"endDate"!==t||(this.parent.dataOperation.updateWorkWithDuration(e),0===i.duration&&this.parent.setRecordValue("isMilestone",!0,i,!0)):r||"work"!==t?this.parent.dataOperation.updateWorkWithDuration(e):this.parent.dataOperation.updateUnitWithWork(e));break;case"FixedWork":0!==s.length&&(r?"duration"===t||"endDate"===t?(this.parent.dataOperation.updateUnitWithWork(e),0===i.duration&&this.parent.setRecordValue("isMilestone",!0,i,!0)):this.parent.dataOperation.updateDurationWithWork(e):"work"===t?this.parent.dataOperation.updateUnitWithWork(e):this.parent.dataOperation.updateWorkWithDuration(e));break;case"FixedDuration":0===s.length?this.parent.dataOperation.updateWorkWithDuration(e):s.length&&"work"===t?this.parent.dataOperation.updateUnitWithWork(e):this.parent.dataOperation.updateWorkWithDuration(e)}},C.prototype.validateScheduleValues=function(e,t,i){var n=this.parent;2<e.length?n.dataOperation.calculateScheduledValues(t,i,!1):1<e.length?this.validateScheduleByTwoValues(i,e,t):this.dialogModule.validateScheduleValuesByCurrentField(e[0],i[e[0]],t)},C.prototype.validateScheduleByTwoValues=function(e,t,i){var n,a,r,s=this.parent,o=s.taskFields,l=i.ganttProperties,d=s.allowUnscheduledTasks;-1!==t.indexOf(o.startDate)&&(n=e[o.startDate]),-1!==t.indexOf(o.endDate)&&(a=e[o.endDate]),-1!==t.indexOf(o.duration)&&(r=e[o.duration]),n&&a||d&&-1!==t.indexOf(o.startDate)&&-1!==t.indexOf(o.endDate)?(s.setRecordValue("startDate",s.dataOperation.getDateFromFormat(n),l,!0),s.setRecordValue("endDate",s.dataOperation.getDateFromFormat(a),l,!0),s.dataOperation.calculateDuration(i)):a&&r||d&&-1!==t.indexOf(o.endDate)&&-1!==t.indexOf(o.duration)?(s.setRecordValue("endDate",s.dataOperation.getDateFromFormat(a),l,!0),s.dataOperation.updateDurationValue(r,l)):(n&&r||d&&-1!==t.indexOf(o.startDate)&&-1!==t.indexOf(o.duration))&&(s.setRecordValue("startDate",s.dataOperation.getDateFromFormat(n),l,!0),s.dataOperation.updateDurationValue(r,l))},C.prototype.isTaskbarMoved=function(e){var t,i,n,a,r=!1,s=e.ganttProperties,e=this.parent.previousRecords&&this.parent.previousRecords[e.uniqueID];return e&&e.ganttProperties&&(t=oe.getValue("ganttProperties.startDate",e),i=oe.getValue("ganttProperties.endDate",e),n=oe.getValue("ganttProperties.duration",e),a=oe.getValue("ganttProperties.durationUnit",e),-1===(e=Object.keys(e.ganttProperties)).indexOf("startDate")&&-1===e.indexOf("endDate")&&-1===e.indexOf("duration")&&-1===e.indexOf("durationUnit")||(oe.isNullOrUndefined(t)&&!oe.isNullOrUndefined(s.startDate)||oe.isNullOrUndefined(i)&&!oe.isNullOrUndefined(s.endDate)||oe.isNullOrUndefined(s.startDate)&&!oe.isNullOrUndefined(t)||oe.isNullOrUndefined(s.endDate)&&!oe.isNullOrUndefined(i)||t&&t.getTime()!==s.startDate.getTime()||i&&i.getTime()!==s.endDate.getTime()||!oe.isNullOrUndefined(n)&&n!==s.duration||!oe.isNullOrUndefined(n)&&n===s.duration&&a!==s.durationUnit)&&(r=!0)),r},C.prototype.isPredecessorUpdated=function(e){var t=!1,i=this.parent.previousRecords[e.uniqueID];return i&&i.ganttProperties&&i.ganttProperties.hasOwnProperty("predecessor")&&(e.ganttProperties.predecessorsName===i.ganttProperties.predecessorsName||""===e.ganttProperties.predecessorsName&&oe.isNullOrUndefined(i.ganttProperties.predecessorsName)?this.parent.setRecordValue("predecessor",i.ganttProperties.predecessor,e.ganttProperties,!0):t=!0),t},C.prototype.isCheckPredecessor=function(e){var t=!1;return t=this.parent.previousRecords[e.uniqueID]&&this.parent.taskFields.dependency&&this.parent.isInPredecessorValidation&&0<this.parent.predecessorModule.getValidPredecessor(e).length&&this.isTaskbarMoved(e)?!0:t},C.prototype.updateGanttProperties=function(t,i){var n=["taskId","uniqueID","rowUniqueID","parentId","predecessor"];Object.keys(t.ganttProperties).forEach(function(e){-1===n.indexOf(e)&&(i.ganttProperties[e]=t.ganttProperties[e])})},C.prototype.initiateUpdateAction=function(e){var t,i=this.isCheckPredecessor(e.data);if(oe.isNullOrUndefined(e.data.parentItem)||i){if(0<e.data.childRecords.length&&!i&&!(i=this.isCheckPredecessor(e.data))&&this.isTaskbarMoved(e.data))for(var n=0;n<e.data.childRecords.length;n++)0<this.parent.predecessorModule.getValidPredecessor(e.data.childRecords[n]).length&&(t=n,i=!0)}else a=this.parent.getRecordByID(e.data.parentItem.taskId),i=!!(this.isTaskbarMoved(e.data)&&0<this.parent.predecessorModule.getValidPredecessor(a).length&&this.parent.isInPredecessorValidation);(!this.parent.undoRedoModule||this.parent.undoRedoModule&&!this.parent.undoRedoModule.currentAction||this.parent.undoRedoModule.currentAction&&"indent"!==this.parent.undoRedoModule.currentAction.action&&"outdent"!==this.parent.undoRedoModule.currentAction.action)&&(this.taskbarMoved=this.isTaskbarMoved(e.data)),this.predecessorUpdated=this.isPredecessorUpdated(e.data),this.predecessorUpdated&&(this.parent.isConnectorLineUpdate=!0,this.parent.connectorLineEditModule.addRemovePredecessor(e.data));var a,r={};!i||!this.parent.autoCalculateDateScheduling||this.parent.isLoad&&this.parent.treeGrid.loadChildOnDemand&&this.parent.taskFields.hasChildMapping?(this.taskbarMoved&&(this.parent.isConnectorLineUpdate=!0),this.updateEditedTask(e)):(r=oe.isNullOrUndefined(a)?oe.isNullOrUndefined(t)?this.parent.connectorLineEditModule.validateTypes(e.data):this.parent.connectorLineEditModule.validateTypes(e.data.childRecords[t],e.data):this.parent.connectorLineEditModule.validateTypes(a,e.data),this.parent.isConnectorLineUpdate=!0,oe.isNullOrUndefined(oe.getValue("violationType",r))?this.updateEditedTask(e):!1===(a=this.validateTaskEvent(e)).validateMode.preserveLinkWithEditing&&!1===a.validateMode.removeLink&&!1===a.validateMode.respectLink?this.parent.connectorLineEditModule.openValidationDialog(r):(this.parent.editModule&&this.parent.editModule.dialogModule&&this.parent.editModule.dialogModule.isEdit&&this.predecessorUpdated&&(this.isValidatedEditedRecord=!0,this.parent.predecessorModule.validatePredecessor(e.data,[],"")),this.parent.connectorLineEditModule.applyPredecessorOption()))},C.prototype.validateTaskEvent=function(e){var t={};return this.resetValidateArgs(),(this.parent.currentEditedArgs=t).cancel=!1,t.data=e.data,t.requestType="validateLinkedTask",t.validateMode=this.parent.dialogValidateMode,t.editEventArgs=e,this.parent.actionBeginTask(t),t},C.prototype.resetValidateArgs=function(){this.parent.dialogValidateMode.preserveLinkWithEditing=!0,this.parent.dialogValidateMode.removeLink=!1,this.parent.dialogValidateMode.respectLink=!1},C.prototype.validateChildPredecessors=function(){for(var e=0;e<this.parent.predecessorModule.validatedChildItems.length;e++){var t=this.parent.predecessorModule.validatedChildItems[e];t.ganttProperties.predecessor&&0<t.ganttProperties.predecessor.length&&(this.parent.editedTaskBarItem=t,this.isValidatedEditedRecord||(this.isFirstCall=!0),this.parent.predecessorModule.validatePredecessor(t,[],""))}},C.prototype.updateEditedTask=function(e){var t,i=e.data;if(this.editedRecord=i,!this.parent.autoCalculateDateScheduling||this.parent.isLoad&&this.parent.treeGrid.loadChildOnDemand&&this.parent.taskFields.hasChildMapping||this.updateParentChildRecord(i),this.parent.predecessorModule&&(this.parent.predecessorModule.isValidatedParentTaskID=""),(this.parent.isConnectorLineUpdate||this.parent.undoRedoModule&&this.parent.undoRedoModule.isUndoRedoPerformed)&&this.parent.autoCalculateDateScheduling&&!(this.parent.isLoad&&this.parent.treeGrid.loadChildOnDemand&&this.parent.taskFields.hasChildMapping)){if(this.validateChildPredecessors(),i.ganttProperties.predecessor&&(this.parent.isMileStoneEdited=i.ganttProperties.isMilestone,this.taskbarMoved&&(this.parent.editedTaskBarItem=i),this.isValidatedEditedRecord||(this.isFirstCall=!0,this.parent.predecessorModule.validatePredecessor(i,[],""),this.parent.predecessorModule.isChildRecordValidated=[]),this.isValidatedEditedRecord=!1),this.parent.predecessorModule.isValidatedParentTaskID="",this.parent.allowParentDependency&&this.parent.predecessorModule.isValidatedParentTaskID!==i.ganttProperties.taskId&&i.hasChildRecords&&this.parent.previousRecords[i.uniqueID].ganttProperties.startDate&&"TaskbarEditing"!==e.action&&(!i.hasChildRecords||i.hasChildRecords&&i.ganttProperties.isAutoSchedule)&&(this.parent.predecessorModule.updateChildItems(i),this.validateChildPredecessors()),this.parent.predecessorModule.isValidatedParentTaskID="",this.parent.undoRedoModule&&this.parent.undoRedoModule.isUndoRedoPerformed)for(var n=0;n<i.childRecords.length;n++)i.childRecords[n].ganttProperties.predecessor&&this.parent.predecessorModule.validatePredecessor(i.childRecords[n],[],"");this.updateParentItemOnEditing(),this.parent.dataOperation.updateParentItems(i,!0)}i.parentItem&&(!this.parent.autoCalculateDateScheduling||this.parent.isLoad&&this.parent.treeGrid.loadChildOnDemand&&this.parent.taskFields.hasChildMapping||this.parent.dataOperation.updateParentItems(i,!0),t=this.parent.getRecordByID(i.parentItem.taskId),oe.isNullOrUndefined(t)||t.ganttProperties.predecessorsName||(this.isFirstCall=!0,this.parent.predecessorModule.validatePredecessor(t,[],""),this.updateParentItemOnEditing())),this.parent.updateOffsetOnTaskbarEdit&&this.parent.connectorLineEditModule&&e.data&&(this.parent.connectorLineEditModule.validatedOffsetIds=[],this.parent.connectorLineEditModule.calculateOffset(e.data)),this.parent.predecessorModule.validatedParentIds=[],(oe.isNullOrUndefined(this.dialogModule)||this.dialogModule&&!this.dialogModule.isFromDialogPredecessor)&&this.initiateSaveAction(e)},C.prototype.updateParentItemOnEditing=function(){for(var t=this,e=oe.getValue("parentRecord",this.parent.predecessorModule),i=0;i<e.length;i++)this.parent.dataOperation.updateParentItems(e[i]);this.parent.editModule.updateParentRecords&&0<this.parent.editModule.updateParentRecords.length&&this.parent.editModule.updateParentRecords.forEach(function(e){e.ganttProperties.predecessor&&0<e.ganttProperties.predecessor.length&&t.parent.predecessorModule.validatePredecessor(e,[],"")});for(i=0;i<e.length;i++)this.parent.dataOperation.updateParentItems(e[i]);oe.setValue("parentRecord",[],this.parent.predecessorModule),oe.setValue("parentIds",[],this.parent.predecessorModule)},C.prototype.updateParentChildRecord=function(e){!e.hasChildRecords||!this.taskbarMoved||!1!==e[this.parent.taskFields.manual]&&"Auto"!==this.parent.taskMode||oe.isNullOrUndefined(this.parent.editModule.cellEditModule)||this.parent.editModule.cellEditModule.isResourceCellEdited||this.parent.predecessorModule.updateChildItems(e),oe.isNullOrUndefined(this.parent.editModule.cellEditModule)||(this.parent.editModule.cellEditModule.isResourceCellEdited=!1)},C.prototype.updateTaskScheduleModes=function(e){var t=e[this.parent.taskFields.startDate],i=e.ganttProperties;this.parent.taskFields.manual&&this.parent.setRecordValue(this.parent.taskFields.manual,!e.ganttProperties.isAutoSchedule,e),e.hasChildRecords&&i.isAutoSchedule?(this.parent.setRecordValue("startDate",i.autoStartDate,i,!0),this.parent.setRecordValue("endDate",i.autoEndDate,i,!0),this.parent.setRecordValue("StartDate",i.autoStartDate,e,!0),this.parent.setRecordValue("EndDate",i.autoEndDate,e,!0),this.parent.setRecordValue("taskData.StartDate",i.autoStartDate,e,!0),this.parent.setRecordValue("taskData.EndDate",i.autoEndDate,e,!0),this.parent.setRecordValue("width",this.parent.dataOperation.calculateWidth(e,!0),i,!0),this.parent.setRecordValue("left",this.parent.dataOperation.calculateLeft(i,e,!0),i,!0),this.parent.setRecordValue("progressWidth",this.parent.dataOperation.getProgressWidth(i.width,i.progress),i,!0),this.parent.dataOperation.calculateDuration(e)):e.hasChildRecords&&!i.isAutoSchedule?(this.parent.dataOperation.updateWidthLeft(e),this.parent.dataOperation.calculateDuration(e),this.parent.setRecordValue("autoStartDate",i.autoStartDate,i,!0),this.parent.setRecordValue("autoEndDate",i.autoEndDate,i,!0),this.parent.setRecordValue("autoDuration",this.parent.dataOperation.calculateAutoDuration(e),i,!0),this.parent.dataOperation.updateAutoWidthLeft(e)):(i=this.parent.dateValidationModule.checkStartDate(t,e.ganttProperties),this.parent.setRecordValue("startDate",i,e.ganttProperties,!0),this.parent.dataOperation.updateMappingData(e,"startDate"),this.parent.dateValidationModule.calculateEndDate(e),this.parent.setRecordValue("taskData."+this.parent.taskFields.manual,e[this.parent.taskFields.manual],e),this.parent.dataOperation.updateWidthLeft(e))},C.prototype.updateParentProgress=function(e){var t,i=0,e=this.parent.getParentTask(e),n=e.childRecords,a=n?n.length:0,r=0,s=0,o=0;if(n){for(var l=0;l<a;l++)n[l].ganttProperties.isMilestone&&!n[l].hasChildRecords||!H(n[l].ganttProperties)?s+=1:(t=this.parent.dataOperation.getParentProgress(n[l]),r+=oe.getValue("totalProgress",t),o+=oe.getValue("totalDuration",t));i=0<a-s?Math.round(r/o):0,isNaN(i)&&(i=0),this.parent.setRecordValue("progressWidth",this.parent.dataOperation.getProgressWidth(e.ganttProperties.isAutoSchedule?e.ganttProperties.width:e.ganttProperties.autoWidth,i),e.ganttProperties,!0),this.parent.setRecordValue("progress",Math.floor(i),e.ganttProperties,!0),this.parent.setRecordValue("totalProgress",r,e.ganttProperties,!0),this.parent.setRecordValue("totalDuration",o,e.ganttProperties,!0)}this.parent.dataOperation.updateTaskData(e),e.parentItem&&this.updateParentProgress(e.parentItem)},C.prototype.revertCellEdit=function(e){this.parent.editModule.reUpdatePreviousRecords(!1,!0),this.resetEditProperties()},C.prototype.reUpdatePreviousRecords=function(e,t){for(var i=this.parent.previousRecords,n=Object.keys(i),a=0;a<n.length;a++){var r,s=n[a],o=i[s],s=this.parent.getTaskByUniqueID(s),o=(this.copyTaskData(s.taskData,o.taskData),delete o.taskData,this.copyTaskData(s.ganttProperties,o.ganttProperties),delete o.ganttProperties,this.copyTaskData(s,o),this.parent.currentViewData.indexOf(s));e&&this.parent.chartRowsModule.refreshRow(o),t&&(r="ProjectView"===this.parent.viewType?s.ganttProperties.taskId:s.ganttProperties.rowUniqueID,this.parent.treeGrid.grid.setRowData(r,s),this.parent.treeGrid.grid.getRowObjectFromUID(this.parent.treeGrid.grid.getDataRows()[o].getAttribute("data-uid")).data=s)}},C.prototype.copyTaskData=function(e,t){oe.isNullOrUndefined(t)||oe.extend(e,t)},C.prototype.updateScheduleDatesOnEditing=function(e){},C.prototype.initiateSaveAction=function(d){var h=this,p={requestType:"beforeSave"},u=(p.data=d.data,this.createArray=!(p.cancel=!1),this.parent.toolbarModule&&this.parent.undoRedoModule&&!this.parent.undoRedoModule.isUndoRedoPerformed&&0<this.parent.undoRedoModule.getUndoCollection.length&&this.parent.toolbarModule.enableItems([this.parent.controlId+"_undo"],!0),p.modifiedRecords=this.parent.editedRecords,oe.isNullOrUndefined(d.target)||(p.target=d.target),p.modifiedTaskData=X(this.parent.editedRecords,!0),"DrawConnectorLine"!==d.action&&"DeleteConnectorLine"!==d.action||(p.action=d.action,"DeleteConnectorLine"===d.action&&(this.parent.connectorLineEditModule.isPublicDependencyDelete=!1,this.parent.contextMenuModule)&&(this.parent.contextMenuModule.isCntxtMenuDependencyDelete=!1)),this.parent),c=Pn({},p.data.ganttProperties.baselineStartDate),g=Pn({},p.data.ganttProperties.baselineEndDate),f=p.data.ganttProperties.progress,m=JSON.parse(JSON.stringify(p.data.ganttProperties));this.parent.trigger("actionBegin",p,function(e){c===e.data.ganttProperties.baselineStartDate&&g===e.data.ganttProperties.baselineEndDate||(u.setRecordValue("baselineLeft",u.dataOperation.calculateBaselineLeft(e.data.ganttProperties),e.data.ganttProperties,!0),u.setRecordValue("baselineWidth",u.dataOperation.calculateBaselineWidth(e.data.ganttProperties),e.data.ganttProperties,!0)),h.parent.autoCalculateDateScheduling&&m!==e.data.ganttProperties&&!oe.isNullOrUndefined(e.data.parentItem)&&(h.updateParentItemOnEditing(),h.parent.dataOperation.updateParentItems(e.data,!0));var t=e.data.ganttProperties,i=t.startDate,n=t.endDate,a=t.segments,r=t.durationUnit,s=t.isAutoSchedule,o=t.isMilestone;if(i&&n&&!a&&!h.parent.dataOperation.isDurationValueUpdated&&0!==h.parent.dateValidationModule.getDuration(i,n,r,s,o,!0)&&(t.isMilestone=!1,h.parent.dateValidationModule.calculateDuration(e.data)),h.parent.dataOperation.updateWidthLeft(e.data),oe.isNullOrUndefined(h.parent.taskFields.progress)||f===e.data.ganttProperties.progress||(a=e.data.ganttProperties.isAutoSchedule?e.data.ganttProperties.width:e.data.ganttProperties.autoWidth,h.parent.setRecordValue("progressWidth",h.parent.dataOperation.getProgressWidth(a,e.data.ganttProperties.progress),e.data.ganttProperties,!0)),h.parent.chartRowsModule.updateSegment(e.data.ganttProperties.segments,e.data.ganttProperties.taskId),e.cancel)h.reUpdatePreviousRecords(),h.parent.chartRowsModule.refreshRecords([d.data]),h.resetEditProperties(p);else{if(oe.isNullOrUndefined(h.parent.loadingIndicator)||"Shimmer"!==h.parent.loadingIndicator.indicatorType?h.parent.showSpinner():h.parent.showMaskRow(),e.modifiedRecords)for(var l=0;l<e.modifiedRecords.length;l++)h.parent.dataOperation.updateTaskData(e.modifiedRecords[l]);e.modifiedTaskData=X(e.modifiedRecords,null,null,h.parent),_(h.parent.dataSource)?(i=h.parent.dataSource,n={changedRecords:e.modifiedTaskData},r=h.parent.query instanceof y.Query?h.parent.query:new y.Query,((s=i.adaptor)instanceof y.WebApiAdaptor&&s instanceof y.ODataAdaptor&&!i.dataSource.batchUrl?i.update(h.parent.taskFields.id,n.changedRecords,null,r):i.saveChanges(n,h.parent.taskFields.id,null,r)).then(function(e){return h.dmSuccess(e,d)}).catch(function(e){return h.dmFailure(e,d)})):h.saveSuccess(d),h.parent.enableVirtualization&&h.parent.enableTimelineVirtualization&&h.parent.ganttChartModule.setVirtualHeight(),h.parent.undoRedoModule&&(h.parent.previousFlatData=oe.extend([],h.parent.flatData,[],!0))}}),this.parent.ganttChartModule.reRenderConnectorLines()},C.prototype.updateEditedFields=function(e){for(var t=(e.changedRecords||e).length,i=0;i<t;i++){for(var n=(e.changedRecords||e)[parseInt(i.toString(),10)],a=Object.keys(n).length,r=0,s=Object.keys(n);r<a;r++){var o=s[parseInt(r.toString(),10)];this.parent.editedRecords[parseInt(i.toString(),10)][""+o]=n[""+o],this.parent.editedRecords[parseInt(i.toString(),10)].taskData[""+o]=n[""+o]}this.updateEditedRecordFields(n,this.parent.editedRecords[parseInt(i.toString(),10)])}},C.prototype.dmSuccess=function(e,t){this.updateEditedFields(e),this.saveSuccess(t)},C.prototype.updateEditedRecordFields=function(e,t){for(var i=this.parent.taskFields,n=Object.keys(e).length,a=0,r=Object.keys(e);a<n;a++){var s=r[parseInt(a.toString(),10)];t[""+s]=e[""+s]}null!==i.id&&(t.ganttProperties.taskId=e[i.id]),null!==i.name&&(t.ganttProperties.taskName=e[i.name]),null!==i.startDate&&(t.ganttProperties.startDate=e[i.startDate]),null!==i.endDate&&(t.ganttProperties.endDate=e[i.endDate]),null!==i.duration&&(t.ganttProperties.duration=parseFloat(e[i.duration])),null!==i.durationUnit&&(t.ganttProperties.durationUnit=e[i.durationUnit]),null!==i.progress&&(t.ganttProperties.progress=e[i.progress]),null!==i.dependency&&(t.ganttProperties.dependency=e[i.dependency]),null!==i.parentID&&(t.ganttProperties.parentID=e[i.parentID]),null!==i.baselineEndDate&&(t.ganttProperties.baselineEndDate=e[i.baselineEndDate]),null!==i.baselineStartDate&&(t.ganttProperties.baselineStartDate=e[i.baselineStartDate]),null!==i.resourceInfo&&(t.ganttProperties.resources=e[i.resourceInfo])},C.prototype.dmFailure=function(e,t){if(this.deletedTaskDetails.length){for(var i=this.deletedTaskDetails,n=0;n<i.length;n++)i[n].isDelete=!1;this.deletedTaskDetails=[]}this.reUpdatePreviousRecords(!0,!0),this.resetEditProperties(),this.parent.trigger("actionFailure",{error:e})},C.prototype.updateSharedTask=function(e){for(var t=e.ganttProperties.sharedTaskUniqueIds,i=0;i<t.length;i++){var n=this.parent.flatData[this.parent.ids.indexOf(t[i].toString())];n&&n.uniqueID!==e.uniqueID&&(this.updateGanttProperties(e,n),this.parent.setRecordValue("taskData",e.taskData,n,!0),this.parent.dataOperation.updateTaskData(n),this.parent.dataOperation.updateResourceName(n),oe.isNullOrUndefined(n.parentItem)||this.parent.dataOperation.updateParentItems(n.parentItem))}},C.prototype.saveSuccess=function(e){var t={};if(this.parent.timelineSettings.updateTimescaleView&&(n=this.parent.editedRecords,this.parent.timelineModule.updateTimeLineOnEditing([n],e.action)),"ResourceView"===this.parent.viewType){"TaskbarEditing"===e.action||"DrawConnectorLine"===e.action||"DeleteConnectorLine"===e.action?this.updateSharedTask(e.data):"DialogEditing"!==e.action&&"CellEditing"!==e.action&&"methodUpdate"!==e.action||(this.parent.editModule.dialogModule.isResourceUpdate?(this.updateResoures(this.parent.editModule.dialogModule.previousResource,e.data.ganttProperties.resourceInfo,e.data),this.updateSharedTask(e.data),this.isTreeGridRefresh=!0):this.updateSharedTask(e.data));for(var i=0;i<this.updateParentRecords.length;i++)this.parent.dataOperation.updateParentItems(this.updateParentRecords[i]);this.updateParentRecords=[],this.parent.editModule.dialogModule.isResourceUpdate=!1,this.parent.editModule.dialogModule.previousResource=[]}var n=this.parent.criticalPathModule;this.parent.enableCriticalPath&&n&&n.criticalPathCollection&&(n.showCriticalPath(!0),n.criticalConnectorLine(n.criticalPathCollection,n.detailPredecessorCollection,!0,n.predecessorCollectionTaskIds)),this.isTreeGridRefresh||(this.parent.editSettings.allowEditing&&0<this.parent.treeGrid.element.getElementsByClassName("e-editedbatchcell").length&&(this.parent.treeGrid.grid.element.querySelector("form").ej2_instances[0].validate()||(oe.setValue("isEdit",!1,this.parent.treeGrid.grid),this.parent.editModule.cellEditModule.isCellEdit=!1),this.parent.treeGrid.endEdit()),this.parent.chartRowsModule.refreshRecords(this.parent.editedRecords),!this.parent.allowTaskbarOverlap&&this.parent.showOverAllocation&&(this.parent.contentHeight=this.parent.element.getElementsByClassName("e-content")[0].children[0].offsetHeight,this.parent.ganttChartModule.chartBodyContent.style.height=this.parent.contentHeight+"px",this.parent.ganttChartModule.renderRangeContainer(this.parent.currentViewData),this.parent.taskFields.dependency)&&this.parent.ganttChartModule.reRenderConnectorLines(),(this.parent.isConnectorLineUpdate||this.parent.undoRedoModule&&this.parent.undoRedoModule.currentAction&&this.parent.undoRedoModule.currentAction.connectedRecords)&&!oe.isNullOrUndefined(this.parent.connectorLineEditModule)&&(this.parent.updatedConnectorLineCollection=[],this.parent.connectorLineIds=[],this.parent.connectorLineEditModule.refreshEditedRecordConnectorLine(this.parent.editedRecords),this.updateScheduleDatesOnEditing(e))),!this.parent.editSettings.allowTaskbarEditing||this.parent.editSettings.allowTaskbarEditing&&!this.taskbarEditModule.dependencyCancel?(t.requestType="save",t.data=e.data,t.modifiedRecords=this.parent.editedRecords,t.modifiedTaskData=X(this.parent.editedRecords,null,null,this.parent),!this.parent.allowTaskbarDragAndDrop&&this.parent.rowDragAndDropModule&&"middleSegment"!==this.parent.rowDragAndDropModule.dropPosition&&this.updateRowIndex(),oe.isNullOrUndefined(e.action)||oe.setValue("action",e.action,t),"TaskbarEditing"===e.action&&(t.taskBarEditAction=e.taskBarEditAction),this.endEditAction(e),this.parent.trigger("actionComplete",t),this.parent.allowTaskbarDragAndDrop&&this.parent.rowDragAndDropModule&&this.parent.rowDragAndDropModule.draggedRecord&&(this.parent.rowDragAndDropModule.draggedRecord=null),oe.isNullOrUndefined(this.parent.loadingIndicator)||"Shimmer"!==this.parent.loadingIndicator.indicatorType?this.parent.hideSpinner():this.parent.hideMaskRow()):(this.taskbarEditModule.dependencyCancel=!1,this.resetEditProperties()),"ResourceView"===this.parent.viewType&&this.isTreeGridRefresh&&(this.parent.treeGrid.parentData=[],this.parent.updatedConnectorLineCollection=[],this.parent.connectorLineIds=[],this.parent.predecessorModule.createConnectorLinesCollection(this.parent.flatData),this.parent.treeGrid.refresh(),this.isTreeGridRefresh=!1),this.parent.editedRecords=[]},C.prototype.updateResoures=function(e,t,i){var n=this.parent.flatData,a=t?t.length:0,r=e?e.length:0;if(0!==a||0!==r){for(var s=0;s<a;s++){var o,l=[];if("NaN"===(c=parseInt(t[s][this.parent.resourceFields.id],10).toString())&&(c=t[s][this.parent.resourceFields.id]),!oe.isNullOrUndefined(e))for(var d=0;d<e.length;d++){var h=parseInt(e[d][this.parent.resourceFields.id],10).toString();if((h="NaN"===h?e[d][this.parent.resourceFields.id]:h)===c){l.push(d);break}}0===l.length?(o=n[this.parent.getTaskIds().indexOf("R"+c)])&&this.addNewRecord(i,o):("NaN"===(o=parseInt(l[0].toString(),10)).toString()&&(o=l[0].toString()),e.splice(o,1))}for(var p=e?e.length:0,s=0;s<p;s++){var u=i.ganttProperties.taskId,c=e[s][this.parent.resourceFields.id],g=n[this.parent.getTaskIds().indexOf("R"+c)];if(!oe.isNullOrUndefined(g))for(var f=0;f<g.childRecords.length;f++)g.childRecords[f].ganttProperties.taskId===u&&this.removeChildRecord(g.childRecords[f])}0<a&&(r=this.parent.getParentTask(i.parentItem))&&r.ganttProperties.taskName===this.parent.localeObj.getConstant("unassignedTask")&&this.removeChildRecord(i),0===a&&this.checkWithUnassignedTask(i),this.parent.undoRedoModule&&this.parent.undoRedoModule.isUndoRedoPerformed&&this.parent.flatData[this.parent.flatData.length-1].ganttProperties.taskName===this.parent.localeObj.getConstant("unassignedTask")&&(this.parent.flatData.splice(this.parent.flatData.length-1,1),this.parent.currentViewData.splice(this.parent.currentViewData.length-1,1),this.parent.taskIds.splice(this.parent.flatData.length-1,1),this.parent.ids.splice(this.parent.flatData.length-1,1))}},C.prototype.checkWithUnassignedTask=function(t){for(var e,i=null,n=0;n<this.parent.flatData.length;n++)this.parent.flatData[n].ganttProperties.taskName===this.parent.localeObj.getConstant("unassignedTask")&&(i=this.parent.flatData[n]);oe.isNullOrUndefined(i)?((a={})[this.parent.taskFields.id]=0,a[this.parent.taskFields.name]=this.parent.localeObj.getConstant("unassignedTask"),e=this.parent.isOnEdit,this.parent.isOnEdit=!1,a=this.parent.dataOperation.createRecord(a,0),this.parent.isOnEdit=e,this.addRecordAsBottom(a),e=this.parent.flatData[this.parent.flatData.length-1],a=this.parent.flatData.indexOf(e)+1+e.childRecords.length,t.index=a,t.level=e.level+1,this.addNewRecord(t,e),this.parent.dataSource.push(t.taskData)):this.addNewRecord(t,i);var a=this.parent.currentViewData.filter(function(e){return e.ganttProperties.taskId===t.ganttProperties.taskId&&e.hasChildRecords===t.hasChildRecords})[0];t.parentItem=a.parentItem,t.parentUniqueID=a.parentUniqueID},C.prototype.addRecordAsBottom=function(e){var t=this.parent.flatData.length,i=(this.parent.currentViewData.splice(t+1,0,e),this.parent.flatData.splice(t+1,0,e),this.parent.ids.splice(t+1,0,e.ganttProperties.rowUniqueID.toString()),0===e.level?"R"+e.ganttProperties.taskId:"T"+e.ganttProperties.taskId);this.parent.getTaskIds().splice(t+1,0,i),this.updateTreeGridUniqueID(e,"add")},C.prototype.addNewRecord=function(e,t){var i=null,i=oe.extend({},{},e,!0),n=(this.parent.setRecordValue("uniqueID",this.parent.dataOperation.getGanttUid(this.parent.element.id+"_data_"),i),this.parent.setRecordValue("uniqueID",i.uniqueID,i.ganttProperties,!0),i.uniqueID.replace(this.parent.element.id+"_data_","")),a=(this.parent.setRecordValue("rowUniqueID",n,i),this.parent.setRecordValue("rowUniqueID",n,i.ganttProperties,!0),this.parent.setRecordValue("level",1,i),this.parent.taskFields.parentID&&this.parent.setRecordValue("parentId",t.ganttProperties.taskId,i.ganttProperties,!0),this.parent.setRecordValue("parentItem",this.parent.dataOperation.getCloneParent(t),i),i.parentItem?i.parentItem.uniqueID:null);this.parent.setRecordValue("parentUniqueID",a,i),e.ganttProperties.sharedTaskUniqueIds.push(n),i.ganttProperties.sharedTaskUniqueIds=e.ganttProperties.sharedTaskUniqueIds,this.addRecordAsChild(t,i)},C.prototype.removeChildRecord=function(e){var t=this.parent,i=[],i=this.parent.dataSource instanceof y.DataManager&&0<this.parent.dataSource.dataSource.json.length?this.parent.dataSource.dataSource.json:this.parent.currentViewData,n=this.parent.dataSource,a=e,e=this.parent.getParentTask(a.parentItem);if(a){a.parentItem&&(d=0,r=e?e.childRecords:[])&&0<r.length&&(1===r.length&&(this.parent.isOnDelete=!0,r[0].isDelete=!0,this.parent.dataOperation.updateParentItems(e),this.parent.isOnDelete=!1,r[0].isDelete=!1),d=r.indexOf(a),e.childRecords.splice(d,1),this.updateParentRecords.push(e)),a.ganttProperties.sharedTaskUniqueIds.length&&(r=a.ganttProperties.sharedTaskUniqueIds.indexOf(a.ganttProperties.rowUniqueID),a.ganttProperties.sharedTaskUniqueIds.splice(r,1)),this.updateTreeGridUniqueID(a,"delete"),this.parent.taskFields.parentID||((d=[]).push(a.ganttProperties.rowUniqueID.toString()),"ProjectView"===this.parent.viewType&&this.parent.editModule.removeFromDataSource(d));var r=this.parent.flatData.indexOf(a);if(t.taskFields.parentID){for(var s=void 0,o=this.parent.currentViewData,l=0;l<o.length;l++)o[l].ganttProperties.rowUniqueID===a.ganttProperties.rowUniqueID&&(s=l);-1!==s&&(0<n.length&&n.splice(s,1),i.splice(s,1),this.parent.flatData.splice(r,1),this.parent.ids.splice(r,1),this.parent.getTaskIds().splice(r,1))}var d=i.indexOf(a);t.taskFields.parentID||(n=this.parent.editModule.getChildCount(a,0),i.splice(d,n+1),this.parent.flatData.splice(r,n+1),this.parent.ids.splice(r,n+1),this.parent.getTaskIds().splice(r,n+1)),a.parentItem&&e&&e.childRecords&&!e.childRecords.length&&(this.parent.setRecordValue("expanded",!1,e),this.parent.setRecordValue("hasChildRecords",!1,e))}},C.prototype.addRecordAsChild=function(e,t){var i,n,a=this.parent,r=this.parent.flatData.indexOf(e),s=this.parent.editModule.getChildCount(e,0),o=this.parent.getTaskByUniqueID(t.parentItem.uniqueID);if(this.parent.undoRedoModule&&this.parent.undoRedoModule.isUndoRedoPerformed&&this.dialogModule.indexes&&this.dialogModule.indexes.deletedIndexes&&0<this.dialogModule.indexes.deletedIndexes.length)if(o.ganttProperties.taskName===this.parent.localeObj.getConstant("unassignedTask"))h=this.parent.taskIds.length+1;else for(var l=0;l<this.dialogModule.indexes.deletedIndexes.length;l++){if(this.dialogModule.indexes.deletedIndexes[l].data.parentUniqueID===t.parentUniqueID&&t.ganttProperties.taskId===this.dialogModule.indexes.deletedIndexes[l].data.ganttProperties.taskId){for(var d=this.dialogModule.indexes.deletedIndexes[l].index,h="above"===this.dialogModule.indexes.deletedIndexes[l].position?d:d+1,p=0;p<e.childRecords.length;p++)if("T"+e.childRecords[p].ganttProperties.taskId===this.dialogModule.indexes.deletedIndexes[l].id){i="above"===this.dialogModule.indexes.deletedIndexes[l].position?p:p+1;break}break}if(this.dialogModule.indexes.deletedIndexes[l].data.parentUniqueID!==t.parentUniqueID&&t.ganttProperties.taskId===this.dialogModule.indexes.deletedIndexes[l].data.ganttProperties.taskId){d=this.parent.getTaskByUniqueID(t.parentItem.uniqueID);h=d.index+d.childRecords.length+1;break}}else if(this.parent.undoRedoModule&&this.parent.undoRedoModule.isUndoRedoPerformed&&o.ganttProperties.taskName===this.parent.localeObj.getConstant("unassignedTask")&&this.parent.undoRedoModule.currentAction.deletedRecordsDetails){for(p=0;p<this.parent.undoRedoModule.currentAction.deletedRecordsDetails.length;p++)if(this.parent.undoRedoModule.currentAction.deletedRecordsDetails[p].data.ganttProperties.taskId===t.ganttProperties.taskId){i=o.index?(h=this.parent.undoRedoModule.currentAction.deletedRecordsDetails[p].data.index)-o.index-1:(h=oe.isNullOrUndefined(s)||0===s?r+1:s+r+1,0);break}}else h=!oe.isNullOrUndefined(this.addRowIndex)&&this.addRowPosition&&e.childRecords&&"Child"!==this.addRowPosition?(u=e.childRecords[this.addRowIndex],n="Above"===this.addRowPosition||"Below"===this.addRowPosition?this.addRowPosition:"Child",h=u?this.addRowIndex+r+1:s+r+1,"Above"===n?h:h+1):oe.isNullOrUndefined(s)||0===s?r+1:s+r+1;this.parent.currentViewData.splice(h,0,t),this.parent.flatData.splice(h,0,t),this.parent.ids.splice(h,0,t.ganttProperties.rowUniqueID.toString()),this.updateTreeGridUniqueID(t,"add");var u=0===t.level?"R"+t.ganttProperties.taskId:"T"+t.ganttProperties.taskId;this.parent.getTaskIds().splice(h,0,u),e.hasChildRecords||(this.parent.setRecordValue("hasChildRecords",!0,e),this.parent.setRecordValue("expanded",!0,e),e.childRecords.length)||(e.childRecords=[],!a.taskFields.parentID&&oe.isNullOrUndefined(e.taskData[this.parent.taskFields.child])&&(e.taskData[this.parent.taskFields.child]=[])),0<=i?e.childRecords.splice(i,0,t):e.childRecords.splice(e.childRecords.length,0,t),oe.isNullOrUndefined(t)||this.parent.taskFields.parentID||oe.isNullOrUndefined(e.taskData[this.parent.taskFields.child])||e.taskData[this.parent.taskFields.child].splice(e.childRecords.length,0,t.taskData),oe.isNullOrUndefined(t.parentItem)||this.updateParentRecords.push(e)},C.prototype.resetEditProperties=function(e){this.parent.currentEditedArgs={},this.resetValidateArgs(),this.parent.editedTaskBarItem=null,this.parent.isOnEdit=!1,this.parent.predecessorModule.validatedChildItems=[],this.parent.isConnectorLineUpdate=!1,this.parent.editedTaskBarItem=null,this.taskbarMoved=!1,this.predecessorUpdated=!1,oe.isNullOrUndefined(this.dialogModule)||!oe.isNullOrUndefined(e)&&(oe.isNullOrUndefined(e)||"beforeSave"!==e.requestType||e.cancel)||(this.dialogModule.dialog&&!this.dialogModule.dialogObj.isDestroyed&&this.dialogModule.dialogObj.hide(),this.dialogModule.dialogClose()),this.parent.hideSpinner(),this.parent.initiateEditAction(!1)},C.prototype.endEditAction=function(e){this.resetEditProperties(),"TaskbarEditing"===e.action?this.parent.trigger("taskbarEdited",e):"CellEditing"===e.action?this.parent.trigger("endEdit",e):"DialogEditing"===e.action&&(this.dialogModule.dialog&&!this.dialogModule.dialogObj.isDestroyed&&this.dialogModule.dialogObj.hide(),this.dialogModule.dialogClose())},C.prototype.saveFailed=function(e){this.reUpdatePreviousRecords(),this.parent.hideSpinner()},C.prototype.renderDeleteConfirmDialog=function(){var e=new U.Dialog({width:"320px",isModal:!0,visible:!1,enableRtl:this.parent.enableRtl,content:this.parent.localeObj.getConstant("confirmDelete"),buttons:[{click:this.confirmDeleteOkButton.bind(this),buttonModel:{content:this.parent.localeObj.getConstant("okText"),isPrimary:!0}},{click:this.closeConfirmDialog.bind(this),buttonModel:{content:this.parent.localeObj.getConstant("cancel")}}],target:this.parent.element,animationSettings:{effect:"None"}});e.appendTo("#"+this.parent.element.id+"_deleteConfirmDialog"),this.confirmDialog=e},C.prototype.closeConfirmDialog=function(){this.confirmDialog.hide()},C.prototype.confirmDeleteOkButton=function(){this.deleteSelectedItems(),this.confirmDialog.hide(),this.parent.element.querySelector(".e-treegrid").focus()},C.prototype.startDeleteAction=function(){this.parent.editSettings.allowDeleting&&!this.parent.readOnly&&(this.parent.editSettings.showDeleteConfirmDialog?this.confirmDialog.show():(this.deleteSelectedItems(),this.parent.element.querySelector(".e-treegrid").focus()))},C.prototype.deleteResourceRecords=function(a){for(var r=this,s=[],o=this,e=0;e<a.length;e++)!function(t){if(a[t].parentItem)if(1===a[t].ganttProperties.sharedTaskUniqueIds.length){for(var e=a[t],i=e.ganttProperties.sharedTaskUniqueIds,n=0;n<i.length;n++)-1!==o.parent.ids.indexOf(i[n].toString())?s.push(o.parent.flatData[o.parent.ids.indexOf(i[n].toString())]):o.parent.undoRedoModule&&o.parent.undoRedoModule.isUndoRedoPerformed&&o.parent.undoRedoModule.currentAction&&"Delete"===o.parent.undoRedoModule.currentAction.action&&s.push(o.parent.flatData[o.parent.taskIds.indexOf("T"+a[t].ganttProperties.taskId)]);-1!==o.parent.ids.indexOf(e.ganttProperties.rowUniqueID)&&-1===s.indexOf(o.parent.flatData[o.parent.ids.indexOf(e.ganttProperties.rowUniqueID)])&&s.push(o.parent.flatData[o.parent.ids.indexOf(e.ganttProperties.rowUniqueID)])}else 1<a[t].ganttProperties.sharedTaskUniqueIds.length&&a.forEach(function(e){e.ganttProperties.sharedTaskUniqueIds.forEach(function(e){s.push(r.parent.getTaskByUniqueID(r.parent.element.id+"_data_"+e))})});else{e=o.parent.flatData.filter(function(e){return e.ganttProperties.taskId===a[t].ganttProperties.taskId&&e.hasChildRecords})[0];oe.isNullOrUndefined(e)||s.push(e)}}(e);this.deleteRow(s)},C.prototype.add=function(e,t){if(t.push(e),e.hasChildRecords)for(var i=e.childRecords,n=0;n<i.length;n++)this.add(i[n],t);else-1===t.indexOf(e)&&t.push(e)},C.prototype.deleteSelectedItems=function(){var e;this.isFromDeleteMethod?(this.targetedRecords.length&&("ResourceView"===this.parent.viewType?this.deleteResourceRecords(this.targetedRecords):this.deleteRow(this.targetedRecords)),this.isFromDeleteMethod=!1):(e=[],"Cell"!==this.parent.selectionSettings.mode?e=this.parent.selectionModule.getSelectedRecords():"Cell"===this.parent.selectionSettings.mode&&(e=this.parent.selectionModule.getCellSelectedRecords()),"ResourceView"===this.parent.viewType?this.deleteResourceRecords(e):this.deleteRow(e))},C.prototype.deleteRecord=function(e){this.isFromDeleteMethod=!0;var t=typeof e;switch(this.targetedRecords=[],t){case"number":case"string":var i=e.toString();"ResourceView"===this.parent.viewType?oe.isNullOrUndefined(i)||-1===this.parent.getTaskIds().indexOf("T"+i)||this.targetedRecords.push(this.parent.flatData[this.parent.getTaskIds().indexOf("T"+i)]):oe.isNullOrUndefined(i)||-1===this.parent.ids.indexOf(i)||this.targetedRecords.push(this.parent.getRecordByID(i));break;case"object":Array.isArray(e)?this.updateTargetedRecords(e):this.targetedRecords.push(e.valueOf())}this.startDeleteAction()},C.prototype.updateTargetedRecords=function(e){if(e.length)if("object"==typeof e[0])this.targetedRecords=e;else for(var t=0;t<e.length;t++){var i=e[t].toString();"ResourceView"===this.parent.viewType?oe.isNullOrUndefined(i)||-1===this.parent.getTaskIds().indexOf("T"+i)||this.targetedRecords.push(this.parent.flatData[this.parent.getTaskIds().indexOf("T"+i)]):oe.isNullOrUndefined(i)||-1===this.parent.ids.indexOf(i)||this.targetedRecords.push(this.parent.getRecordByID(i))}},C.prototype.deleteRow=function(e){var t=this,l=e&&e.length?e:this.parent.selectionModule.getSelectedRecords();if(this.parent.addDeleteRecord=!0,l.length){this.parent.isOnDelete=!0,l.forEach(function(e){t.parent.undoRedoModule&&t.parent.undoRedoModule.isUndoRedoPerformed&&(("ProjectView"===t.parent.viewType?t.parent.getRecordByID(e.ganttProperties.taskId):t.parent.flatData[t.parent.taskIds.indexOf((e.hasChildRecords?"R":"T")+e.ganttProperties.taskId)]).isDelete=!0),e.isDelete=!0}),"ResourceView"!==this.parent.viewType||e.length||(l=[]),this.parent.undoRedoModule&&!this.parent.undoRedoModule.isUndoRedoPerformed&&this.parent.isUndoRedoItemPresent("Delete")&&(this.parent.undoRedoModule.redoEnabled&&!this.parent.undoRedoModule.isUndoRedoPerformed&&(this.parent.undoRedoModule.disableRedo(),this.parent.undoRedoModule.getUndoCollection[0]=[]),this.parent.undoRedoModule.isUndoRedoPerformed||this.parent.undoRedoModule.createUndoCollection(),e={action:"Delete",deletedRecordsDetails:[]},this.parent.undoRedoModule.findPosition(oe.extend([],[],l,!0),e,"deletedRecordsDetails"),this.parent.undoRedoModule.getUndoCollection[this.parent.undoRedoModule.getUndoCollection.length-1]=e);for(var d=this,i=0;i<l.length;i++)!function(e){var t=l[e];if(-1!==d.deletedTaskDetails.indexOf(t))return;var i,n=[t];"ResourceView"===d.parent.viewType&&d.parent.undoRedoModule&&d.parent.undoRedoModule.isUndoRedoPerformed&&l[e].ganttProperties.resourceInfo&&1<l[e].ganttProperties.resourceInfo.length&&(n=[],l[e].hasChildRecords||(i="T"+l[e].ganttProperties.taskId,d.parent.taskIds.reduce(function(e,t){e===i&&n.push(this.parent.flatData[t])}.bind(d),[])));for(var a=0;a<n.length;a++){var r=d.parent.getParentTask(n[a].parentItem),s=(n[a].parentItem&&(s=void 0,oe.isNullOrUndefined(r)||0<(1===(s=r.childRecords).length?s:s.filter(function(e){return!e.isDelete})).length&&d.parent.dataOperation.updateParentItems(n[a].parentItem)),n[a].ganttProperties.predecessor),o=!0;"ResourceView"===d.parent.viewType&&r&&r.ganttProperties.taskName!==d.parent.localeObj.getConstant("unassignedTask")&&(o=!1),s&&s.length&&o&&d.removePredecessorOnDelete(n[a]),d.deletedTaskDetails.push(n[a]),n[a].hasChildRecords&&d.deleteChildRecords(n[a])}}(i);this.parent.selectionModule&&this.parent.allowSelection&&this.parent.selectionModule.clearSelection();e={};e.deletedRecordCollection=this.deletedTaskDetails,e.updatedRecordCollection=this.parent.editedRecords,e.cancel=!1,e.action="delete",this.initiateDeleteAction(e),this.parent.isOnDelete=!1}oe.isNullOrUndefined(this.parent.toolbarModule)||this.parent.toolbarModule.refreshToolbarItems()},C.prototype.removePredecessorOnDelete=function(e){for(var t=e.ganttProperties.predecessor,i=0;i<t.length;i++){var n=t[i],a="ResourceView"===this.parent.viewType?e.ganttProperties.taskId:e.ganttProperties.rowUniqueID;if(n.from.toString()===a.toString()){var r=this.parent.connectorLineModule.getRecordByID(n.to.toString());if(!oe.isNullOrUndefined(r)){for(var s=oe.extend([],[],r.ganttProperties.predecessor,!0),o=void 0,l=0;l<s.length;l++){var d="ResourceView"===this.parent.viewType?r.ganttProperties.taskId:r.ganttProperties.rowUniqueID;if(s[l].to.toString()===d.toString()&&s[l].from.toString()===a.toString()){o=l;break}}s.splice(o,1),this.updatePredecessorValues(r,s)}}else if(n.to.toString()===a.toString()){var h=this.parent.connectorLineModule.getRecordByID(n.from.toString());if(!oe.isNullOrUndefined(h)){for(var p=oe.extend([],[],h.ganttProperties.predecessor,!0),o=void 0,l=0;l<p.length;l++){var u="ResourceView"===this.parent.viewType?h.ganttProperties.taskId:h.ganttProperties.rowUniqueID;if(p[l].from.toString()===u.toString()&&p[l].to.toString()===a.toString()){o=l;break}}e.uniqueID!==h.parentUniqueID&&e.parentUniqueID!==h.uniqueID&&!this.parent.isOnDelete||(p.splice(o,1),this.updatePredecessorValues(h,p))}}}},C.prototype.updatePredecessorValues=function(e,t){this.parent.setRecordValue("predecessor",t,e.ganttProperties,!0);t=this.parent.predecessorModule.getPredecessorStringValue(e);this.parent.setRecordValue("predecessorsName",t,e.ganttProperties,!0),this.parent.setRecordValue("taskData."+this.parent.taskFields.dependency,t,e),this.parent.setRecordValue(this.parent.taskFields.dependency,t,e)},C.prototype.updateTaskId=function(e,t){if(!this.parent.readOnly){var i="number"==typeof e?e.toString():e,n="number"==typeof t?t.toString():t,a=this.parent.ids;if(!oe.isNullOrUndefined(i)&&!oe.isNullOrUndefined(n)){var e=a.indexOf(i),r=a.indexOf(n);if(!(-1===e||-1<r)){r=this.parent.flatData[e];if(oe.isNullOrUndefined(r)||(this.parent.setRecordValue("taskId",t,r.ganttProperties,!0),this.parent.setRecordValue("rowUniqueID",n,r.ganttProperties,!0),this.parent.setRecordValue(this.parent.taskFields.id,t,r,!0),this.parent.setRecordValue(this.parent.taskFields.id,t,r.taskData,!0)),a[e]=n,r.hasChildRecords&&this.parent.taskFields.parentID)for(var s=r.childRecords,o=0;o<s.length;o++){var l=s[o];l[this.parent.taskFields.parentID]=t,this.parent.chartRowsModule.refreshRecords([l])}if(this.parent.taskFields.dependency&&!oe.isNullOrUndefined(r.ganttProperties.predecessor))for(var d=r.ganttProperties.predecessor,h=void 0,p=0;p<d.length;p++){var u=d[p];u.to===i?h=this.parent.flatData[a.indexOf(u.from)]:u.from===i&&(h=this.parent.flatData[a.indexOf(u.to)]),this.updatePredecessorOnUpdateId(h,i,n)}this.parent.treeGrid.parentData=[],this.parent.treeGrid.refresh()}}}},C.prototype.updatePredecessorOnUpdateId=function(e,t,i){if(-1<this.parent.flatData.indexOf(e))for(var n=e.ganttProperties.predecessor,a=0;a<n.length;a++){var r=n[a];r.to===t?r.to=i:r.from===t&&(r.from=i)}this.updatePredecessorValues(e,e.ganttProperties.predecessor)},C.prototype.deleteChildRecords=function(e){for(var t=this,i=e.childRecords,n=0;n<i.length;n++){var a,r,s,o=i[n];-1===this.deletedTaskDetails.indexOf(o)&&(a=o.ganttProperties.predecessor,r=!0,s=this.parent.getParentTask(o.parentItem),"ResourceView"===this.parent.viewType&&s&&s.ganttProperties.taskName!==this.parent.localeObj.getConstant("unassignedTask")&&(r=!1),a&&a.length&&r&&this.removePredecessorOnDelete(o),!oe.isNullOrUndefined(o.ganttProperties.sharedTaskUniqueIds)&&1<o.ganttProperties.sharedTaskUniqueIds.length?o.ganttProperties.sharedTaskUniqueIds.forEach(function(e){t.deletedTaskDetails.push(t.parent.getTaskByUniqueID(t.parent.element.id+"_data_"+e))}):this.deletedTaskDetails.push(o),o.hasChildRecords)&&this.deleteChildRecords(o)}},C.prototype.removeFromDataSource=function(e){var t=this.parent.dataSource instanceof y.DataManager?this.parent.dataSource.dataSource.json:this.parent.dataSource;this.removeData(t,e),this.isBreakLoop=!1},C.prototype.removeData=function(e,t){for(var i,n=0;n<e.length&&!this.isBreakLoop;n++)if(-1!==t.indexOf(oe.getValue(this.parent.taskFields.id,e[n]).toString())){if(e[n][this.parent.taskFields.child]&&(i=e[n][this.parent.taskFields.child],this.removeData(i,t)),t.splice(t.indexOf(oe.getValue(this.parent.taskFields.id,e[n]).toString()),1),e.splice(n,1),0===t.length){this.isBreakLoop=!0;break}}else e[n][this.parent.taskFields.child]&&(i=e[n][this.parent.taskFields.child],this.removeData(i,t))},C.prototype.initiateDeleteAction=function(d){var h=this,e=(this.parent.showSpinner(),{});e.requestType="beforeDelete",e.data=d.deletedRecordCollection,e.modifiedRecords=d.updatedRecordCollection,e.modifiedTaskData=X(d.updatedRecordCollection,null,null,this.parent),this.parent.trigger("actionBegin",e,function(e){if(e.cancel){for(var t=h.deletedTaskDetails,i=0;i<t.length;i++)t[i].isDelete=!1;h.deletedTaskDetails=[],h.reUpdatePreviousRecords(),h.parent.initiateEditAction(!1),h.parent.hideSpinner()}else if(oe.isNullOrUndefined(h.parent.loadingIndicator)||"Shimmer"!==h.parent.loadingIndicator.indicatorType?h.parent.showSpinner():h.parent.showMaskRow(),_(h.parent.dataSource)){var n=h.parent.dataSource,a=(h.parent.timezone&&e.modifiedRecords.forEach(function(e){Z(e,h.parent)}),{deletedRecords:X(e.data,null,null,h.parent),changedRecords:e.modifiedTaskData}),e=n.adaptor,r=h.parent.query instanceof y.Query?h.parent.query:new y.Query;if(e instanceof y.WebApiAdaptor&&e instanceof y.ODataAdaptor&&!n.dataSource.batchUrl){for(var s="deletedRecords",o=null,l=0;l<a[s].length;l++)o=n.remove(h.parent.taskFields.id,a[s][l],null,r);o.then(function(){for(var i="changedRecords",e=a[i].length-1;0<=e;e--)!function(t){a.deletedRecords.some(function(e){return e[h.parent.taskFields.id]===a[i][t].taskId})&&a[i].splice(t,1)}(e);n.update(h.parent.taskFields.id,a[i],null,r).then(function(){return h.deleteSuccess(d)}).catch(function(e){return h.dmFailure(e,d)})}).catch(function(e){return h.dmFailure(e,d)})}else n.saveChanges(a,h.parent.taskFields.id,null,r).then(function(){return h.deleteSuccess(d)}).catch(function(e){return h.dmFailure(e,d)})}else h.deleteSuccess(d)})},C.prototype.deleteSuccess=function(e){for(var a=this,t=this.parent.flatData,i=this.parent.currentViewData,n=[],r=0;r<e.deletedRecordCollection.length;r++)if("ProjectView"===this.parent.viewType){var s=this.parent.getRecordByID(e.deletedRecordCollection[r].ganttProperties.taskId);oe.isNullOrUndefined(s)||n.push(s)}else{var o=e.deletedRecordCollection[r].hasChildRecords,l=e.deletedRecordCollection[r].ganttProperties.taskName===this.parent.localeObj.getConstant("unassignedTask"),d=!e.deletedRecordCollection[r].expanded;if(o&&l&&d)return oe.isNullOrUndefined(this.parent.loadingIndicator)||"Shimmer"!==this.parent.loadingIndicator.indicatorType?this.parent.hideSpinner():this.parent.hideMaskRow(),this.deletedTaskDetails=[],void this.parent.initiateEditAction(!1);e.deletedRecordCollection[r].hasChildRecords?"R"+e.deletedRecordCollection[r].ganttProperties.taskId:"T"+e.deletedRecordCollection[r].ganttProperties.taskId,n.push(this.parent.getTaskByUniqueID(e.deletedRecordCollection[r].uniqueID))}var h=[];0<n.length&&(s=y=void 0,this.parent.enableVirtualization?(y=this.parent.flatData.indexOf(n[n.length-1]),this.parent.staticSelectedRowIndex=this.parent.selectedRowIndex=y,s=this.parent.flatData[this.parent.selectedRowIndex+1],this.parent.isCollapseAll||(this.parent.staticSelectedRowIndex=y-(n.length-1))):(y=this.parent.currentViewData.indexOf(n[n.length-1]),this.parent.staticSelectedRowIndex=this.parent.selectedRowIndex=y,s=this.parent.currentViewData[this.parent.selectedRowIndex+1]),oe.isNullOrUndefined(s)?0<=(y=this.parent.selectedRowIndex-1)&&(this.parent.currentSelection=(this.parent.enableVirtualization?this.parent.flatData:this.parent.currentViewData)[y]):this.parent.currentSelection=s),this.deletedRecord=n;for(r=0;r<n.length;r++){var p=n[r],u=void 0,c=void 0,c="ResourceView"===this.parent.viewType?p.hasChildRecords?(u=this.parent.taskIds.indexOf("R"+p.ganttProperties.taskId.toString()),this.parent.taskIds.indexOf("R"+p.ganttProperties.taskId.toString())):(u=this.parent.taskIds.indexOf("T"+p.ganttProperties.taskId.toString()),this.parent.taskIds.indexOf("T"+p.ganttProperties.taskId.toString())):(u=i.indexOf(p),t.indexOf(p)),g=this.parent.treeGrid.parentData.indexOf(p),f=oe.getValue("dataOperation.dataArray",this.parent),m=f.indexOf(p.taskData);-1!==u&&i.splice(u,1),-1!==c&&t.splice(c,1),-1!==m&&f.splice(m,1),oe.isNullOrUndefined(p)||(h.push(p.ganttProperties.taskId.toString()),-1!==c&&(this.parent.ids.splice(c,1),"ResourceView"===this.parent.viewType)&&(this.parent.getTaskIds().splice(c,1),p.hasChildRecords||(p.ganttProperties.resourceInfo=null,delete p.ganttProperties.resourceNames,p[this.parent.taskFields.resourceInfo]=null,p.ganttProperties.sharedTaskUniqueIds=[],delete p.taskData[this.parent.taskFields.resourceInfo])),0===p.level&&-1!==g&&this.parent.treeGrid.parentData.splice(g,1),p.parentItem&&(u=this.parent.getParentTask(p.parentItem))&&(-1!==(m=(f=u.childRecords).indexOf(p))&&f.splice(m,1),f.length||this.parent.setRecordValue("hasChildRecords",!1,u)),this.updateTreeGridUniqueID(p,"delete"))}0<h.length&&this.removeFromDataSource(h),this.updateRowIndex();var y={};if(this.parent.updatedConnectorLineCollection=[],this.parent.connectorLineIds=[],this.parent.predecessorModule.createConnectorLinesCollection(this.parent.flatData),this.parent.treeGrid.parentData=[],this.isAdded=!1,this.parent.treeGrid.editModule&&(this.parent.treeGrid.editModule.isOnBatch=!1),this.parent.treeGrid.refresh(),this.parent.enableImmutableMode&&this.refreshRecordInImmutableMode(),y.requestType="delete",y.data=e.deletedRecordCollection,y.modifiedRecords=e.updatedRecordCollection,y.modifiedTaskData=X(e.updatedRecordCollection,null,null,this.parent),oe.setValue("action",e.action,y),this.parent.isOnDelete=!1,"ResourceView"===this.parent.viewType&&(!this.parent.undoRedoModule||this.parent.undoRedoModule&&(!this.parent.undoRedoModule.isUndoRedoPerformed||this.parent.undoRedoModule.isUndoRedoPerformed&&"Delete"===this.parent.undoRedoModule.currentAction.action)))for(var D=y.data.filter(function(e){return!e.hasChildRecords}),k=this,r=0;r<D.length;r++)!function(t){var i=k.parent.flatData.filter(function(e){return e.ganttProperties.taskName===a.parent.localeObj.getConstant("unassignedTask")})[0],e=[],n=(i&&(e=i.childRecords.filter(function(e){return e.ganttProperties.taskId===D[t].ganttProperties.taskId})),k.parent.getParentTask(D[t].parentItem)),n=((!n||n.ganttProperties.taskName===k.parent.localeObj.getConstant("unassignedTask")||0!==e.length)&&(n||e&&0!==e.length)||k.checkWithUnassignedTask(D[t]),i=k.parent.flatData.filter(function(e){return e.ganttProperties.taskName===a.parent.localeObj.getConstant("unassignedTask")})[0],k.parent.currentViewData.filter(function(e){return e.ganttProperties.taskId===D[t].ganttProperties.taskId&&!e.hasChildRecords&&e.parentItem&&i.uniqueID===e.parentItem.uniqueID?e:null}));n[0]&&k.parent.dataOperation.updateParentItems(n[0])}(r);this.parent.trigger("actionComplete",y),this.deletedTaskDetails=[],this.parent.initiateEditAction(!1),oe.isNullOrUndefined(this.parent.loadingIndicator)||"Shimmer"!==this.parent.loadingIndicator.indicatorType?this.parent.hideSpinner():this.parent.hideMaskRow(),this.parent.treeGrid.closeEdit()},C.prototype.getNewTaskId=function(){var e="ResourceView"===this.parent.viewType?this.parent.getTaskIds():this.parent.ids,t=e.length+1;if("ResourceView"===this.parent.viewType){if(!(-1===e.indexOf("T"+t)&&-1===e.indexOf("R"+t)||-1===e.indexOf("T"+(t+=1))&&-1===e.indexOf("R"+t)))for(;-1!==e.indexOf("T"+(t+=1))||-1!==e.indexOf("R"+t););}else if(-1!==e.indexOf(t.toString())&&-1!==e.indexOf((t+=1).toString()))for(;-1!==e.indexOf((t+=1).toString()););return"stringedit"===this.parent.columnByField[this.parent.taskFields.id].editType?t.toString():t},C.prototype.prepareNewlyAddedData=function(e,t){var i=this.parent.taskFields,n=this.parent.ids;e[i.id]&&(-1!==n.indexOf(e[i.id].toString())?e[i.id]=null:(n="string"==typeof e[i.id]?e[i.id]:parseInt(e[i.id],10),e[i.id]=oe.isNullOrUndefined(n)?null:n)),e[i.id]||(n=this.getNewTaskId(),e[i.id]=n),this.parent.allowUnscheduledTasks||e[i.startDate]||(e[i.startDate]=this.parent.projectStartDate),!this.parent.allowUnscheduledTasks&&i.duration&&oe.isNullOrUndefined(e[i.duration])&&!e[i.endDate]&&(e[i.duration]="5"),i.progress&&(e[i.progress]=e[i.progress]?100<e[i.progress]?100:e[i.progress]:0),this.parent.allowUnscheduledTasks||e[i.endDate]||!i.endDate||e[i.duration]||(n=this.parent.dataOperation.getDateFromFormat(this.parent.projectStartDate),oe.isNullOrUndefined(n))||(n.setDate(n.getDate()+4),e[i.endDate]=this.parent.getFormatedDate(n,this.parent.getDateFormat()))},C.prototype.updateNewlyAddedDataBeforeAjax=function(e,t,i,n,a){var r=this.parent.dataOperation.createRecord(e,t);switch(i){case"Above":r.index=a;break;case"Below":case"Child":r.index=a+1;break;case"Bottom":r.index=(this.parent.enableVirtualization?this.parent.flatData:this.parent.currentViewData).length;break;case"Top":r.index=0}if(oe.isNullOrUndefined(n)||(this.parent.setRecordValue("parentItem",this.parent.dataOperation.getCloneParent(n),r),p=r.parentItem?r.parentItem.index:null,this.parent.setRecordValue("parentIndex",p,r),u=r.parentItem?r.parentItem.uniqueID:null,this.parent.setRecordValue("parentUniqueID",u,r),oe.isNullOrUndefined(this.parent.taskFields.id))||oe.isNullOrUndefined(this.parent.taskFields.parentID)||!r.parentItem||("ProjectView"===this.parent.viewType&&this.parent.setRecordValue(this.parent.taskFields.parentID,r.parentItem.taskId,r.taskData,!0),this.parent.setRecordValue("parentId",r.parentItem.taskId,r.ganttProperties,!0),this.parent.setRecordValue(this.parent.taskFields.parentID,r.parentItem.taskId,r,!0)),this.parent.isOnEdit=!0,this.parent.undoRedoModule&&this.parent.undoRedoModule.isUndoRedoPerformed)if(e.hasChildRecords){for(var s=[],o=this.parent.undoRedoModule.currentAction.deletedRecordsDetails,l=0;l<e.childRecords.length;l++)this.add(e.childRecords[l],s);for(var d=0;d<o.length;d++)if(e.ganttProperties.taskId===o[d].data.ganttProperties.taskId){"child"===o[d].position?i="Child":"below"===o[d].position?i="Below":"above"===o[d].position&&(i="Above"),this.backUpAndPushNewlyAddedRecord(r,i,n);for(l=0;l<s.length;l++)"ProjectView"===this.parent.viewType?s[l].parentItem.taskId===r.ganttProperties.taskId&&(s[l].parentItem.index=r.index,s[l].parentItem.taskId=r.ganttProperties.taskId,s[l].parentItem.uniqueID=r.ganttProperties.uniqueID,s[l].parentUniqueID=r.ganttProperties.uniqueID):(s[l].parentItem.index=r.index,s[l].parentItem.taskId=r.ganttProperties.rowUniqueID,s[l].parentItem.uniqueID=r.ganttProperties.uniqueID,s[l].parentUniqueID=r.ganttProperties.uniqueID);break}(this.addRowSelectedItem=r).taskData[this.parent.taskFields.child]=[];for(var h=0;h<s.length;h++){this.parent.isOnEdit=!1;var p,u,c=this.parent.dataOperation.createRecord(s[h],s[h].level);0===c.childRecords.length&&c.taskData[this.parent.taskFields.child]&&(c.taskData[this.parent.taskFields.child]=[]),n=this.parent.getRecordByID(s[h].parentItem.taskId),oe.isNullOrUndefined(n)||(this.parent.setRecordValue("parentItem",this.parent.dataOperation.getCloneParent(n),c),p=c.parentItem?c.parentItem.index:null,this.parent.setRecordValue("parentIndex",p,c),u=c.parentItem?c.parentItem.uniqueID:null,this.parent.setRecordValue("parentUniqueID",u,c),oe.isNullOrUndefined(this.parent.taskFields.id))||oe.isNullOrUndefined(this.parent.taskFields.parentID)||!c.parentItem||("ProjectView"===this.parent.viewType&&this.parent.setRecordValue(this.parent.taskFields.parentID,c.parentItem.taskId,c.taskData,!0),this.parent.setRecordValue("parentId",c.parentItem.taskId,c.ganttProperties,!0),this.parent.setRecordValue(this.parent.taskFields.parentID,c.parentItem.taskId,c,!0)),this.parent.isOnEdit=!0,c.parentItem&&(i=0===n.childRecords.length?"Child":"Below"),0<this.parent.getParentTask(c.parentItem).childRecords.length&&(this.addRowSelectedItem=this.parent.getParentTask(c.parentItem).childRecords[this.parent.getParentTask(c.parentItem).childRecords.length-1]),this.backUpAndPushNewlyAddedRecord(c,i,n);for(l=0;l<s.length;l++)"ProjectView"===this.parent.viewType?s[l].parentItem.taskId===c.ganttProperties.taskId&&(s[l].parentItem.index=c.index,s[l].parentItem.taskId=c.ganttProperties.taskId,s[l].parentItem.uniqueID=c.ganttProperties.uniqueID,s[l].parentUniqueID=c.ganttProperties.uniqueID):(s[l].parentItem.index=r.index,s[l].parentItem.taskId=r.ganttProperties.rowUniqueID,s[l].parentItem.uniqueID=r.ganttProperties.uniqueID,s[l].parentUniqueID=r.ganttProperties.uniqueID)}}else this.backUpAndPushNewlyAddedRecord(r,i,n);else this.backUpAndPushNewlyAddedRecord(r,i,n);return this.parent.taskFields.dependency&&r.ganttProperties.predecessorsName&&(this.parent.undoRedoModule&&this.parent.undoRedoModule.isUndoRedoPerformed||this.parent.predecessorModule.ensurePredecessorCollectionHelper(r,r.ganttProperties),this.parent.predecessorModule.updatePredecessorHelper(r),this.parent.predecessorModule.validatePredecessorDates(r)),r.parentItem&&this.parent.getParentTask(r.parentItem).ganttProperties.isAutoSchedule&&this.parent.dataOperation.updateParentItems(r.parentItem),this.parent.isOnEdit=!1,r},C.prototype.getChildCount=function(e,t){var i;if(!e.hasChildRecords)return 0;for(var n=0;n<e.childRecords.length;n++)t++,(i=e.childRecords[n]).hasChildRecords&&(t=this.getChildCount(i,t));return t},C.prototype.getVisibleChildRecordCount=function(e,t,i){if(e.hasChildRecords)for(var n,a=(n=e.childRecords).length,r=0;r<a;r++)-1!==i.indexOf(n[r])&&t++,n[r].hasChildRecords&&(t=this.getVisibleChildRecordCount(n[r],t,i));else-1!==i.indexOf(e)&&t++;return t},C.prototype.updatePredecessorOnIndentOutdent=function(e){for(var t=e.ganttProperties.predecessor.length,i=e.ganttProperties,n=i.predecessor,a=0;a<t;a++){var r,s,o,l=this.parent.getRecordByID(n[a].from),d=this.parent.getRecordByID(n[a].to);(o=this.parent.predecessorModule.validateParentPredecessor(l,d))&&this.parent.allowParentDependency||(n[a].to===i.rowUniqueID.toString()?(r=this.parent.getRecordByID(n[a].from),s=K(n[a],"from",r.ganttProperties.predecessor,"to"),(l=oe.extend([],r.ganttProperties.predecessor,[],!0)).splice(s,1),this.parent.setRecordValue("predecessor",l,r.ganttProperties,!0)):n[a].from===i.rowUniqueID.toString()&&(d=(r=this.parent.getRecordByID(n[a].to)).ganttProperties.predecessorsName.toString().split(","),l=n[a].from+n[a].type,l=d.indexOf(l),d.splice(l,1),this.parent.setRecordValue("predecessorsName",d.join(","),r.ganttProperties,!0),this.parent.setRecordValue(this.parent.taskFields.dependency,d.join(","),r),s=K(n[a],"from",r.ganttProperties.predecessor,"to"),(l=oe.extend([],r.ganttProperties.predecessor,[],!0)).splice(s,1),this.parent.setRecordValue("predecessor",l,r.ganttProperties,!0),this.parent.predecessorModule.validatePredecessorDates(r)))}o&&this.parent.allowParentDependency||(this.parent.setRecordValue("predecessor",[],e.ganttProperties,!0),this.parent.setRecordValue("predecessorsName","",e.ganttProperties,!0))},C.prototype.backUpAndPushNewlyAddedRecord=function(e,t,i){var n,a=this.parent.flatData,r=this.parent.currentViewData,s=this.parent.ids;switch(t){case"Top":a.splice(0,0,e),r.splice(0,0,e),s.splice(0,0,e.ganttProperties.rowUniqueID.toString());break;case"Bottom":a.push(e),r.push(e),s.push(e.ganttProperties.rowUniqueID.toString()),"ResourceView"===this.parent.viewType&&(n=0===e.level?"R"+e.ganttProperties.taskId:"T"+e.ganttProperties.taskId,this.parent.getTaskIds().push(n));break;case"Above":o=a.indexOf(this.addRowSelectedItem),l=r.indexOf(this.addRowSelectedItem),this.recordCollectionUpdate(void 0,o,l,e,i,t);break;case"Below":var o,l,d=a.indexOf(this.addRowSelectedItem);l=this.addRowSelectedItem.hasChildRecords?(o=d+this.getChildCount(this.addRowSelectedItem,0)+1,r.indexOf(this.addRowSelectedItem)+this.getVisibleChildRecordCount(this.addRowSelectedItem,0,r)+1):(o=d+1,r.indexOf(this.addRowSelectedItem)+1),this.recordCollectionUpdate(NaN,o,l,e,i,t);break;case"Child":d=a.indexOf(this.addRowSelectedItem),this.addRowSelectedItem.hasChildRecords?(o=d+this.getChildCount(this.addRowSelectedItem,0)+1,this.addRowSelectedItem.expanded||this.parent.enableMultiTaskbar||this.parent.expandByID(this.addRowSelectedItem.ganttProperties.rowUniqueID),l=r.indexOf(this.addRowSelectedItem)+this.getVisibleChildRecordCount(this.addRowSelectedItem,0,r)+1):(this.parent.setRecordValue("hasChildRecords",!0,this.addRowSelectedItem),this.parent.setRecordValue("isMilestone",!1,this.addRowSelectedItem.ganttProperties,!0),this.parent.setRecordValue("expanded",!0,this.addRowSelectedItem),this.parent.setRecordValue("childRecords",[],this.addRowSelectedItem),o=d+1,l=r.indexOf(this.addRowSelectedItem)+1,this.addRowSelectedItem.ganttProperties.predecessor&&this.updatePredecessorOnIndentOutdent(this.addRowSelectedItem),oe.isNullOrUndefined(this.addRowSelectedItem.ganttProperties.segments)||(this.addRowSelectedItem.ganttProperties.segments=null)),this.recordCollectionUpdate(NaN,o,l,e,i,t)}this.newlyAddedRecordBackup=e},C.prototype.recordCollectionUpdate=function(e,t,i,n,a,r){var s=this.parent.flatData,o=this.parent.currentViewData,l=this.parent.ids;s.splice(t,0,n),o.splice(i,0,n),l.splice(t,0,n.ganttProperties.rowUniqueID.toString()),"ResourceView"===this.parent.viewType&&(s=0===n.level?"R"+n.ganttProperties.taskId:"T"+n.ganttProperties.taskId,this.parent.getTaskIds().splice(t,0,s)),!oe.isNullOrUndefined(a)&&(e="Above"===r?a.childRecords.indexOf(this.addRowSelectedItem):"Below"===r?a.childRecords.indexOf(this.addRowSelectedItem)+1:a.childRecords.length,a.childRecords.splice(e,0,n),this.parent.taskFields.child||(this.parent.taskFields.child="Children"),this.parent.dataSource instanceof y.DataManager&&oe.isNullOrUndefined(a.taskData[this.parent.taskFields.parentID])||!oe.isNullOrUndefined(this.parent.dataSource))&&(o=this.parent.taskFields.child,a.taskData[o]&&0<a.taskData[o].length?"Above"===r||"Below"===r?a.taskData[o].splice(e,0,n.taskData):a.taskData[o].push(n.taskData):(a.taskData[o]=[],a.taskData[o].push(n.taskData)),this.isNewRecordAdded=!0)},C.prototype.constructTaskAddedEventArgs=function(e,t,i){var n={};if(n.action=n.requestType=i,1<e.length){n.data=[],n.newTaskData=[],n.recordIndex=[];for(var a=0;a<e.length;a++)n.data[a]=e[a],n.newTaskData[a]=X([e[a]],n.data[a],n,this.parent),n.recordIndex[a]=e[a].index}else if(1===e.length)for(a=0;a<e.length;a++)n.data=e[a],n.newTaskData=X([e[a]],n.data,n,this.parent),n.recordIndex=e[a].index;return n.modifiedRecords=t,n.modifiedTaskData=X(t,null,null,this.parent),n},C.prototype.addSuccess=function(e){this.parent.updatedConnectorLineCollection=[],this.parent.connectorLineIds=[],this.parent.predecessorModule.createConnectorLinesCollection(this.parent.flatData),this.parent.treeGrid.parentData=[],this.parent.addDeleteRecord=!0,this.parent.treeGrid.isAddedFromGantt=!0,this.isAdded=!0,this.parent.treeGrid.editModule&&(this.parent.treeGrid.editModule.isOnBatch=!1),this.parent.treeGrid.refresh(),this.parent.enableImmutableMode&&(this.parent.modifiedRecords=e.modifiedRecords,this.parent.modifiedRecords.push(e.data),this.refreshRecordInImmutableMode()),this.parent.treeGrid.closeEdit()},C.prototype.refreshRecordInImmutableMode=function(e,t){if(!t&&!oe.isNullOrUndefined(e))for(var i=e[0].index+1;i<this.parent.currentViewData.length&&e[0].level<this.parent.currentViewData[i].level;i++)this.parent.modifiedRecords.push(this.parent.currentViewData[i]);for(var r=this,i=0;i<this.parent.modifiedRecords.length;i++)!function(e){var t,i=r.parent.modifiedRecords[e],e=r.parent.rowDragAndDropModule&&r.parent.allowRowDragAndDrop?1:0,n=r.parent.taskFields.id,a=r.parent.currentViewData.findIndex(function(e){return e[n]===i[n]});r.parent.treeGrid.getRows()[a]&&(t=r.parent.treeGrid.grid.getRowObjectFromUID(r.parent.treeGrid.grid.getDataRows()[a].getAttribute("data-uid")),r.parent.treeGrid.renderModule.cellRender({data:t.data,cell:r.parent.treeGrid.getRows()[a].cells[r.parent.treeColumnIndex+e],column:r.parent.treeGrid.grid.getColumns()[r.parent.treeColumnIndex],requestType:"rowDragAndDrop"}),r.parent.treeGrid.renderModule.RowModifier({data:i,row:r.parent.treeGrid.getRows()[a],rowHeight:r.parent.rowHeight}))}(i)},C.prototype.updateRealDataSource=function(e,t){var i=this.parent.taskFields,n=j(this.parent)?oe.getValue("result",this.parent.dataSource):this.parent.dataSource;this.parent.dataSource instanceof y.DataManager&&(n=this.parent.dataSource.dataSource.json);for(var a=0;a<e.length;a++)"Top"===(t=oe.isNullOrUndefined(t)||oe.isNullOrUndefined(this.addRowSelectedItem)?"Bottom"===t?"Bottom":"Top":t)?n.splice(0,0,e[a].taskData):"Bottom"!==t&&(oe.isNullOrUndefined(i.id)||oe.isNullOrUndefined(i.parentID)||"Child"!==t)?(this.isNewRecordAdded||this.addDataInRealDataSource(n,e[a].taskData,t),this.isNewRecordAdded=!1):n.push(e[a].taskData),this.isBreakLoop=!1},C.prototype.addDataInRealDataSource=function(e,t,i){for(var n=0;n<e.length;n++){var a=this.parent.taskFields.child;if(this.isBreakLoop)break;if(oe.getValue(this.parent.taskFields.id,e[n]).toString()===this.addRowSelectedItem.ganttProperties.rowUniqueID.toString()){var r=void 0;if(this.parent.rowDragAndDropModule&&this.parent.rowDragAndDropModule.droppedRecord&&"ResourceView"===this.parent.viewType)for(var s=0;s<e.length;s++)if(e[s][this.parent.taskFields.id]===this.parent.rowDragAndDropModule.droppedRecord.ganttProperties.taskId){r=s;break}"Above"===i?r?e.splice(r,0,t):e.splice(n,0,t):"Below"===i?r?e.splice(r+1,0,t):e.splice(n+1,0,t):"Child"===i&&(e[n][a]&&0<e[n][a].length||(e[n][a]=[]),e[n][a].push(t)),this.isBreakLoop=!0;break}e[n][a]&&(a=e[n][a],this.addDataInRealDataSource(a,t,i))}},C.prototype.updateClientDataFromServer=function(e,t){for(var i=e.addedRecords[0],n=Object.keys(i).length,a=0,r=Object.keys(i);a<n;a++){var s=r[parseInt(a.toString(),10)];t.data[""+s]=i[""+s]}null!==this.parent.taskFields.id&&(t.data.ganttProperties.taskId=i[this.parent.taskFields.id]),null!==this.parent.taskFields.name&&(t.data.ganttProperties.taskName=i[this.parent.taskFields.name]),null!==this.parent.taskFields.startDate&&(t.data.ganttProperties.startDate=i[this.parent.taskFields.startDate]),null!==this.parent.taskFields.endDate&&(t.data.ganttProperties.endDate=i[this.parent.taskFields.endDate]),null!==this.parent.taskFields.duration&&(t.data.ganttProperties.duration=parseFloat(i[this.parent.taskFields.duration])),null!==this.parent.taskFields.durationUnit&&(t.data.ganttProperties.durationUnit=i[this.parent.taskFields.durationUnit]),null!==this.parent.taskFields.progress&&(t.data.ganttProperties.progress=i[this.parent.taskFields.progress]),null!==this.parent.taskFields.dependency&&(t.data.ganttProperties.dependency=i[this.parent.taskFields.dependency]),null!==this.parent.taskFields.parentID&&(t.data.ganttProperties.parentID=i[this.parent.taskFields.parentID]),null!==this.parent.taskFields.baselineEndDate&&(t.data.ganttProperties.baselineEndDate=i[this.parent.taskFields.baselineEndDate]),null!==this.parent.taskFields.baselineStartDate&&(t.data.ganttProperties.baselineStartDate=i[this.parent.taskFields.baselineStartDate]),null!==this.parent.taskFields.resourceInfo&&(t.data.ganttProperties.resources=i[this.parent.taskFields.resourceInfo])},C.prototype.addNewUndoCollection=function(e,t){if(this.parent.undoRedoModule&&(!this.parent.undoRedoModule.isUndoRedoPerformed||this.parent.undoRedoModule.isUndoRedoPerformed&&"Add"===this.parent.undoRedoModule.currentAction.action&&"ResourceView"===this.parent.viewType)&&this.parent.isUndoRedoItemPresent("Add")){e.action="Add";for(var i=0<t.data.length?oe.extend([],[],t.data,!0):[t.data],n=[],a=this,r=0;r<i.length;r++)!function(t){n=a.parent.flatData.filter(function(e){return i[t].index===e.index&&i[t].ganttProperties.taskId===e.ganttProperties.taskId})}(r);e.addedRecords=oe.extend([],[],n,!0),this.parent.undoRedoModule.getUndoCollection[this.parent.undoRedoModule.getUndoCollection.length-1]=e}},C.prototype.addRecord=function(e,u,t){var c=this,g=this.parent.taskFields.id;if(this.parent.editModule&&this.parent.editSettings.allowAdding){this.parent.isDynamicData=!0,this.parent.treeGrid.isAddedFromGantt=!0,this.parent.isOnAdded=!0;var f=[];if(oe.isNullOrUndefined(e))this.validateTaskPosition(e,u,t,f);else if(e instanceof Array)if(this.parent.undoRedoModule&&this.parent.undoRedoModule.isUndoRedoPerformed){var i=e,n=t;"ResourceView"===this.parent.viewType&&("below"===e[0].position?u="Below":"above"===e[0].position?u="Above":"child"===e[0].position&&(u="Child"),n=this.parent.taskIds.indexOf(e[0].id.toString()),i=e[0].data),this.validateTaskPosition(i,u,n,f)}else for(var a=0;a<e.length;a++)this.validateTaskPosition(e[a],u,t,f);else{if("object"!=typeof e)return;this.validateTaskPosition(e,u,t,f)}i={},i=this.constructTaskAddedEventArgs(f,this.parent.editedRecords,"beforeAdd");oe.isNullOrUndefined(u)||(i.rowPosition=u),this.parent.undoRedoModule&&!this.parent.undoRedoModule.isUndoRedoPerformed&&this.parent.isUndoRedoItemPresent("Add")&&(this.parent.undoRedoModule.redoEnabled&&this.parent.undoRedoModule.disableRedo(),this.parent.undoRedoModule.createUndoCollection()),this.parent.trigger("actionBegin",i,function(i){c.parent.previousRecords={};var e=c.parent.taskFields,e="ResourceView"===c.parent.viewType?0<i.data.childRecords.length?c.parent.flatData[c.parent.getTaskIds().indexOf("R"+i.data[e.id])]:c.parent.flatData[c.parent.getTaskIds().indexOf("T"+i.data[e.id])]:c.parent.getRecordByID(i.data[e.id]);if(oe.isNullOrUndefined(e)||(c.validateUpdateValues(i.newTaskData,e,!0),c.parent.dateValidationModule.calculateEndDate(e),c.parent.dataOperation.updateWidthLeft(e),c.parent.dataOperation.updateParentItems(e)),!oe.isNullOrUndefined(i.data[""+g])&&i.data[g]!==i.data.ganttProperties.taskId){for(var t=0,n=Object.keys(c.parent.ids);t<n.length;t++){var a=n[t];if(c.parent.ids[a]===i.data.ganttProperties.taskId.toString()){c.parent.ids[a]=i.data[g].toString();break}}i.data.ganttProperties.taskId=i.data[g],i.newTaskData[g]=i.data[g],i.data.ganttProperties.rowUniqueID=i.data[g].toString()}if(i.cancel)c.removeAddedRecord(),c.reUpdatePreviousRecords(),c._resetProperties();else{oe.isNullOrUndefined(c.parent.loadingIndicator)||"Shimmer"!==c.parent.loadingIndicator.indicatorType?c.parent.showSpinner():c.parent.showMaskRow();if(_(c.parent.dataSource)){var r=c.parent.dataSource,s={addedRecords:[i.newTaskData],changedRecords:i.modifiedTaskData},o=c.parent.query instanceof y.Query?c.parent.query:new y.Query,l=r.adaptor;!(l instanceof y.WebApiAdaptor||l instanceof y.ODataAdaptor||l instanceof y.ODataV4Adaptor)||r.dataSource.batchUrl?r.saveChanges(s,c.parent.taskFields.id,null,o).then(function(e){e.addedRecords[0][c.parent.taskFields.id].toString()!==i.data.ganttProperties.taskId&&(i.data.ganttProperties.taskId=e.addedRecords[0][c.parent.taskFields.id].toString(),i.newTaskData[g]=e.addedRecords[0][c.parent.taskFields.id].toString(),i.data.ganttProperties.rowUniqueID=e.addedRecords[0][c.parent.taskFields.id].toString(),c.parent.ids.push(e.addedRecords[0][c.parent.taskFields.id].toString()));var t=i.data.ganttProperties.taskId.toString();c.parent.taskFields.id&&!oe.isNullOrUndefined(e.addedRecords[0][c.parent.taskFields.id])&&e.addedRecords[0][c.parent.taskFields.id].toString()===t&&(c.parent.setRecordValue("taskId",e.addedRecords[0][c.parent.taskFields.id],i.data.ganttProperties,!0),c.parent.setRecordValue("taskData",e.addedRecords[0],i.data),c.parent.setRecordValue(c.parent.taskFields.id,e.addedRecords[0][c.parent.taskFields.id],i.data),c.parent.setRecordValue("rowUniqueID",e.addedRecords[0][c.parent.taskFields.id].toString(),i.data.ganttProperties,!0),c.updateClientDataFromServer(e,i),-1!==(t=c.parent.ids.indexOf(t)))&&(c.parent.ids[t]=e.addedRecords[0][c.parent.taskFields.id].toString()),c.updateNewRecord(f,i)}).catch(function(e){c.removeAddedRecord(),c.dmFailure(e,i),c._resetProperties()}):r.insert(s.addedRecords,null,o).then(function(e){var t=(oe.isNullOrUndefined(e[0])?s.addedRecords:e)[0];f.forEach(function(e){oe.isNullOrUndefined(e)||(c.updateEditedRecordFields(t,e),c.parent.dataOperation.updateTaskData(e))}),c.updateNewRecord(f,i)}).catch(function(e){c.removeAddedRecord(),c.dmFailure(e,i),c._resetProperties()})}else{if("ProjectView"===c.parent.viewType?("Top"===u||"Bottom"===u||"Above"===u||"Below"===u||"Child"===u||oe.isNullOrUndefined(u)&&!i.data.parentItem)&&(i.data instanceof Array?c.updateRealDataSource(i.data,u):((l=[]).push(i.data),c.updateRealDataSource(l,u),c.parent.currentSelection=f[0])):(j(c.parent)?oe.getValue("result",c.parent.dataSource):c.parent.dataSource).push(i.data.taskData),0===f.level&&c.parent.treeGrid.parentData.splice(0,0,f),c.updateTreeGridUniqueID(f,"add"),"ResourceView"===c.parent.viewType&&c.parent.undoRedoModule&&c.parent.undoRedoModule.currentAction){r=!1;if((i.data.hasChildRecords||i.data.parentItem&&c.parent.getTaskByUniqueID(i.data.parentItem.uniqueID).ganttProperties.taskName!==c.parent.localeObj.getConstant("unassignedTask"))&&(r=!0),-1!==c.parent.taskIds.indexOf("R0")&&c.parent.undoRedoModule&&c.parent.undoRedoModule.isUndoRedoPerformed&&"Delete"===c.parent.undoRedoModule.currentAction.action&&r){for(var d=c.parent.flatData[c.parent.taskIds.indexOf("R0")],h=d.childRecords.filter(function(e){return e.ganttProperties.taskId===i.data.ganttProperties.taskId}),p=(i.data.hasChildRecords&&(h=i.data.childRecords),0);p<h.length;p++)!function(e){var n,t;1===d.childRecords.length?(c.parent.flatData.splice(c.parent.taskIds.indexOf("R0"),2),c.parent.ids.splice(c.parent.taskIds.indexOf("R0"),2),c.parent.taskIds.splice(c.parent.taskIds.indexOf("R0"),2)):(t=c.parent.taskIds.indexOf("T"+h[e].ganttProperties.taskId),n="T"+h[e].ganttProperties.taskId,t=(e=c.parent.taskIds.reduce(function(e,t,i){return t===n&&e.push(i),e},[]))[e.length-1],c.parent.taskIds.splice(t,1),c.parent.flatData.splice(t,1),c.parent.ids.splice(t,1))}(p);d&&"ResourceView"===c.parent.viewType&&!c.parent.flatData[c.parent.taskIds.indexOf("R0")+1]&&(c.parent.flatData.splice(c.parent.taskIds.indexOf("R0"),1),c.parent.ids.splice(c.parent.taskIds.indexOf("R0"),1),c.parent.taskIds.splice(c.parent.taskIds.indexOf("R0"),1))}}c.refreshNewlyAddedRecord(i,f),"ResourceView"===c.parent.viewType&&c.parent.taskFields.work&&e&&c.parent.dataOperation.updateParentItems(e,!0),c.addNewUndoCollection({},i),c._resetProperties()}c.parent.isOnAdded=!1}})}},C.prototype.createNewRecord=function(){for(var e={},t=this.parent.ganttColumns,i=this.parent.taskFields,n=this.parent.editModule.getNewTaskId(),a=0;a<t.length;a++){var r=t[a].field;r===i.id?e[r]=n:t[a].field===i.startDate?(oe.isNullOrUndefined(e[i.endDate])?e[r]=this.parent.editModule.dialogModule.getMinimumStartDate():e[r]=new Date(e[i.endDate]),this.parent.timezone&&(e[r]=this.parent.dateValidationModule.remove(e[r],this.parent.timezone))):t[a].field===i.endDate?(oe.isNullOrUndefined(e[i.startDate])?e[r]=this.parent.editModule.dialogModule.getMinimumStartDate():e[r]=new Date(e[i.startDate]),this.parent.timezone&&(e[r]=this.parent.dateValidationModule.remove(e[r],this.parent.timezone))):t[a].field===i.duration?e[r]=1:t[a].field===i.name?e[r]=this.parent.editModule.dialogModule.localeObj.getConstant("addDialogTitle")+" "+n:t[a].field===i.progress||t[a].field===i.work?e[r]=0:t[a].field===i.type||"taskType"===t[a].field?e[r]=this.parent.taskType:t[a].field===i.milestone?e[r]=null:e[this.parent.ganttColumns[a].field]=""}return e},C.prototype.validateTaskPosition=function(e,t,i,n){var a,r=oe.isNullOrUndefined(i)||isNaN(parseInt(i.toString(),10))?this.parent.selectionModule?"Row"!==this.parent.selectionSettings.mode&&"Both"!==this.parent.selectionSettings.mode||1!==this.parent.selectionModule.selectedRowIndexes.length?"Cell"===this.parent.selectionSettings.mode&&1===this.parent.selectionModule.getSelectedRowCellIndexes().length?this.parent.selectionModule.getSelectedRowCellIndexes()[0].rowIndex:null:this.parent.selectionModule.selectedRowIndexes[0]:null:i,s=(this.addRowSelectedItem=oe.isNullOrUndefined(r)?null:this.parent.updatedRecords[r],t=oe.isNullOrUndefined(t)?this.parent.editSettings.newRowPosition:t,e=oe.isNullOrUndefined(e)?this.createNewRecord():e,0);switch(t=(oe.isNullOrUndefined(r)||r<0||oe.isNullOrUndefined(this.addRowSelectedItem))&&("Above"===t||"Below"===t||"Child"===t)||!t||"Above"!==t&&"Below"!==t&&"Child"!==t&&"Top"!==t&&"Bottom"!==t?"Top":t){case"Top":case"Bottom":s="ResourceView"===this.parent.viewType?1:0;break;case"Above":case"Below":s=this.addRowSelectedItem.level,a=this.parent.getParentTask(this.addRowSelectedItem.parentItem);break;case"Child":s=this.addRowSelectedItem.level+1,a=this.addRowSelectedItem}this.parent.undoRedoModule&&this.parent.undoRedoModule.isUndoRedoPerformed||this.prepareNewlyAddedData(e,t);r=this.updateNewlyAddedDataBeforeAjax(e,s,t,a,i);n.push(r)},C.prototype.updateRowIndex=function(){for(var e=this.parent.currentViewData,t=e.length,i=0;i<t;i++){var n=i;e[i].index=n,e[i].parentItem&&e[i].parentItem.taskId&&(n=this.parent.getRecordByID(e[i].parentItem.taskId),oe.isNullOrUndefined(n)||oe.isNullOrUndefined(n.index)||oe.isNullOrUndefined(n.level)||(e[i].parentItem.index=n.index,e[i].parentItem.level=n.level))}},C.prototype.updateNewRecord=function(e,t){var i=this;e.forEach(function(e){0===e.level&&(i.parent.treeGrid.parentData.splice(0,0,e),oe.getValue("dataOperation.dataArray",i.parent).splice(0,0,e.taskData)),i.updateTreeGridUniqueID(e,"add")}),this.updateTreeGridUniqueID(e,"add"),this.refreshNewlyAddedRecord(t,e);this.addNewUndoCollection({},t),this._resetProperties()},C.prototype._resetProperties=function(){this.parent.isOnEdit=!1,this.parent.hideSpinner(),this.addRowSelectedItem=null,this.newlyAddedRecordBackup=null,this.isBreakLoop=!1,this.parent.element.tabIndex=0,this.parent.initiateEditAction(!1)},C.prototype.updateTreeGridUniqueID=function(e,t){"add"===t?oe.setValue("uniqueIDCollection."+e.uniqueID,e,this.parent.treeGrid):"delete"===t&&oe.deleteObject(oe.getValue("uniqueIDCollection",this.parent.treeGrid),e.uniqueID)},C.prototype.refreshNewlyAddedRecord=function(e,t){var i=this;if(this.parent.selectionModule&&this.parent.allowSelection&&("Row"===this.parent.selectionSettings.mode||"Both"===this.parent.selectionSettings.mode)&&(this.parent.staticSelectedRowIndex=this.parent.currentViewData.indexOf(e.data)),this.parent.timelineSettings.updateTimescaleView&&(s=[],0<e.modifiedRecords.length?(s=0<e.data.length?oe.extend([],[],e.data,!0):[e.data]).push.apply(s,e.modifiedRecords):s=0<e.data.length?oe.extend([],[],e.data,!0):[e.data],this.parent.timelineModule.updateTimeLineOnEditing([s],e.action)),this.addSuccess(e),e=this.constructTaskAddedEventArgs(t,e.modifiedRecords,"add"),this.updateRowIndex(),this.parent.trigger("actionComplete",e),oe.isNullOrUndefined(this.parent.loadingIndicator)||"Shimmer"!==this.parent.loadingIndicator.indicatorType?this.parent.hideSpinner():this.parent.hideMaskRow(),this.dialogModule.dialog&&!this.dialogModule.dialogObj.isDestroyed&&this.dialogModule.dialogObj.hide(),this.dialogModule.dialogClose(),"ResourceView"===this.parent.viewType)if(1<t.length)for(var n,a=0;a<t.length;a++){e.data[a].ganttProperties.sharedTaskUniqueIds.push(e.data[a].ganttProperties.rowUniqueID),e.data[a].ganttProperties.resourceInfo?((n=oe.extend([],[],e.data[a].ganttProperties.resourceInfo,!0)).splice(0,1),this.updateResoures([],n,e.data[a])):this.parent.undoRedoModule&&(!this.parent.undoRedoModule||e.data[a].hasChildRecords||!this.parent.undoRedoModule.isUndoRedoPerformed)&&this.parent.undoRedoModule.isUndoRedoPerformed||(this.removeChildRecord(e.data[a]),this.parent.editModule.checkWithUnassignedTask(e.data[a]));for(var r=0;r<this.updateParentRecords.length;r++)this.parent.dataOperation.updateParentItems(this.updateParentRecords[r]);this.updateParentRecords=[]}else{e.data.ganttProperties.sharedTaskUniqueIds.push(e.data.ganttProperties.rowUniqueID);var s=e.data,o=s.ganttProperties,l=s.childRecords,d=this.parent.undoRedoModule,h=function(e,t){e&&1<e.length&&((e=oe.extend([],[],e,!0)).splice(0,1),d&&d.isUndoRedoPerformed&&(i.parent.editModule.addRowIndex=void 0),i.updateResoures([],e,t))};o.resourceInfo&&o.resourceInfo.length?h(o.resourceInfo,s):0<l.length&&l[0].ganttProperties.resourceInfo&&l[0].ganttProperties.resourceInfo.length?h(l[0].ganttProperties.resourceInfo,e.data.childRecords[0]):this.parent.undoRedoModule&&(!this.parent.undoRedoModule||e.data.hasChildRecords||!this.parent.undoRedoModule.isUndoRedoPerformed)&&this.parent.undoRedoModule.isUndoRedoPerformed||(this.removeChildRecord(e.data),this.parent.editModule.checkWithUnassignedTask(e.data));for(r=0;r<this.updateParentRecords.length;r++)this.parent.dataOperation.updateParentItems(this.updateParentRecords[r]);this.updateParentRecords=[]}},C.prototype.removeAddedRecord=function(){var e,t,i=this.parent.flatData,n=this.parent.currentViewData,a=this.parent.ids,r=i.indexOf(this.newlyAddedRecordBackup),s=n.indexOf(this.newlyAddedRecordBackup),o=a.indexOf(this.newlyAddedRecordBackup.ganttProperties.rowUniqueID.toString());oe.deleteObject(this.parent.previousRecords,i[r].uniqueID),this.newlyAddedRecordBackup.parentItem&&(t=(e=this.parent.getParentTask(this.newlyAddedRecordBackup.parentItem)).childRecords.indexOf(this.newlyAddedRecordBackup),e.childRecords.splice(t,1),0===e.childRecords.length)&&e.hasChildRecords&&(e.hasChildRecords=!1),i.splice(r,1),n.splice(s,1),a.splice(o,1)},C.prototype.getPrevRecordIndex=function(){var e=this.parent.updatedRecords[this.parent.selectionModule.getSelectedRowIndexes()[0]-1],t=this.parent.selectionModule.getSelectedRecords()[0],e=this.parent.getRootParent(e,t.level);return this.parent.updatedRecords.indexOf(e)},C.prototype.indent=function(){var e=this.parent.selectedRowIndex,t=!!this.parent.selectionModule&&(1===this.parent.selectionModule.selectedRowIndexes.length||1===this.parent.selectionModule.getSelectedRowCellIndexes().length),i=this.parent.updatedRecords[this.parent.selectionModule.getSelectedRowIndexes()[0]-1],n=this.parent.selectionModule.getSelectedRecords()[0];this.parent.editSettings.allowEditing&&0!==e&&-1!==e&&t&&"ResourceView"!==this.parent.viewType&&(oe.isNullOrUndefined(this.parent.updatedRecords[e])||this.parent.updatedRecords[e].level-i.level!=1)&&(t=i.level-n.level==0?this.parent.selectionModule.getSelectedRowIndexes()[0]-1:this.getPrevRecordIndex(),this.indentOutdentRow([this.parent.selectionModule.getSelectedRowIndexes()[0]],t,"child"))},C.prototype.outdent=function(){var e=this.parent.selectionModule.getSelectedRowIndexes()[0],t=!!this.parent.selectionModule&&(1===this.parent.selectionModule.selectedRowIndexes.length||1===this.parent.selectionModule.getSelectedRowCellIndexes().length);this.parent.editSettings.allowEditing&&-1!==e&&0!==e&&t&&"ResourceView"!==this.parent.viewType&&0!==this.parent.updatedRecords[e].level&&(t=this.parent.getTaskByUniqueID(this.parent.selectionModule.getSelectedRecords()[0].parentItem.uniqueID),t=this.parent.updatedRecords.indexOf(t),this.indentOutdentRow([e],t,"below"))},C.prototype.indentOutdentRow=function(e,t,i){var n=this;e[0],"above"===i&&(this.dropPosition="topSegment"),"below"===i&&(this.dropPosition="bottomSegment"),"child"===i&&(this.dropPosition="middleSegment");for(var i=void 0,a=[],r=0;r<e.length;r++)this.parent.undoRedoModule&&this.parent.undoRedoModule.isUndoRedoPerformed&&this.parent.undoRedoModule.currentAction?this.parent.undoRedoModule.currentAction.modifiedRecord?a[r]=this.parent.undoRedoModule.currentAction.modifiedRecord[r].data:a[r]=this.parent.undoRedoModule.currentAction.data[r]:a[r]=this.parent.updatedRecords[e[r]];var s={data:a,dropIndex:t,dropPosition:this.dropPosition};"middleSegment"===this.dropPosition?i="indenting":"bottomSegment"===this.dropPosition&&(i="outdenting"),this.parent.trigger("actionBegin",{action:i,data:a[0],cancel:!1},function(e){e.cancel?oe.isNullOrUndefined(n.parent.loadingIndicator)||"Shimmer"!==n.parent.loadingIndicator.indicatorType?n.parent.hideSpinner():n.parent.hideMaskRow():(oe.isNullOrUndefined(n.parent.loadingIndicator)||"Shimmer"!==n.parent.loadingIndicator.indicatorType?n.parent.showSpinner():n.parent.showMaskRow(),n.reArrangeRows(s,!0))})},C.prototype.reArrangeRows=function(e,t){var i=this;if(this.dropPosition=e.dropPosition,this.parent.oldRecords=[],this.parent.oldRecords=oe.extend([],[],e.data,!0),"Invalid"!==e.dropPosition&&this.parent.editModule){for(var n,a,r,s,o,l=this.parent,l=(this.droppedRecord=l.updatedRecords[e.dropIndex],"middleSegment"===e.dropPosition?"Indent":"Outdent"),d=(this.parent.undoRedoModule&&!this.parent.undoRedoModule.isUndoRedoPerformed&&this.parent.isUndoRedoItemPresent(l)&&((a={}).action=l,a.modifiedRecord=[],a.selectedRowIndexes=oe.extend([],[],this.parent.selectionModule.selectedRowIndexes,!0),this.parent.undoRedoModule.findPosition(oe.extend([],[],[e.data],!0)[0],a,"modifiedRecord"),a.droppedRecord=oe.extend([],[],this.droppedRecord,!0),this.parent.undoRedoModule.redoEnabled&&(this.parent.undoRedoModule.redoEnabled=!1,this.parent.undoRedoModule.getUndoCollection=[],this.parent.undoRedoModule.getRedoCollection=[],this.parent.toolbarModule&&this.parent.toolbarModule.enableItems([this.parent.controlId+"_redo"],!1),this.parent.undoRedoModule.getUndoCollection[0]=[]),this.parent.undoRedoModule.createUndoCollection(),this.parent.undoRedoModule.getUndoCollection[this.parent.undoRedoModule.getUndoCollection.length-1]=a),[]),h=this.droppedRecord,p=(e.data[0]?d=e.data:d.push(e.data),0),u=d.length,c=0;c<u;c++)this.parent.isOnEdit=!0,n=d[c],this.draggedRecord=n,"Invalid"!==this.dropPosition&&(t&&this.deleteDragRow(),o=this.treeGridData.indexOf(h),this.parent.editModule.updateResourceRelatedFields(h,""),"bottomSegment"===this.dropPosition&&(h.hasChildRecords?(p=this.parent.editModule.getChildCount(h,0),this.parent.taskFields.parentID&&0<this.ganttData.length&&this.ganttData.splice(o+p+1,0,this.draggedRecord.taskData),this.treeGridData.splice(o+p+1,0,this.draggedRecord),this.parent.ids.splice(o+p+1,0,this.draggedRecord.ganttProperties.rowUniqueID.toString()),(r=this.parent.ids.indexOf(this.draggedRecord[this.parent.taskFields.id].toString()))!==o+p+1&&(this.parent.ids.splice(r,1),this.parent.ids.splice(o+p+1,0,this.draggedRecord[this.parent.taskFields.id].toString()))):(this.parent.taskFields.parentID&&0<this.ganttData.length&&this.ganttData.splice(o+1,0,this.draggedRecord.taskData),this.treeGridData.splice(o+1,0,this.draggedRecord),this.parent.ids.splice(o+1,0,this.draggedRecord.ganttProperties.rowUniqueID.toString())),this.parent.setRecordValue("parentItem",this.treeGridData[o].parentItem,n),this.parent.setRecordValue("parentUniqueID",this.treeGridData[o].parentUniqueID,n),this.parent.setRecordValue("level",this.treeGridData[o].level,n),n.hasChildRecords&&(this.updateChildRecordLevel(n,1),this.updateChildRecord(n,o+p+1)),h.parentItem)&&(s=(r=a=this.parent.getParentTask(h.parentItem).childRecords).indexOf(h)+1,r.splice(s,0,n)),"middleSegment"===this.dropPosition&&this.dropMiddle(o),oe.isNullOrUndefined(n.parentItem&&-1!==this.updateParentRecords.indexOf(n.parentItem))||this.updateParentRecords.push(this.parent.getTaskByUniqueID(n.parentItem.uniqueID))),oe.isNullOrUndefined(n.parentItem)&&(o=(s=this.parent.treeGrid.parentData).indexOf(this.droppedRecord),"bottomSegment"===this.dropPosition)&&s.splice(o+1,0,n),this.refreshDataSource();if("middleSegment"===this.dropPosition){if(!oe.isNullOrUndefined(h.ganttProperties.predecessor))for(var g,f,m=h.ganttProperties.predecessor.length-1;0<=m;m--)oe.isNullOrUndefined(h.ganttProperties.predecessor)||(f=this.parent.getRecordByID(h.ganttProperties.predecessor[m].from),g=this.parent.getRecordByID(h.ganttProperties.predecessor[m].to),f=this.parent.predecessorModule.validateParentPredecessor(f,g),!h.ganttProperties.predecessor)||f&&this.parent.allowParentDependency||(this.parent.editModule.removePredecessorOnDelete(h),h.ganttProperties.predecessor.splice(m,1),h.ganttProperties.predecessorsName=null,h[this.parent.taskFields.dependency]=null,h.taskData[this.parent.taskFields.dependency]=null);h.ganttProperties.isMilestone&&(this.parent.setRecordValue("isMilestone",!1,h.ganttProperties,!0),oe.isNullOrUndefined(h.taskData[this.parent.taskFields.milestone])||!0===h.taskData[this.parent.taskFields.milestone]&&(h.taskData[this.parent.taskFields.milestone]=!1))}for(var y=0;y<this.updateParentRecords.length;y++)this.parent.dataOperation.updateParentItems(this.updateParentRecords[y]);this.parent.editedRecords.forEach(function(e){i.isFirstCall=!0,i.parent.predecessorModule.validatePredecessor(e,[],"")});for(y=0;y<this.updateParentRecords.length;y++)this.parent.dataOperation.updateParentItems(this.updateParentRecords[y]);this.updateParentRecords=[],this.parent.isOnEdit=!1}this.canReset=!0,this.refreshRecord(e)},C.prototype.refreshRecord=function(t,i){var e,n,a,r,s=this;_(this.parent.dataSource)?(e=this.parent.dataSource,n={changedRecords:X(this.parent.editedRecords,null,null,this.parent)},a=this.parent.query instanceof y.Query?this.parent.query:new y.Query,((r=e.adaptor)instanceof y.WebApiAdaptor&&r instanceof y.ODataAdaptor&&!e.dataSource.batchUrl?e.update(this.parent.taskFields.id,n.changedRecords,null,a):e.saveChanges(n,this.parent.taskFields.id,null,a)).then(function(e){return s.indentSuccess(e,t,i)}).catch(function(e){return s.indentFailure(e)})):this.indentOutdentSuccess(t,i)},C.prototype.indentSuccess=function(e,t,i){this.updateEditedFields(e),this.indentOutdentSuccess(t,i)},C.prototype.indentFailure=function(e){this.parent.trigger("actionFailure",{error:e})},C.prototype.indentOutdentSuccess=function(e,t){if(this.parent.treeGrid.parentData=[],this.parent.treeGrid.editModule&&(this.parent.treeGrid.editModule.isOnBatch=!1),this.parent.treeGrid.refresh(),this.parent.enableImmutableMode&&(this.refreshRecordInImmutableMode(e.data,t),this.parent.chartRowsModule.refreshRecords(this.parent.editedRecords)),t?e.requestType="rowDropped":"middleSegment"===this.dropPosition?e.requestType="indented":"bottomSegment"===this.dropPosition&&(e.requestType="outdented"),e.modifiedRecords=this.parent.editedRecords,this.parent.timezone)for(var i=0;i<e.modifiedRecords.length;i++)Z(e.modifiedRecords[i],this.parent);this.canReset&&(this.parent.previousRecords={}),this.canReset=!1,this.parent.trigger("actionComplete",e),oe.isNullOrUndefined(this.parent.loadingIndicator)||"Shimmer"!==this.parent.loadingIndicator.indicatorType?this.parent.hideSpinner():this.parent.hideMaskRow(),this.parent.rowDragAndDropModule&&(this.parent.rowDragAndDropModule.draggedRecord=null)},C.prototype.refreshDataSource=function(){var e,t,i=this.draggedRecord,n=this.droppedRecord,a=this.parent,r=this.parent.dataSource instanceof y.DataManager?oe.getValue("dataOperation.dataArray",this.parent):a.dataSource;if(0<r.length&&!oe.isNullOrUndefined(n)&&!n.parentItem){for(var s=0;s<Object.keys(r).length;s++)r[s][this.parent.taskFields.child]===n.taskData[this.parent.taskFields.child]&&(e=s);"topSegment"===this.dropPosition?this.parent.taskFields.parentID||r.splice(e,0,i.taskData):"bottomSegment"!==this.dropPosition||this.parent.taskFields.parentID||r.splice(e+1,0,i.taskData)}else this.parent.taskFields.parentID||oe.isNullOrUndefined(n)||!n.parentItem||"topSegment"!==this.dropPosition&&"bottomSegment"!==this.dropPosition||(a="topSegment"===this.dropPosition?"Above":"Below",this.parent.editModule.addRowSelectedItem=n,t=[],Array.isArray(i)?t=i:t[0]=i,this.parent.editModule.updateRealDataSource(t,a),delete this.parent.editModule.addRowSelectedItem);this.parent.taskFields.parentID&&(i.parentItem?"topSegment"===this.dropPosition||"bottomSegment"===this.dropPosition?(i[this.parent.taskFields.parentID]=n[this.parent.taskFields.parentID],i.taskData[this.parent.taskFields.parentID]=n[this.parent.taskFields.parentID],i.ganttProperties.parentId=n[this.parent.taskFields.parentID]):(i[this.parent.taskFields.parentID]=n[this.parent.taskFields.id],i.taskData[this.parent.taskFields.parentID]=n[this.parent.taskFields.id],i.ganttProperties.parentId=n[this.parent.taskFields.id]):(i[this.parent.taskFields.parentID]=null,i.taskData[this.parent.taskFields.parentID]=null,i.ganttProperties.parentId=null))},C.prototype.deleteDragRow=function(){this.parent.dataSource instanceof y.DataManager?this.ganttData=oe.getValue("dataOperation.dataArray",this.parent):this.ganttData=j(this.parent)?oe.getValue("result",this.parent.dataSource):this.parent.dataSource,this.treeGridData=j(this.parent)?oe.getValue("result",this.parent.treeGrid.dataSource):this.parent.treeGrid.dataSource;var e=this.parent.getTaskByUniqueID(this.draggedRecord.uniqueID);this.removeRecords(e)},C.prototype.updateIndentedChildRecords=function(e){for(var t={uniqueID:e.uniqueID,expanded:e.expanded,level:e.level,index:e.index,taskId:e.ganttProperties.rowUniqueID},i=0;i<e.childRecords.length;i++)this.parent.setRecordValue("parentItem",t,e.childRecords[i]),this.parent.setRecordValue("parentUniqueID",e.uniqueID,e.childRecords[i]);if(e.hasChildRecords){e=e.childRecords;for(var n=0;n<e.length;n++)this.updateIndentedChildRecords(e[n])}},C.prototype.dropMiddle=function(e){var t,i,n=this.parent;this.parent.undoRedoModule&&this.parent.undoRedoModule.isUndoRedoPerformed&&this.parent.undoRedoModule.currentAction.modifiedRecord&&"child"!==this.parent.undoRedoModule.currentAction.modifiedRecord[0].position?"above"===this.parent.undoRedoModule.currentAction.modifiedRecord[0].position?t=this.parent.ids.indexOf(this.parent.undoRedoModule.currentAction.modifiedRecord[0].id.toString()):"below"===this.parent.undoRedoModule.currentAction.modifiedRecord[0].position&&(t=this.parent.ids.indexOf(this.parent.undoRedoModule.currentAction.modifiedRecord[0].id.toString())+1):(i=this.parent.editModule.getChildCount(this.droppedRecord,0),t=oe.isNullOrUndefined(i)||0===i?e+1:i+e+1),"middleSegment"===this.dropPosition&&(this.droppedRecord.ganttProperties.isAutoSchedule&&!oe.isNullOrUndefined(this.droppedRecord.ganttProperties.predecessorsName)&&""!==this.droppedRecord.ganttProperties.predecessorsName&&(i=this.droppedRecord.ganttProperties.startDate,this.parent.setRecordValue("startDate",i,this.draggedRecord.ganttProperties,!0),this.parent.dateValidationModule.calculateEndDate(this.draggedRecord),this.parent.dataOperation.updateTaskData(this.draggedRecord),this.parent.dataOperation.updateTaskLeftWidth(this.draggedRecord)),n.taskFields.parentID&&0<this.ganttData.length&&this.ganttData.splice(t,0,this.draggedRecord.taskData),this.treeGridData.splice(t,0,this.draggedRecord),this.parent.ids.splice(t,0,this.draggedRecord[this.parent.taskFields.id].toString()),this.recordLevel(),this.draggedRecord.hasChildRecords&&(this.updateChildRecord(this.draggedRecord,t,this.droppedRecord.expanded),this.parent.enableImmutableMode)&&(e=this.draggedRecord,this.updateIndentedChildRecords(e)),oe.isNullOrUndefined(this.draggedRecord.parentItem&&-1!==this.updateParentRecords.indexOf(this.draggedRecord.parentItem)))&&this.updateParentRecords.push(this.draggedRecord.parentItem)},C.prototype.updateChildRecordLevel=function(e,t){if(t++,!e.hasChildRecords)return 0;for(var i=e.childRecords.length,n=0;n<i;n++){var a=e.childRecords[n],r=void 0;e.parentItem&&(r=this.parent.treeGrid.uniqueIDCollection[e.parentItem.uniqueID]),a.level=e.parentItem?r.level+t:e.level+1,a.hasChildRecords&&(t--,t=this.updateChildRecordLevel(a,t))}return t},C.prototype.updateChildRecord=function(e,t,i){var n,a=this.parent;if(!e.hasChildRecords)return 0;for(var r=e.childRecords.length,s=0;s<r;s++)n=e.childRecords[s],a.flatData.splice(++t,0,n),this.parent.ids.splice(t,0,n.ganttProperties.rowUniqueID.toString()),a.taskFields.parentID&&0<this.ganttData.length&&this.ganttData.splice(t,0,n.taskData),n.hasChildRecords&&(t=this.updateChildRecord(n,t));return t},C.prototype.removeRecords=function(e){var t=this.parent,i=this.parent.dataSource instanceof y.DataManager?oe.getValue("dataOperation.dataArray",this.parent):this.parent.dataSource,n=e;if(n){e=this.parent.getParentTask(n.parentItem);if(n.parentItem&&(l=0,d=e?e.childRecords:[])&&0<d.length&&(l=d.indexOf(n),e.childRecords.splice(l,1),this.parent.taskFields.parentID||e.taskData[this.parent.taskFields.child].splice(l,1),this.updateParentRecords.push(e)),t.taskFields.parentID){n.hasChildRecords&&0<n.childRecords.length&&this.removeChildItem(n);for(var a=void 0,r=0<i.length?i:this.parent.currentViewData,s=0;s<r.length;s++)r[s][this.parent.taskFields.id]===n.taskData[this.parent.taskFields.id]&&(a=s);if(-1!==a){0<i.length&&i.splice(a,1);for(var o=void 0,s=0;s<this.treeGridData.length;s++)this.treeGridData[s][this.parent.taskFields.id]===n.taskData[this.parent.taskFields.id]&&(o=s);this.treeGridData.splice(o,1),this.parent.ids.splice(o,1),-1!==this.parent.treeGrid.parentData.indexOf(n)&&this.parent.treeGrid.parentData.splice(this.parent.treeGrid.parentData.indexOf(n),1)}}var l,d=this.treeGridData.indexOf(n);t.taskFields.parentID||(l=this.getChildCount(n,0),this.treeGridData.splice(d,l+1),this.parent.ids.splice(d,l+1),-1!==(i=this.ganttData.indexOf(n.taskData))&&(this.ganttData.splice(i,1),this.parent.treeGrid.parentData.splice(i,1))),n.parentItem&&e&&e.childRecords&&!e.childRecords.length&&(this.parent.setRecordValue("expanded",!1,e),this.parent.setRecordValue("hasChildRecords",!1,e))}},C.prototype.removeChildItem=function(e){for(var t,i=0;i<e.childRecords.length;i++){for(var n=e.childRecords[i],a=void 0,a=this.parent.dataSource instanceof y.DataManager?oe.getValue("dataOperation.dataArray",this.parent):this.parent.dataSource,r=0;r<a.length;r++)a[r][this.parent.taskFields.id]===n.taskData[this.parent.taskFields.id]&&(t=r);if(-1!==t){0<a.length&&a.splice(t,1);for(var s=void 0,o=0;o<this.treeGridData.length;o++)this.treeGridData[o][this.parent.taskFields.id]===n.taskData[this.parent.taskFields.id]&&(s=o);this.treeGridData.splice(s,1),this.parent.ids.splice(s,1)}n.hasChildRecords&&this.removeChildItem(n)}},C.prototype.recordLevel=function(){var e,t=this.parent,i=this.draggedRecord,n=this.droppedRecord,a=t.taskFields.child;n.hasChildRecords||(n.hasChildRecords=!0,n.childRecords.length)||(n.childRecords=[],!t.taskFields.parentID&&oe.isNullOrUndefined(n.taskData[a])&&(n.taskData[a]=[])),"middleSegment"===this.dropPosition&&(delete(e=oe.extend({},n)).childRecords,e={uniqueID:e.uniqueID,expanded:e.expanded,level:e.level,index:e.index,taskId:e.ganttProperties.rowUniqueID},this.parent.setRecordValue("parentItem",e,i),this.parent.setRecordValue("parentUniqueID",n.uniqueID,i),n.childRecords.splice(n.childRecords.length,0,i),oe.isNullOrUndefined(i)||t.taskFields.parentID||oe.isNullOrUndefined(n.taskData[a])||n.taskData[t.taskFields.child].splice(n.childRecords.length,0,i.taskData),!oe.isNullOrUndefined(n.ganttProperties.segments)&&0<n.ganttProperties.segments.length&&(n.ganttProperties.segments=null,n.taskData[t.taskFields.segments]=null),i.hasChildRecords?(i.level=n.level+1,this.updateChildRecordLevel(i,1)):i.level=n.level+1,n.expanded=!0)},C);function C(e){this.isFromDeleteMethod=!1,this.targetedRecords=[],this.isNewRecordAdded=!1,this.isValidatedEditedRecord=!1,this.createArray=!0,this.deletedRecord=[],this.canReset=!1,this.updateParentRecords=[],this.isaddtoBottom=!1,this.confirmDialog=null,this.taskbarMoved=!1,this.predecessorUpdated=!1,this.isBreakLoop=!1,this.deletedTaskDetails=[],this.parent=e,this.parent.predecessorModule.validatedChildItems=[],this.parent.editSettings.allowEditing&&"Auto"===this.parent.editSettings.mode&&(this.cellEditModule=new cn(this.parent)),this.parent.taskFields.dependency&&(this.parent.connectorLineEditModule=new vn(this.parent)),(this.parent.editSettings.allowAdding||this.parent.editSettings.allowEditing&&("Dialog"===this.parent.editSettings.mode||"Auto"===this.parent.editSettings.mode))&&(this.dialogModule=new bn(this.parent)),this.parent.editSettings.allowTaskbarEditing&&(this.taskbarEditModule=new kn(this.parent)),this.parent.editSettings.allowDeleting&&(e=oe.createElement("div",{id:this.parent.element.id+"_deleteConfirmDialog"}),this.parent.element.appendChild(e),this.renderDeleteConfirmDialog()),this.parent.treeGrid.recordDoubleClick=this.recordDoubleClick.bind(this),this.parent.treeGrid.editSettings.allowAdding=this.parent.editSettings.allowAdding,this.parent.treeGrid.editSettings.allowDeleting=this.parent.editSettings.allowDeleting,this.parent.treeGrid.editSettings.showDeleteConfirmDialog=this.parent.editSettings.showDeleteConfirmDialog,this.parent.treeGrid.editSettings.allowNextRowEdit=this.parent.editSettings.allowNextRowEdit,"Dialog"===this.parent.editSettings.mode&&T.TreeGrid.Inject(T.Edit),this.updateDefaultColumnEditors()}Cn.prototype.getModuleName=function(){return"reorder"},Cn.prototype.bindEvents=function(){var t=this;this.parent.treeGrid.columnDragStart=function(e){t.parent.trigger("columnDragStart",e)},this.parent.treeGrid.columnDrag=function(e){t.parent.trigger("columnDrag",e)},this.parent.treeGrid.columnDrop=function(e){t.parent.trigger("columnDrop",e)}},Cn.prototype.destroy=function(){};var Sn=Cn;function Cn(e){this.parent=e,T.TreeGrid.Inject(T.Reorder),this.parent.treeGrid.allowReordering=this.parent.allowReordering,this.bindEvents()}var Rn=function(){return(Rn=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var a in t=arguments[i])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},Mn=(xn.prototype.getModuleName=function(){return"resize"},xn.prototype.bindEvents=function(){var i=this;this.parent.treeGrid.resizeStart=function(e){var t;i.parent.undoRedoModule&&i.parent.isUndoRedoItemPresent("ColumnResize")&&(i.parent.undoRedoModule.createUndoCollection(),(t={action:"ColumnResize"}).resizedColumn=Rn({},e.column),i.parent.undoRedoModule.getUndoCollection[i.parent.undoRedoModule.getUndoCollection.length-1]=t),i.parent.trigger("resizeStart",e)},this.parent.treeGrid.resizing=function(e){i.parent.trigger("resizing",e)},this.parent.treeGrid.resizeStop=function(e){i.parent.trigger("resizeStop",e)}},xn.prototype.destroy=function(){},xn);function xn(e){this.parent=e,T.TreeGrid.Inject(T.Resize),this.parent.treeGrid.allowResizing=this.parent.allowResizing,this.bindEvents()}R.prototype.getModuleName=function(){return"filter"},R.prototype.updateCustomFilters=function(){for(var e=this.parent.taskFields,t=0;t<this.parent.ganttColumns.length;t++){var i=this.parent.ganttColumns[t];("datepickeredit"!==i.editType&&"datetimepickeredit"!==i.editType||i.field!==e.startDate&&i.field!==e.endDate&&i.field!==e.baselineStartDate&&i.field!==e.baselineEndDate)&&(i.field!==e.duration||"stringedit"!==i.editType)||this.initiateFiltering(this.parent.ganttColumns[t])}},R.prototype.updateModel=function(){this.parent.filterSettings=this.parent.treeGrid.filterSettings},R.prototype.addEventListener=function(){this.parent.on("updateModel",this.updateModel,this),this.parent.on("actionBegin",this.actionBegin,this),this.parent.on("actionComplete",this.actionComplete,this),this.parent.on("columnMenuOpen",this.columnMenuOpen,this)},R.prototype.wireEvents=function(e){oe.EventHandler.add(document.getElementById(e),"click",this.mouseClickHandler,this)},R.prototype.initiateFiltering=function(e){var t=this.parent.getColumnByField(e.field,this.parent.treeGridModule.treeGridColumns);e.allowFiltering=!1!==e.allowFiltering,!e.allowFiltering||"Menu"!==this.parent.filterSettings.type&&"Excel"!==this.parent.filterSettings.type||e.filter||(e.filter={ui:this.getCustomFilterUi(e)}),t&&(t.allowFiltering=e.allowFiltering,t.filter=e.allowFiltering?e.filter:{})},R.prototype.getCustomFilterUi=function(e){var t=this.parent.taskFields,i={};return"datepickeredit"!==e.editType||e.field!==t.startDate&&e.field!==t.endDate&&e.field!==t.baselineStartDate&&e.field!==t.baselineEndDate?"datetimepickeredit"!==e.editType||e.field!==t.startDate&&e.field!==t.endDate&&e.field!==t.baselineStartDate&&e.field!==t.baselineEndDate?e.field===t.duration&&"stringedit"===e.editType&&(i=this.getDurationFilter()):i=this.getDateTimePickerFilter():i=this.getDatePickerFilter(e.field),i},R.prototype.mouseClickHandler=function(e){oe.closest(e.target,".e-excelfilter")&&this.parent.treeGrid.grid.notify("click",e)},R.prototype.unWireEvents=function(){oe.EventHandler.remove(this.parent.element,"click",this.mouseClickHandler)},R.prototype.getDatePickerFilter=function(e){var n,a=this,t=this.parent,i=e===t.taskFields.startDate||e===t.taskFields.baselineStartDate?t.defaultStartTime:t.defaultEndTime;return{create:function(e){var t=b.getCustomDateFormat(e.column.format,e.column.type),i=oe.createElement("input",{className:"flm-input"});e.target.appendChild(i),(n=new W.DatePicker({placeholder:a.parent.localeObj.getConstant("enterValue"),format:t})).enableRtl=a.parent.enableRtl,n.appendTo(i)},write:function(e){n.value=e.filteredValue},read:function(e){n.value&&n.value.setSeconds(i),e.fltrObj.filterByColumn(e.column.field,e.operator,n.value)}}},R.prototype.getDateTimePickerFilter=function(){var n,a=this;return{create:function(e){var t=b.getCustomDateFormat(e.column.format,e.column.type),i=oe.createElement("input",{className:"flm-input"});e.target.appendChild(i),(n=new W.DateTimePicker({placeholder:a.parent.localeObj.getConstant("enterValue"),format:t})).enableRtl=a.parent.enableRtl,n.appendTo(i)},write:function(e){n.value=e.filteredValue},read:function(e){e.fltrObj.filterByColumn(e.column.field,e.operator,n.value)}}},R.prototype.getDurationFilter=function(){var a,r=this,s=this.parent,o="";return{create:function(e){var t=oe.createElement("input",{className:"e-input"});t.setAttribute("placeholder",r.parent.localeObj.getConstant("enterValue")),e.target.appendChild(t),(a=new B.TextBox).enableRtl=r.parent.enableRtl,a.appendTo(t)},write:function(e){a.value=e.filteredValue?o:""},read:function(e){var t,i=r.parent.dataOperation.getDurationValue(a.value),n=oe.getValue("duration",i),i=oe.getValue("durationUnit",i);o=0<=n?(t=void 0,"minute"===i?t=60*n/s.secondsPerDay:"hour"===i?t=60*n*60/s.secondsPerDay:(t=n,i="day"),e.fltrObj.filterByColumn(e.column.field,e.operator,t),r.parent.dataOperation.getDurationString(n,i)):(e.fltrObj.filterByColumn(e.column.field,e.operator,null),null)}}},R.prototype.columnMenuOpen=function(e){this.filterMenuElement&&document.body.contains(this.filterMenuElement)&&oe.remove(this.filterMenuElement),this.filterMenuElement=null},R.prototype.actionBegin=function(e){},R.prototype.closeFilterOnContextClick=function(e){var t,i=document.querySelector("body > div.e-datepicker"),n=document.querySelector("body > div.e-datetimepicker");this.filterMenuElement&&document.body.contains(this.filterMenuElement)&&(t=oe.closest(e,"#"+this.parent.element.id)||e.querySelector("#"+this.parent.element.id),(this.filterMenuElement.contains(e)||oe.isNullOrUndefined(t))&&(this.filterMenuElement.contains(e)||this.parent.enableAdaptiveUI||!oe.isNullOrUndefined(i)||!oe.isNullOrUndefined(n)||"DIV"!==e.nodeName&&"HTML"!==e.nodeName&&"SPAN"!==e.nodeName&&"BUTTON"!==e.nodeName||e.classList.contains("e-dropdownbase"))||(oe.remove(this.filterMenuElement),this.parent.treeGrid.grid.notify("filter-menu-close",{isOpen:!1}),this.filterMenuElement=null))},R.prototype.actionComplete=function(e){var t,i,n,a,r,s;oe.isNullOrUndefined(e.filterModel)||oe.isNullOrUndefined(e.filterModel.dialogObj)||oe.isNullOrUndefined(e.filterModel.dialogObj.element)||"Excel"===this.parent.filterSettings.type&&this.wireEvents(e.filterModel.dialogObj.element.id),e.requestType===b.filterAfterOpen&&("Menu"===this.parent.treeGrid.filterSettings.type?this.filterMenuElement=oe.getValue("filterModel.dlgObj.element",e):this.filterMenuElement=oe.getValue("filterModel.dialogObj.element",e),this.updateFilterMenuPosition(this.filterMenuElement,e),t=this.parent.taskFields.id,i=this.parent.taskFields.dependency,n=this.parent.taskFields.resourceInfo,a=this.parent.treeGrid.grid.filterModule,a=oe.getValue("values",a),e.columnName===i&&oe.isNullOrUndefined(oe.getValue(i,a))||e.columnName===n&&oe.isNullOrUndefined(oe.getValue(n,a))?(r=this.filterMenuElement.querySelector(".e-dropdownlist"),s=void 0,oe.isNullOrUndefined(r)||((s=oe.getValue("ej2_instances[0]",r)).index=2,s.dataBind())):e.columnName===t&&oe.isNullOrUndefined(oe.getValue(t,a))&&"Menu"===this.parent.treeGrid.filterSettings.type&&(r=this.filterMenuElement.querySelector(".e-flmenu-input"),s=oe.getValue("ej2_instances[0]",r),!oe.isNullOrUndefined(s))&&oe.isNullOrUndefined(this.parent.columnByField[e.columnName].format)&&(s.format="n"))},R.prototype.setPosition=function(e,t){var i,n,a,r=this.parent.element.getBoundingClientRect(),s=r.top+window.scrollY,o=r.left,l=!1;if(!oe.isNullOrUndefined(this.parent.element.parentNode)&&"BODY"!==this.parent.element.parentNode.tagName){var l=!0,d=this.parent.element.parentNode,h=Math.abs(d.getBoundingClientRect().top),p=h>window.scrollY?h-window.scrollY:window.scrollY-h;for(d.style.marginTop;;){if(Math.abs(s)>Math.abs(p)){n=s-p;break}if(!oe.isNullOrUndefined(this.parent.element.parentNode)){if(d.parentNode instanceof HTMLDocument)break;(d=d.parentNode).parentNode&&d.parentNode.style&&d.parentNode.style.marginTop}p=d.getBoundingClientRect().top}for(i=(d=this.parent.element.parentNode).getBoundingClientRect().left,d.style.marginLeft;;){if(Math.abs(o)>Math.abs(i)){a=o-i;break}if(!oe.isNullOrUndefined(this.parent.element.parentNode)){if(d.parentNode instanceof HTMLDocument)break;(d=d.parentNode).style.marginLeft}i=d.getBoundingClientRect().left}}var h=e.getBoundingClientRect(),u=t.getBoundingClientRect(),c=h.right+window.scrollX,g=l?h.top-s:h.top+window.scrollY;r.right<c+t.offsetWidth?h.left-t.offsetWidth>r.left?c=h.left-t.offsetWidth:c-=c+t.offsetWidth-r.right:oe.isNullOrUndefined(n)&&oe.isNullOrUndefined(a)||!l||(c=Math.abs(h.right-r.left),g=Math.abs(h.top-r.top)),oe.isNullOrUndefined(n)||oe.isNullOrUndefined(a)?(t.style.top=g+"px",t.style.left=c+"px"):(l=h.top,(r=this.hasParentWithLeftSpacing(document.getElementsByClassName("e-gantt")[0]))&&(l=h.top-this.parent.element.getBoundingClientRect().top),e=h.width+parseInt(e.parentElement.style.left,10),h.top>u.top||(l=g),u.left!==h.left+h.width&&!r||(e=c),t.style.top=l+window.scrollY+"px",t.style.left=e+"px")},R.prototype.hasParentWithLeftSpacing=function(e){for(var t=e.parentElement;t;){var i=window.getComputedStyle(t),n=parseFloat(i.marginLeft);if(0<parseFloat(i.paddingLeft)||0<n)return i=!1,!!(t.previousElementSibling&&0<parseInt(t.previousElementSibling.style.width,10))||i;t=t.parentElement}return!1},R.prototype.updateFilterMenuPosition=function(e,t){var i;oe.addClass([e],"e-gantt"),this.parent.enableAdaptiveUI||document.querySelector("#"+this.parent.controlId).appendChild(e),this.parent.showColumnMenu?(i=document.querySelector("#treeGrid"+this.parent.controlId+"_gridcontrol_colmenu_Filter"))&&(e.style.zIndex=i.parentElement.style.zIndex,"Menu"===this.parent.treeGrid.filterSettings.type?this.setPosition(i,oe.getValue("filterModel.dlgObj.element",t)):this.setPosition(i,oe.getValue("filterModel.dialogObj.element",t))):(i=this.parent.treeGrid.grid.getColumnHeaderByField(t.columnName).querySelector(".e-filtermenudiv"),"Menu"===this.parent.treeGrid.filterSettings.type?b.getFilterMenuPostion(i,oe.getValue("filterModel.dlgObj",t)):b.getFilterMenuPostion(i,oe.getValue("filterModel.dialogObj",t))),e.style.display="block","Menu"===this.parent.treeGrid.filterSettings.type&&e.querySelector(".e-valid-input").focus(),"Excel"===this.parent.treeGrid.filterSettings.type&&document.querySelector(".e-searchinput").focus()},R.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off("updateModel",this.updateModel),this.parent.off("actionBegin",this.actionBegin),this.parent.off("actionComplete",this.actionComplete),this.parent.off("columnMenuOpen",this.columnMenuOpen))},R.prototype.destroy=function(){this.removeEventListener(),this.unWireEvents()};var On=R;function R(e){this.parent=e,T.TreeGrid.Inject(T.Filter),this.parent.treeGrid.allowFiltering=this.parent.allowFiltering,this.updateCustomFilters(),this.parent.treeGrid.filterSettings=b.getActualProperties(this.parent.filterSettings),this.addEventListener()}En.prototype.getModuleName=function(){return"sort"},En.prototype.addEventListener=function(){this.parent.on("updateModel",this.updateModel,this)},En.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off("updateModel",this.updateModel)},En.prototype.destroy=function(){this.removeEventListener()},En.prototype.sortColumn=function(e,t,i){this.parent.treeGrid.sortByColumn(e,t,i)},En.prototype.clearSorting=function(){this.parent.treeGrid.clearSorting()},En.prototype.updateModel=function(){this.parent.sortSettings=this.parent.treeGrid.sortSettings},En.prototype.removeSortColumn=function(e){this.parent.treeGrid.grid.removeSortColumn(e)};var In=En;function En(e){this.parent=e,T.TreeGrid.Inject(T.Sort),this.parent.treeGrid.allowSorting=this.parent.allowSorting,this.parent.treeGrid.sortSettings=b.getActualProperties(this.parent.sortSettings),this.addEventListener()}M.prototype.getModuleName=function(){return"selection"},M.prototype.wireEvents=function(){this.parent.on("selectRowByIndex",this.selectRowByIndex,this),this.parent.isAdaptive?(this.parent.on("chartMouseClick",this.mouseUpHandler,this),this.parent.on("treeGridClick",this.popUpClickHandler,this)):this.parent.on("chartMouseUp",this.mouseUpHandler,this)},M.prototype.selectRowByIndex=function(){-1===this.parent.selectedRowIndex&&-1===this.parent.staticSelectedRowIndex||(this.selectRow(-1!==this.parent.staticSelectedRowIndex?this.parent.staticSelectedRowIndex:this.parent.selectedRowIndex),this.parent.staticSelectedRowIndex=-1)},M.prototype.bindEvents=function(){this.parent.treeGrid.rowSelecting=this.rowSelecting.bind(this),this.parent.treeGrid.rowSelected=this.rowSelected.bind(this),this.parent.treeGrid.rowDeselecting=this.rowDeselecting.bind(this),this.parent.treeGrid.rowDeselected=this.rowDeselected.bind(this),this.parent.treeGrid.cellSelecting=this.cellSelecting.bind(this),this.parent.treeGrid.cellSelected=this.cellSelected.bind(this),this.parent.treeGrid.cellDeselecting=this.cellDeselecting.bind(this),this.parent.treeGrid.cellDeselected=this.cellDeselected.bind(this)},M.prototype.rowSelecting=function(e){this.parent.isGanttChartRendered?(e.isCtrlPressed=this.isMultiCtrlRequest||e.isCtrlPressed,e.isShiftPressed=this.isMultiShiftRequest||e.isShiftPressed,e.target=this.actualTarget,oe.isNullOrUndefined(e.foreignKeyData)||0!==Object.keys(e.foreignKeyData).length||delete e.foreignKeyData,this.parent.selectionSettings&&this.parent.selectionSettings.persistSelection&&(this.parent.treeGrid.grid.selectionModule.checkSelectAllClicked=!0),this.parent.trigger("rowSelecting",e),(this.isMultiShiftRequest||this.isMultiCtrlRequest)&&(this.isMultiShiftRequest=this.isMultiCtrlRequest=!1)):e.cancel=!0},M.prototype.rowSelected=function(e){var t="rowIndexes",t="Multiple"!==this.parent.selectionSettings.type||oe.isNullOrUndefined(e[t])?[e.rowIndex]:e[t];if(this.addRemoveClass(t,e.name),this.selectedRowIndexes=oe.extend([],this.getSelectedRowIndexes(),[],!0),this.parent.setProperties({selectedRowIndex:this.parent.treeGrid.grid.selectedRowIndex},!0),this.isMultiShiftRequest&&(this.selectedRowIndexes=t),this.parent.autoFocusTasks)if(this.parent.enableTimelineVirtualization&&(this.parent.isRowSelected=!0),e.data&&!oe.isNullOrUndefined(e.data.length))for(var i=0;i<e.data.length;i++)this.parent.ganttChartModule.updateScrollLeft(e.data[i].ganttProperties.left);else this.parent.loadChildOnDemand&&this.parent.taskFields.hasChildMapping&&oe.isNullOrUndefined(oe.getValue("data.ganttProperties.left",e))&&(e.data=this.parent.getRecordByID(e.data.taskId)),this.parent.ganttChartModule.updateScrollLeft(oe.getValue("data.ganttProperties.left",e));e.target=this.actualTarget,oe.isNullOrUndefined(e.foreignKeyData)||0!==Object.keys(e.foreignKeyData).length||delete e.foreignKeyData,this.prevRowIndex=e.rowIndex,oe.isNullOrUndefined(this.parent.toolbarModule)||this.parent.toolbarModule.refreshToolbarItems(e),oe.isNullOrUndefined(this.parent.focusModule.previousActiveElement)||(t=this.parent.focusModule.previousActiveElement,oe.removeClass([t],"e-focused"),oe.removeClass([t],"e-focus")),this.parent.trigger("rowSelected",e)},M.prototype.rowDeselecting=function(e){e.target=this.actualTarget,e.isInteracted=this.isInteracted,this.parent.trigger("rowDeselecting",e)},M.prototype.rowDeselected=function(e){var t,i;if(0!==this.multipleIndexes.length)t=this.multipleIndexes;else if(oe.isNullOrUndefined(e.rowIndexes))t=[e.rowIndex];else{for(var n=0;n<e.rowIndexes.length;n++)e.rowIndexes[n]===e.rowIndex&&(i=!0);t=i?e.rowIndexes:[e.rowIndex]}this.addRemoveClass(t),this.selectedRowIndexes=oe.extend([],this.getSelectedRowIndexes(),[],!0),this.parent.setProperties({selectedRowIndex:-1},!0),1===this.selectedRowIndexes.length&&this.parent.setProperties({selectedRowIndex:this.selectedRowIndexes[0]},!0),oe.isNullOrUndefined(this.parent.toolbarModule)||this.parent.toolbarModule.refreshToolbarItems(),"Multiple"===this.parent.selectionSettings.type&&this.parent.isAdaptive&&0===this.selectedRowIndexes.length&&this.hidePopUp(),e.target=this.actualTarget,e.isInteracted=this.isInteracted,this.parent.trigger("rowDeselected",e),this.isInteracted=!1,this.multipleIndexes=[]},M.prototype.cellSelecting=function(e){var t=new y.Deferred;return this.parent.trigger("cellSelecting",e,function(e){t.resolve(e)}),t},M.prototype.cellSelected=function(e){this.parent.trigger("cellSelected",e),oe.isNullOrUndefined(this.parent.toolbarModule)||this.parent.toolbarModule.refreshToolbarItems()},M.prototype.cellDeselecting=function(e){this.parent.trigger("cellDeselecting",e)},M.prototype.cellDeselected=function(e){this.parent.trigger("cellDeselected",e),oe.isNullOrUndefined(this.parent.toolbarModule)||this.parent.toolbarModule.refreshToolbarItems()},M.prototype.selectCell=function(e,t){this.parent.treeGrid.selectCell(e,t)},M.prototype.selectCells=function(e){this.parent.treeGrid.grid.selectCells(e)},M.prototype.selectRow=function(t,e,i){var n,a=[].slice.call(this.parent.ganttChartModule.chartBodyContent.querySelector("tbody").children),a=(this.parent.enableVirtualization&&(this.parent.treeGridModule.addedRecord||this.parent.editModule&&this.parent.editModule.isAdded)&&(t=this.parent.getExpandedRecords(this.parent.flatData).indexOf(this.parent.flatData[t]),this.parent.treeGridModule.addedRecord=!1,this.parent.editModule)&&(this.parent.editModule.isAdded=!1),a.filter(function(e){return parseInt(e.getAttribute("aria-rowindex"),10)-1===t})[0]);-1===t||oe.isNullOrUndefined(a)&&!this.parent.enableVirtualization||"Cell"===this.parent.selectionSettings.mode||(this.parent.showActiveElement&&!oe.isNullOrUndefined(i)&&!i||this.isFromChart?(this.isFromChart&&(this.isFromChart=!1),this.parent.treeGrid.grid.selectionModule.preventFocus=!0):this.parent.treeGrid.grid.selectionModule.preventFocus=!1,!0!==(n=oe.isNullOrUndefined(this.selectedClass)||this.selectedClass!==a||e?n:!0)&&this.parent.treeGrid.selectRow(t,e),this.parent.treeGrid.grid.selectionModule.preventFocus=!0!==this.parent.treeGrid.grid.selectionModule.preventFocus&&this.parent.treeGrid.grid.selectionModule.preventFocus,this.prevRowIndex=t,this.selectedClass=a)},M.prototype.selectRows=function(e){!oe.isNullOrUndefined(e)&&0<e.length&&this.parent.treeGrid.selectRows(e)},M.prototype.getSelectedRowIndexes=function(){return this.parent.treeGrid.getSelectedRowIndexes()},M.prototype.getSelectedRowCellIndexes=function(){return this.parent.treeGrid.getSelectedRowCellIndexes()},M.prototype.getSelectedRecords=function(){if(this.parent.loadChildOnDemand&&this.parent.taskFields.hasChildMapping){for(var i=[],n=this.parent.selectionModule.getSelectedRowIndexes(),a=this,e=0;e<n.length;e++)!function(t){var e=a.parent.currentViewData.filter(function(e){return e.index===n[t]})[0];i.push(e)}(e);return i}return this.parent.treeGrid.getSelectedRecords()},M.prototype.getCellSelectedRecords=function(){for(var e=this.parent.selectionModule.getSelectedRowCellIndexes(),t=[],i=0;i<e.length;i++)t.push(this.parent.currentViewData[e[i].rowIndex]);return t},M.prototype.getSelectedRows=function(){return this.parent.treeGrid.getSelectedRows()},M.prototype.clearSelection=function(){this.addRemoveClass(this.selectedRowIndexes),this.parent.treeGrid.clearSelection(),this.parent.selectedRowIndex=-1,this.selectedRowIndexes=[],this.selectedClass=null,oe.isNullOrUndefined(this.parent.toolbarModule)||this.parent.toolbarModule.refreshToolbarItems(),this.isInteracted=!1},M.prototype.highlightSelectedRows=function(e,t){var i;this.isMultiCtrlRequest=e.ctrlKey||this.enableSelectMultiTouch,this.isMultiShiftRequest=e.shiftKey,this.actualTarget=e.target,this.isInteracted=!0,(this.isSelectionFromChart=t)&&(t=oe.closest(e.target,"tr.e-chart-row"),t=parseInt(t.getAttribute("aria-rowindex"),10)-1,i=this.parent.selectionSettings.enableToggle,"Single"===this.parent.selectionSettings.type||!this.isMultiCtrlRequest&&!this.isMultiShiftRequest?(this.parent.selectionSettings.persistSelection&&this.addRemoveClass(this.selectedRowIndexes,e.name),(!this.parent.allowTaskbarDragAndDrop||this.parent.allowTaskbarDragAndDrop&&this.parent.rowDragAndDropModule&&!this.parent.rowDragAndDropModule.draggedRecord)&&(this.isFromChart=!0,this.selectRow(t,i))):this.isMultiShiftRequest?this.selectRowsByRange(oe.isNullOrUndefined(this.prevRowIndex)?t:this.prevRowIndex,t):(oe.setValue("isMultiCtrlRequest",!0,this.parent.treeGrid.grid.selectionModule),this.parent.treeGrid.grid.selectionModule.addRowsToSelection([t]),-1<this.selectedRowIndexes.indexOf(t)&&this.addRemoveClass([t],e.name)))},M.prototype.getselectedrowsIndex=function(e,t){for(var i=[],n=e<t?{i:e,max:t}:{i:t,max:e},a=n.i,r=n.max;a<=r;a++)i.push(a);t<e&&i.reverse(),this.selectedRowIndexes=i},M.prototype.selectRowsByRange=function(e,t){this.isSelectionFromChart=!0,this.getselectedrowsIndex(e,t),this.selectRows(this.selectedRowIndexes)},M.prototype.addRemoveClass=function(r,s){"number"==typeof r&&(r=[r]);for(var o=[].slice.call(this.parent.ganttChartModule.chartBodyContent.querySelector("tbody").children),l=this,e=0;e<r.length;e++)!function(t){var e,i,n,a=o.filter(function(e){return parseInt(e.getAttribute("aria-rowindex"),10)-1===r[parseInt(t.toString(),10)]})[0];oe.isNullOrUndefined(a)||(e=!1,i=l.getSelectedRowIndexes().indexOf(r[parseInt(t.toString(),10)]),n=l.getSelectedRecords().length,l.parent.selectionSettings.persistSelection&&l.parent.selectionSettings.enableToggle&&!oe.isNullOrUndefined(s)&&"Multiple"!==l.parent.selectionSettings.type&&0<n&&(e=!0),l.parent.selectionSettings.enableToggle&&l.parent.selectionSettings.persistSelection&&-1<i&&"Single"===l.parent.selectionSettings.type&&e||-1<i&&!oe.isNullOrUndefined(s)&&"Multiple"===l.parent.selectionSettings.type?l.addClass(a):oe.isNullOrUndefined(s)?l.removeClass(a):-1<i&&l.addClass(a),l.parent.selectionSettings.enableToggle&&-1<i&&("Single"===l.parent.selectionSettings.type||!l.isMultiCtrlRequest&&!l.isMultiShiftRequest)&&l.parent.selectionSettings.persistSelection&&"chartMouseUp"===s&&l.isSelectionFromChart&&l.removeClass(a))}(e)},M.prototype.addClass=function(e){oe.addClass([e],"e-active"),e.setAttribute("aria-selected","true")},M.prototype.removeClass=function(e){oe.removeClass([e],"e-active"),e.removeAttribute("aria-selected")},M.prototype.showPopup=function(e){this.isSelectionFromChart?(b.setCssInGridPopUp(this.parent.element.querySelector(".e-ganttpopup"),e,"e-rowselect e-icons e-icon-rowselect"+(this.enableSelectMultiTouch&&(1<this.getSelectedRecords().length||1<this.getSelectedRowCellIndexes().length)?" e-spanclicked":"")),document.getElementsByClassName("e-gridpopup")[0].style.display="none",this.openPopup=!0):0===this.selectedRowIndexes.length&&this.hidePopUp()},M.prototype.hidePopUp=function(){this.openPopup?(document.getElementsByClassName("e-ganttpopup")[0].style.display="none",this.openPopup=!1):document.getElementsByClassName("e-gridpopup")[0].style.display="none"},M.prototype.popUpClickHandler=function(e){var e=e.target,t=this.parent.treeGrid.grid,i=oe.closest(e,".e-ganttpopup")?oe.closest(e,".e-ganttpopup"):oe.closest(e,".e-gridpopup");i?(i=i.querySelector(".e-rowselect"),oe.closest(e,".e-ganttpopup")&&!i.classList.contains("e-spanclicked")?(this.enableSelectMultiTouch=!0,i.classList.add("e-spanclicked")):oe.closest(e,".e-gridpopup")&&i.classList.contains("e-spanclicked")?(this.openPopup=!0,this.enableSelectMultiTouch=!0):(this.hidePopUp(),this.enableSelectMultiTouch=!1,oe.closest(e,".e-ganttpopup")&&i.classList.remove("e-spanclicked"))):"Multiple"===this.parent.selectionSettings.type&&this.parent.isAdaptive&&oe.closest(e,".e-rowcell")&&(0===this.selectedRowIndexes.length&&"Row"===this.parent.selectionSettings.mode||0===this.getCellSelectedRecords().length&&"Cell"===this.parent.selectionSettings.mode)&&this.hidePopUp(),t&&oe.setValue("enableSelectMultiTouch",this.enableSelectMultiTouch,t.selectionModule)},M.prototype.mouseUpHandler=function(e){var t=!1,i=document.querySelectorAll(".e-drag-item"),n=null;e.target.closest(".e-rowcell")?n=e.target:e.target.closest(".e-chart-row")&&(n=e.target.closest(".e-left-label-container")||e.target.closest(".e-taskbar-main-container")||e.target.closest(".e-right-label-container")),this.parent.focusModule&&this.parent.focusModule.setActiveElement(n),!(t=this.parent.editModule&&this.parent.editSettings.allowTaskbarEditing&&this.parent.editModule.taskbarEditModule&&((n=this.parent.editModule.taskbarEditModule).isMouseDragged||n.tapPointOnFocus)?!0:t)&&this.parent.element.contains(e.target)&&1!==i.length&&(n=b.parentsUntil(e.target,"e-chart-row"),t=e.target.classList.contains("e-rowcell")||e.target.classList.contains("e-row")||e.target.parentElement&&e.target.parentElement.classList.contains("e-checkbox-wrapper")||e.target.classList.contains("e-treegridexpand")||e.target.classList.contains("e-treegridcollapse")||!oe.isNullOrUndefined(n),this.popUpClickHandler(e),"Cell"!==this.parent.selectionSettings.mode&&t?(oe.closest(e.target,"tr.e-chart-row")?(this.parent.enableVirtualization&&(this.parent.treeGrid.grid.selectionModule.isInteracted=!0),this.parent.treeGrid.isFromChartSide=!0,this.highlightSelectedRows(e,!0)):(this.parent.treeGrid.isFromChartSide=!1,this.highlightSelectedRows(e,!1)),"Multiple"===this.parent.selectionSettings.type&&this.parent.isAdaptive&&(0<this.selectedRowIndexes.length?this.showPopup(e):this.hidePopUp())):this.isSelectionFromChart=!1)},M.prototype.maintainSelectedRecords=function(e){-1<this.parent.selectionModule.getSelectedRowIndexes().indexOf(e)&&this.addRemoveClass([e])},M.prototype.destroy=function(){this.parent.isDestroyed||(this.parent.off("selectRowByIndex",this.selectRowByIndex),this.parent.isAdaptive?(this.parent.off("chartMouseClick",this.mouseUpHandler),this.parent.off("treeGridClick",this.popUpClickHandler)):this.parent.off("chartMouseUp",this.mouseUpHandler))};var Un=M;function M(e){this.isSelectionFromChart=!1,this.isFromChart=!1,this.multipleIndexes=[],this.selectedRowIndexes=[],this.enableSelectMultiTouch=!1,this.openPopup=!1,this.parent=e,this.bindEvents(),this.parent.treeGrid.selectedRowIndex=this.parent.selectedRowIndex,this.parent.treeGrid.allowSelection=this.parent.allowSelection,this.parent.treeGrid.grid.selectionSettings.enableToggle=this.parent.selectionSettings.enableToggle,this.parent.treeGrid.selectionSettings=b.getActualProperties(this.parent.selectionSettings),this.wireEvents()}x.prototype.getModuleName=function(){return"toolbar"},x.prototype.renderToolbar=function(){if(0<(this.parent.toolbar||[]).length){this.element=oe.createElement("div",{id:this.parent.controlId+"_Gantt_Toolbar",className:"e-gantt-toolbar"}),this.parent.treeGrid.grid.headerModule?this.parent.element.insertBefore(this.element,this.parent.treeGridPane.offsetParent):this.parent.element.appendChild(this.element);for(var e=0,t=["Add","Edit","Update","Delete","Cancel","ExpandAll","CollapseAll","PrevTimeSpan","NextTimeSpan","ZoomIn","ZoomOut","ZoomToFit","ExcelExport","CsvExport","PdfExport","Indent","Outdent","CriticalPath","Undo","Redo"];e<t.length;e++){var i=t[e],n=void 0,a=void 0,a="CriticalPath"===i?(n="critical-path","criticalPath"):(n=i.toLowerCase(),i[0].toLowerCase()+i.slice(1));this.predefinedItems[i]={id:this.parent.element.id+"_"+n,prefixIcon:"e-"+n,text:this.parent.isAdaptive?"":this.parent.localeObj.getConstant(a),tooltipText:this.parent.localeObj.getConstant(a)+("add"===a||"edit"===a||"delete"===a?this.parent.localeObj.getConstant("task"):"expandAll"===a||"collapseAll"===a?this.parent.localeObj.getConstant("tasks"):""),align:this.parent.isAdaptive?"Right":"Left"},this.parent.enableRtl&&("PrevTimeSpan"===i&&(this.predefinedItems[i].prefixIcon="e-nexttimespan"),"NextTimeSpan"===i)&&(this.predefinedItems[i].prefixIcon="e-prevtimespan")}var r=this.parent.localeObj.getConstant("search");this.parent.isAdaptive?this.predefinedItems.Search={id:this.id+"_searchbutton",prefixIcon:"e-search-icon",tooltipText:r,align:"Right"}:this.predefinedItems.Search={id:this.id+"_search",template:'<div class="e-input-group e-search" role="search"><input id="'+this.id+'_searchbar" class="e-input" name="input" type="search"placeholder= "'+r+'"/><span id="'+this.id+'_searchbutton" class="e-input-group-icon e-search-icon e-icons"tabindex="-1" title="'+r+'" aria-label= "search" role="button"></span></div>',tooltipText:r,align:"Right",cssClass:"e-search-wrapper"},this.createToolbar()}},x.prototype.addReactToolbarPortals=function(e){this.parent.isReact&&e&&(this.parent.portals=this.parent.portals.concat(e),this.parent.renderTemplates())},x.prototype.createToolbar=function(){var e=this.getItems(),e=(this.toolbar=new V.Toolbar({items:e,enableRtl:this.parent.enableRtl,clicked:this.toolbarClickHandler.bind(this),height:this.parent.isAdaptive?48:"auto"}),this.toolbar.isStringTemplate=!0,this.toolbar.isReact=this.parent.isReact,this.toolbar.on("render-react-toolbar-template",this.addReactToolbarPortals,this),this.toolbar.appendTo(this.element),this.parent.treeGrid.grid&&this.parent.isReact&&(this.parent.treeGrid.grid.portals=this.parent.portals),this.element.querySelector("#"+this.parent.element.id+"_cancel")),t=this.element.querySelector("#"+this.parent.element.id+"_update"),i=(e&&oe.addClass([e],ue),t&&oe.addClass([t],ue),!1);this.parent.toolbar.map(function(e){"Search"===e&&(i=!0)}),this.parent.isAdaptive&&i?(this.element.insertBefore(this.getSearchBarElement(),this.element.childNodes[0]),this.searchElement=this.element.querySelector("#"+this.parent.element.id+"_searchbar"),new B.TextBox({placeholder:this.parent.localeObj.getConstant("search"),enableRtl:this.parent.enableRtl,floatLabelType:"Never",showClearButton:!0}).appendTo(this.searchElement)):this.searchElement=this.element.querySelector("#"+this.parent.element.id+"_searchbar"),this.parent.filterModule&&(this.wireEvent(),this.parent.searchSettings)&&this.updateSearchTextBox(),this.enableItems([this.parent.controlId+"_redo",this.parent.controlId+"_undo"],!1),this.parent.readOnly&&this.enableItems([this.parent.element.id+"_add",this.parent.element.id+"_update",this.parent.element.id+"_delete",this.parent.element.id+"_cancel",this.parent.element.id+"_indent",this.parent.element.id+"_outdent"],!1)},x.prototype.getSearchBarElement=function(){var e=this,t=oe.createElement("div",{className:"e-adaptive-searchbar",styles:"display: none"}),i=oe.createElement("input",{attrs:{type:"text"},id:this.parent.element.id+"_searchbar"}),n=oe.createElement("span",{className:"e-backarrowspan e-icons"});return n.onclick=function(){t.style.display="none",e.element.childNodes[1].style.display="block"},t.appendChild(n),t.appendChild(i),t},x.prototype.wireEvent=function(){this.searchElement&&(oe.EventHandler.add(this.searchElement,"keyup",this.keyUpHandler,this),oe.EventHandler.add(this.searchElement,"focus",this.focusHandler,this),oe.EventHandler.add(this.searchElement,"blur",this.blurHandler,this))},x.prototype.propertyChanged=function(e){oe.getValue("module",e)===this.getModuleName()&&this.parent.toolbar&&(this.element&&this.element.parentNode&&oe.remove(this.element),this.renderToolbar(),this.refreshToolbarItems())},x.prototype.unWireEvent=function(){this.searchElement&&(oe.EventHandler.remove(this.searchElement,"keyup",this.keyUpHandler),oe.EventHandler.remove(this.searchElement,"focus",this.focusHandler),oe.EventHandler.remove(this.searchElement,"blur",this.blurHandler),this.searchElement=null),this.parent.isDestroyed||this.parent.off("ui-toolbarupdate",this.propertyChanged)},x.prototype.keyUpHandler=function(e){13===e.keyCode&&this.parent.searchSettings.key!==this.searchElement.value&&(this.parent.searchSettings.key=this.searchElement.value,this.parent.dataBind())},x.prototype.focusHandler=function(e){e.target.parentElement.classList.add("e-input-focus")},x.prototype.blurHandler=function(e){e.target.parentElement.classList.remove("e-input-focus")},x.prototype.updateSearchTextBox=function(){this.searchElement&&this.searchElement.value!==this.parent.searchSettings.key&&(this.searchElement.value=this.parent.searchSettings.key)},x.prototype.getItems=function(){var e,t=[],i=this.parent.toolbar,n=-1;i.forEach(function(e,t){("string"==typeof e&&"Search"===e||"object"==typeof e&&"Search"===e.text)&&(n=t)}),-1<n&&(e=i.splice(n,1),i.push(e[0]));for(var a=0,r=i;a<r.length;a++){var s=r[a];t.push("string"==typeof s?this.getItemObject(s):this.getItem(s))}return t},x.prototype.getItem=function(e){var t=this.predefinedItems[e.text],t=t?oe.extend(t,t,e):e;return t.align||(t.align=this.parent.isAdaptive?"Right":"Left"),t},x.prototype.getItemObject=function(e){return this.predefinedItems[e]||{text:e,id:this.id+"_"+e}},x.prototype.toolbarClickHandler=function(i){var n=this,a=this.parent,r=this.id;this.parent.isToolBarClick=!1,oe.extend(i,{cancel:!1}),a.trigger(un,i,function(e){if(!e.cancel)switch(i.item.properties.id!==n.parent.element.id+"_pdfexport"&&i.item.properties.id!==n.parent.element.id+"_critical-path"||(oe.isNullOrUndefined(n.parent.loadingIndicator)||"Shimmer"!==n.parent.loadingIndicator.indicatorType?n.parent.showSpinner():n.parent.showMaskRow()),!0!==n.parent.isAdaptive||e.item.id!==r+"_edit"&&e.item.id!==r+"_add"&&e.item.id!==r+"_delete"&&e.item.id!==r+"_searchbutton"&&e.item.id!==r+"_expandall"&&e.item.id!==r+"_collapseall"||n.parent.selectionModule&&"Multiple"===n.parent.selectionSettings.type&&(n.parent.selectionModule.hidePopUp(),document.getElementsByClassName("e-gridpopup")[0].style.display="none"),!oe.isNullOrUndefined(e.item)&&e.item.id){case r+"_edit":a.editModule&&a.editSettings.allowEditing&&a.editModule.dialogModule.openToolbarEditDialog();break;case r+"_indent":a.editModule&&a.selectionModule.getSelectedRecords().length&&a.indent();break;case r+"_critical-path":a.enableCriticalPath?a.enableCriticalPath=!1:a.enableCriticalPath=!0;break;case r+"_outdent":a.editModule&&a.selectionModule.getSelectedRecords().length&&a.outdent();break;case r+"_update":a.editModule.cellEditModule.isCellEdit=!1,a.treeGrid.grid.saveCell();break;case r+"_cancel":a.cancelEdit();break;case r+"_add":a.editModule&&a.editSettings.allowAdding&&a.editModule.dialogModule.openAddDialog();break;case r+"_delete":n.parent.selectionModule&&n.parent.editModule&&("Cell"!==n.parent.selectionSettings.mode&&n.parent.selectionModule.selectedRowIndexes.length||"Cell"===n.parent.selectionSettings.mode&&n.parent.selectionModule.getSelectedRowCellIndexes().length)&&n.parent.editModule.startDeleteAction();break;case r+"_search":oe.getValue("originalEvent.target.id",e)===n.parent.element.id+"_searchbutton"&&n.parent.filterModule&&(t=n.element.querySelector("#"+n.parent.element.id+"_searchbar").value,n.parent.searchSettings.key!==t)&&(n.parent.searchSettings.key=t,n.parent.dataBind());break;case r+"_searchbutton":var t=n.element.querySelector(".e-adaptive-searchbar");t.parentElement.childNodes[1].style.display="none",t.style.display="block";break;case r+"_expandall":n.parent.ganttChartModule.expandCollapseAll("expand"),n.parent.isCollapseAll=!1;break;case r+"_collapseall":n.parent.ganttChartModule.expandCollapseAll("collapse"),n.parent.isCollapseAll=!0;break;case r+"_prevtimespan":n.parent.previousTimeSpan();break;case r+"_nexttimespan":n.parent.nextTimeSpan();break;case r+"_zoomin":n.zoomIn();break;case r+"_zoomout":n.zoomOut();break;case r+"_zoomtofit":n.zoomToFit();break;case r+"_undo":n.parent.undo();break;case r+"_redo":n.parent.redo()}})},x.prototype.zoomIn=function(){this.parent.timelineModule.processZooming(!0),this.parent.timelineModule.isZooming=!1},x.prototype.zoomToFit=function(){this.parent.timelineModule.isZoomIn&&(this.parent.timelineModule.isZoomIn=!1),this.parent.timelineModule.processZoomToFit(),this.parent.ganttChartModule.updateScrollLeft(0),this.parent.timelineModule.isZoomToFit=!1},x.prototype.zoomOut=function(){this.parent.timelineModule.processZooming(!1),this.parent.timelineModule.isZooming=!1},x.prototype.refreshToolbarItems=function(e){var t=this.parent,i=[],n=[],a=t.editSettings,r=this.id,s=t.selectedRowIndex;if(this.parent.loadChildOnDemand&&this.parent.taskFields.hasChildMapping)for(var o=0;o<t.updatedRecords.length;o++)if(t.updatedRecords[o].index===s){s=o;break}var l=!1,d=(!t.selectionModule||1!==t.selectionModule.getSelectedRecords().length&&1!==t.selectionModule.getSelectedRowCellIndexes().length||(l=!0),t.selectionModule&&"Multiple"===t.selectionSettings.type&&1<t.selectionModule.selectedRowIndexes.length&&(l=!1),!1);if(t.selectionModule&&t.selectionSettings.persistSelection){var h=t.selectionModule.getSelectedRecords().length;if(t.selectionSettings.persistSelection&&1===h)for(o=0;o<h;o++)-1===(k=t.currentViewData.indexOf(t.selectionModule.getSelectedRecords()[o]))&&(d=!0);d&&(l=!1)}var p=this.toolbar?this.toolbar.items:[],u=[r+"_add",r+"_edit",r+"_delete",r+"_update",r+"_cancel",r+"_indent",r+"_outdent"],e="ResourceView"===this.parent.viewType&&0!==oe.getValue("data.level",e)||"ProjectView"===this.parent.viewType;if(oe.isNullOrUndefined(this.parent.editModule))n.push(r+"_delete"),n.push(r+"_add"),n.push(r+"_edit"),n.push(r+"_update"),n.push(r+"_cancel"),n.push(r+"_indent"),n.push(r+"_outdent");else{var c=!!t.editModule.taskbarEditModule&&t.editModule.taskbarEditModule.touchEdit,g=t.flatData&&t.flatData.length,f=((a.allowAdding&&!c?i:n).push(r+"_add"),(a.allowEditing&&e&&g&&l&&!c?i:n).push(r+"_edit"),a.allowEditing&&0!==s&&-1!==s&&g&&l&&"ResourceView"!==this.parent.viewType?oe.isNullOrUndefined(t.updatedRecords[s])||0!==t.updatedRecords[s].level||!g||c?(e=t.updatedRecords[s-1],oe.isNullOrUndefined(t.updatedRecords[s])||t.updatedRecords[s].level-e.level!=1||-1===s?-1!==s&&(i.push(r+"_indent"),i.push(r+"_outdent")):(n.push(r+"_indent"),i.push(r+"_outdent"))):(i.push(r+"_indent"),n.push(r+"_outdent")):(n.push(r+"_indent"),n.push(r+"_outdent")),!!t.selectionModule&&(0<t.selectionModule.getSelectedRecords().length||0<t.selectionModule.getSelectedRowCellIndexes().length));if(t.selectionModule&&t.selectionSettings.persistSelection){d&&(f=!1);var m=(h=t.selectionModule.getSelectedRecords()).length;if(t.selectionSettings.persistSelection&&1<m)for(o=0;o<m;o++){if(-1<(k=t.currentViewData.indexOf(h[o]))){f=!0;break}f=!1}}if((a.allowDeleting&&g&&f&&!c?i:n).push(r+"_delete"),"Auto"===t.editSettings.mode&&!oe.isNullOrUndefined(t.editModule.cellEditModule)&&t.editModule.cellEditModule.isCellEdit){(i=[]).push(r+"_update",r+"_cancel");for(var n=[],y=0;y<p.length;y++)p[y].id!==r+"_update"&&p[y].id!==r+"_cancel"&&-1!==u.indexOf(p[y].id)&&n.push(p[y].id)}else{n.push(r+"_update",r+"_cancel");for(y=0;y<p.length;y++)-1===i.indexOf(p[y].id)&&-1===n.indexOf(p[y].id)&&i.push(p[y].id)}}for(var D=0;D<i.length;D++){for(var k=void 0,y=0;y<p.length;y++)if(p[y].id===i[D]){k=y;break}0<p.length&&!oe.isNullOrUndefined(p[k])&&p[k].properties.visible&&this.toolbar.hideItem(k,!1)}for(var w=0;w<n.length;w++){for(k=void 0,y=0;y<p.length;y++)if(p[y].id===n[w]){k=y;break}0<p.length&&this.toolbar.hideItem(k,!0)}},x.prototype.enableItems=function(e,t){for(var i=0,n=e;i<n.length;i++){var a=n[i],a=this.element.querySelector("#"+a);a&&this.toolbar.enableItems(a.parentElement,t)}},x.prototype.destroy=function(){this.parent.filterModule&&this.unWireEvent(),this.parent.isDestroyed||(this.toolbar&&this.toolbar.off("render-react-toolbar-template",this.addReactToolbarPortals),this.toolbar.destroy(),oe.remove(this.element))};var Fn=x;function x(e){this.predefinedItems={},this.items=["Add","Edit","Update","Delete","Cancel","ExpandAll","CollapseAll","Search","PrevTimeSpan","NextTimeSpan","ZoomIn","ZoomOut","ZoomToFit","ExcelExport","CsvExport","PdfExport","Indent","Outdent","CriticalPath"],this.parent=e,this.id=this.parent.element.id,this.parent.on("ui-toolbarupdate",this.propertyChanged,this)}Ln.prototype.createNonworkingContainer=function(){this.parent.ganttChartModule.chartBodyContent.contains(this.nonworkingContainer)||(this.nonworkingContainer=oe.createElement("div",{className:"e-nonworking-day-container"}),this.parent.enableTimelineVirtualization&&(this.nonworkingContainer.style.height="100%"),this.parent.ganttChartModule.chartBodyContent.insertBefore(this.nonworkingContainer,this.parent.ganttChartModule.chartBodyContent.firstChild))},Ln.prototype.renderHolidays=function(){var e,t=this;this.parent.holidays&&0<this.parent.holidays.length?(this.createNonworkingContainer(),this.nonworkingContainer.contains(this.holidayContainer)||(this.holidayContainer=oe.createElement("div",{className:"e-holiday-container"}),this.parent.enableTimelineVirtualization&&(this.holidayContainer.style.height="100%",this.holidayContainer.style.zIndex="-1"),this.nonworkingContainer.appendChild(this.holidayContainer)),e=this.getHolidaysElement().childNodes,this.holidayContainer.innerHTML="",e.forEach(function(e){t.holidayContainer.appendChild(e.cloneNode(!0))})):this.holidayContainer&&this.holidayContainer.parentNode&&(oe.remove(this.holidayContainer),this.nonworkingContainer)&&0===this.nonworkingContainer.childNodes.length&&oe.remove(this.nonworkingContainer)},Ln.prototype.getHolidaysElement=function(){for(var e,t,i=oe.createElement("div"),n=this.parent.contentHeight,a=0,r=(oe.isNullOrUndefined(this.parent.toolbarModule)||oe.isNullOrUndefined(this.parent.toolbarModule.element)||(a=this.parent.toolbarModule.element.offsetHeight),this.parent.ganttHeight-a-this.parent.ganttChartModule.chartTimelineContainer.offsetHeight),s=0;s<this.parent.holidays.length;s++){this.parent.holidays[s].from&&this.parent.holidays[s].to?(e=this.parent.dateValidationModule.getDateFromFormat(this.parent.holidays[s].from),(t=this.parent.dateValidationModule.getDateFromFormat(this.parent.holidays[s].to)).setDate(t.getDate()+1),e.setHours(0,0,0,0),t.setHours(0,0,0,0)):this.parent.holidays[s].from?(e=this.parent.dateValidationModule.getDateFromFormat(this.parent.holidays[s].from)).setHours(0,0,0,0):this.parent.holidays[s].to&&(e=this.parent.dateValidationModule.getDateFromFormat(this.parent.holidays[s].to)).setHours(0,0,0,0);var o=this.parent.holidays[s].from&&this.parent.holidays[s].to?this.parent.dataOperation.getTaskWidth(e,t):this.parent.perDayWidth,l=this.parent.dataOperation.getTaskLeft(e,!1,!0),l=this.parent.enableRtl?"right:"+l+"px;":"left:"+l+"px;",l=oe.createElement("div",{className:"e-holiday",styles:l+" width:"+o+"px; height:100%;"}),o=oe.createElement("span",{className:"e-span",styles:"top:"+(r<n?r/2:n/2)+"px;left:"+o/2+"px;"}),d=this.parent.disableHtmlEncode?"textContent":"innerHTML";o[d]=this.parent.holidays[s].label||"",this.parent.enableHtmlSanitizer&&"string"==typeof o[d]&&(o[d]=oe.SanitizeHtmlHelper.sanitize(o[d])),l.appendChild(o),this.parent.holidays[s].cssClass&&l.classList.add(this.parent.holidays[s].cssClass),i.appendChild(l)}return i},Ln.prototype.renderWeekends=function(){var e,t=this;this.parent.highlightWeekends&&this.parent.timelineSettings.showWeekend?(this.createNonworkingContainer(),this.nonworkingContainer.contains(this.weekendContainer)||(this.weekendContainer=oe.createElement("div",{className:"e-weekend-container"}),this.parent.enableTimelineVirtualization&&(this.weekendContainer.style.height="100%",this.weekendContainer.style.zIndex="-1"),this.nonworkingContainer.appendChild(this.weekendContainer)),e=this.getWeekendElements().childNodes,this.weekendContainer.innerHTML="",e.forEach(function(e){t.weekendContainer.appendChild(e.cloneNode(!0))})):this.weekendContainer&&(oe.remove(this.weekendContainer),this.nonworkingContainer)&&0===this.nonworkingContainer.childNodes.length&&oe.remove(this.nonworkingContainer)},Ln.prototype.getWeekendElements=function(){var e,t,i,n,a,r,s,o=oe.createElement("div"),l=this.parent.enableTimelineVirtualization&&0!==this.parent.ganttChartModule.scrollObject.element.scrollLeft?this.parent.ganttChartModule.scrollObject.getTimelineLeft():null,d=this.parent.enableTimelineVirtualization&&!oe.isNullOrUndefined(l)?new Date(this.parent.timelineModule.dateByLeftValue(l).getTime()):new Date(this.parent.timelineModule.timelineStartDate.getTime()),h=this.parent.enableTimelineVirtualization?new Date(this.parent.timelineModule.weekendEndDate.getTime()):new Date(this.parent.timelineModule.timelineEndDate.getTime()),p=this.parent.nonWorkingDayIndex,u=!0,c=!0,g=(this.weekendWidthUpdated=!1,this.parent.dataOperation.hasDSTTransition(d.getFullYear()));do{}while(-1!==p.indexOf(d.getDay())&&(e=this.parent.dataOperation.getTaskLeft(d,!1,!0),t=this.parent.perDayWidth,u&&(i=new Date(d.getTime()),(n=new Date(i.getTime())).setDate(n.getDate()+1),n.setHours(0,0,0,0),t=this.parent.dataOperation.getTaskWidth(i,n),u=!1),g||(i=new Date(d),n=new Date(d),i.setDate(i.getDate()+1),s=i.getTimezoneOffset(),a=n.getTimezoneOffset(),c?c=!1:(r="Hour"===this.parent.timelineModule.bottomTier&&1===this.parent.timelineModule.customTimelineSettings.bottomTier.count||"Minutes"===this.parent.timelineModule.bottomTier&&60===this.parent.timelineModule.customTimelineSettings.bottomTier.count||"Hour"===this.parent.timelineModule.topTier&&1===this.parent.timelineModule.customTimelineSettings.topTier.count&&"Minutes"===this.parent.timelineModule.bottomTier&&(30===this.parent.timelineModule.customTimelineSettings.bottomTier.count||15===this.parent.timelineModule.customTimelineSettings.bottomTier.count),this.weekendWidthUpdated||r&&s<a&&(t-=this.parent.perDayWidth/24,this.weekendWidthUpdated=!0))),r=this.parent.enableRtl?"right:"+e+"px;":"left:"+e+"px;",s=oe.createElement("div",{className:"e-weekend",styles:r+" width:"+t+"px;height:100%;"}),o.appendChild(s)),d.setDate(d.getDate()+1),d.setHours(0,0,0,0),d<h);return o},Ln.prototype.updateHolidayLabelHeight=function(){for(var e=this.parent.getContentHeight(),t=document.getElementById(this.parent.element.id),i=0,t=(oe.isNullOrUndefined(this.parent.toolbarModule)||oe.isNullOrUndefined(this.parent.toolbarModule.element)||(i=this.parent.toolbarModule.element.offsetHeight),"auto"===this.parent.height?t.offsetHeight-i-this.parent.ganttChartModule.chartTimelineContainer.offsetHeight:this.parent.ganttHeight-i-this.parent.ganttChartModule.chartTimelineContainer.offsetHeight),n=t<e?t/2:e/2,a=this.holidayContainer.querySelectorAll(".e-span"),r=0;r<a.length;r++)a[r].style.top=oe.formatUnit(n)},Ln.prototype.updateContainerHeight=function(){var e=this.parent.getContentHeight();this.holidayContainer&&(this.holidayContainer.style.height=oe.formatUnit(e),this.updateHolidayLabelHeight()),this.weekendContainer&&(this.weekendContainer.style.height=oe.formatUnit(e))},Ln.prototype.removeContainers=function(){this.holidayContainer&&oe.remove(this.holidayContainer),this.weekendContainer&&oe.remove(this.weekendContainer),this.nonworkingContainer&&oe.remove(this.nonworkingContainer)};var Nn=Ln;function Ln(e){this.weekendWidthUpdated=!1,this.parent=e,this.nonworkingContainer=null,this.holidayContainer=null,this.weekendContainer=null}Bn.prototype.renderEventMarkers=function(){this.parent.eventMarkers&&0<this.parent.eventMarkers.length?(this.parent.ganttChartModule.chartBodyContent.contains(this.eventMarkersContainer)||(this.eventMarkersContainer=oe.createElement("div",{className:"e-event-markers-container"}),this.eventMarkersContainer.setAttribute("role","term"),this.parent.ganttChartModule.chartBodyContent.appendChild(this.eventMarkersContainer)),this.eventMarkersContainer.innerHTML="",this.getEventMarkersElements(this.eventMarkersContainer)):this.removeContainer()},Bn.prototype.removeContainer=function(){this.eventMarkersContainer&&(oe.remove(this.eventMarkersContainer),this.eventMarkersContainer=null)},Bn.prototype.getEventMarkersElements=function(e){for(var t,i,n,a=[],r=0;r<this.parent.eventMarkers.length;r++)oe.isNullOrUndefined(this.parent.eventMarkers[r].day)||(this.parent.isFromEventMarker=!0,n=this.parent.dataOperation.getTaskLeft(this.parent.dateValidationModule.getDateFromFormat(this.parent.eventMarkers[r].day,!0),!1,!0),this.parent.isFromEventMarker=!1,a.push({id:r,left:n,label:this.parent.eventMarkers[r].label,date:this.parent.dateValidationModule.getDateFromFormat(this.parent.eventMarkers[r].day,!0)}),i=void 0,i=this.parent.enableRtl?"right:"+n+"px;":"left:"+n+"px;",n=oe.createElement("div",{className:"e-event-markers",styles:i+"  height:100%;",id:"stripline"+r}),this.parent.eventMarkers[r].label&&((i=oe.createElement("div",{className:"e-span-label"}))[t=this.parent.disableHtmlEncode?"textContent":"innerHTML"]=this.parent.eventMarkers[r].label,this.parent.enableHtmlSanitizer&&"string"==typeof i[t]&&(i[t]=oe.SanitizeHtmlHelper.sanitize(i[t])),this.parent.enableRtl?i.style.right="5px":i.style.left="5px",n.appendChild(i),t=oe.createElement("div",{className:"e-gantt-right-arrow"}),n.appendChild(t)),this.parent.eventMarkers[r].cssClass&&n.classList.add(this.parent.eventMarkers[r].cssClass),n.setAttribute("tabindex","-1"),n.setAttribute("aria-label",this.parent.localeObj.getConstant("eventMarkers")+" "+("string"==typeof this.parent.eventMarkers[r].day?this.parent.eventMarkers[r].day:this.parent.getFormatedDate(this.parent.eventMarkers[r].day))+" "+this.parent.eventMarkers[r].label),e.appendChild(n));this.parent.eventMarkerColloction=a},Bn.prototype.updateContainerHeight=function(){this.eventMarkersContainer&&(this.eventMarkersContainer.style.height=oe.formatUnit(this.parent.getContentHeight()))};var Vn=Bn;function Bn(e){this.parent=e,this.eventMarkersContainer=null}Wn.prototype.wireEvents=function(){this.parent.on("refreshDayMarkers",this.refreshMarkers,this),this.parent.on("updateHeight",this.updateHeight,this),this.parent.on("ui-update",this.propertyChanged,this)},Wn.prototype.propertyChanged=function(e){for(var t=Object.keys(oe.getValue("properties",e)),i=0;i<t.length;i++)switch(t[i]){case"eventMarkers":this.eventMarkerRender.renderEventMarkers(),this.updateHeight();break;case"highlightWeekends":this.nonworkingDayRender.renderWeekends(),this.updateHeight();break;case"holidays":this.nonworkingDayRender.renderHolidays(),this.updateHeight()}},Wn.prototype.refreshMarkers=function(){this.nonworkingDayRender.renderWeekends(),this.nonworkingDayRender.renderHolidays(),"Vertical"!==this.parent.gridLines&&"Both"!==this.parent.gridLines||this.parent.renderChartVerticalLines(),this.eventMarkerRender.renderEventMarkers()},Wn.prototype.updateHeight=function(){this.nonworkingDayRender.updateContainerHeight(),this.eventMarkerRender.updateContainerHeight()},Wn.prototype.getModuleName=function(){return"dayMarkers"},Wn.prototype.destroy=function(){this.parent.isDestroyed||(this.nonworkingDayRender.removeContainers(),this.eventMarkerRender.removeContainer(),this.parent.off("refreshDayMarkers",this.refreshMarkers),this.parent.off("updateHeight",this.updateHeight),this.parent.off("ui-update",this.propertyChanged))};var An=Wn;function Wn(e){this.parent=e,this.nonworkingDayRender=new Nn(this.parent),this.eventMarkerRender=new Vn(this.parent),this.wireEvents()}jn.prototype.getCriticalTasks=function(){return this.criticalTasks},jn.prototype.showCriticalPath=function(e){var n=this.parent.ids,a=this.parent.flatData;if(e&&0<this.parent.flatData.length){this.parent.enableCriticalPath=!0;var t,i=this.parent.treeGrid.parentData,r=i[0].ganttProperties.endDate,s=0,o=[],l=[],d=[],h=0,p=[],u=[],c=[],g=[],f=[];this.criticalTasks=[],i[0].ganttProperties.autoEndDate>i[0].ganttProperties.endDate&&!i[0].ganttProperties.isAutoSchedule&&(r=i[0].ganttProperties.autoEndDate);for(var m=1;m<i.length;m++)i[m].ganttProperties.endDate>=r&&(r=i[m].ganttProperties.endDate),i[m].ganttProperties.isAutoSchedule||i[m].ganttProperties.autoEndDate>=r&&(r=i[m].ganttProperties.autoEndDate);this.maxEndDate=r;for(var y=0;y<a.length;y++)a[y].isCritical=!1,a[y].ganttProperties.isCritical=!1,s=this.parent.dataOperation.getDuration(a[y].ganttProperties.endDate,r,a[y].ganttProperties.durationUnit,a[y].ganttProperties.isAutoSchedule,a[y].ganttProperties.isMilestone),a[y].slack=s+" "+a[y].ganttProperties.durationUnit,a[y].ganttProperties.slack=s+" "+a[y].ganttProperties.durationUnit,a[y].ganttProperties.endDate>=r&&o.push(a[y].ganttProperties.taskId),a[y].ganttProperties.predecessor&&0!==a[y].ganttProperties.predecessor.length&&(l.push(a[y]),d.push(a[y].ganttProperties.taskId));if("ResourceView"===this.parent.viewType)for(m=0;m<this.parent.taskIds.length;m++)this.resourceCollectionIds[m]=this.parent.taskIds[m].slice(1);for(var D=this,k=0;k<o.length;k++)!function(t){if(-1===d.indexOf(o[t])){if("ProjectView"===D.parent.viewType)h=n.indexOf(o[t].toString());else for(var e=D.parent.currentViewData.filter(function(e){return parseInt(e.ganttProperties.taskId,10)===o[t]}),i=0;i<e.length;i++)!e[i].hasChildRecords&&e[i].ganttProperties.endDate>=D.maxEndDate&&(h=e[i].index);a[h].ganttProperties.progress<100&&(a[h].isCritical=!0,a[h].ganttProperties.isCritical=!0),a[h].slack="0 "+a[h].ganttProperties.durationUnit,p.push(o[t])}else u.push(o[t])}(k);for(var w=l.length,b=[],T=0;T<w;T++){for(var v=-1,P=-1,S=-1,C=-1,R=T,M=l[T].ganttProperties.predecessor,L=l[T].ganttProperties.predecessor.length,x=l[T].ganttProperties.taskId,O=0;O<L;O++)(isNaN(Number(M[O].from))||"string"==typeof x?(isNaN(Number(M[O].from)),M[O].from):parseInt(M[O].from,10))===x&&(S=-1===v?(v=M[O].offset?M[O].to+":"+M[O].offset+M[O].offsetUnit:M[O].to,M[O].type):(v=M[O].offset?v+","+M[O].to+":"+M[O].offset+M[O].offsetUnit:v+","+M[O].to,S+","+M[O].type)),(isNaN(Number(M[O].to))||"string"==typeof x?(isNaN(Number(M[O].to)),M[O].to):parseInt(M[O].to,10))===x&&(C=-1===P?(P=M[O].offset?M[O].from+":"+M[O].offset+M[O].offsetUnit:M[O].from,M[O].type):(P=M[O].offset?P+","+M[O].from+":"+M[O].offset+M[O].offsetUnit:P+","+M[O].from,C+","+M[O].type));-1===P&&(C=P=null),-1===v&&(S=v=null),c.push({from:P,fromPredecessor:C,taskid:x,to:v,toPredecessor:S,currentIndex:R,slack:null,enddate:null}),g.push(x)}for(var I,V=c.length,E=0,U=void 0,F=0;F<V;F++)c[F].to||(U=c[F].taskid,E=("ProjectView"===this.parent.viewType?n:this.resourceCollectionIds).indexOf(U.toString()),I=a[E].ganttProperties,s=this.parent.dataOperation.getDuration(I.endDate,r,"minute",I.isAutoSchedule,I.isMilestone),c[F].slack=s,c[F].fs=-1,c[F].enddate=I.endDate,b.push({fromdata:c[F].from,todateID:c[F].taskid,fromDataPredecessor:c[F].fromPredecessor}));for(k=0;k<b.length;k++)f.push(b[k]),this.slackCalculation(f,c,g,r,a,n);t=this.finalCriticalPath(c,p,a,n,r),this.validatedids=[],this.criticalPathCollection=t,this.detailPredecessorCollection=c,this.predecessorCollectionTaskIds=g}if(!1===e&&0<this.parent.flatData.length){var N;this.parent.enableCriticalPath=!1;for(F=0;F<this.criticalPathCollection.length;F++)N=n.indexOf(this.criticalPathCollection[F].toString()),a[N].isCritical=!1;this.criticalPathCollection=[],this.detailPredecessorCollection=[],this.predecessorCollectionTaskIds=[]}},jn.prototype.slackCalculation=function(e,t,i,n,a,r){for(var s,o,l,d,h,p=e[0].fromdata.split(","),u=e[0].fromDataPredecessor.split(","),c=(i=(i=i.toString()).split(","),[]),g=0;g<p.length;g++){var c=p[g].split(":"),f=i.indexOf(c[0].toString()),m=i.indexOf(e[0].todateID.toString()),y=("ProjectView"===this.parent.viewType?(s=r.indexOf(c[0].toString()),r):(s=this.resourceCollectionIds.indexOf(c[0].toString()),this.resourceCollectionIds)).indexOf(e[0].todateID.toString()),D=void 0,y=(-1!==s&&(D=a[s].ganttProperties),a[y].ganttProperties);1<c.length&&(d=-1!==c[1].indexOf("hour")?60*parseFloat(c[1]):-1!==c[1].indexOf("day")?parseFloat(c[1])*(this.parent.secondsPerDay/3600)*60:parseFloat(c[1])),D&&-1!==f&&("FS"===u[g]&&(o=D.endDate>y.startDate?-this.parent.dataOperation.getDuration(y.startDate,D.endDate,"minute",D.isAutoSchedule,D.isMilestone):this.parent.dataOperation.getDuration(D.endDate,y.startDate,"minute",D.isAutoSchedule,D.isMilestone),oe.isNullOrUndefined(t[f].slack)?c.length<=1&&(t[m].slack+o<=0?t[f].slack=0:t[f].slack=t[m].slack+o):t[f].slack>o&&0!==t[f].slack&&c.length<=1&&(t[m].slack+o<=0?t[f].slack=0:t[f].slack=t[m].slack+o),1<c.length&&(t[f].slack=t[m].slack+o,t[f].slack=t[f].slack-d,t[f].slack<=0)&&(t[f].slack=0),t[f].fs=1,t[f].fsslack=t[f].slack,t[f].enddate=D.startDate,D.endDate>=n)&&(t[f].slack=0),"SS"===u[g]&&(D.isAutoSchedule?(o=D.startDate>y.startDate?-this.parent.dataOperation.getDuration(y.endDate,D.startDate,"minute",D.isAutoSchedule,D.isMilestone):this.parent.dataOperation.getDuration(D.startDate,y.startDate,"minute",D.isAutoSchedule,D.isMilestone),oe.isNullOrUndefined(t[f].slack)?c.length<=1&&(t[m].slack+o<=0?t[f].slack=0:t[f].slack=t[m].slack+o):t[f].slack>o&&0!==t[f].slack&&c.length<=1&&(t[m].slack+o<=0?t[f].slack=0:t[f].slack=t[m].slack+o),1<c.length&&(t[f].slack=t[m].slack+o,t[f].slack=t[f].slack-d,t[f].slack<=0)&&(t[f].slack=0),t[f].fs=1,t[f].fsslack=t[f].slack,t[f].enddate=D.startDate):!D.isAutoSchedule&&(o=this.getSlackDuration(D.endDate,n,"minute",a[s]),oe.isNullOrUndefined(t[f].slack)||t[f].slack>o&&0!==t[f].slack)&&(t[f].slack=o),D.endDate>=n)&&D.endDate<=n&&(t[f].slack=0),"FF"===u[g]&&(1!==t[m].fs&&1!==t[m].ff&&-1!==t[m].fs||(1!==t[m].fs&&1!==t[m].ff||(l=y.endDate,h=t[m].slack),-1===t[m].fs&&(l=t[m].enddate,h=t[m].slack),o=l>D.endDate?-this.getSlackDuration(D.endDate,l,"minute",a[s]):this.getSlackDuration(l,D.endDate,"minute",a[s]),oe.isNullOrUndefined(t[f].slack)?c.length<=1&&(t[f].slack=h-o<0?0:h-o):t[f].slack>o&&0!==t[f].slack&&c.length<=1&&(t[f].slack=h-o<0?0:h-o),1<c.length&&(t[f].slack=t[m].slack-o,t[f].slack=t[f].slack-d,t[f].slack<=0)&&(t[f].slack=0),t[f].ff=1,t[f].enddate=l,t[f].fsslack=h),D.endDate>=n)&&D.endDate<=n&&(t[f].slack=0),"SF"===u[g]&&(D.isAutoSchedule?(oe.isNullOrUndefined(t[f].slack)?c.length<=1?oe.isNullOrUndefined(t[m].to)?(o=this.getSlackDuration(D.endDate,n,"minute",a[s]),t[f].slack=o):oe.isNullOrUndefined(t[m].to)||(o=y.endDate>D.startDate?-this.parent.dataOperation.getDuration(D.startDate,y.endDate,"minute",D.isAutoSchedule,D.isMilestone):this.getSlackDuration(y.endDate,D.startDate,"minute",a[s]),t[m].slack+o<=0?t[f].slack=0:t[f].slack=t[m].slack+o):1<c.length&&(o=y.endDate>=D.endDate?D.startDate>y.endDate?-this.getSlackDuration(y.endDate,D.startDate,"minute",a[s]):this.parent.dataOperation.getDuration(D.startDate,y.endDate,"minute",D.isAutoSchedule,D.isMilestone):this.getSlackDuration(D.endDate,n,"minute",a[s]),t[f].slack=t[m].slack+o,t[f].slack=t[f].slack-d,t[f].slack<=0)&&(t[f].slack=0):c.length<=1?(oe.isNullOrUndefined(t[m].to)?o=this.getSlackDuration(D.endDate,n,"minute",a[s]):oe.isNullOrUndefined(t[m].to)||(o=y.endDate>D.startDate?-this.parent.dataOperation.getDuration(D.startDate,y.endDate,"minute",D.isAutoSchedule,D.isMilestone):this.getSlackDuration(y.endDate,D.startDate,"minute",a[s])),t[f].slack>o&&0!==t[f].slack&&(oe.isNullOrUndefined(t[m].to)?t[f].slack=o:oe.isNullOrUndefined(t[m].to)||(t[m].slack+o<=0?t[f].slack=0:t[f].slack=t[m].slack+o))):1<c.length&&(o=y.endDate>D.endDate?D.startDate>y.endDate?-this.getSlackDuration(y.endDate,D.startDate,"minute",a[s]):this.parent.dataOperation.getDuration(D.startDate,y.endDate,"minute",D.isAutoSchedule,D.isMilestone):this.getSlackDuration(D.endDate,n,"minute",a[s]),t[f].slack>o)&&0!==t[f].slack&&(t[f].slack=t[m].slack+o,t[f].slack=t[f].slack-d,t[f].slack<=0)&&(t[f].slack=0),t[f].fs=1,t[f].fsslack=t[f].slack,t[f].enddate=D.startDate):!D.isAutoSchedule&&(o=this.getSlackDuration(D.endDate,n,"minute",a[s]),oe.isNullOrUndefined(t[f].slack)||t[f].slack>o&&0!==t[f].slack)&&(t[f].slack=o),D.endDate>=n)&&D.endDate<=n&&(t[f].slack=0),t[f].from)&&((y=[]).push({fromdata:t[f].from,todateID:t[f].taskid,fromDataPredecessor:t[f].fromPredecessor}),this.slackCalculation(y,t,i,n,a,r))}},jn.prototype.getSlackDuration=function(e,t,i,n){e=this.parent.dateValidationModule.checkStartDate(new Date(e)),t=this.parent.dateValidationModule.checkEndDate(new Date(t));return this.parent.dataOperation.getTimeDifference(e,t,!0)<=0?0:this.parent.dataOperation.getDuration(e,t,i,n.ganttProperties.isAutoSchedule,!0)},jn.prototype.updateCriticalTasks=function(e,t){for(var i=0;i<e.ganttProperties.predecessor.length;i++){var n=void 0,a=(n="ProjectView"===this.parent.viewType?this.parent.getRecordByID(e.ganttProperties.predecessor[i].from):(a=this.resourceCollectionIds.indexOf(e.ganttProperties.predecessor[i].from.toString()),this.parent.flatData[a]),void 0);e.ganttProperties.endDate&&e.ganttProperties.endDate.getTime()>=this.maxEndDate.getTime()&&(e.ganttProperties.slack=e.slack="0 "+e.ganttProperties.durationUnit,e.ganttProperties.progress<100)&&(e.isCritical=!0,e.ganttProperties.isCritical=!0,-1===t.indexOf(e.ganttProperties.taskId))&&t.push(e.ganttProperties.taskId),n&&("FS"===e.ganttProperties.predecessor[i].type?a=this.parent.dataOperation.getDuration(n.ganttProperties.endDate,e.ganttProperties.startDate,n.ganttProperties.durationUnit,n.ganttProperties.isAutoSchedule,!0):"SS"===e.ganttProperties.predecessor[i].type?a=this.parent.dataOperation.getDuration(n.ganttProperties.startDate,e.ganttProperties.startDate,n.ganttProperties.durationUnit,n.ganttProperties.isAutoSchedule,!0):"FF"===e.ganttProperties.predecessor[i].type?a=this.parent.dataOperation.getDuration(n.ganttProperties.endDate,e.ganttProperties.endDate,n.ganttProperties.durationUnit,n.ganttProperties.isAutoSchedule,!0):"SF"===e.ganttProperties.predecessor[i].type&&(a=this.parent.dataOperation.getDuration(e.ganttProperties.endDate,n.ganttProperties.startDate,n.ganttProperties.durationUnit,n.ganttProperties.isAutoSchedule,!0)),0<=a)&&-1===this.validatedids.indexOf(parseInt(n.ganttProperties.taskId,10))&&n.ganttProperties.taskId!==e.ganttProperties.taskId&&(n.ganttProperties.slack=e.ganttProperties.slack,n.slack=e.slack,n.isCritical=e.ganttProperties.isCritical,n.ganttProperties.isCritical=e.ganttProperties.isCritical,-1===t.indexOf(n.ganttProperties.taskId)&&n.ganttProperties.isCritical&&n.ganttProperties.progress<100&&(t.push(n.ganttProperties.taskId),this.validatedids.push(parseInt(n.ganttProperties.taskId,10)),-1===this.criticalTasks.indexOf(n))&&this.criticalTasks.push(n),n.ganttProperties.predecessorsName)&&this.updateCriticalTasks(n,t)}},jn.prototype.finalCriticalPath=function(e,t,i,n,a){for(var r=[],s=e.length-1;0<=s;s--){var o,l=i[o=("ProjectView"===this.parent.viewType?n:this.resourceCollectionIds).indexOf(e[s].taskid.toString())].ganttProperties.predecessor,d="0 "+i[o].ganttProperties.durationUnit;if(l&&0<l.length)for(var h=l.length-1;0<=h;h--){var p=void 0,p=("ProjectView"===this.parent.viewType?this.parent.ids:this.resourceCollectionIds).indexOf(l[h].to),u=void 0,c=i[o].ganttProperties;-1!==p&&("FS"===l[h].type?l[h].to!==c.taskId.toString()&&(l[h].to!==c.taskId.toString()||"ResourceView"===this.parent.viewType?u=this.parent.dataOperation.getDuration(c.endDate,i[p].ganttProperties.startDate,c.durationUnit,c.isAutoSchedule,c.isMilestone):-1!==(p=this.parent.ids.indexOf(l[h].from))&&0===(u=this.parent.dataOperation.getDuration(i[p].ganttProperties.endDate,c.startDate,c.durationUnit,c.isAutoSchedule,c.isMilestone))&&o!==p&&i[o].slack===d&&(i[p].slack=i[o].slack,i[p].ganttProperties.slack=i[o].slack),-1!==p)&&(0===u&&o!==p&&i[o].slack!==d?(i[o].slack=i[p].slack,i[o].ganttProperties.slack=i[p].slack):0!==u&&o!==p&&i[p].isCritical&&(i[o].slack=u+" "+i[o].ganttProperties.durationUnit,i[o].ganttProperties.slack=u+" "+i[o].ganttProperties.durationUnit)):u="SF"===l[h].type?this.parent.dataOperation.getDuration(c.startDate,i[p].ganttProperties.endDate,c.durationUnit,c.isAutoSchedule,c.isMilestone):"SS"===l[h].type?this.parent.dataOperation.getDuration(c.startDate,i[p].ganttProperties.startDate,c.durationUnit,c.isAutoSchedule,c.isMilestone):this.parent.dataOperation.getDuration(c.endDate,i[p].ganttProperties.endDate,c.durationUnit,c.isAutoSchedule,c.isMilestone),("number"==typeof i[o][this.parent.taskFields.id]?parseInt(l[h].from,10):l[h].from)===i[o][this.parent.taskFields.id])&&i[p].slack===d&&u<=0&&(i[o].slack=d,i[o].ganttProperties.slack=d)}i[o].slack===d&&i[o].ganttProperties.progress<100&&(i[o].isCritical=!0,i[o].ganttProperties.isCritical=!0,-1===this.criticalTasks.indexOf(i[o])&&this.criticalTasks.push(i[o]),-1===r.indexOf(e[s].taskid))&&r.push(e[s].taskid),i[o].ganttProperties.predecessor&&0<i[o].ganttProperties.predecessor.length&&this.updateCriticalTasks(i[o],r)}if(0<t.length)for(h=0;h<t.length;h++)-1!==(o=("ProjectView"===this.parent.viewType?n:this.resourceCollectionIds).indexOf(t[h].toString()))&&i[o].ganttProperties.progress<100&&(this.criticalTasks.push(i[o]),-1===r.indexOf(t[h]))&&(r=r.concat(t[h]));return r},jn.prototype.criticalConnectorLine=function(h,e,t,i){this.parent.removeCriticalPathStyles();for(var p=this,n=0;n<h.length;n++)!function(t){var i;if("ProjectView"===p.parent.viewType)i=p.parent.flatData[p.parent.ids.indexOf(h[t].toString())];else for(var e=p.parent.flatData.filter(function(e){return e.ganttProperties.taskId.toString()===h[t].toString()}),n=0;n<e.length;n++)(e[n].ganttProperties.isCritical||e[n].ganttProperties.endDate>=p.maxEndDate)&&(i=e[n]);var a=p.parent.currentViewData.indexOf(i),a=p.parent.getRowByIndex(a),r=void 0,s=p.parent.taskFields;if(i&&i.parentItem){var o=p.parent.currentViewData.filter(function(e){return i.parentItem.uniqueID===e.uniqueID}),o=p.parent.flatData.indexOf(o[0]),o=p.parent.getRowByIndex(o);if(o)for(var l=o.querySelectorAll(".e-taskbar-main-container"),d=0;d<l.length;d++)l[d].getAttribute("rowuniqueid")===i.rowUniqueID&&oe.addClass(l[d].querySelectorAll(".e-gantt-child-taskbar-inner-div"),ve)}r=p.parent.allowUnscheduledTasks&&i&&!i[s.startDate]&&!i[s.endDate]&&i[s.duration]?"e-gantt-critical-unscheduled-taskbar":Pe,a&&("ProjectView"===p.parent.viewType||"ResourceView"===p.parent.viewType&&!i.hasChildRecords)&&(a.getElementsByClassName("e-gantt-milestone")[0]&&oe.addClass(a.querySelectorAll(".e-gantt-milestone"),Se),0<a.getElementsByClassName("e-gantt-child-taskbar-inner-div").length&&oe.addClass(a.querySelectorAll(".e-gantt-child-taskbar-inner-div"),ve),0<a.getElementsByClassName("e-gantt-child-progressbar-inner-div").length)&&oe.addClass(a.querySelectorAll(".e-gantt-child-progressbar-inner-div"),r)}(n);if(0!==e.length)for(var a,r=void 0,s=[],o=void 0,l=void 0,n=0;n<this.criticalPathCollection.length;n++)if(r=e[a=i.indexOf(this.criticalPathCollection[n])],-1!==a&&r.to)for(var s=r.to.split(","),d=0;d<s.length;d++){var u,c,l=s[d].split("+"),o=(l=0<=s[d].indexOf("-")?s[d].split("-"):l)[0].replace(":","");"number"==typeof h[d]&&(o=parseInt(l[0],10)),-1!==h.indexOf(o)&&(u=String(r.taskid),c=String(o),0<this.parent.element.querySelectorAll("#ConnectorLineparent"+u.replace(/([.])/g,"\\$1")+"child"+c.replace(/([.])/g,"\\$1")).length)&&(oe.addClass(this.parent.element.querySelectorAll("#ConnectorLineparent"+u.replace(/([.])/g,"\\$1")+"child"+c.replace(/([.])/g,"\\$1"))[0].querySelectorAll(".e-connector-line"),it),oe.addClass(this.parent.element.querySelectorAll("#ConnectorLineparent"+u.replace(/([.])/g,"\\$1")+"child"+c.replace(/([.])/g,"\\$1"))[0].querySelectorAll(".e-connector-line-arrow"),nt))}},jn.prototype.getModuleName=function(){return"criticalPath"},jn.prototype.destroy=function(){!this.parent.enableCriticalPath&&this.parent.criticalPathModule&&(this.parent.criticalPathModule=void 0)};var Hn=jn;function jn(e){this.validatedids=[],this.resourceCollectionIds=[],this.criticalTasks=[],this.parent=e}var Gn=function(){return(Gn=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var a in t=arguments[i])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},zn=(qn.prototype.undoAction=function(){var e=this;if(0<this.getUndoCollection.length){var t=this.getUndoCollection[this.getUndoCollection.length-1],i={};if("ZoomIn"===t.action||"ZoomOut"===t.action||"ZoomToFit"===t.action)i.action=t.action,i.previousZoomingLevel=oe.extend({},{},this.parent.currentZoomingLevel,!0);else if("NextTimeSpan"===t.action||"PreviousTimeSpan"===t.action)i.action=t.action,i.previousTimelineStartDate=oe.extend([],[this.parent.timelineModule.timelineStartDate],[],!0)[0],i.previousTimelineEndDate=oe.extend([],[this.parent.timelineModule.timelineEndDate],[],!0)[0];else if("Sorting"===t.action)i.action="Sorting",i.sortColumns=this.previousSortedColumns;else if("Filtering"===t.action)i.action="Filtering",i.filteredColumns=t.filteredColumns;else if("ColumnReorder"===t.action)i.action=t.action,i.toColumn=t.fromColumn,i.fromColumn=t.toColumn,i.fromIndex=t.toIndex,i.toIndex=t.fromIndex;else if("Search"===t.action)i.action=t.action,i.searchString=this.searchString;else if("ColumnState"===t.action)i.action=t.action,i.showhideColumns=t.showhideColumns;else if("ColumnResize"===t.action)i.action=t.action,i.resizedColumn=Gn({},this.parent.treeGrid.columns[t.resizedColumn.index]);else if("RowDragAndDrop"===t.action||"TaskbarDragAndDrop"===t.action){for(var n=[],a=0;a<t.beforeDrop.length;a++)"ProjectView"===this.parent.viewType?n.push(this.parent.getRecordByID(t.beforeDrop[a].data.ganttProperties.taskId)):n.push(this.parent.flatData[this.parent.taskIds.indexOf("T"+t.beforeDrop[a].data.ganttProperties.taskId.toString())]);i.action=t.action,i.beforeDrop=[];var r={},s=oe.extend([],[],[this.parent.getRecordByID(t.afterDrop.dropRecord.ganttProperties.taskId)],!0)[0];r.data=[];for(a=0;a<t.afterDrop.data.length;a++)"ProjectView"===this.parent.viewType?r.data.push(oe.extend([],[],[this.parent.getRecordByID(t.afterDrop.data[a].ganttProperties.taskId)],!0)[0]):r.data.push(oe.extend([],[],this.parent.flatData[this.parent.taskIds.indexOf("T"+t.afterDrop.data[a].ganttProperties.taskId)],!0)[0]);r.dropRecord=oe.extend([],[],[s],!0)[0],r.dropPosition=t.afterDrop.dropPosition,i.afterDrop=r,this.findPosition(n,i,"beforeDrop")}else if("Indent"===t.action||"Outdent"===t.action)i.selectedRowIndexes=t.selectedRowIndexes,i.droppedRecord=oe.extend([],[],[this.parent.flatData[this.parent.ids.indexOf(t.droppedRecord.ganttProperties.taskId.toString())]],!0)[0],i.modifiedRecord=[],this.findPosition(oe.extend([],[],[this.parent.flatData[this.parent.ids.indexOf(t.modifiedRecord[0].data.ganttProperties.taskId.toString())]],!0),i,"modifiedRecord"),i.action=t.action;else if("Delete"===t.action){i.action="Delete",i.deleteRecords=[];for(a=0;a<t.deletedRecordsDetails.length;a++)i.deleteRecords.push(t.deletedRecordsDetails[a].data)}else if("Add"===t.action){i.action="Add",i.deletedRecordsDetails=[];n=t.addedRecords;this.findPosition(n,i,"deletedRecordsDetails")}else{i.action=t.action,i.modifiedRecords=[];for(a=0;a<t.modifiedRecords.length;a++){var o=void 0,o="ProjectView"===this.parent.viewType?this.parent.ids.indexOf(t.modifiedRecords[a].ganttProperties.taskId.toString()):t.modifiedRecords[a].hasChildRecords?this.parent.taskIds.indexOf("R"+t.modifiedRecords[a].ganttProperties.taskId):this.parent.taskIds.indexOf("T"+t.modifiedRecords[a].ganttProperties.taskId);i.modifiedRecords.push(oe.extend([],[this.parent.flatData[o]],[],!0)[0])}}if(this.getRedoCollection.push(i),this.isUndoRedoPerformed=!0,this.changedRecords=[],"ZoomIn"===(this.currentAction=t).action||"ZoomOut"===t.action||"ZoomToFit"===t.action)this.parent.timelineSettings.timelineViewMode=t.previousZoomingLevel.timelineViewMode,this.parent.timelineSettings.timelineUnitSize=t.previousZoomingLevel.timelineUnitSize,this.parent.timelineSettings.updateTimescaleView=t.previousZoomingLevel.updateTimescaleView,this.parent.timelineSettings.topTier.unit=t.previousZoomingLevel.topTier.unit,this.parent.timelineSettings.topTier.count=t.previousZoomingLevel.topTier.count,this.parent.timelineSettings.topTier.format=t.previousZoomingLevel.topTier.format,this.parent.timelineSettings.bottomTier.unit=t.previousZoomingLevel.bottomTier.unit,this.parent.timelineSettings.bottomTier.count=t.previousZoomingLevel.bottomTier.count,this.parent.timelineSettings.bottomTier.format=t.previousZoomingLevel.bottomTier.format,this.parent.timelineSettings.weekStartDay=t.previousZoomingLevel.weekStartDay,this.parent.timelineSettings.weekendBackground=t.previousZoomingLevel.weekendBackground,"ZoomToFit"===t.action&&this.parent.timelineModule.refreshTimeline();else if("NextTimeSpan"===t.action||"PreviousTimeSpan"===t.action)this.parent.updateProjectDates(t.previousTimelineStartDate,t.previousTimelineEndDate,!1);else if("Sorting"===t.action)if(this.isFromUndoRedo=!0,(this.sortedColumnsLength=0)<t.sortColumns.length)for(a=0;a<t.sortColumns.length;a++)this.parent.treeGrid.sortByColumn(t.sortColumns[a].field,t.sortColumns[a].direction,0<a);else this.parent.clearSorting();else if("Filtering"===t.action){this.isFromUndoRedo=!0;for(a=this.getUndoCollection.length-1;0<=a;a--)if(this.getUndoCollection[a].filteredColumns){for(var l=[],d=0;d<this.getUndoCollection[a].filteredColumns.length;d++)l.push(this.getUndoCollection[a].filteredColumns[d].field);this.parent.clearFiltering(l)}}else if("ColumnReorder"===t.action){this.isFromUndoRedo=!0;var s=this.parent.treeGrid.columns[t.fromIndex].field,h=this.parent.treeGrid.columns[t.toIndex].field;this.parent.reorderColumns(s,h)}else if("Search"===t.action)this.isFromUndoRedo=!0,this.parent.search(t.searchString);else if("ColumnState"===t.action){this.isFromUndoRedo=!0;for(a=0;a<t.showhideColumns.length;a++)t.showhideColumns[a].visible?this.parent.hideColumn(t.showhideColumns[a].field,"field"):this.parent.showColumn(t.showhideColumns[a].field,"field")}else if("ColumnResize"===t.action)this.parent.treeGrid.columns[t.resizedColumn.index].width=t.resizedColumn.width,this.parent.treeGrid.refreshColumns();else if("RowDragAndDrop"===t.action||"TaskbarDragAndDrop"===t.action)for(a=0;a<t.beforeDrop.length;a++){var p=void 0,u=void 0,u=("ProjectView"===this.parent.viewType?(p=this.parent.ids.indexOf(t.beforeDrop[a].data.ganttProperties.taskId.toString()),this.parent.ids):(p=this.parent.ids.indexOf("T"+t.beforeDrop[a].data.ganttProperties.taskId.toString()),this.parent.taskIds)).indexOf(t.beforeDrop[a].id.toString());this.parent.reorderRows([p],u,t.beforeDrop[a].position),this.parent.updateRecordByID(t.beforeDrop[a].data),"child"===t.afterDrop.dropPosition&&this.parent.updateRecordByID(t.afterDrop.dropRecord)}else if("Indent"===t.action||"Outdent"===t.action)this.parent.selectRow(this.parent.ids.indexOf(t.modifiedRecord[0].data.ganttProperties.taskId.toString())),"Indent"===t.action?this.parent.outdent():this.parent.indent(),setTimeout(function(){e.isUndoRedoPerformed=!0,e.parent.updateRecordByID(t.droppedRecord),e.isUndoRedoPerformed=!1});else if("Delete"===t.action)for(var c=void 0,a=0;a<t.deletedRecordsDetails.length;a++){var c=("ProjectView"===this.parent.viewType?this.parent.ids:this.parent.taskIds).indexOf(t.deletedRecordsDetails[a].id.toString()),g=void 0;"above"===t.deletedRecordsDetails[a].position&&(g="Above"),"below"===t.deletedRecordsDetails[a].position&&(g="Below"),"child"===t.deletedRecordsDetails[a].position&&(g="Child"),oe.isNullOrUndefined(g)&&(g=t.deletedRecordsDetails[a].position.replace(/^./,function(e){return e.toUpperCase()})),this.parent.addRecord(t.deletedRecordsDetails[a].data,g,c)}else if("Add"===t.action){s=oe.extend([],[this.parent.editSettings.showDeleteConfirmDialog],[],!0)[0],h=(this.parent.editSettings.showDeleteConfirmDialog=!1,t.addedRecords);"ResourceView"===this.parent.viewType&&1===t.addedRecords.length&&t.addedRecords[0].parentItem&&1===(f=this.parent.getTaskByUniqueID(t.addedRecords[0].parentItem.uniqueID)).childRecords.length&&"Unassigned Task"===f.ganttProperties.taskName&&(h=f),this.parent.deleteRecord(h),this.parent.editSettings.showDeleteConfirmDialog=s}else if(this.parent.updateRecordByID(this.getUndoCollection[this.getUndoCollection.length-1].modifiedRecords[0]),t.connectedRecords&&"ProjectView"===this.parent.viewType)for(a=0;a<t.connectedRecords.length;a++)this.parent.updateRecordByID(t.connectedRecords[a]);var f={};(f=oe.extend([],[],[this.getUndoCollection[this.getUndoCollection.length-1]],!0)[0]).requestType="afterUndoAction",this.parent.trigger("onAfterUndo",f),this.isUndoRedoPerformed=!1,0<this.getRedoCollection.length&&(this.parent.toolbarModule&&this.parent.toolbarModule.enableItems([this.parent.controlId+"_redo"],!0),this.redoEnabled=!0)}this.getUndoCollection.splice(this.getUndoCollection.length-1,1),0===this.getUndoCollection.length&&this.parent.toolbarModule&&this.parent.toolbarModule.enableItems([this.parent.controlId+"_undo"],!1)},qn.prototype.redoAction=function(){if(0<this.getRedoCollection.length){var e=this.getRedoCollection[this.getRedoCollection.length-1],t={};if("ZoomIn"===e.action||"ZoomOut"===e.action||"ZoomToFit"===e.action)t.action=e.action,t.previousZoomingLevel=oe.extend({},{},this.parent.currentZoomingLevel,!0);else if("NextTimeSpan"===e.action||"PreviousTimeSpan"===e.action)t.action=e.action,t.previousTimelineStartDate=oe.extend([],[this.parent.timelineModule.timelineStartDate],[],!0)[0],t.previousTimelineEndDate=oe.extend([],[this.parent.timelineModule.timelineEndDate],[],!0)[0];else if("Sorting"===e.action)t.action="Sorting",t.sortColumns=oe.extend([],this.parent.sortSettings.columns,[],!0);else if("Filtering"===e.action)t.action="Filtering",t.filteredColumns=e.filteredColumns;else if("ColumnReorder"===e.action)t.action=e.action,t.toColumn=e.fromColumn,t.fromColumn=e.toColumn,t.fromIndex=e.toIndex,t.toIndex=e.fromIndex;else if("Search"===e.action)t.action=e.action,t.searchString=oe.extend([],[this.parent.searchSettings.key],[],!0)[0];else if("ColumnState"===e.action)t.action=e.action,t.showhideColumns=e.showhideColumns;else if("ColumnResize"===e.action)t.action=e.action,t.resizedColumn=Gn({},this.parent.treeGrid.columns[e.resizedColumn.index]);else if("RowDragAndDrop"===e.action||"TaskbarDragAndDrop"===e.action){for(var i=[],n=0;n<e.beforeDrop.length;n++)"ProjectView"===this.parent.viewType?i.push(this.parent.getRecordByID(e.beforeDrop[n].data.ganttProperties.taskId)):i.push(this.parent.flatData[this.parent.taskIds.indexOf("T"+e.beforeDrop[n].data.ganttProperties.taskId.toString())]);t.action=e.action,t.beforeDrop=[];var a={},r=void 0;e.afterDrop.dropRecord&&(r=oe.extend([],[],[this.parent.getRecordByID(e.afterDrop.dropRecord.ganttProperties.taskId)],!0)[0]),a.data=[];for(n=0;n<e.afterDrop.data.length;n++)"ProjectView"===this.parent.viewType?a.data.push(oe.extend([],[],[this.parent.getRecordByID(e.afterDrop.data[n].ganttProperties.taskId)],!0)[0]):void 0!==e.afterDrop.data[n]&&a.data.push(oe.extend([],[],this.parent.flatData[this.parent.taskIds.indexOf("T"+e.afterDrop.data[n].ganttProperties.taskId)],!0)[0]);a.dropRecord=oe.extend([],[],[r],!0)[0],a.dropPosition=e.afterDrop.dropPosition,t.afterDrop=a,this.findPosition(i,t,"beforeDrop")}else if("Indent"===e.action||"Outdent"===e.action)t.selectedRowIndexes=e.selectedRowIndexes,t.droppedRecord=oe.extend([],[],[this.parent.flatData[this.parent.ids.indexOf(e.droppedRecord.ganttProperties.taskId.toString())]],!0)[0],t.modifiedRecord=[],this.findPosition(oe.extend([],[],[this.parent.flatData[this.parent.ids.indexOf(e.modifiedRecord[0].data.ganttProperties.taskId.toString())]],!0),t,"modifiedRecord"),t.action=e.action;else if("Delete"===e.action)t.action="Delete",t.deletedRecordsDetails=[],this.findPosition(oe.extend([],[],e.deleteRecords,!0),t,"deletedRecordsDetails");else if("Add"===e.action)t.action="Add",t.addedRecords=[e.deletedRecordsDetails[0].data];else{t.action=e.action,t.modifiedRecords=[];for(n=0;n<e.modifiedRecords.length;n++){var s=void 0,s="ProjectView"===this.parent.viewType?this.parent.ids.indexOf(e.modifiedRecords[n].ganttProperties.taskId.toString()):e.modifiedRecords[n].hasChildRecords?this.parent.taskIds.indexOf("R"+e.modifiedRecords[n].ganttProperties.taskId):this.parent.taskIds.indexOf("T"+e.modifiedRecords[n].ganttProperties.taskId);t.modifiedRecords.push(oe.extend([],[this.parent.flatData[s]],[],!0)[0])}}if(this.getUndoCollection.push(t),this.isUndoRedoPerformed=!0,"ZoomIn"===(this.currentAction=e).action||"ZoomOut"===e.action||"ZoomToFit"===e.action)"ZoomToFit"===e.action?this.parent.fitToProject():(this.parent.timelineSettings.timelineViewMode=e.previousZoomingLevel.timelineViewMode,this.parent.timelineSettings.timelineUnitSize=e.previousZoomingLevel.timelineUnitSize,this.parent.timelineSettings.updateTimescaleView=e.previousZoomingLevel.updateTimescaleView,this.parent.timelineSettings.topTier.unit=e.previousZoomingLevel.topTier.unit,this.parent.timelineSettings.topTier.count=e.previousZoomingLevel.topTier.count,this.parent.timelineSettings.topTier.format=e.previousZoomingLevel.topTier.format,this.parent.timelineSettings.bottomTier.unit=e.previousZoomingLevel.bottomTier.unit,this.parent.timelineSettings.bottomTier.count=e.previousZoomingLevel.bottomTier.count,this.parent.timelineSettings.bottomTier.format=e.previousZoomingLevel.bottomTier.format,this.parent.timelineSettings.weekStartDay=e.previousZoomingLevel.weekStartDay,this.parent.timelineSettings.weekendBackground=e.previousZoomingLevel.weekendBackground);else if("NextTimeSpan"===e.action||"PreviousTimeSpan"===e.action)this.parent.updateProjectDates(e.previousTimelineStartDate,e.previousTimelineEndDate,!1);else if("Sorting"===e.action)if(this.isFromUndoRedo=!0,(this.sortedColumnsLength=0)===e.sortColumns.length)this.parent.clearSorting();else for(n=0;n<e.sortColumns.length;n++)this.parent.treeGrid.sortByColumn(e.sortColumns[n].field,e.sortColumns[n].direction,1<e.sortColumns.length);else if("ColumnState"===e.action){this.isFromUndoRedo=!0;for(n=0;n<e.showhideColumns.length;n++)e.showhideColumns[n].visible?this.parent.hideColumn(e.showhideColumns[n].field,"field"):this.parent.showColumn(e.showhideColumns[n].field,"field")}else if("Filtering"===e.action)for(var o=0;o<e.filteredColumns.length;o++)this.isFromUndoRedo=!0,this.parent.filterByColumn(e.filteredColumns[o].field,e.filteredColumns[o].operator,e.filteredColumns[o].value,e.filteredColumns[o].predicate,e.filteredColumns[o].matchCase,e.filteredColumns[o].ignoreAccent);else if("ColumnReorder"===e.action){this.isFromUndoRedo=!0;var r=this.parent.treeGrid.columns[e.fromIndex].field,l=this.parent.treeGrid.columns[e.toIndex].field;this.parent.reorderColumns(r,l)}else if("Search"===e.action)this.isFromUndoRedo=!0,this.parent.search(e.searchString);else if("ColumnResize"===e.action)this.parent.treeGrid.columns[e.resizedColumn.index].width=e.resizedColumn.width,this.parent.treeGrid.refreshColumns();else if("RowDragAndDrop"===e.action||"TaskbarDragAndDrop"===e.action)for(n=0;n<e.beforeDrop.length;n++){var d=void 0,h=void 0,h=("ProjectView"===this.parent.viewType?(d=this.parent.ids.indexOf(e.beforeDrop[n].data.ganttProperties.taskId.toString()),this.parent.ids):(d=this.parent.ids.indexOf("T"+e.beforeDrop[n].data.ganttProperties.taskId.toString()),this.parent.taskIds)).indexOf(e.beforeDrop[n].id.toString());this.parent.reorderRows([d],h,e.beforeDrop[n].position)}else if("Indent"===e.action||"Outdent"===e.action)this.parent.selectRow(e.selectedRowIndexes[0]),"Indent"===e.action&&this.parent.indent(),"Outdent"===e.action&&this.parent.outdent();else if("Delete"===e.action){r=oe.extend([],[this.parent.editSettings.showDeleteConfirmDialog],[],!0)[0];this.parent.editSettings.showDeleteConfirmDialog=!1,this.parent.deleteRecord(e.deleteRecords),this.parent.editSettings.showDeleteConfirmDialog=r}else if("Add"===e.action)if("ResourceView"===this.parent.viewType&&1<e.deletedRecordsDetails.length)this.parent.editModule.addRecord(oe.extend([],[],e.deletedRecordsDetails,!0));else for(var p=void 0,n=0;n<e.deletedRecordsDetails.length;n++){var p=("ProjectView"===this.parent.viewType?this.parent.ids:this.parent.taskIds).indexOf(e.deletedRecordsDetails[n].id.toString()),u=void 0;"above"===e.deletedRecordsDetails[n].position&&(u="Above"),"below"===e.deletedRecordsDetails[n].position&&(u="Below"),"child"===e.deletedRecordsDetails[n].position&&(u="Child"),"bottom"===e.deletedRecordsDetails[n].position&&(u="Bottom"),this.parent.editModule.addRecord(e.deletedRecordsDetails[n].data,u,p)}else this.parent.updateRecordByID(e.modifiedRecords[0]);this.isUndoRedoPerformed=!1,0<this.getUndoCollection.length&&this.parent.toolbarModule&&this.parent.toolbarModule.enableItems([this.parent.controlId+"_undo"],!0),this.getRedoCollection.splice(this.getRedoCollection.length-1,1),0===this.getRedoCollection.length&&this.parent.toolbarModule&&(this.redoEnabled=!1,this.parent.toolbarModule.enableItems([this.parent.controlId+"_redo"],!1))}},qn.prototype.createUndoCollection=function(){this.parent.totalUndoAction+1>this.parent.undoRedoStepsCount&&this.getUndoCollection.length===this.parent.totalUndoAction&&(this.getUndoCollection.splice(0,1),this.disableRedo()),this.parent.toolbarModule&&this.parent.toolbarModule.enableItems([this.parent.controlId+"_undo"],!0),0===this.getUndoCollection.length?(this.getUndoCollection[0]=[],this.parent.totalUndoAction+1<=this.parent.undoRedoStepsCount&&this.parent.totalUndoAction++):0<Object.keys(this.getUndoCollection[this.getUndoCollection.length-1]).length&&(this.getUndoCollection[this.getUndoCollection.length]=[],this.parent.totalUndoAction+1<=this.parent.undoRedoStepsCount)&&this.parent.totalUndoAction++},qn.prototype.disableRedo=function(){this.redoEnabled=!1,this.getRedoCollection=[],this.parent.toolbarModule&&this.parent.toolbarModule.enableItems([this.parent.controlId+"_redo"],!1)},qn.prototype.findPosition=function(y,D,k){for(var w=this,e=0;e<y.length;e++)!function(t){var e,i={};if(i.data=y[t],"ProjectView"===w.parent.viewType)if(!y[t].hasChildRecords&&y[t].parentItem)if(1<(e=w.parent.getRecordByID(y[t].parentItem.taskId)).childRecords.length){var n=w.parent.ids.indexOf(y[t].ganttProperties.taskId.toString());if((g=w.parent.flatData[n-1]).parentItem&&g.parentItem.taskId.toString()===e.ganttProperties.taskId.toString())i.position="below",i.id=oe.extend([],[w.parent.flatData[w.parent.ids.indexOf(y[t].ganttProperties.taskId.toString())-1].ganttProperties.taskId],[],!0)[0];else{i.position="above";var a=w.parent.flatData[w.parent.ids.indexOf(y[t].ganttProperties.taskId.toString())+1],r=w.parent.ids.indexOf(y[t].ganttProperties.taskId.toString())+1,s=t;do{}while((f=y[s+1])&&a.ganttProperties.taskId.toString()===f.ganttProperties.taskId.toString()?(s++,a=w.parent.flatData[++r]):a&&a.parentItem?i.id=oe.extend([],[a.ganttProperties.taskId],[],!0)[0]:(i.id=oe.extend([],[y[t].parentItem.taskId],[],!0)[0],i.position="child"),!i.id)}}else i.position="child",i.id=oe.extend([],[e.ganttProperties.taskId],[],!0)[0];else if(y[t].hasChildRecords||y[t].parentItem){if(y[t].hasChildRecords&&!y[t].parentItem){for(d=void 0,a=void 0,h=void 0,l=0;l<w.parent.treeGrid.parentData.length;l++)if(w.parent.treeGrid.parentData[l].ganttProperties.taskId.toString()===y[t].ganttProperties.taskId.toString()){d=l,a=w.parent.treeGrid.parentData[l+1],h=l+1;break}if(-1!==d)if(0===d){i.position="above";s=t;do{}while((f=y[s+1])&&a.ganttProperties.taskId.toString()===f.ganttProperties.taskId.toString()?(s++,a=w.parent.treeGrid.parentData[++h]):(a=a||w.parent.treeGrid.parentData[d],i.id=oe.extend([],[a.ganttProperties.taskId],[],!0)[0]),!i.id)}else i.position="below",i.id=oe.extend([],[w.parent.treeGrid.parentData[d-1].ganttProperties.taskId],[],!0)[0]}else if(y[t].hasChildRecords&&y[t].parentItem)if(1===(e=w.parent.getRecordByID(y[t].parentItem.taskId)).childRecords.length)i.position="child",i.id=oe.extend([],[y[t].parentItem.taskId],[],!0)[0];else{for(var o=void 0,l=0;l<e.childRecords.length;l++)if(e.childRecords[t].ganttProperties.taskId.toString()===y[t].ganttProperties.taskId.toString()){o=l;break}oe.isNullOrUndefined(o)||(0===o?(i.position="above",i.id=oe.extend([],[e.childRecords[o+1].ganttProperties.taskId],[],!0)[0]):(i.position="below",i.id=oe.extend([],[e.childRecords[o-1].ganttProperties.taskId],[],!0)[0]))}}else{w.parent.ids.indexOf(y[t].ganttProperties.taskId.toString())===w.parent.ids.length-1?i.position="below":i.position="above";for(var d=void 0,a=void 0,h=void 0,l=0;l<w.parent.treeGrid.parentData.length;l++)if(w.parent.treeGrid.parentData[l].ganttProperties.taskId.toString()===y[t].ganttProperties.taskId.toString()){d=l,a=w.parent.treeGrid.parentData[l+1],h=l+1;break}var s=t;do{}while((f=y[s+1])&&a.ganttProperties.taskId.toString()===f.ganttProperties.taskId.toString()?(s++,a=w.parent.treeGrid.parentData[++h]):(a=(a=a||w.parent.treeGrid.parentData[d-1])||w.parent.treeGrid.parentData[d],i.id=oe.extend([],[a.ganttProperties.taskId],[],!0)[0]),!i.id)}else if(y[t].parentItem){var p=void 0;if(1===(p=y[t].parentItem.index?w.parent.flatData[y[t].parentItem.index]:w.parent.flatData[w.parent.ids.indexOf(y[t].parentItem.taskId)]).childRecords.length)i.position="bottom",i.id="R"+p.ganttProperties.taskId,"deletedIndexes"===k&&(i.position="child",i.index=p.index);else{for(var u=void 0,c=0;c<p.childRecords.length;c++)if(p.childRecords[c].ganttProperties.taskId.toString()===y[t].ganttProperties.taskId.toString()){u=c;break}if((g=p.childRecords[u-1])&&g.parentItem&&g.parentUniqueID===p.uniqueID)i.position="below",i.id=oe.extend([],["T"+w.parent.flatData[w.parent.taskIds.indexOf("T"+y[t].ganttProperties.taskId.toString())-1].ganttProperties.taskId],[],!0)[0],"deletedIndexes"===k&&(i.index=w.parent.taskIds.indexOf("T"+y[t].ganttProperties.taskId.toString())-1);else{r=void 0;if(u!==p.childRecords.length-1){i.position="above",0===u&&p.childRecords[1]?r=p.childRecords[1].index:p.childRecords[u-1]&&(r=p.childRecords[u-1].index);a=w.parent.flatData[r],n=r,s=t;do{}while((f=y[s+1])&&a.ganttProperties.taskId.toString()===f.ganttProperties.taskId.toString()?(s++,a=w.parent.flatData[++n]):a.parentItem?(i.id=oe.extend([],["T"+a.ganttProperties.taskId],[],!0)[0],"deletedIndexes"===k&&(i.index=oe.extend([],[a.index],[],!0)[0],0===u)&&p.childRecords[1].ganttProperties.taskId===a.ganttProperties.taskId&&(i.index=i.index-1)):(i.id=oe.extend([],["R"+y[t].parentItem.taskId],[],!0)[0],i.position="child","deletedIndexes"===k&&(i.index=y[t].parentItem.index)),!i.id)}else u===p.childRecords.length-1?i.position="below":i.position="above",i.id="T"+p.childRecords[u-1].ganttProperties.taskId,"deletedIndexes"===k&&(i.index=p.childRecords[u-1].index)}}}else{var g=w.parent.treeGrid.parentData.filter(function(e){return e.ganttProperties.taskId===y[t].ganttProperties.taskId})[0],g=w.parent.treeGrid.parentData.indexOf(g);if(0===g){i.position="above";for(a=void 0,h=void 0,l=0;l<w.parent.treeGrid.parentData.length;l++)if(w.parent.treeGrid.parentData[l].ganttProperties.taskId===y[t].ganttProperties.taskId){a=w.parent.treeGrid.parentData[l+1],h=l+1;break}var f,s=t;do{}while((f=y[s+1])&&a.ganttProperties.taskId===f.ganttProperties.taskId?(s++,a=w.parent.treeGrid.parentData[++h]):(i.id="R"+a.ganttProperties.taskId,"deletedIndexes"===k&&(i.index=a.index)),!i.id)}else i.position="below",i.id="R"+w.parent.treeGrid.parentData[g-1].ganttProperties.taskId,"deletedIndexes"===k&&(i.index=w.parent.treeGrid.parentData[g-1].index)}if("deletedIndexes"===k){var m=w.parent.getTaskByUniqueID(i.data.parentUniqueID);if(0===w.parent.editModule.dialogModule.ganttResources.length&&-1===D[k].indexOf(i))D[k].push(i);else for(c=0;c<w.parent.editModule.dialogModule.ganttResources.length;c++)w.parent.editModule.dialogModule.ganttResources[c][w.parent.resourceFields.id]!==m.ganttProperties.taskId&&-1===D[k].indexOf(i)&&D[k].push(i)}else D[k].some(function(e){return e.data.ganttProperties.taskId===i.data.ganttProperties.taskId})||D[k].push(i)}(e)},qn.prototype.getModuleName=function(){return"undoRedo"},qn.prototype.destroy=function(){!this.parent.enableUndoRedo&&this.parent.undoRedoModule&&(this.parent.undoRedoModule=void 0)},qn);function qn(e){this.isUndoRedoPerformed=!1,this.changedRecords=[],this.getRedoCollection=[],this.getUndoCollection=[],this.redoEnabled=!1,this.previousSortedColumns=[],this.searchString="",this.isFromUndoRedo=!1,this.canUpdateIndex=!0,this.sortedColumnsLength=0,this.parent=e}O.prototype.addEventListener=function(){this.parent.isDestroyed||(this.parent.on("initiate-contextMenu",this.render,this),this.parent.on("reRender-contextMenu",this.reRenderContextMenu,this),this.parent.on("contextMenuClick",this.contextMenuItemClick,this),this.parent.on("contextMenuOpen",this.contextMenuBeforeOpen,this))},O.prototype.reRenderContextMenu=function(e){e.module===this.getModuleName()&&e.enable&&(this.contextMenu&&(this.contextMenu.destroy(),oe.remove(this.element)),this.resetItems(),this.render())},O.prototype.render=function(){this.element=this.parent.createElement("ul",{id:this.ganttID+"_contextmenu",className:ue}),this.parent.element.appendChild(this.element);var e="#"+this.ganttID;this.contextMenu=new V.ContextMenu({items:this.getMenuItems(),locale:this.parent.locale,enableRtl:this.parent.enableRtl,target:e,animationSettings:{effect:"None"},select:this.contextMenuItemClick.bind(this),beforeOpen:this.contextMenuBeforeOpen.bind(this),onOpen:this.contextMenuOpen.bind(this),onClose:this.contextMenuOnClose.bind(this),cssClass:"e-gantt"}),this.contextMenu.appendTo(this.element),this.parent.treeGrid.contextMenuItems=this.headerMenuItems},O.prototype.contextMenuItemClick=function(e){this.item=this.getKeyFromId(e.item.id);var t,i,n,a,r,s,o=oe.getValue("parentObj",e.item),l=-1;switch(e.type="Content",e.rowData=this.rowData,this.parent.trigger("contextMenuClick",e),o&&!oe.isNullOrUndefined(o.id)&&"DeleteDependency"===this.getKeyFromId(o.id)&&(l=o.items.indexOf(e.item)),!this.parent.isAdaptive||"TaskInformation"!==this.item&&"Above"!==this.item&&"Below"!==this.item&&"Child"!==this.item&&"DeleteTask"!==this.item||this.parent.selectionModule&&"Multiple"===this.parent.selectionSettings.type&&(this.parent.selectionModule.hidePopUp(),document.getElementsByClassName("e-gridpopup")[0].style.display="none"),this.item){case"TaskInformation":oe.isNullOrUndefined(this.rowData)||("string"==typeof this.rowData.ganttProperties.taskId?this.parent.openEditDialog(this.rowData.ganttProperties.rowUniqueID):this.parent.openEditDialog(Number(this.rowData.ganttProperties.rowUniqueID)));break;case"Above":case"Below":case"Child":oe.isNullOrUndefined(this.rowData)?0===this.parent.flatData.length&&this.parent.addRecord():(r=this.item,(n=oe.extend({},{},this.rowData.taskData,!0))[(a=this.parent.taskFields).startDate]&&this.parent.setRecordValue(a.startDate,this.rowData.ganttProperties.startDate,n,!0),n[a.endDate]&&this.parent.setRecordValue(a.endDate,this.rowData.ganttProperties.endDate,n,!0),oe.isNullOrUndefined(a.dependency)||(n[a.dependency]=null),!oe.isNullOrUndefined(a.child)&&n[a.child]&&delete n[a.child],!oe.isNullOrUndefined(a.parentID)&&n[a.parentID]&&(n[a.parentID]=null),this.rowData&&("ResourceView"===this.parent.viewType&&this.rowData.parentItem&&n[this.parent.taskFields.resourceInfo]&&(t=this.parent.getParentTask(this.rowData.parentItem),i=this.parent.resourceFields.id,s=this.rowData.taskData[this.parent.taskFields.resourceInfo].find(function(e){return e[i]===t.ganttProperties.taskId}),n[this.parent.taskFields.resourceInfo]=s?[s]:[]),s=this.parent.updatedRecords.indexOf(this.rowData),this.parent.addRecord(n,r,s)));break;case"Milestone":case"ToMilestone":oe.isNullOrUndefined(this.rowData)?0===this.parent.flatData.length&&"Milestone"===this.item&&(r=this.parent.editModule.createNewRecord(),s=this.parent.taskFields,this.parent.taskFields.duration&&(r[s.duration]=0),this.parent.taskFields.milestone&&(r[s.milestone]=!0),this.parent.addRecord(r)):this.parent.convertToMilestone(this.rowData.ganttProperties.rowUniqueID);break;case"DeleteTask":"Cell"!==this.parent.selectionSettings.mode&&1<this.parent.selectionModule.selectedRowIndexes.length||"Cell"===this.parent.selectionSettings.mode&&this.parent.selectionModule.getSelectedRowCellIndexes().length?this.parent.editModule.startDeleteAction():this.parent.editModule.deleteRecord(this.rowData);break;case"ToTask":oe.isNullOrUndefined(this.rowData)||(n=oe.extend({},{},this.rowData.taskData,!0),a=this.parent.taskFields,oe.isNullOrUndefined(a.duration)?(n[a.startDate]=new Date(this.rowData.taskData[a.startDate]),(s=new Date(this.rowData.taskData[a.startDate])).setDate(s.getDate()+1),n[a.endDate]=s):(r=parseInt(n[a.duration],10)<=0?1:n[a.duration],n[a.duration]=r,this.parent.setRecordValue("duration",r,this.rowData.ganttProperties,!0)),oe.isNullOrUndefined(n[a.milestone])||!0===n[a.milestone]&&(n[a.milestone]=!1),"FixedWork"!==(s=(oe.isNullOrUndefined(this.rowData.ganttProperties.taskType)?this.parent:this.rowData.ganttProperties).taskType)&&"FixedUnit"!==s||(this.parent.dataOperation.updateWorkWithDuration(this.rowData),oe.isNullOrUndefined(n[a.work]))||(n[a.work]=this.rowData.ganttProperties.work),n[a.startDate]&&this.parent.setRecordValue(a.startDate,this.rowData.ganttProperties.startDate,n,!0),this.parent.updateRecordByID(n));break;case"Cancel":this.parent.cancelEdit();break;case"Save":this.parent.editModule.cellEditModule.isCellEdit=!1,this.parent.treeGrid.grid.saveCell();break;case"Dependency"+l:this.isCntxtMenuDependencyDelete=!0,this.parent.connectorLineEditModule.removePredecessorByIndex(this.rowData,l);break;case"Auto":case"Manual":this.parent.changeTaskMode(this.rowData);break;case"Indent":this.parent.indent();break;case"Outdent":this.parent.outdent();break;case"Left":case"Right":this.mergeCall(this.item);break;case"SplitTask":this.splitTaskCall(e)}},O.prototype.splitTaskCall=function(e){var t=this,i=(this.isEdit=!0,this.parent.taskFields),n=this.getClickedDate(e.element),e=(oe.isNullOrUndefined(this.parent.timelineSettings.bottomTier)&&"Hour"!==this.parent.timelineSettings.bottomTier.unit&&n.setHours(0,0,0,0),{rowData:this.rowData,requestType:"splitTaskbar",splitDate:n,cancel:!1,target:this.targetElement});this.parent.trigger("actionBegin",e,function(e){e.cancel||(oe.isNullOrUndefined(t.parent.loadingIndicator)||"Shimmer"!==t.parent.loadingIndicator.indicatorType?t.parent.showSpinner():t.parent.showMaskRow(),t.parent.chartRowsModule.splitTask(t.rowData[i.id],n),t.parent.chartRowsModule.updateSegment(t.rowData.ganttProperties.segments,t.rowData.ganttProperties.taskId))})},O.prototype.mergeCall=function(e){var t=this,i=(this.isEdit=!0,this.parent.taskFields),n=this.rowData.ganttProperties.segments,a=[{firstSegmentIndex:("Right"===e?this:n[this.segmentIndex-1]).segmentIndex,secondSegmentIndex:("Left"===e?this:n[this.segmentIndex+1]).segmentIndex}],e={rowData:this.rowData,mergeSegmentIndexes:a,requestType:"mergeSegment",cancel:!1,target:this.targetElement};this.parent.trigger("actionBegin",e,function(e){!1===e.cancel&&(oe.isNullOrUndefined(t.parent.loadingIndicator)||"Shimmer"!==t.parent.loadingIndicator.indicatorType?t.parent.showSpinner():t.parent.showMaskRow(),t.parent.chartRowsModule.mergeTask(t.rowData[i.id],a))})},O.prototype.getClickedDate=function(e){a=this.parent.enableRtl?(a=this.parent.element.getBoundingClientRect(),t=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft,i=document.documentElement.clientLeft||document.body.clientLeft||0,a.left+t-i):this.parent.getOffsetRect(this.parent.element).left,t=this.parent.enableRtl?(r=Math.abs(a+this.parent.ganttChartModule.chartElement.offsetWidth-this.rowData.ganttProperties.left-this.parent.ganttChartModule.scrollElement.scrollLeft),Math.abs(this.clickedPosition-r)):(r=a+this.parent.ganttChartModule.chartElement.offsetLeft+this.rowData.ganttProperties.left-this.parent.ganttChartModule.scrollElement.scrollLeft,this.clickedPosition-r);var t,i=Math.ceil(t/this.parent.perDayWidth);if(!this.parent.timelineSettings.showWeekend){var n=new Date(this.rowData.ganttProperties.startDate),a=864e5/this.parent.perDayWidth;if(!this.parent.timelineSettings.showWeekend){for(var r=Math.floor(t*a/864e5),a=7-this.parent.nonWorkingDayIndex.length,s=Math.floor(r/a),o=r%a,l=(n.setDate(n.getDate()+7*s),0);l<o;)n.setDate(n.getDate()+1),-1===this.parent.nonWorkingDayIndex.indexOf(n.getDay())&&l++;r=n;i+=this.parent.timelineModule.calculateNonWorkingDaysBetweenDates(new Date(this.rowData.ganttProperties.startDate),r)}}a=this.rowData.ganttProperties.startDate;return oe.isNullOrUndefined(this.parent.timelineSettings.bottomTier)||"Hour"!==this.parent.timelineSettings.bottomTier.unit||(i=Math.ceil(t/this.parent.timelineSettings.timelineUnitSize),--i),oe.isNullOrUndefined(this.parent.timelineSettings.bottomTier)||"Minutes"!==this.parent.timelineSettings.bottomTier.unit&&"Hour"!==this.parent.timelineSettings.bottomTier.unit?this.parent.dataOperation.getEndDate(a,i,1<this.rowData.ganttProperties.duration?this.rowData.ganttProperties.durationUnit:("None"!==this.parent.timelineSettings.bottomTier.unit?this.parent.timelineSettings.bottomTier:this.parent.timelineSettings.topTier).unit.toLocaleLowerCase(),this.rowData,!1):(i=Math.ceil(t/this.parent.timelineSettings.timelineUnitSize),this.parent.dataOperation.getEndDate(a,--i,this.parent.timelineSettings.bottomTier.unit.toLocaleLowerCase(),this.rowData,!1))},O.prototype.contextMenuBeforeOpen=function(t){var i=this,e=t.event?t.event.target:this.parent.focusModule?this.parent.ganttChartModule.targetElement:this.parent.focusModule.getActiveElement(),n=((!oe.isNullOrUndefined(this.parent.editModule)&&this.parent.editModule.cellEditModule&&this.parent.editModule.cellEditModule.isCellEdit&&e.parentElement.classList.contains("e-row")||e.parentElement.classList.contains("e-treecolumn-container"))&&this.parent.treeGrid.endEdit(),oe.isNullOrUndefined(t.element)||t.element.id!==this.parent.element.id+"_contextmenu"||(this.clickedPosition=oe.getValue("event",t).clientX),oe.closest(e,".e-gantt-child-taskbar")),n=(n&&(this.targetElement=t.target=n),t.gridRow=oe.closest(e,".e-row"),t.chartRow=oe.closest(e,".e-chart-row"),oe.closest(e,".e-gantt"));if(!oe.closest(e,ct)&&this.parent.editModule&&this.parent.editModule.cellEditModule&&this.parent.editModule.cellEditModule.isCellEdit&&this.parent.editModule.dialogModule.dialogObj&&!this.parent.editModule.dialogModule.dialogObj.open&&(this.parent.treeGrid.grid.saveCell(),this.parent.editModule.cellEditModule.isCellEdit=!1),this.parent.readOnly&&this.contextMenu.enableItems(["Add","Save","Convert","Delete Dependency","Delete Task","TaskMode","Indent","Outdent","SplitTask","MergeTask"],!1),(oe.isNullOrUndefined(t.gridRow)&&oe.isNullOrUndefined(t.chartRow)||0===this.contentMenuItems.length)&&((oe.isNullOrUndefined(t.parentItem)||oe.isNullOrUndefined(n))&&oe.isNullOrUndefined(oe.closest(e,".e-content"))?t.cancel=!0:t.cancel=!1),!t.cancel){var a=-1;t.gridRow?a=parseInt(t.gridRow.getAttribute("aria-rowindex"),0)-1:t.chartRow&&(a=parseInt(t.chartRow.getAttribute("aria-rowindex"),0)-1),this.parent.selectionModule&&this.parent.allowSelection&&!t.parentItem&&!oe.isNullOrUndefined(t.chartRow)&&this.parent.selectionModule.selectRow(a),t.parentItem||(this.rowData=this.parent.ganttChartModule.getRecordByTarget(t.event));for(var r,s=0,o=t.items;s<o.length;s++){var l=o[s];l.separator||(!e.classList.contains("e-gantt-unscheduled-taskbar")||l.text!==this.getLocale("splitTask")&&l.text!==this.getLocale("mergeTask")?this.updateItemStatus(l,e,a):this.hideItems.push(l.text))}if(t.rowData=this.rowData,t.type="Content",t.disableItems=this.disableItems,t.hideItems=this.hideItems,t.hideChildItems=[],oe.isNullOrUndefined(t.rowData)||0!==t.rowData.level||"ResourceView"!==this.parent.viewType)return r=new y.Deferred,this.parent.trigger("contextMenuOpen",t,function(e){r.resolve(e),i.hideItems=e.hideItems,i.disableItems=e.disableItems,e.parentItem||e.hideItems.length!==e.items.length||(i.revertItemStatus(),e.cancel=!0),0<i.hideItems.length&&i.contextMenu.hideItems(i.hideItems),0<i.disableItems.length&&i.contextMenu.enableItems(i.disableItems,!1),0<t.hideChildItems.length&&i.contextMenu.hideItems(t.hideChildItems)}),r;t.cancel=!0}},O.prototype.updateItemStatus=function(e,t,i){var n=this.getKeyFromId(e.id),a=oe.closest(t,ct),r=[],s=oe.closest(t,".e-gantt-child-taskbar")||oe.closest(t,"e-taskbar-right-resizer")||oe.closest(t,"e-taskbar-left-resizer");if(a)"Save"!==n&&"Cancel"!==n&&this.hideItems.push(e.text);else switch(n){case"TaskInformation":this.parent.editSettings.allowEditing&&this.parent.editModule||this.updateItemVisibility(e.text),0===this.parent.flatData.length&&this.hideItems.push(e.text);break;case"Add":this.parent.editSettings.allowAdding&&this.parent.editModule||this.updateItemVisibility(e.text);break;case"Save":case"Cancel":this.hideItems.push(e.text);break;case"Convert":!oe.isNullOrUndefined(this.rowData)&&this.rowData.hasChildRecords?this.hideItems.push(e.text):this.parent.editSettings.allowEditing&&this.parent.editModule?(oe.isNullOrUndefined(this.rowData)||this.rowData.ganttProperties.isMilestone?r.push(this.createItemModel(p,"ToTask",this.getLocale("toTask"))):r.push(this.createItemModel(p,"ToMilestone",this.getLocale("toMilestone"))),e.items=r):this.updateItemVisibility(e.text),0===this.parent.flatData.length&&this.hideItems.push(e.text);break;case"DeleteDependency":var o=this.getPredecessorsItems();oe.isNullOrUndefined(this.rowData)||!this.rowData.hasChildRecords||this.parent.allowParentDependency?this.parent.editSettings.allowDeleting&&0!==o.length&&this.parent.editModule?0<o.length&&(e.items=o):this.updateItemVisibility(e.text):this.hideItems.push(e.text);break;case"DeleteTask":this.parent.editSettings.allowDeleting&&this.parent.editModule||this.updateItemVisibility(e.text),0===this.parent.flatData.length&&this.hideItems.push(e.text);break;case"TaskMode":"Custom"!==this.parent.taskMode?this.updateItemVisibility(e.text):(this.rowData.ganttProperties.isAutoSchedule?r.push(this.createItemModel(p,"Manual",this.getLocale("manual"))):r.push(this.createItemModel(p,"Auto",this.getLocale("auto"))),e.items=r);break;case"Indent":this.parent.allowSelection&&this.parent.editModule&&this.parent.editSettings?(o=this.parent.selectedRowIndex,d=!!this.parent.selectionModule&&(1===this.parent.selectionModule.selectedRowIndexes.length||1===this.parent.selectionModule.getSelectedRowCellIndexes().length),l=this.parent.updatedRecords[this.parent.selectionModule.getSelectedRowIndexes()[0]-1],this.parent.editSettings.allowEditing&&0!==o&&-1!==o&&d&&"ResourceView"!==this.parent.viewType&&this.parent.updatedRecords[parseInt(o.toString(),10)].level-l.level!=1||this.updateItemVisibility(e.text)):this.hideItems.push(e.text);break;case"Outdent":this.parent.allowSelection&&this.parent.editModule&&this.parent.editSettings?(d=this.parent.selectionModule.getSelectedRowIndexes()[0],o=!!this.parent.selectionModule&&(1===this.parent.selectionModule.selectedRowIndexes.length||1===this.parent.selectionModule.getSelectedRowCellIndexes().length),this.parent.editSettings.allowEditing&&-1!==d&&0!==d&&o&&"ResourceView"!==this.parent.viewType&&0!==this.parent.updatedRecords[parseInt(d.toString(),10)].level||this.updateItemVisibility(e.text)):this.hideItems.push(e.text);break;case"SplitTask":var l=!1,o=!1,d=this.parent.taskFields;oe.isNullOrUndefined(this.parent.timelineSettings.bottomTier)||(l="Minutes"===this.parent.timelineSettings.bottomTier.unit,o="Hour"===this.parent.timelineSettings.bottomTier.unit),(this.parent.readOnly||!s||oe.isNullOrUndefined(d.segments)||this.parent.flatData[Number(i)].hasChildRecords||this.parent.flatData[Number(i)].ganttProperties.duration<2&&!l&&!o)&&this.updateItemVisibility(e.text);break;case"MergeTask":this.parent.readOnly||!s?this.updateItemVisibility(e.text):this.mergeItemVisiblity(t,e)}},O.prototype.mergeItemVisiblity=function(e,t){var i=[],n=this.parent.taskFields,e=this.getClickedDate(e),e=(this.segmentIndex=this.parent.chartRowsModule.getSegmentIndex(e,this.rowData),this.rowData.ganttProperties.segments);!oe.isNullOrUndefined(e)&&0<e.length?oe.isNullOrUndefined(n.segments)&&-1===this.segmentIndex?this.updateItemVisibility(t.text):(0===this.segmentIndex?i.push(this.createItemModel(p,"Right",this.getLocale("right"))):(this.segmentIndex!==e.length-1&&i.push(this.createItemModel(p,"Right",this.getLocale("right"))),i.push(this.createItemModel(p,"Left",this.getLocale("left")))),t.items=i):this.hideItems.push(t.text)},O.prototype.updateItemVisibility=function(e){(!!oe.isNullOrUndefined(this.parent.contextMenuItems)?this.hideItems:this.disableItems).push(e)},O.prototype.contextMenuOpen=function(e){this.isOpen=!0;e=this.parent.args=e.element.querySelectorAll("li:not(.e-menu-hide):not(.e-disabled)")[0];oe.isNullOrUndefined(e)||oe.addClass([e],"e-focused")},O.prototype.getMenuItems=function(){for(var e=0,t=oe.isNullOrUndefined(this.parent.contextMenuItems)?this.getDefaultItems():this.parent.contextMenuItems;e<t.length;e++){var i=t[e];"string"==typeof i&&-1!==this.getDefaultItems().indexOf(i)?this.buildDefaultItems(i):"string"!=typeof i&&(-1!==this.getDefaultItems().indexOf(i.text)?this.buildDefaultItems(i.text,i.iconCss):(".e-gridheader"===i.target?this.headerMenuItems:this.contentMenuItems).push(i))}return this.contentMenuItems},O.prototype.createItemModel=function(e,t,i,n){return{text:i,id:this.generateID(t),target:e,iconCss:n?"e-icons "+n:null}},O.prototype.getLocale=function(e){return this.parent.localeObj.getConstant(e)},O.prototype.buildDefaultItems=function(e,t){var i;switch(e){case"AutoFitAll":case"AutoFit":case"SortAscending":case"SortDescending":this.headerMenuItems.push(e);break;case"TaskInformation":i=this.createItemModel(p,e,this.getLocale("taskInformation"),this.getIconCSS(gt,t));break;case"Indent":i=this.createItemModel(p,e,this.getLocale("indent"),this.getIconCSS("e-indent",t));break;case"Outdent":i=this.createItemModel(p,e,this.getLocale("outdent"),this.getIconCSS("e-outdent",t));break;case"Save":i=this.createItemModel(gt,e,this.getLocale("save"),this.getIconCSS("e-save",t));break;case"Cancel":i=this.createItemModel(gt,e,this.getLocale("cancel"),this.getIconCSS("e-cancel",t));break;case"Add":(i=this.createItemModel(p,e,this.getLocale("add"),this.getIconCSS("e-add",t))).items=[],i.items.push(this.createItemModel(p,"Above",this.getLocale("above"),this.getIconCSS("e-add-above",t))),i.items.push(this.createItemModel(p,"Below",this.getLocale("below"),this.getIconCSS("e-add-below",t))),"ResourceView"!==this.parent.viewType&&i.items.push(this.createItemModel(p,"Child",this.getLocale("child"))),i.items.push(this.createItemModel(p,"Milestone",this.getLocale("milestone")));break;case"DeleteTask":i=this.createItemModel(p,e,this.getLocale("deleteTask"),this.getIconCSS("e-delete",t));break;case"DeleteDependency":(i=this.createItemModel(p,e,this.getLocale("deleteDependency"))).items=[],i.items.push({});break;case"Convert":(i=this.createItemModel(p,e,this.getLocale("convert"))).items=[],i.items.push({});break;case"TaskMode":(i=this.createItemModel(p,e,this.getLocale("changeScheduleMode"))).items=[],i.items.push({});break;case"SplitTask":i=this.createItemModel(p,e,this.getLocale("splitTask"));break;case"MergeTask":(i=this.createItemModel(p,e,this.getLocale("mergeTask"))).items=[],i.items.push({})}i&&this.contentMenuItems.push(i)},O.prototype.getIconCSS=function(e,t){return oe.isNullOrUndefined(t)?e:t},O.prototype.getPredecessorsItems=function(){this.predecessors=this.parent.predecessorModule.getValidPredecessor(this.rowData);for(var e=[],t=0,i=0,n=this.predecessors;i<n.length;i++){var a=n[i],a=this.parent.connectorLineModule.getRecordByID(a.from).ganttProperties,a=a.rowUniqueID+" - "+a.taskName,r="Dependency"+t++,r=this.createItemModel(p,r,a);e.push(r)}return e},O.prototype.getDefaultItems=function(){return["AutoFitAll","AutoFit","TaskInformation","DeleteTask","Save","Cancel","SortAscending","SortDescending","Add","DeleteDependency","Convert","TaskMode","Indent","Outdent","SplitTask","MergeTask"]},O.prototype.getModuleName=function(){return"contextMenu"},O.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off("initiate-contextMenu",this.render),this.parent.off("reRender-contextMenu",this.reRenderContextMenu),this.parent.off("contextMenuClick",this.contextMenuItemClick),this.parent.off("contextMenuOpen",this.contextMenuOpen))},O.prototype.contextMenuOnClose=function(e){0<e.items.length&&e.items[0].parentObj instanceof V.ContextMenu&&this.revertItemStatus()},O.prototype.revertItemStatus=function(){this.contextMenu.showItems(this.hideItems),this.contextMenu.enableItems(this.disableItems),this.hideItems=[],this.disableItems=[],this.isOpen=!1},O.prototype.resetItems=function(){this.hideItems=[],this.disableItems=[],this.headerMenuItems=[],this.contentMenuItems=[],this.item=null},O.prototype.generateID=function(e){return this.ganttID+"_contextMenu_"+e},O.prototype.getKeyFromId=function(e){var t=this.ganttID+"_contextMenu_";return-1<e.indexOf(t)?e.replace(t,""):"Custom"},O.prototype.destroy=function(){this.contextMenu.destroy(),oe.remove(this.element),this.removeEventListener(),this.contextMenu=null,this.element=null};var _n=O;function O(e){var n=this;this.segmentIndex=-1,this.isCntxtMenuDependencyDelete=!1,this.headerContextMenuClick=function(e){var t=oe.closest(e.event.target,".e-row"),i=oe.closest(e.event.target,".e-chart-row");oe.isNullOrUndefined(t)&&oe.isNullOrUndefined(i)&&(e.type="Header",n.parent.trigger("contextMenuClick",e))},this.headerContextMenuOpen=function(e){var t=oe.closest(e.event.target,".e-row"),i=oe.closest(e.event.target,".e-chart-row");oe.isNullOrUndefined(t)&&oe.isNullOrUndefined(i)?(e.type="Header",n.parent.trigger("contextMenuOpen",e)):e.cancel=!0},this.parent=e,this.ganttID=e.element.id,T.TreeGrid.Inject(T.ContextMenu),this.parent.treeGrid.contextMenuClick=this.headerContextMenuClick.bind(this),this.parent.treeGrid.contextMenuOpen=this.headerContextMenuOpen.bind(this),this.addEventListener(),this.resetItems()}Zn.prototype.getModuleName=function(){return"excelExport"},Zn.prototype.destroy=function(){},Zn.prototype.bindEvents=function(){var t=this;this.parent.treeGrid.beforeExcelExport=function(e){t.parent.trigger("beforeExcelExport",e),oe.getValue("cancel",e)||(oe.isNullOrUndefined(t.parent.loadingIndicator)||"Shimmer"!==t.parent.loadingIndicator.indicatorType?t.parent.showSpinner():t.parent.showMaskRow())},this.parent.treeGrid.excelQueryCellInfo=function(e){t.parent.trigger("excelQueryCellInfo",e)},this.parent.treeGrid.excelHeaderQueryCellInfo=function(e){t.parent.trigger("excelHeaderQueryCellInfo",e)},this.parent.treeGrid.excelExportComplete=function(e){t.parent.trigger("excelExportComplete",e),oe.isNullOrUndefined(t.parent.loadingIndicator)||"Shimmer"!==t.parent.loadingIndicator.indicatorType?t.parent.hideSpinner():t.parent.hideMaskRow()}};var Xn=Zn;function Zn(e){this.parent=e,T.TreeGrid.Inject(T.ExcelExport),this.parent.treeGrid.allowExcelExport=this.parent.allowExcelExport,this.bindEvents()}Kn.prototype.getColumnMenu=function(){return this.parent.treeGrid.columnMenuModule.getColumnMenu()},Kn.prototype.destroy=function(){},Kn.prototype.getModuleName=function(){return"columnMenu"};var Yn=Kn;function Kn(e){T.TreeGrid.Inject(T.ColumnMenu),this.parent=e}I.prototype.getModuleName=function(){return"rowDragAndDrop"},I.prototype.destroy=function(){},I.prototype.bindEvents=function(){this.parent.treeGrid.rowDragStart=this.rowDragStart.bind(this),this.parent.treeGrid.rowDragStartHelper=this.rowDragStartHelper.bind(this),this.parent.treeGrid.rowDrag=this.rowDrag.bind(this),this.parent.treeGrid.rowDrop=this.rowDrop.bind(this)},I.prototype.rowDragStart=function(e){this.parent.trigger("rowDragStart",e),this.parent.element.style.position="relative"},I.prototype.addErrorElem=function(){var e,t,i,n,a=document.querySelector(".e-ganttdrag");a&&!!!a.querySelector(".e-errorelem")&&((e=document.createElement("div")).classList.add("e-errorcontainer","e-icons","e-errorelem"),a=a.querySelector(".e-rowcell"))&&(t=a.childNodes,(i=a.querySelector(".errorValue"))&&(t=i.childNodes,i.remove()),a.innerHTML="",(n=document.createElement("span")).className="errorValue",n.style.paddingLeft="16px",t.forEach(function(e){n.appendChild(e.cloneNode(!0))}),a.appendChild(e),a.appendChild(n))},I.prototype.removeErrorElem=function(){var e=document.querySelector(".e-errorelem");e&&e.remove()},I.prototype.rowDrag=function(e){var t,i=this.parent.element.querySelector(".e-cloneproperties"),i=(i.style.display="none",i.cloneNode(!0)),i=(i.classList.add("e-ganttdrag"),i.style.display="",this.parent.element.querySelectorAll(".e-cloneproperties").length<=1?this.parent.element.appendChild(i):document.getElementsByClassName("e-cloneproperties")[0].querySelectorAll(".e-errorelem").length?this.addErrorElem():this.removeErrorElem(),"Both"===this.parent.gridLines&&oe.addClass(this.parent.element.querySelectorAll(".e-ganttdrag .e-rowcell"),["e-bothganttlines"]),this.parent.element.querySelector(".e-ganttdrag")),n=this.parent.element.getClientRects()[0].top,a=this.parent.element.getClientRects()[0].left,a=this.parent.isAdaptive?(t=e.originalEvent.event.touches[0].clientX-a,e.originalEvent.event.touches[0].clientY-n):(t=oe.getValue("event",e.originalEvent).clientX-a,oe.getValue("event",e.originalEvent).clientY-n);i.style.left=t+20+"px",i.style.top=a+20+"px",this.parent.trigger("rowDrag",e)},I.prototype.rowDragStartHelper=function(e){this.parent.trigger("rowDragStartHelper",e),this.parent.readOnly&&(e.cancel=!0),"ResourceView"===this.parent.viewType&&0===oe.getValue("level",e.data[0])&&(e.cancel=!0)},I.prototype.rowDrop=function(e){var t=oe.closest(e.target,".e-row"),t=(this.parent.oldRecords=oe.extend([],[],e.data,!0),t?parseInt(t.getAttribute("aria-rowindex"),10)-1:e.dropIndex);e.dropIndex=t,e.dropRecord=this.parent.updatedRecords[e.dropIndex],this.parent.trigger("rowDrop",e),"ResourceView"===this.parent.viewType&&("middleSegment"!==e.dropPosition||1!==e.dropRecord.level&&e.dropRecord.uniqueID!==oe.getValue("parentItem",e.data[0]).uniqueID||(e.cancel=!0),"middleSegment"===e.dropPosition||0!==e.dropRecord.level&&oe.getValue("parentItem",e.data[0]).uniqueID!==e.dropRecord.parentItem.uniqueID||(e.cancel=!0)),e.cancel||(e.requestType="beforeDrop",this.parent.trigger("actionBegin",e),e.cancel?oe.isNullOrUndefined(this.parent.loadingIndicator)||"Shimmer"!==this.parent.loadingIndicator.indicatorType?this.parent.hideSpinner():this.parent.hideMaskRow():(oe.isNullOrUndefined(this.parent.loadingIndicator)||"Shimmer"!==this.parent.loadingIndicator.indicatorType?this.parent.showSpinner():this.parent.showMaskRow(),this.dropRows(e,!0),e.cancel=!0))},I.prototype.dropRows=function(i,u){if(!this.parent.readOnly){if(this.dropPosition=i.dropPosition,"Invalid"!==i.dropPosition&&this.parent.editModule){var c=this.parent;if(this.droppedRecord=c.updatedRecords[i.dropIndex],this.parent.undoRedoModule&&this.parent.isUndoRedoItemPresent("RowDragAndDrop")){if(!this.parent.undoRedoModule.isUndoRedoPerformed){this.parent.undoRedoModule.redoEnabled&&(this.parent.undoRedoModule.disableRedo(),this.parent.undoRedoModule.createUndoCollection()),!i.target&&this.parent.editModule&&this.parent.editModule.taskbarEditModule&&this.parent.editModule.taskbarEditModule.taskBarEditAction?this.parent.undoRedoModule.getUndoCollection[this.parent.undoRedoModule.getUndoCollection.length-1]=[]:this.parent.undoRedoModule.createUndoCollection();for(var e=[],n=this,a=0;a<i.data.length;a++)!function(t){e.push(n.parent.flatData.filter(function(e){return i.data[t].ganttProperties.taskId===e.ganttProperties.taskId})[0])}(a);var t=oe.extend([],[],e,!0),r={},s=(i.name?r.action="RowDragAndDrop":r.action="TaskbarDragAndDrop",r.beforeDrop=[],{});s.dropRecord=oe.extend([],[],[i.dropRecord||this.droppedRecord],!0)[0],s.data=oe.extend([],[],i.data,!0),"middleSegment"===i.dropPosition?s.dropPosition="child":"topSegment"===i.dropPosition?s.dropPosition="above":"bottomSegment"===i.dropPosition&&(s.dropPosition="below"),r.afterDrop=s,this.parent.undoRedoModule.findPosition(t,r,"beforeDrop"),this.parent.undoRedoModule.getUndoCollection[this.parent.undoRedoModule.getUndoCollection.length-1]=r}this.parent.toolbarModule&&this.parent.toolbarModule.enableItems([this.parent.controlId+"_undo"],!0)}for(var g=void 0,f=[],m=this.droppedRecord,y=(i.data[0]?f=i.data:f.push(i.data),0),o=f.length,l=function(e){if(D.parent.isOnEdit=!0,g=f[e],D.draggedRecord=g,"Invalid"!==D.dropPosition){if("ResourceView"===D.parent.viewType&&(D.checkisSharedTask(),0!==D.draggedRecord.level)&&(D.previousParent=D.draggedRecord.parentItem.uniqueID),D.isSharedTask)return{value:void 0};u&&D.deleteDragRow();var t,e=D.treeGridData.indexOf(m);if("topSegment"===D.dropPosition&&D.dropAtTop(e),"bottomSegment"!==D.dropPosition||D.isSharedTask||(m.hasChildRecords?(y=D.parent.editModule.getChildCount(m,0),D.parent.taskFields.parentID&&0<D.ganttData.length&&D.ganttData.splice(e+y+1,0,D.draggedRecord.taskData),D.treeGridData.splice(e+y+1,0,D.draggedRecord),D.parent.ids.splice(e+y+1,0,D.draggedRecord.ganttProperties.rowUniqueID.toString()),"ResourceView"===D.parent.viewType&&(r=0===D.draggedRecord.level?"R"+D.draggedRecord.ganttProperties.taskId:"T"+D.draggedRecord.ganttProperties.taskId,D.parent.getTaskIds().splice(e+y+1,0,r))):(D.parent.taskFields.parentID&&0<D.ganttData.length&&D.ganttData.splice(e+1,0,D.draggedRecord.taskData),D.treeGridData.splice(e+1,0,D.draggedRecord),D.parent.ids.splice(e+1,0,D.draggedRecord.ganttProperties.rowUniqueID.toString()),"ResourceView"===D.parent.viewType&&(r=0===D.draggedRecord.level?"R"+D.draggedRecord.ganttProperties.taskId:"T"+D.draggedRecord.ganttProperties.taskId,D.parent.getTaskIds().splice(e+1,0,r))),D.parent.setRecordValue("parentItem",D.treeGridData[e].parentItem,g),D.parent.setRecordValue("parentUniqueID",D.treeGridData[e].parentUniqueID,g),D.parent.setRecordValue("level",D.treeGridData[e].level,g),g.hasChildRecords&&(D.updateChildRecordLevel(g,1),D.updateChildRecord(g,e+y+1)),m.parentItem&&(t=(r=D.parent.getParentTask(m.parentItem).childRecords).indexOf(m)+1,r.splice(t,0,g))),"middleSegment"===D.dropPosition&&(D.dropMiddle(e),0<m.childRecords.length)&&(delete m.ganttProperties.segments,delete m.taskData[D.parent.taskFields.segments]),0!==D.treeGridData.length)for(var i,n=0;n<D.treeGridData.length;n++)D.treeGridData[parseInt(n.toString(),10)].index=n,oe.isNullOrUndefined(D.treeGridData[parseInt(n.toString(),10)].parentItem)||(i=oe.getValue("uniqueIDCollection."+D.treeGridData[parseInt(n.toString(),10)].parentUniqueID,D.parent.treeGrid),D.treeGridData[parseInt(n.toString(),10)].parentItem.index=i.index);oe.isNullOrUndefined(g.parentItem&&-1!==D.updateParentRecords.indexOf(g.parentItem))||D.updateParentRecords.push(g.parentItem)}if(!D.parent.enableVirtualization){var a=c.flatData,r=void 0,s=void 0,o=D.parent.dataSource,l=D.parent.taskFields.id;if(g.index<m.index){for(var r=g.index,d=0;d<o.length;d++)if("break"===function(t){var e=D.parent.currentViewData.filter(function(e){return e[l]===o[t][l]})[0];if(e&&e.index>m.index)return s=e.index,"break"}(d))break}else{r=m.index;for(var h=0;h<o.length;h++)if("break"===function(t){var e=D.parent.currentViewData.filter(function(e){return e[l]===o[t][l]})[0];if(e&&e.index>g.index)return s=e.index,"break"}(h))break}for(var p=r;p<=s;p++)!function(t){var e;oe.isNullOrUndefined(a[t])||(a[t].index=t,oe.isNullOrUndefined(a[t].parentItem))||(e=a.filter(function(e){return e.uniqueID===a[t].parentUniqueID})[0],a[t].parentItem.index=e.index)}(p)}c.rowDragAndDropModule.refreshDataSource()},D=this,a=0;a<o;a++){var d=l(a);if("object"==typeof d)return d.value}if("middleSegment"===this.dropPosition){if(m.ganttProperties.predecessor)for(var h=m.ganttProperties.predecessor.length,p=0;p<h;p++)if(m.ganttProperties.predecessor&&m.ganttProperties.predecessor[p]){var k=this.parent.getRecordByID(m.ganttProperties.predecessor[p].from),w=this.parent.getRecordByID(m.ganttProperties.predecessor[p].to),k=this.parent.predecessorModule.validateParentPredecessor(k,w);if(m.ganttProperties.predecessor&&(!k||!this.parent.allowParentDependency)&&(this.parent.editModule.removePredecessorOnDelete(m),m.ganttProperties.predecessor.splice(0,1),m.ganttProperties.predecessorsName)){for(var b=m.ganttProperties.predecessorsName.split(","),a=0;a<b.length;a++)-1!==b[a].indexOf(g.ganttProperties.taskId+"")&&b.splice(a,1);w=b.join();m.ganttProperties.predecessorsName=w,m[this.parent.taskFields.dependency]=w,m.taskData[this.parent.taskFields.dependency]=w}}m.ganttProperties.isMilestone&&(this.parent.setRecordValue("isMilestone",!1,m.ganttProperties,!0),oe.isNullOrUndefined(m.taskData[this.parent.taskFields.milestone])||!0===m.taskData[this.parent.taskFields.milestone]&&(m.taskData[this.parent.taskFields.milestone]=!1))}if("ResourceView"!==this.parent.viewType||this.isSharedTask||(s=void 0,s=("middleSegment"!==this.dropPosition&&this.droppedRecord.parentItem||this.droppedRecord).uniqueID,t=this.parent.getTaskByUniqueID(s),(r={})[this.parent.taskFields.resourceInfo]=[],r[this.parent.taskFields.resourceInfo].push(t.ganttProperties.taskId),this.removeExistingResources(),s=this.parent.dataOperation.setResourceInfo(r),r=this.draggedRecord,oe.isNullOrUndefined(r.ganttProperties.resourceInfo)&&(r.ganttProperties.resourceInfo=[]),"Unassigned Task"===t.ganttProperties.taskName?(r.ganttProperties.resourceInfo=[],r.ganttProperties.sharedTaskUniqueIds=[r.ganttProperties.rowUniqueID]):r.ganttProperties.resourceInfo.push(s[0]),this.updateCurrentTask(r),"Unassigned Task"===t.ganttProperties.taskName?this.deleteSharedResourceTask():this.updateSharedResourceTask()),this.parent.taskFields.dependency&&this.parent.allowParentDependency){var s=void 0,s=g.parentItem?this.parent.flatData[this.parent.ids.indexOf(g.parentItem.taskId)]:g,T=m.parentItem?this.parent.flatData[this.parent.ids.indexOf(m.parentItem.taskId)]:m,v=void 0;if(T.uniqueID===s.uniqueID||s.parentItem&&T.uniqueID===this.parent.flatData[this.parent.ids.indexOf(s.parentItem.taskId)].uniqueID)for(var v=this.parent.currentViewData.filter(function(e){if(e.ganttProperties.predecessor&&0<e.ganttProperties.predecessor.length){var t=0;if(t<e.ganttProperties.predecessor.length)return parseInt(e.ganttProperties.predecessor[t].to,10)===parseInt(T.ganttProperties.taskId,10)||parseInt(e.ganttProperties.predecessor[t].from,10)===parseInt(T.ganttProperties.taskId,10)}return null}),P=[],a=0;a<v.length;a++){if(P=[],v[a].ganttProperties.predecessor)for(var S=0;S<v[a].ganttProperties.predecessor.length;S++)parseInt(v[a].ganttProperties.taskId,10)!==parseInt(v[a].ganttProperties.predecessor[S].from,10)?P.push(v[a].ganttProperties.predecessor[S].from):P.push(v[a].ganttProperties.predecessor[S].to);for(var C=this,R=0;R<P.length;R++)!function(e){var t=P[e].replace(/\D/g,""),e=C.parent.currentViewData.filter(function(e){return parseInt(e.ganttProperties.taskId,10)===parseInt(t,10)});C.parent.predecessorModule.validateParentPredecessor(v[a],e[0])||(C.parent.dataOperation.resetDependency(v[a]),C.parent.dataOperation.resetDependency(e[0]))}(R)}}for(R=0;R<this.updateParentRecords.length;R++)this.parent.dataOperation.updateParentItems(this.updateParentRecords[R]);"ProjectView"===this.parent.viewType&&this.parent.editModule&&this.parent.editModule.taskbarEditModule&&this.parent.undoRedoModule&&this.parent.undoRedoModule.isUndoRedoPerformed&&this.parent.predecessorModule&&"TaskbarDragAndDrop"===this.parent.undoRedoModule.currentAction.action&&"child"!==this.parent.undoRedoModule.currentAction.beforeDrop[0].position&&(r=this.parent.flatData[this.parent.ids.indexOf(this.parent.undoRedoModule.currentAction.afterDrop.dropRecord.ganttProperties.taskId.toString())],this.parent.editModule.taskbarEditModule.taskBarEditRecord=r,this.parent.editModule.taskbarEditModule.taskBarEditAction="ChildDrag",this.parent.predecessorModule.validatePredecessor(r,[],""),this.parent.editModule.taskbarEditModule.taskBarEditAction=null),this.updateParentRecords=[],this.parent.isOnEdit=!1}oe.isNullOrUndefined(this.parent.editModule)||this.parent.editModule.refreshRecord(i,!0),(!this.parent.undoRedoModule||this.parent.undoRedoModule&&this.parent.undoRedoModule.isUndoRedoPerformed)&&(this.parent.previousFlatData=oe.extend([],[],this.parent.flatData,!0))}this.parent.oldRecords=[]},I.prototype.updateCurrentTask=function(e){this.parent.dataOperation.updateMappingData(e,"resourceInfo"),this.parent.editModule.updateResourceRelatedFields(e,"resource"),this.parent.editModule.dialogModule.dialogEditValidationFlag=!1,this.parent.editModule.dialogModule.validateDuration(e),this.parent.dataOperation.updateWidthLeft(e),this.parent.dataOperation.updateTaskData(e)},I.prototype.deleteSharedResourceTask=function(){for(var e=0;e<this.parent.getTaskIds().length;e++)this.parent.getTaskIds()[e]==="T"+this.draggedRecord.ganttProperties.taskId&&("Unassigned Task"!==this.parent.getTaskByUniqueID(this.parent.flatData[e].parentItem.uniqueID).ganttProperties.taskName&&this.removeRecords(this.parent.flatData[e]),oe.isNullOrUndefined(this.parent.flatData[parseInt(e.toString(),10)].parentItem&&-1!==this.updateParentRecords.indexOf(this.parent.flatData[parseInt(e.toString(),10)].parentItem))||this.updateParentRecords.push(this.parent.flatData[e].parentItem))},I.prototype.removeExistingResources=function(){var e=this.parent.getTaskByUniqueID(this.previousParent);if(this.draggedRecord.ganttProperties.resourceInfo)for(var t=0;t<this.draggedRecord.ganttProperties.resourceInfo.length;t++)if(this.draggedRecord.ganttProperties.resourceInfo[parseInt(t.toString(),10)][this.parent.resourceFields.id]===e.ganttProperties.taskId){this.draggedRecord.ganttProperties.resourceInfo.splice(t,1);break}},I.prototype.updateSharedResourceTask=function(){for(var e=0;e<this.parent.getTaskIds().length;e++)this.parent.getTaskIds()[e]==="T"+this.draggedRecord.ganttProperties.taskId&&(this.parent.editModule.updateGanttProperties(this.draggedRecord,this.parent.flatData[e]),this.parent.dataOperation.updateTaskData(this.parent.flatData[e]),oe.isNullOrUndefined(this.parent.flatData[parseInt(e.toString(),10)].parentItem&&-1!==this.updateParentRecords.indexOf(this.parent.flatData[parseInt(e.toString(),10)].parentItem))||this.updateParentRecords.push(this.parent.flatData[e].parentItem))},I.prototype._getExistingTaskWithID=function(e){for(var t=[],i=0;i<this.parent.getTaskIds().length;i++)this.parent.getTaskIds()[i]==="T"+e.ganttProperties.taskId&&t.push(this.parent.flatData[i]);return t},I.prototype.removeResourceInfo=function(e){var t=this.parent.getTaskByUniqueID(this.draggedRecord.parentItem.uniqueID);if(e.ganttProperties.resourceInfo&&1<e.ganttProperties.resourceInfo.length){var i=this._getExistingTaskWithID(e);if(null!==i)for(var n=0;n<i.length;n++)for(var a,r=(a=i[n]).ganttProperties.resourceInfo,s=0;s<r.length;s++)if(r[s][this.parent.resourceFields.id]===t.ganttProperties.taskId){r.splice(s,1),this.parent.setRecordValue("resourceInfo",r,a.ganttProperties,!0),this.updateCurrentTask(a),oe.isNullOrUndefined(a.parentItem&&-1!==this.updateParentRecords.indexOf(a.parentItem))||this.updateParentRecords.push(a.parentItem);break}}},I.prototype.refreshDataSource=function(){var e,t=this.draggedRecord,i=this.droppedRecord,n=this.parent,a=this.parent.taskFields,r=this.parent.dataSource instanceof y.DataManager?oe.getValue("dataOperation.dataArray",this.parent):n.dataSource;if(0<r.length&&!oe.isNullOrUndefined(i)&&!i.parentItem){for(var s=0;s<Object.keys(r).length;s++)(!oe.isNullOrUndefined(i.taskData[a.child])&&r[s][a.child]===i.taskData[a.child]||oe.isNullOrUndefined(i.taskData[a.child])&&i.taskData[a.id]===r[s][a.id])&&(e=s);"topSegment"===this.dropPosition?this.parent.taskFields.parentID||r.splice(e,0,t.taskData):"bottomSegment"!==this.dropPosition||this.parent.taskFields.parentID||r.splice(e+1,0,t.taskData)}else this.parent.taskFields.parentID||oe.isNullOrUndefined(i)||!i.parentItem||"topSegment"!==this.dropPosition&&"bottomSegment"!==this.dropPosition||(n="topSegment"===this.dropPosition?"Above":"Below",this.parent.editModule.addRowSelectedItem=i,this.parent.editModule.updateRealDataSource([t],n),delete this.parent.editModule.addRowSelectedItem);this.parent.taskFields.parentID&&(t.parentItem?(n="middleSegment"===this.dropPosition?this.parent.taskFields.id:this.parent.taskFields.parentID,t[this.parent.taskFields.parentID]=i[n],t.ganttProperties.parentId=i[n],("ResourceView"===this.parent.viewType&&"middleSegment"!==this.dropPosition||"ProjectView"===this.parent.viewType)&&(t.taskData[this.parent.taskFields.parentID]=i.taskData[n])):(t[this.parent.taskFields.parentID]=null,t.taskData[this.parent.taskFields.parentID]=null,t.ganttProperties.parentId=null)),"ProjectView"===this.parent.viewType&&this.parent.editModule&&this.parent.editModule.taskbarEditModule&&this.parent.undoRedoModule&&this.parent.undoRedoModule.isUndoRedoPerformed&&this.parent.predecessorModule&&"TaskbarDragAndDrop"===this.parent.undoRedoModule.currentAction.action&&(n=this.parent.flatData[this.parent.ids.indexOf(this.parent.undoRedoModule.currentAction.afterDrop.data[0].ganttProperties.taskId.toString())],this.parent.editModule.taskbarEditModule.taskBarEditRecord=n,this.parent.editModule.taskbarEditModule.taskBarEditAction="ChildDrag",this.parent.predecessorModule.validatePredecessor(n,[],""),this.parent.editModule.taskbarEditModule.taskBarEditAction=null)},I.prototype.dropMiddle=function(e){var t=this.parent,i=this.parent.editModule.getChildCount(this.droppedRecord,0),i=oe.isNullOrUndefined(i)||0===i?e+1:i+e+1;"middleSegment"!==this.dropPosition||this.isSharedTask||(t.taskFields.parentID&&0<this.ganttData.length&&this.ganttData.splice(i,0,this.draggedRecord.taskData),this.treeGridData.splice(i,0,this.draggedRecord),this.parent.ids.splice(i,0,this.draggedRecord.ganttProperties.rowUniqueID.toString()),"ResourceView"===this.parent.viewType&&(e=0===this.draggedRecord.level?"R"+this.draggedRecord.ganttProperties.taskId:"T"+this.draggedRecord.ganttProperties.taskId,this.parent.getTaskIds().splice(i,0,e)),this.draggedRecord.hasChildRecords&&this.updateChildRecord(this.draggedRecord,i,this.droppedRecord.expanded),this.recordLevel(),oe.isNullOrUndefined(this.draggedRecord.parentItem&&-1!==this.updateParentRecords.indexOf(this.draggedRecord.parentItem))&&this.updateParentRecords.push(this.draggedRecord.parentItem))},I.prototype.recordLevel=function(){var e,t=this.parent,i=this.draggedRecord,n=this.droppedRecord,a=t.taskFields.child;n.hasChildRecords||(n.hasChildRecords=!0,n.childRecords.length)||(n.childRecords=[],!t.taskFields.parentID&&oe.isNullOrUndefined(n.taskData[a])&&(n.taskData[a]=[])),"middleSegment"===this.dropPosition&&(delete(e=oe.extend({},n)).childRecords,e={uniqueID:e.uniqueID,expanded:e.expanded,level:e.level,index:e.index,taskId:e.ganttProperties.rowUniqueID},this.parent.setRecordValue("parentItem",e,i),this.parent.setRecordValue("parentUniqueID",n.uniqueID,i),n.childRecords.splice(n.childRecords.length,0,i),oe.isNullOrUndefined(i)||t.taskFields.parentID||oe.isNullOrUndefined(n.taskData[a])||n.taskData[t.taskFields.child].splice(n.childRecords.length,0,i.taskData),i.hasChildRecords?(i.level=n.level+1,this.parent.setRecordValue("level",this.draggedRecord.level,this.draggedRecord),this.updateChildRecordLevel(i,1)):i.level=n.level+1,n.expanded=!0)},I.prototype.deleteDragRow=function(){var e;this.treeGridData=j(this.parent)?oe.getValue("result",this.parent.treeGrid.dataSource):this.parent.treeGrid.dataSource,this.parent.dataSource instanceof y.DataManager?this.ganttData=oe.getValue("dataOperation.dataArray",this.parent):this.ganttData=j(this.parent)?oe.getValue("result",this.parent.dataSource):this.parent.dataSource,e=this.parent.undoRedoModule&&this.parent.undoRedoModule.isUndoRedoPerformed?"ProjectView"===this.parent.viewType?this.parent.flatData[this.parent.ids.indexOf(this.draggedRecord.ganttProperties.taskId.toString())]:this.draggedRecord.hasChildRecords?this.parent.flatData["R"+this.parent.taskIds.indexOf(this.draggedRecord.ganttProperties.taskId)]:this.parent.flatData["T"+this.parent.taskIds.indexOf(this.draggedRecord.ganttProperties.taskId)]:this.parent.getTaskByUniqueID(this.draggedRecord.uniqueID),this.removeRecords(e)},I.prototype.checkisSharedTask=function(){this.isSharedTask=!1;for(var e=null,t=(0===this.droppedRecord.level?this.droppedRecord:this.droppedRecord.parentItem).uniqueID,i=this.parent.getTaskByUniqueID(t).childRecords,n=0;n<i.length;n++)"T"+this.draggedRecord.ganttProperties.taskId=="T"+i[n].ganttProperties.taskId&&(this.isSharedTask=!0,e=i[n]);this.isSharedTask&&this.removeResourceInfo(e)},I.prototype.dropAtTop=function(e){var t=this.parent;this.isSharedTask||(t.taskFields.parentID&&0<this.ganttData.length&&this.ganttData.splice(e,0,this.draggedRecord.taskData),this.treeGridData.splice(e,0,this.draggedRecord),this.parent.ids.splice(e,0,this.draggedRecord.ganttProperties.rowUniqueID.toString()),this.parent.setRecordValue("parentItem",this.droppedRecord.parentItem,this.draggedRecord),this.parent.setRecordValue("parentUniqueID",this.droppedRecord.parentUniqueID,this.draggedRecord),this.parent.setRecordValue("level",this.droppedRecord.level,this.draggedRecord),"ResourceView"===this.parent.viewType&&(t=0===this.draggedRecord.level?"R"+this.draggedRecord.ganttProperties.taskId:"T"+this.draggedRecord.ganttProperties.taskId,this.parent.getTaskIds().splice(e,0,t)),this.draggedRecord.hasChildRecords&&(this.updateChildRecord(this.draggedRecord,e),this.updateChildRecordLevel(this.draggedRecord,1)),this.droppedRecord.parentItem&&(e=(t=this.parent.getParentTask(this.droppedRecord.parentItem).childRecords).indexOf(this.droppedRecord),t.splice(e,0,this.draggedRecord)),oe.isNullOrUndefined(this.draggedRecord.parentItem&&-1!==this.updateParentRecords.indexOf(this.draggedRecord.parentItem)))||this.updateParentRecords.push(this.draggedRecord.parentItem)},I.prototype.updateChildRecordLevel=function(e,t){if(t++,!e.hasChildRecords)return 0;for(var i=e.childRecords.length,n=0;n<i;n++){var a=e.childRecords[n],r=void 0;e.parentItem&&(r=this.parent.treeGrid.uniqueIDCollection[e.parentItem.uniqueID]),a.level=e.parentItem?r.level+t:e.level+1,this.parent.setRecordValue("level",a.level,a),a.hasChildRecords&&(t--,t=this.updateChildRecordLevel(a,t))}return t},I.prototype.updateChildRecord=function(e,t,i){var n,a=this.parent;if(!e.hasChildRecords)return 0;for(var r=e.childRecords.length,s=0;s<r;s++)n=e.childRecords[s],a.flatData.splice(++t,0,n),this.parent.ids.splice(t,0,n.ganttProperties.rowUniqueID.toString()),a.taskFields.parentID&&0<a.dataSource.length&&this.ganttData.splice(t,0,n.taskData),n.hasChildRecords&&(t=this.updateChildRecord(n,t));return t},I.prototype.removeRecords=function(e){var t=this.parent,i=this.parent.dataSource instanceof y.DataManager?oe.getValue("dataOperation.dataArray",this.parent):this.parent.dataSource,n=e,e=n&&n.parentItem?this.parent.getParentTask(n.parentItem):null;if(n){if(n.parentItem&&(l=[],o=0,l=e?e.childRecords:l)&&0<l.length&&("ResourceView"===this.parent.viewType&&1===l.length&&(this.parent.isOnDelete=!0,l[0].isDelete=!0,this.parent.dataOperation.updateParentItems(e),this.parent.isOnDelete=!1,l[0].isDelete=!1),o=l.indexOf(n),e.childRecords.splice(o,1),!this.parent.taskFields.parentID&&e.taskData[this.parent.taskFields.child]&&e.taskData[this.parent.taskFields.child].splice(o,1),this.updateParentRecords.push(e)),!this.parent.taskFields.parentID&&((l=[]).push(n.ganttProperties.taskId.toString()),"ProjectView"===this.parent.viewType||"ResourceView"===this.parent.viewType&&"middleSegment"!==this.dropPosition)&&this.parent.editModule.removeFromDataSource(l),t.taskFields.parentID){n.hasChildRecords&&0<n.childRecords.length&&this.removeChildItem(n);for(var a=void 0,r=0<i.length&&"ResourceView"!==this.parent.viewType?i:this.parent.updatedRecords,s=0;s<r.length;s++)"ResourceView"===this.parent.viewType?r[s].ganttProperties.rowUniqueID===n.ganttProperties.rowUniqueID&&(a=s):r[s][this.parent.taskFields.id]===n.taskData[this.parent.taskFields.id]&&(a=s);-1!==a&&(0<i.length&&i.splice(a,1),o=this.treeGridData.indexOf(n),this.treeGridData.splice(o,1),this.parent.ids.splice(o,1),-1!==this.parent.treeGrid.parentData.indexOf(n)&&this.parent.treeGrid.parentData.splice(this.parent.treeGrid.parentData.indexOf(n),1),"ResourceView"===this.parent.viewType)&&this.parent.getTaskIds().splice(a,1)}var o,l=this.treeGridData.indexOf(n);t.taskFields.parentID||(i=this.parent.editModule.getChildCount(n,0),this.treeGridData.splice(l,i+1),this.parent.ids.splice(l,i+1),-1!==(o=this.ganttData.indexOf(n.taskData))&&(this.ganttData.splice(o,1),this.parent.treeGrid.parentData.splice(o,1)),"ResourceView"===this.parent.viewType&&this.parent.getTaskIds().splice(l,i+1)),n.parentItem&&e&&e.childRecords&&!e.childRecords.length&&(e.expanded=!1,e.hasChildRecords=!1)}},I.prototype.removeChildItem=function(e){for(var t,i=0;i<e.childRecords.length;i++){for(var n,a=e.childRecords[i],r=void 0,r=this.parent.dataSource instanceof y.DataManager?oe.getValue("dataOperation.dataArray",this.parent):this.parent.dataSource,s=0;s<r.length;s++)r[s][this.parent.taskFields.id]===a.taskData[this.parent.taskFields.id]&&(t=s);-1!==t&&(0<r.length&&r.splice(t,1),n=this.treeGridData.indexOf(a),this.treeGridData.splice(n,1),this.parent.ids.splice(n,1),"ResourceView"===this.parent.viewType)&&this.parent.getTaskIds().splice(t,1),a.hasChildRecords&&this.removeChildItem(a)}},I.prototype.reorderRows=function(e,t,i){if(!this.parent.readOnly&&e[0]!==t&&("above"===i||"below"===i||"child"===i)){"above"===i&&(this.dropPosition="topSegment"),"below"===i&&(this.dropPosition="bottomSegment"),"child"===i&&(this.dropPosition="middleSegment");for(var n=void 0,a=(this.parent.undoRedoModule&&(n=oe.extend([],[],[this.parent.undoRedoModule.currentAction],!0)[0]),[]),r=0;r<e.length;r++)this.parent.undoRedoModule&&this.parent.undoRedoModule.isUndoRedoPerformed&&("RowDragAndDrop"===n.action||"TaskbarDragAndDrop"===n.action)?a[r]=n.beforeDrop[r].data:a[r]=this.parent.flatData[e[r]];i={data:a,dropIndex:t,dropPosition:this.dropPosition};this.dropRows(i,!0)}};var Qn=I;function I(e){this.isTest=!1,this.updateParentRecords=[],this.isaddtoBottom=!1,this.updateCollection={},this.isSharedTask=!1,this.canDrop=!0,this.parent=e,T.TreeGrid.Inject(T.RowDD),this.parent.treeGrid.allowRowDragAndDrop=this.parent.allowRowDragAndDrop,this.bindEvents()}Object.defineProperty($n.prototype,"style",{get:function(){return this.ganttStyle},enumerable:!0,configurable:!0}),$n.prototype.setTheme=function(e,t){switch(this.initStyles(e),e.columnHeader.fontSize=9.5,e.columnHeader.fontColor=new le.PdfColor(0,0,0),e.columnHeader.fontColor.gray=.2,e.columnHeader.backgroundColor=new le.PdfColor(255,255,255),e.columnHeader.borderColor=new le.PdfColor(234,234,234),e.columnHeader.format.lineAlignment=1,e.columnHeader.format.alignment=0,e.fontFamily=le.PdfFontFamily.Helvetica,e.cell.fontSize=9.5,e.cell.backgroundColor=new le.PdfColor(255,255,255),e.cell.borderColor=new le.PdfColor(234,234,234),e.cell.fontColor=new le.PdfColor(0,0,0),e.cell.fontColor.gray=.2,e.cell.format.lineAlignment=1,e.cell.format.alignment=0,e.footer.fontSize=9.5,e.footer.fontStyle=0,e.footer.format.alignment=1,e.footer.format.lineAlignment=1,e.footer.borderColor=new le.PdfColor(235,235,235),e.timeline.fontSize=9.5,e.timeline.fontStyle=0,e.timeline.backgroundColor=new le.PdfColor(252,252,252),e.timeline.fontColor=new le.PdfColor(40,40,39),e.chartGridLineColor=new le.PdfColor(235,235,235),e.timeline.borderColor=new le.PdfColor(235,235,235),e.eventMarker.label.backgroundColor=new le.PdfColor(100,253,191),e.eventMarker.label.fontColor=new le.PdfColor(33,33,33),e.eventMarker.lineStyle=new le.PdfPen(new le.PdfColor(227,22,91)),e.eventMarker.lineStyle.dashStyle=le.PdfDashStyle.Dash,e.holiday.backgroundColor=new le.PdfColor(238,238,238),t){case"Bootstrap":e.taskbar.taskColor=new le.PdfColor(49,122,185),e.taskbar.progressColor=new le.PdfColor(33,82,125),e.taskbar.criticalTaskColor=new le.PdfColor(255,139,139),e.taskbar.criticalProgressColor=new le.PdfColor(255,85,85),e.taskbar.baselineColor=new le.PdfColor(240,173,78),e.taskbar.baselineBorderColor=new le.PdfColor(240,173,78),e.criticalConnectorLineColor=new le.PdfColor(255,85,85),e.taskbar.criticalTaskBorderColor=new le.PdfColor(255,85,85),e.taskbar.parentTaskColor=new le.PdfColor(119,119,119),e.taskbar.parentProgressColor=new le.PdfColor(85,85,85),e.taskbar.taskBorderColor=new le.PdfColor(33,82,125),e.taskbar.parentTaskBorderColor=new le.PdfColor(85,85,85),e.taskbar.milestoneColor=new le.PdfColor(85,85,85),e.footer.fontColor=new le.PdfColor(0,0,0),e.footer.fontColor.gray=.2,e.connectorLineColor=new le.PdfColor(33,82,125),e.footer.backgroundColor=new le.PdfColor(255,255,255),e.taskbar.progressFontColor=new le.PdfColor(255,255,255),e.label.fontColor=new le.PdfColor(0,0,0),e.taskbar.splitLineBackground=new le.PdfColor(51,51,51),e.taskbar.unscheduledTaskBarColor=new le.PdfColor(49,122,185),e.taskbar.manualParentBackground=new le.PdfColor(119,119,119),e.taskbar.manualParentProgress=new le.PdfColor(85,85,85),e.taskbar.manualChildBackground=new le.PdfColor(117,56,201),e.taskbar.manualChildProgress=new le.PdfColor(87,42,150),e.taskbar.manualLineColor=new le.PdfColor(152,154,156),e.taskbar.manualParentBorder=new le.PdfColor(85,85,85),e.taskbar.manualChildBorder=new le.PdfColor(87,42,150),e.eventMarker.label.backgroundColor=new le.PdfColor(138,109,59),e.eventMarker.label.fontColor=new le.PdfColor(252,248,227),e.eventMarker.lineStyle=new le.PdfPen(new le.PdfColor(49,122,185)),e.holiday.backgroundColor=new le.PdfColor(238,238,238);break;case"Bootstrap 4":e.taskbar.taskColor=new le.PdfColor(0,123,255),e.taskbar.progressColor=new le.PdfColor(0,86,179),e.taskbar.criticalTaskColor=new le.PdfColor(255,139,139),e.taskbar.criticalProgressColor=new le.PdfColor(255,85,85),e.taskbar.baselineColor=new le.PdfColor(255,193,7),e.taskbar.baselineBorderColor=new le.PdfColor(255,193,7),e.criticalConnectorLineColor=new le.PdfColor(255,85,85),e.taskbar.criticalTaskBorderColor=new le.PdfColor(255,85,85),e.taskbar.parentTaskColor=new le.PdfColor(108,117,125),e.taskbar.parentProgressColor=new le.PdfColor(73,80,87),e.taskbar.taskBorderColor=new le.PdfColor(0,86,179),e.taskbar.parentTaskBorderColor=new le.PdfColor(73,80,87),e.taskbar.milestoneColor=new le.PdfColor(73,80,87),e.footer.fontColor=new le.PdfColor(0,0,0),e.footer.fontColor.gray=.2,e.connectorLineColor=new le.PdfColor(0,86,179),e.footer.backgroundColor=new le.PdfColor(255,255,255),e.taskbar.progressFontColor=new le.PdfColor(255,255,255),e.label.fontColor=new le.PdfColor(33,37,41),e.taskbar.splitLineBackground=new le.PdfColor(0,0,0),e.taskbar.unscheduledTaskBarColor=new le.PdfColor(0,123,255),e.taskbar.manualParentBackground=new le.PdfColor(108,117,125),e.taskbar.manualParentProgress=new le.PdfColor(73,80,87),e.taskbar.manualChildBackground=new le.PdfColor(133,83,241),e.taskbar.manualChildProgress=new le.PdfColor(102,40,238),e.taskbar.manualLineColor=new le.PdfColor(152,154,156),e.taskbar.manualParentBorder=new le.PdfColor(73,80,87),e.taskbar.manualChildBorder=new le.PdfColor(102,40,238),e.eventMarker.label.backgroundColor=new le.PdfColor(255,193,7),e.eventMarker.label.fontColor=new le.PdfColor(0,0,0),e.eventMarker.lineStyle=new le.PdfPen(new le.PdfColor(0,123,255)),e.holiday.backgroundColor=new le.PdfColor(233,236,239);break;case"Fabric":e.columnHeader.fontColor=new le.PdfColor(102,102,102),e.cell.fontColor=new le.PdfColor(51,51,51),e.taskbar.taskColor=new le.PdfColor(0,120,214),e.taskbar.progressColor=new le.PdfColor(0,91,163),e.taskbar.criticalTaskColor=new le.PdfColor(255,139,139),e.taskbar.criticalProgressColor=new le.PdfColor(255,85,85),e.taskbar.baselineColor=new le.PdfColor(216,59,1),e.taskbar.baselineBorderColor=new le.PdfColor(216,59,1),e.criticalConnectorLineColor=new le.PdfColor(255,85,85),e.taskbar.criticalTaskBorderColor=new le.PdfColor(255,85,85),e.taskbar.parentTaskColor=new le.PdfColor(118,118,118),e.taskbar.parentProgressColor=new le.PdfColor(80,80,80),e.taskbar.taskBorderColor=new le.PdfColor(0,91,163),e.taskbar.parentTaskBorderColor=new le.PdfColor(80,80,80),e.taskbar.milestoneColor=new le.PdfColor(80,80,80),e.footer.fontColor=new le.PdfColor(51,51,51),e.footer.fontColor.gray=.2,e.connectorLineColor=new le.PdfColor(0,69,122),e.footer.backgroundColor=new le.PdfColor(255,255,255),e.taskbar.progressFontColor=new le.PdfColor(255,255,255),e.label.fontColor=new le.PdfColor(51,51,51),e.taskbar.splitLineBackground=new le.PdfColor(0,0,0),e.taskbar.unscheduledTaskBarColor=new le.PdfColor(0,120,214),e.taskbar.manualParentBackground=new le.PdfColor(118,118,118),e.taskbar.manualParentProgress=new le.PdfColor(80,80,80),e.taskbar.manualChildBackground=new le.PdfColor(154,56,186),e.taskbar.manualChildProgress=new le.PdfColor(109,24,136),e.taskbar.manualLineColor=new le.PdfColor(152,154,156),e.taskbar.manualParentBorder=new le.PdfColor(80,80,80),e.taskbar.manualChildBorder=new le.PdfColor(109,24,136),e.eventMarker.label.backgroundColor=new le.PdfColor(202,232,255),e.eventMarker.label.fontColor=new le.PdfColor(0,90,158),e.eventMarker.lineStyle=new le.PdfPen(new le.PdfColor(0,120,214)),e.holiday.backgroundColor=new le.PdfColor(244,244,244);break;default:e.taskbar.taskColor=new le.PdfColor(88,105,197),e.taskbar.progressColor=new le.PdfColor(63,81,181),e.taskbar.criticalTaskColor=new le.PdfColor(255,139,139),e.taskbar.criticalProgressColor=new le.PdfColor(255,85,85),e.taskbar.baselineColor=new le.PdfColor(193,87,0),e.taskbar.baselineBorderColor=new le.PdfColor(193,87,0),e.criticalConnectorLineColor=new le.PdfColor(255,85,85),e.taskbar.criticalTaskBorderColor=new le.PdfColor(255,85,85),e.taskbar.parentTaskColor=new le.PdfColor(132,132,132),e.taskbar.parentProgressColor=new le.PdfColor(97,97,97),e.taskbar.taskBorderColor=new le.PdfColor(63,81,181),e.taskbar.parentTaskBorderColor=new le.PdfColor(51,51,51),e.taskbar.milestoneColor=new le.PdfColor(97,97,97),e.footer.fontColor=new le.PdfColor(0,0,0),e.footer.fontColor.gray=.2,e.connectorLineColor=new le.PdfColor(63,81,181),e.footer.backgroundColor=new le.PdfColor(255,255,255),e.taskbar.progressFontColor=new le.PdfColor(255,255,255),e.label.fontColor=new le.PdfColor(51,51,51),e.taskbar.splitLineBackground=new le.PdfColor(0,0,0),e.taskbar.unscheduledTaskBarColor=new le.PdfColor(63,81,181),e.taskbar.manualParentBackground=new le.PdfColor(97,97,97),e.taskbar.manualParentProgress=new le.PdfColor(97,97,97),e.taskbar.manualChildBackground=new le.PdfColor(0,135,134),e.taskbar.manualChildProgress=new le.PdfColor(0,135,134),e.taskbar.manualLineColor=new le.PdfColor(152,154,156),e.taskbar.manualParentBorder=new le.PdfColor(97,97,97),e.taskbar.manualChildBorder=new le.PdfColor(0,135,134),e.eventMarker.label.backgroundColor=new le.PdfColor(253,191,100),e.eventMarker.label.fontColor=new le.PdfColor(33,33,33),e.eventMarker.lineStyle=new le.PdfPen(new le.PdfColor(227,22,91)),e.holiday.backgroundColor=new le.PdfColor(238,238,238)}},$n.prototype.initStyles=function(e){e.columnHeader={},e.columnHeader.format=new le.PdfStringFormat,e.cell={},e.cell.format=new le.PdfStringFormat,e.timeline={},e.footer={},e.footer.format=new le.PdfStringFormat,e.label={},e.taskbar={},e.eventMarker={},e.eventMarker.label={},e.eventMarker.lineStyle=new le.PdfPen(null),e.holiday={}};var Jn=$n;function $n(e){this.theme=e,this.ganttStyle={},this.setTheme(this.ganttStyle,this.theme),this.ganttStyle.eventMarker.lineStyle.dashStyle=le.PdfDashStyle.Dash}ta.prototype.size=function(){return this.mKeys.length},ta.prototype.add=function(e,t){if(null==e||null==t)throw new ReferenceError("Provided key or value is not valid.");if(this.mKeys.indexOf(e)<0)return this.mKeys.push(e),this.mValues.push(t),1;throw new RangeError("An item with the same key has already been added.")},ta.prototype.keys=function(){return this.mKeys},ta.prototype.values=function(){return this.mValues},ta.prototype.getValue=function(e){if(null==e)throw new ReferenceError("Provided key is not valid.");e=this.mKeys.indexOf(e);if(e<0)throw new RangeError("No item with the specified key has been added.");return this.mValues[e]},ta.prototype.setValue=function(e,t){if(null==e)throw new ReferenceError("Provided key is not valid.");var i=this.mKeys.indexOf(e);i<0?(this.mKeys.push(e),this.mValues.push(t)):this.mValues[i]=t},ta.prototype.remove=function(e){if(null==e)throw new ReferenceError("Provided key is not valid.");e=this.mKeys.indexOf(e);if(e<0)throw new RangeError("No item with the specified key has been added.");return this.mKeys.splice(e,1),this.mValues.splice(e,1),!0},ta.prototype.containsKey=function(e){if(null==e)throw new ReferenceError("Provided key is not valid.");return!(this.mKeys.indexOf(e)<0)},ta.prototype.clear=function(){this.mKeys=[],this.mValues=[]};var ea=ta;function ta(){this.mKeys=[],this.mValues=[]}Object.defineProperty(na.prototype,"left",{get:function(){return this.leftPen},set:function(e){this.leftPen=e},enumerable:!0,configurable:!0}),Object.defineProperty(na.prototype,"right",{get:function(){return this.rightPen},set:function(e){this.rightPen=e},enumerable:!0,configurable:!0}),Object.defineProperty(na.prototype,"top",{get:function(){return this.topPen},set:function(e){this.topPen=e},enumerable:!0,configurable:!0}),Object.defineProperty(na.prototype,"bottom",{get:function(){return this.bottomPen},set:function(e){this.bottomPen=e},enumerable:!0,configurable:!0}),Object.defineProperty(na.prototype,"all",{set:function(e){this.leftPen=this.rightPen=this.topPen=this.bottomPen=e},enumerable:!0,configurable:!0}),Object.defineProperty(na.prototype,"isAll",{get:function(){return this.leftPen===this.rightPen&&this.leftPen===this.topPen&&this.leftPen===this.bottomPen},enumerable:!0,configurable:!0}),Object.defineProperty(na,"default",{get:function(){return new na},enumerable:!0,configurable:!0});var ia=na;function na(){var e=new le.PdfPen(new le.PdfColor(0,0,0)),t=(e.dashStyle=le.PdfDashStyle.Solid,new le.PdfPen(new le.PdfColor(0,0,0))),i=(t.dashStyle=le.PdfDashStyle.Solid,new le.PdfPen(new le.PdfColor(0,0,0))),n=(i.dashStyle=le.PdfDashStyle.Solid,new le.PdfPen(new le.PdfColor(0,0,0)));n.dashStyle=le.PdfDashStyle.Solid,this.leftPen=e,this.rightPen=t,this.topPen=i,this.bottomPen=n}Object.defineProperty(ra.prototype,"left",{get:function(){return this.leftPad},set:function(e){this.leftPad=e,this.hasLeftPad=!0},enumerable:!0,configurable:!0}),Object.defineProperty(ra.prototype,"right",{get:function(){return this.rightPad},set:function(e){this.rightPad=e,this.hasRightPad=!0},enumerable:!0,configurable:!0}),Object.defineProperty(ra.prototype,"top",{get:function(){return this.topPad},set:function(e){this.topPad=e,this.hasTopPad=!0},enumerable:!0,configurable:!0}),Object.defineProperty(ra.prototype,"bottom",{get:function(){return this.bottomPad},set:function(e){this.bottomPad=e,this.hasBottomPad=!0},enumerable:!0,configurable:!0}),Object.defineProperty(ra.prototype,"all",{set:function(e){this.leftPad=this.rightPad=this.topPad=this.bottomPad=e,this.hasLeftPad=!0,this.hasRightPad=!0,this.hasTopPad=!0,this.hasBottomPad=!0},enumerable:!0,configurable:!0});var aa=ra;function ra(e,t,i,n){this.hasLeftPad=!1,this.hasRightPad=!1,this.hasTopPad=!1,this.hasBottomPad=!1,void 0===e?(this.leftPad=this.rightPad=5.76,this.bottomPad=this.topPad=.5):(this.leftPad=e,this.rightPad=t,this.topPad=i,this.bottomPad=n,this.hasLeftPad=!0,this.hasRightPad=!0,this.hasTopPad=!0,this.hasBottomPad=!0)}function sa(){}var oa,la,da=function(){this.cellSpacing=0,this.borderOverlapStyle=le.PdfBorderOverlapStyle.Overlap,this.allowHorizontalOverflow=!1,this.horizontalOverflowType=k.PdfHorizontalOverflowType.LastPage,this.cellPadding=new aa},ha=(oa=function(e,t){return(oa=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])}))(e,t)},function(e,t){function i(){this.constructor=e}oa(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),pa=(la=le.ElementLayouter,ha(ua,la),Object.defineProperty(ua.prototype,"treegrid",{get:function(){return this.elements},enumerable:!0,configurable:!0}),ua.prototype.layoutInternal=function(e){this.currentPage=e.page;var t=e.format;return null!==this.currentPage&&(this.currentPageBounds=this.currentPage.getClientSize()),this.currentGraphics=this.currentPage.graphics,null!==t&&t.break===le.PdfLayoutBreakType.FitColumnsToPage?this.currentBounds=new le.RectangleF(new le.PointF(e.bounds.x,e.bounds.y),new le.SizeF(this.treegrid.columns.width,this.currentGraphics.clientSize.height)):this.currentBounds=new le.RectangleF(new le.PointF(e.bounds.x,e.bounds.y),this.currentGraphics.clientSize),0!==this.treegrid.rows.count&&(this.currentBounds.width=0<e.bounds.width?e.bounds.width:this.currentBounds.width-this.treegrid.rows.getRow(0).cells.getCell(0).style.borders.left.width/2),this.startLocation=new le.PointF(e.bounds.x,e.bounds.y),0<e.bounds.height&&(this.currentBounds.height=e.bounds.height),this.treegrid.style.allowHorizontalOverflow||this.treegrid.isFitToWidth?(this.treegrid.measureColumnsWidth(this.currentBounds),this.columnRanges.push([0,this.treegrid.columns.count-1])):(this.treegrid.measureColumnsWidth(),this.determineColumnDrawRanges()),this.layoutOnPage(e)},ua.prototype.determineColumnDrawRanges=function(){for(var e=0,t=0,i=0,n=this.treegrid.taskbar.isAutoFit()?he(this.currentGraphics.clientSize.width)-this.currentBounds.x:this.currentGraphics.clientSize.width-this.currentBounds.x,a=0;a<this.treegrid.columns.count;a++)if(n<=(i+=this.treegrid.columns.getColumn(a).width)){for(var r=0,s=e;s<=a&&!(n<(r+=this.treegrid.columns.getColumn(s).width));s++)t=s;this.columnRanges.push([e,t]),e=t+1,t<=a&&(i=this.treegrid.columns.getColumn(a).width)}this.columnRanges.push([e,this.treegrid.columns.count-1])},ua.prototype.getFormat=function(e){return e},ua.prototype.updateCollection=function(e,t,i,n,a,r,s){null!=e&&(e=r,0<t.length&&(e=t[t.length-1].pageNumber),i.push({rowIndex:n,height:a,pageNumber:e+s}))},ua.prototype.layoutOnPage=function(e){for(var t=0,i=0,n=[],a=[],r=this.getFormat(e.format),s=new ea,o=e.page,l=0;l<this.columnRanges.length;l++){for(var d=this.columnRanges[l],h=(this.cellStartIndex=d[0],this.cellEndIndex=d[1],this.treegrid.rows.count),p=0,u=!1,c=0;c<h;c++){var g=this.treegrid.rows.getRow(c),f=(p++,this.currentBounds.y),m=(null===this.currentPage||s.containsKey(this.currentPage)||(n.push({height:t,pageNumber:i}),i++,t=0,s.add(this.currentPage,d)),this.drawRow(g));for(f===this.currentBounds.y?(u=!0,this.repeatRowIndex=this.treegrid.rows.rowCollection.indexOf(g)):(u=!1,this.repeatRowIndex=-1,this.updateCollection(this.currentPage,n,a,c,g.height,i,0));!m.isFinish&&null!==o;)if(this.treegrid.allowRowBreakAcrossPages)this.currentPage=this.getNextPageFormat(r),this.treegrid.enableHeader&&this.drawHeader(),this.checkBounds(r),m=this.drawRow(g),t+=g.height,this.updateCollection(this.currentPage,n,a,c,g.height,i,1);else{if(!this.treegrid.allowRowBreakAcrossPages&&p<length){this.currentPage=this.getNextPageFormat(r),this.treegrid.enableHeader&&this.drawHeader();break}if(p>=length)break}!m.isFinish&&null!==o&&r.layout!==le.PdfLayoutType.OnePage&&u&&(this.startLocation.x=this.currentBounds.x,this.currentPage=this.getNextPageFormat(r),this.treegrid.enableHeader&&this.drawHeader(),this.startLocation.y=this.currentBounds.y,r.paginateBounds===new le.RectangleF(0,0,0,0)?this.currentBounds.x+=this.startLocation.x:(f=this.currentBounds.x,this.currentBounds.x=f),this.currentBounds.x===ia.default.left.width/2&&(this.currentBounds.y+=this.startLocation.x),this.drawRow(g),null===this.currentPage||s.containsKey(this.currentPage)||s.add(this.currentPage,d),this.updateCollection(this.currentPage,n,a,c,g.height,i,0))}this.columnRanges.indexOf(d)<this.columnRanges.length-1&&null!==o&&r.layout!==le.PdfLayoutType.OnePage&&(this.currentPage=this.getNextPageFormat(r),this.checkBounds(r))}e=this.getLayoutResult(),this.treegrid.style.allowHorizontalOverflow&&this.treegrid.style.horizontalOverflowType===k.PdfHorizontalOverflowType.NextPage&&this.reArrangePages(s),n.push({height:t,pageNumber:i});var y={},D=(this.headerHeight=a[0].height,a.forEach(function(e){y[e.pageNumber]||(y[e.pageNumber]=[]),y[e.pageNumber].push(e.height)}),Object.keys(y).map(function(e){e=parseInt(e,10);return{pageNumber:e,totalHeight:y[e].reduce(function(e,t){return e+t},0)}}));return this.pageHeightCollection=D,e},ua.prototype.checkBounds=function(e){var t=new le.PointF(ia.default.right.width/2,ia.default.top.width/2);e.paginateBounds===new le.RectangleF(0,0,0,0)&&this.startLocation===t&&(this.currentBounds.x+=this.startLocation.x,this.currentBounds.y+=this.startLocation.y)},ua.prototype.drawHeader=function(){this.drawRow(this.treegrid.rows.getRow(0))},ua.prototype.reArrangePages=function(e){for(var t=this.currentPage.document,i=[],n=e.keys(),a=0;a<n.length;a++)(o=n[a]).section=null,i.push(o),t.pages.remove(o);for(a=0;a<e.size();a++)for(var r=e.size()/this.columnRanges.length,s=a;s<e.size();s+=r){var o=i[s];-1===t.pages.indexOf(o)&&t.pages.add(o)}},ua.prototype.getNextPageFormat=function(e){var t=this.currentPage.section,i=null,n=t.indexOf(this.currentPage),i=n===t.count-1?t.add():t.getPages()[n+1];return this.currentGraphics=i.graphics,this.currentBounds=new le.RectangleF(new le.PointF(0,0),i.getClientSize()),i},ua.prototype.getLayoutResult=function(){var e=new le.RectangleF(this.startLocation,new le.SizeF(this.currentBounds.width,this.currentBounds.y-this.startLocation.y));return new ga(this.currentPage,e)},ua.prototype.checkIfDefaultFormat=function(e){var t=new le.PdfStringFormat;return e.alignment===t.alignment&&e.characterSpacing===t.characterSpacing&&e.clipPath===t.clipPath&&e.firstLineIndent===t.firstLineIndent&&e.horizontalScalingFactor===t.horizontalScalingFactor&&e.lineAlignment===t.lineAlignment&&e.lineLimit===t.lineLimit&&e.lineSpacing===t.lineSpacing&&e.measureTrailingSpaces===t.measureTrailingSpaces&&e.noClip===t.noClip&&e.paragraphIndent===t.paragraphIndent&&e.rightToLeft===t.rightToLeft&&e.subSuperScript===t.subSuperScript&&e.wordSpacing===t.wordSpacing&&e.wordWrap===t.wordWrap},ua.prototype.drawRow=function(e,t,i){var n;if(oe.isNullOrUndefined(t))return n=new le.RowLayoutResult,(i=0<e.rowBreakHeight?e.rowBreakHeight:e.height)>this.currentPageBounds.height?this.treegrid.allowRowBreakAcrossPages?(n.isFinish=!0,this.drawRowWithBreak(n,e,i)):(n.isFinish=!1,this.drawRow(e,n,i)):this.currentBounds.y+i>this.currentPageBounds.height||this.currentBounds.y+i>this.currentBounds.height?-1<this.repeatRowIndex&&this.repeatRowIndex===e.rowIndex?this.treegrid.allowRowBreakAcrossPages?(n.isFinish=!0,this.drawRowWithBreak(n,e,i)):(n.isFinish=!1,this.drawRow(e,n,i)):n.isFinish=!1:(n.isFinish=!0,this.drawRow(e,n,i)),n;var a=new le.PointF(this.currentBounds.x,this.currentBounds.y),r=(t.bounds=new le.RectangleF(a,new le.SizeF(0,0)),0);i=this.reCalculateHeight(e,i);for(var s=this.cellStartIndex;s<=this.cellEndIndex;s++){var o=e.cells.getCell(s),l=this.treegrid.columns.getColumn(s);if(!oe.isNullOrUndefined(o.value)){l.isTreeColumn&&(r=10*e.level);var d=1<o.columnSpan&&s>this.cellEndIndex+1;if(!d)for(var h=1;h<o.columnSpan;h++)e.cells.getCell(s+h).isCellMergeContinue=!0;var p=new le.SizeF(l.width,i);1<o.columnSpan&&(p=new le.SizeF(o.width,i),s+=o.columnSpan),!this.checkIfDefaultFormat(l.format)&&this.checkIfDefaultFormat(o.style.format)&&(o.style.format=l.format),o.draw(this.currentGraphics,new le.RectangleF(a,p),d,r),e.treegrid.style.allowHorizontalOverflow&&(o.columnSpan>this.cellEndIndex||s+o.columnSpan>this.cellEndIndex+1)&&this.cellEndIndex<e.cells.count-1&&(e.rowOverflowIndex=this.cellEndIndex),a.x+=l.width,r=0}}return this.currentBounds.y+=i,t.bounds=new le.RectangleF(new le.PointF(t.bounds.x,t.bounds.y),new le.SizeF(a.x,a.y)),null},ua.prototype.drawRowWithBreak=function(e,t,i){var n=new le.PointF(this.currentBounds.x,this.currentBounds.y),a=(e.bounds=new le.RectangleF(n,new le.SizeF(0,0)),0);this.treegridHeight=this.currentBounds.height,t.rowBreakHeight=this.currentBounds.y+i-this.currentBounds.height;for(var r=0;r<t.cells.count;r++)(l=t.cells.getCell(r)).measureHeight()===i&&null===l.value&&(t.rowBreakHeight=this.currentBounds.y+i-this.currentBounds.height);for(var s=this.cellStartIndex;s<=this.cellEndIndex;s++){var o=this.treegrid.columns.getColumn(s);o.isTreeColumn&&(a=10*t.level);var l,d=(l=t.cells.getCell(s)).columnSpan+s>this.cellEndIndex+1&&1<l.columnSpan;if(!d)for(var h=1;h<l.columnSpan;h++)t.cells.getCell(s+h).isCellMergeContinue=!0;var p=0<this.treegridHeight?this.treegridHeight:this.currentBounds.height,p=new le.SizeF(o.width,p);!this.checkIfDefaultFormat(o.format)&&this.checkIfDefaultFormat(l.style.format)&&(l.style.format=o.format),l.draw(this.currentGraphics,new le.RectangleF(n,p),d,a),e.isFinish=e.isFinish&&l.finishedDrawingCell,n.x+=o.width,this.currentBounds.y+=(a=0)<this.treegridHeight?this.treegridHeight:i,e.bounds=new le.RectangleF(new le.PointF(e.bounds.x,e.bounds.y),new le.SizeF(n.x,n.y))}},ua.prototype.reCalculateHeight=function(e,t){for(var i=0,n=this.cellStartIndex;n<=this.cellEndIndex;n++)oe.isNullOrUndefined(e.cells.getCell(n).remainingString)&&""!==e.cells.getCell(n).remainingString||(i=Math.max(i,e.cells.getCell(n).measureHeight()));return Math.max(t,i)},ua);function ua(e){e=la.call(this,e)||this;return e.columnRanges=[],e.repeatRowIndex=-1,e.pageHeightCollection=[],e.headerHeight=0,e.currentBounds=new le.RectangleF(0,0,0,0),e}ca=le.PdfLayoutResult,ha(fa,ca);var ca,ga=fa;function fa(e,t){return ca.call(this,e,t)||this}ma=le.PdfLayoutFormat,ha(Da,ma);var ma,ya=Da;function Da(e){return void 0===e?ma.call(this)||this:ma.call(this,e)||this}ka=function(e,t){return(ka=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])}))(e,t)};var ka,wa,ha=function(e,t){function i(){this.constructor=e}ka(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},ba=(wa=le.PdfLayoutElement,ha(Ta,wa),Object.defineProperty(Ta.prototype,"size",{get:function(){return 0===this.treeGridSize.width&&0===this.treeGridSize.height&&(this.treeGridSize=this.calculateTreeGridSize()),this.treeGridSize},set:function(e){this.treeGridSize=e},enumerable:!0,configurable:!0}),Ta.prototype.draw=function(e,t,i,n){var a;return t instanceof le.PointF&&void 0===t.width&&void 0===i?this.drawHelper(e,t.x,t.y):"number"==typeof t&&"number"==typeof i&&void 0===n?this.drawHelper(e,t,i,null):t instanceof le.RectangleF&&void 0!==t.width&&void 0===i?this.drawHelper(e,t,null):t instanceof le.PointF&&void 0===t.width&&i instanceof le.PdfLayoutFormat?this.drawHelper(e,t.x,t.y,i):"number"==typeof t&&"number"==typeof i&&(n instanceof le.PdfLayoutFormat||null===n)?(a=e.graphics.clientSize.width-t,a=new le.RectangleF(t,i,a,0),this.drawHelper(e,a,n)):t instanceof le.RectangleF&&void 0!==t.width&&"boolean"==typeof i?this.drawHelper(e,t,null):this.drawHelper(e,t,i)},Ta.prototype.measureColumnsWidth=function(e){if(void 0!==e)for(var t=this.columns.getDefaultWidths(e.width-e.x),i=0;i<this.columns.count;i++)this.columns.getColumn(i).width<0&&(this.columns.getColumn(i).width=t[i]);else{for(var t=[],n=0,a=0,r=this.columns.count,i=0;i<r;i++){for(var s=this.rows.count,o=0;o<s;o++){var l=this.rows.getRow(o).cells.getCell(i).width,l=0<this.initialWidth?Math.min(this.initialWidth,l):l,n=Math.max(n,l);n=Math.max(this.columns.getColumn(i).width,n),this.columns.getColumn(i).isTreeColumn&&(a=Math.max(a,this.rows.getRow(o).level))}this.columns.getColumn(i).isTreeColumn?t.push(n+10*a):t.push(n),n=0}for(i=0;i<this.columns.count;i++)this.columns.getColumn(i).width<0&&(this.columns.getColumn(i).width=t[i])}},Ta.prototype.calculateTreeGridSize=function(){for(var e=0,t=this.columns.width,i=0;i<this.headers.count;i++)e+=this.headers.getHeader(i).height;for(i=0;i<this.rows.count;i++)e+=this.rows.getRow(i).height;return new le.SizeF(t,e)},Ta.prototype.drawGrid=function(e,t,i,n){this.initialWidth=e.graphics.clientSize.width;var a=new le.RectangleF(0,0,e.getClientSize().height,0);return this.draw(e,a,n)},Ta.prototype.layout=function(e){var t,i;return 0!==this.rows.count&&(t=0!==this.rows.getRow(0).cells.count?this.rows.getRow(0).cells.getCell(0).style:null,oe.isNullOrUndefined(t)||1===t.borders.left.width||(i=t.borders.left.width/2,t=t.borders.top.width/2,e.bounds.x===ia.default.right.width/2&&e.bounds.y===ia.default.right.width/2&&(i=new le.RectangleF(new le.PointF(i,t),new le.SizeF(this.size.width,this.size.height)),e.bounds=i))),this.layouter=new pa(this),this.layouter.layoutInternal(e)},Ta);function Ta(){var e=wa.call(this)||this;return e.treeGridSize=new le.SizeF(0,0),e.treeColumnIndex=0,e.allowRowBreakAcrossPages=!0,e.enableHeader=!0,e.isFitToWidth=!1,e.columns=new Na(e),e.rows=new xa(e),e.headers=new Ia(e),e.style=new da,e.rowHeight=0,e}Object.defineProperty(Pa.prototype,"height",{get:function(){return 0===this.cellHeight&&(this.cellHeight=this.measureHeight()),this.cellHeight},set:function(e){this.cellHeight=e},enumerable:!0,configurable:!0}),Object.defineProperty(Pa.prototype,"width",{get:function(){return 0===this.cellWidth&&(this.cellWidth=this.measureWidth()),Math.round(this.cellWidth)},set:function(e){this.cellWidth=e},enumerable:!0,configurable:!0}),Pa.prototype.measureWidth=function(){var e,t=0,i=new le.PdfStringLayouter;return"string"==typeof this.value&&(e=new le.PdfStandardFont(this.row.treegrid.ganttStyle.fontFamily,this.style.fontSize,this.style.fontStyle),e=this.row.isParentRow?new le.PdfStandardFont(this.row.treegrid.ganttStyle.fontFamily,this.style.fontSize,le.PdfFontStyle.Bold):new le.PdfStandardFont(this.row.treegrid.ganttStyle.fontFamily,this.style.fontSize,this.style.fontStyle),this.row.treegrid.ganttStyle.font&&(e=this.row.treegrid.ganttStyle.font),t=(t+=i.layout(this.value,e,this.style.format,new le.SizeF(Number.MAX_VALUE,Number.MAX_VALUE),!1,new le.SizeF(0,0)).actualSize.width)+2*(this.style.borders.left.width+this.style.borders.right.width)),void 0!==this.row.treegrid.style.cellPadding.left&&this.row.treegrid.style.cellPadding.hasLeftPad&&(t+=this.row.treegrid.style.cellPadding.left),void 0!==this.row.treegrid.style.cellPadding.right&&this.row.treegrid.style.cellPadding.hasRightPad&&(t+=this.row.treegrid.style.cellPadding.right),t+=this.row.treegrid.style.cellSpacing},Pa.prototype.measureHeight=function(){var e,t,i=this.row.treegrid.rowHeight,n=0,a=this.calculateWidth(),r=(a=(a-=this.row.treegrid.style.cellPadding.right+this.row.treegrid.style.cellPadding.left)-(this.style.borders?this.style.borders.left.width+this.style.borders.right.width:0),new le.PdfStringLayouter);return"string"!=typeof this.value&&"string"!=typeof this.remainingString||(e=this.value,this.finishedDrawingCell||(e=oe.isNullOrUndefined(this.remainingString)||""===this.remainingString?this.value:this.remainingString),t=null,t=this.row.isParentRow?new le.PdfStandardFont(this.row.treegrid.ganttStyle.fontFamily,this.style.fontSize,le.PdfFontStyle.Bold):new le.PdfStandardFont(this.row.treegrid.ganttStyle.fontFamily,this.style.fontSize,this.style.fontStyle),this.row.treegrid.ganttStyle.font&&(t=this.row.treegrid.ganttStyle.font),r=r.layout(e,t,this.style.format,new le.SizeF(a-10,0),!1,new le.SizeF(0,0)),t=Math.max(r.lineHeight,r.actualSize.height),80<e.length?n+=t+20:n+=t+r.size.height/2,n+=2*(this.style.borders.top.width+this.style.borders.bottom.width)),i<(n=(n+=this.row.treegrid.style.cellPadding.top+this.row.treegrid.style.cellPadding.bottom)+this.row.treegrid.style.cellSpacing)?n:i},Pa.prototype.calculateWidth=function(){for(var e=this.row.cells.indexOf(this),t=this.columnSpan,i=0,n=0;n<t;n++)i+=this.row.treegrid.columns.getColumn(e+n)?this.row.treegrid.columns.getColumn(e+n).width:0;return this.row.treegrid.columns.getColumn(e)&&this.row.treegrid.columns.getColumn(e).isTreeColumn&&(i-=10*this.row.level),i},Pa.prototype.draw=function(e,t,i,n){var a,r,s,o,l,d=null,h=(this.drawCellBackground(e,t),new le.PdfSolidBrush(this.style.fontColor)),p=null,p=this.row.isParentRow?(u=le.PdfFontStyle.Bold,this.style.fontStyle&&(u=this.style.fontStyle),new le.PdfStandardFont(this.row.treegrid.ganttStyle.fontFamily,this.style.fontSize,u)):new le.PdfStandardFont(this.row.treegrid.ganttStyle.fontFamily,this.style.fontSize,this.style.fontStyle),u=(this.row.treegrid.ganttStyle.font&&(p=this.row.treegrid.ganttStyle.font),t);return this.isHeaderCell||(u.x=u.x,u.width=u.width),u.height>=e.clientSize.height&&(this.row.treegrid.allowRowBreakAcrossPages?(u.height-=u.y,t.height-=t.y):(u.height=e.clientSize.height,t.height=e.clientSize.height)),u=this.adjustContentLayoutArea(u),this.image&&this.value?(l=void 0,l=this.image.width<=u.width?new le.RectangleF(u.x+n,u.y,this.image.width,this.image.height):u,e.drawImage(this.image,l.x+n,l.y-5,l.width,l.height),a=null,r=void 0,o=(o=this.fontStyle)||this.style,s=new le.PdfStandardFont(o.fontFamily,o.fontSize,o.fontStyle),r=o.fontFamily?s:p,o=h,this.row.treegrid.ganttStyle.cell.fontBrush&&(o=new le.PdfSolidBrush(this.row.treegrid.ganttStyle.cell.fontBrush)),this.row.treegrid.ganttStyle.cell.format.alignment&&!this.isHeaderCell&&(this.style.format.alignment=this.row.treegrid.ganttStyle.cell.format.alignment),this.finishedDrawingCell?(a=""===this.remainingString?this.remainingString:this.value,e.drawString(a,r,null,o,u.x+n+(l.width?l.width+8:0),this.isHeaderCell?u.y-16:u.y,u.width-n-10,u.height-10,this.style.format)):e.drawString(this.remainingString,r,null,o,u.x+n,this.isHeaderCell?u.y-16:u.y,this.style.format),d=e.stringLayoutResult):"string"==typeof this.value||"string"==typeof this.remainingString?(a=null,r=void 0,s=new le.PdfStandardFont(this.style.fontFamily,this.style.fontSize,this.style.fontStyle),r=this.style.fontFamily?s:p,o=h,this.row.treegrid.ganttStyle.cell.fontBrush&&(o=new le.PdfSolidBrush(this.row.treegrid.ganttStyle.cell.fontBrush)),this.row.treegrid.ganttStyle.cell.format.alignment&&!this.isHeaderCell&&(this.style.format.alignment=this.row.treegrid.ganttStyle.cell.format.alignment),this.finishedDrawingCell?(a=""===this.remainingString?this.remainingString:this.value,e.drawString(a,r,null,o,u.x+n,this.isHeaderCell?u.y-16:u.y-3,u.width-n-10,u.height-10,this.style.format)):e.drawString(this.remainingString,r,null,o,u.x+n,this.isHeaderCell?u.y-16:u.y,this.style.format),d=e.stringLayoutResult):this.value instanceof le.PdfImage||this.value instanceof le.PdfBitmap?(l=void 0,l=this.value.width<=u.width?new le.RectangleF(u.x,u.y,this.value.width,u.height):u,e.drawImage(this.value,l.x,l.y-10,l.width,l.height)):this.value instanceof le.PdfTextWebLink&&this.value.draw(e.currentPage,u),null!==this.style.borders&&this.drawCellBorder(e,t),d},Pa.prototype.drawCellBackground=function(e,t){var i=new le.PdfSolidBrush(this.style.backgroundColor);null!==i&&(e.save(),e.drawRectangle(i,t.x,t.y,t.width,t.height),e.restore())},Pa.prototype.adjustContentLayoutArea=function(e){var t,e=new le.RectangleF(new le.PointF(e.x,e.y),new le.SizeF(e.width,e.height)),i=this.style.padding;return this.value instanceof ba?(t=this.value.size,this.style.format.alignment===le.PdfTextAlignment.Center?(e.x+=i.left+(e.width-t.width)/2,e.y+=i.top+(e.height-t.height)/2):this.style.format.alignment===le.PdfTextAlignment.Left?(e.x+=i.left,e.y+=i.top):this.style.format.alignment===le.PdfTextAlignment.Right&&(e.x+=i.left+(e.width-t.width),e.y+=i.top)):(e.x+=i.left,e.y+=i.top),e},Pa.prototype.drawCellBorder=function(e,t){var i,n,a;this.row.treegrid.style.borderOverlapStyle===le.PdfBorderOverlapStyle.Inside&&(t.x+=this.style.borders.left.width,t.y+=this.style.borders.top.width,t.width-=this.style.borders.right.width,t.height-=this.style.borders.bottom.width),this.style.borders.isAll&&this.isHeaderCell?e.drawRectangle(this.style.borders.left,t.x,t.y,t.width,t.height):(i=new le.PointF(t.x,t.y+t.height),n=new le.PointF(t.x,t.y),(a=this.style.borders.left).lineCap=this.style.borders.left.dashStyle===le.PdfDashStyle.Solid?le.PdfLineCap.Square:a.lineCap,e.drawLine(a,i,n),e.restore(),i=new le.PointF(t.x+t.width,t.y),n=new le.PointF(t.x+t.width,t.y+t.height),a=this.style.borders.right,t.x+t.width>e.clientSize.width-a.width/2&&(i=new le.PointF(e.clientSize.width-a.width/2,t.y),n=new le.PointF(e.clientSize.width-a.width/2,t.y+t.height)),a.lineCap=this.style.borders.right.dashStyle===le.PdfDashStyle.Solid?le.PdfLineCap.Square:a.lineCap,e.drawLine(a,i,n),e.restore(),i=new le.PointF(t.x,t.y),n=new le.PointF(t.x+t.width,t.y),(a=this.style.borders.top).lineCap=this.style.borders.top.dashStyle===le.PdfDashStyle.Solid?le.PdfLineCap.Square:a.lineCap,e.drawLine(a,i,n),e.restore(),i=new le.PointF(t.x+t.width,t.y+t.height),n=new le.PointF(t.x,t.y+t.height),a=this.style.borders.bottom,t.y+t.height>e.clientSize.height-a.width/2&&(i=new le.PointF(t.x+t.width,e.clientSize.height-a.width/2),n=new le.PointF(t.x,e.clientSize.height-a.width/2)),a.lineCap=this.style.borders.bottom.dashStyle===le.PdfDashStyle.Solid?le.PdfLineCap.Square:a.lineCap,e.drawLine(a,i,n)),e.restore()};var va=Pa;function Pa(e){this.cellWidth=0,this.cellHeight=0,this.finishedDrawingCell=!0,oe.isNullOrUndefined(e)?(this.rowSpan=1,this.columnSpan=1):this.row=e,this.style={}}Ca.prototype.getCell=function(e){if(e<0||e>=this.count)throw new Error("IndexOutOfRangeException");return this.cells[e]},Object.defineProperty(Ca.prototype,"count",{get:function(){return this.cells.length},enumerable:!0,configurable:!0}),Ca.prototype.add=function(e){var t;if(void 0===e)return t=new va,this.add(t),e;e.row=this.treegridRow,this.cells.push(e)},Ca.prototype.indexOf=function(e){return this.cells.indexOf(e)};var Sa=Ca;function Ca(e){this.treegridRow=e,this.cells=[]}Object.defineProperty(Ma.prototype,"cells",{get:function(){return oe.isNullOrUndefined(this.treegridCells)&&(this.treegridCells=new Sa(this)),this.treegridCells},enumerable:!0,configurable:!0}),Object.defineProperty(Ma.prototype,"isParentRow",{get:function(){return this._isParentRow},set:function(e){this._isParentRow=e},enumerable:!0,configurable:!0}),Object.defineProperty(Ma.prototype,"treegrid",{get:function(){return this.pdfTreeGrid},set:function(e){this.pdfTreeGrid=e},enumerable:!0,configurable:!0}),Object.defineProperty(Ma.prototype,"rowBreakHeight",{get:function(){return void 0===this.treegridRowBreakHeight&&(this.treegridRowBreakHeight=0),this.treegridRowBreakHeight},set:function(e){this.treegridRowBreakHeight=e},enumerable:!0,configurable:!0}),Object.defineProperty(Ma.prototype,"rowOverflowIndex",{get:function(){return this.treegridRowOverflowIndex},set:function(e){this.treegridRowOverflowIndex=e},enumerable:!0,configurable:!0}),Object.defineProperty(Ma.prototype,"level",{get:function(){return this.intendLevel},set:function(e){this.intendLevel=e},enumerable:!0,configurable:!0}),Object.defineProperty(Ma.prototype,"height",{get:function(){return 0===this.rowHeight&&(this.rowHeight=this.measureHeight()),this.rowHeight},set:function(e){this.rowHeight=e},enumerable:!0,configurable:!0}),Object.defineProperty(Ma.prototype,"width",{get:function(){return 0===this.rowWidth&&(this.rowWidth=this.measureWidth()),this.rowWidth},enumerable:!0,configurable:!0}),Object.defineProperty(Ma.prototype,"rowIndex",{get:function(){return this.treegrid.rows.rowCollection.indexOf(this)},enumerable:!0,configurable:!0}),Ma.prototype.measureWidth=function(){for(var e=this.treegrid.columns.columns,t=0,i=0;i<e.length;i++)t+=e[i].width;return t},Ma.prototype.measureHeight=function(){for(var e=0===this.cells.count||oe.isNullOrUndefined(this.cells.getCell(0).height)?33:this.cells.getCell(0).height,t=0;t<this.cells.count;t++){var i=this.cells.getCell(t),e=1===i.columnSpan||1===i.rowSpan?Math.max(e,i.height):Math.min(e,i.height);i.height=e}return e};var Ra=Ma;function Ma(e){this.treegridRowOverflowIndex=0,this.rowHeight=0,this.rowWidth=0,this._isParentRow=!1,this.intendLevel=0,this.pdfTreeGrid=e}Object.defineProperty(Oa.prototype,"count",{get:function(){return this.rows.length},enumerable:!0,configurable:!0}),Object.defineProperty(Oa.prototype,"rowCollection",{get:function(){return this.rows},enumerable:!0,configurable:!0}),Oa.prototype.addRow=function(e){var t;if(void 0===e)return t=new Ra(this.treegrid),this.addRow(t),t;if(0===e.cells.count)for(var i=0;i<this.treegrid.columns.count;i++)e.cells.add(new va);this.rows.push(e)},Oa.prototype.getRow=function(e){return this.rows[e]};var xa=Oa;function Oa(e){this.rows=[],this.treegrid=e}Ea.prototype.getHeader=function(e){return this.rows[e]},Object.defineProperty(Ea.prototype,"count",{get:function(){return this.rows.length},enumerable:!0,configurable:!0}),Ea.prototype.add=function(e){this.rows.push(e)},Ea.prototype.indexOf=function(e){return this.rows.indexOf(e)};var Ia=Ea;function Ea(e){this.rows=[],this.treegrid=e,this.rows=[]}Object.defineProperty(Fa.prototype,"headerText",{get:function(){return this._headerText},set:function(e){this._headerText=e},enumerable:!0,configurable:!0}),Object.defineProperty(Fa.prototype,"field",{get:function(){return this._field},set:function(e){this._field=e},enumerable:!0,configurable:!0}),Object.defineProperty(Fa.prototype,"width",{get:function(){return this.columnWidth},set:function(e){this.columnWidth=e},enumerable:!0,configurable:!0}),Object.defineProperty(Fa.prototype,"isTreeColumn",{get:function(){return this.treeColumnIndex},set:function(e){this.treeColumnIndex=e},enumerable:!0,configurable:!0}),Object.defineProperty(Fa.prototype,"format",{get:function(){return oe.isNullOrUndefined(this.stringFormat)&&(this.stringFormat=new le.PdfStringFormat),this.stringFormat},set:function(e){this.stringFormat=e},enumerable:!0,configurable:!0});var Ua=Fa;function Fa(e){this.columnWidth=0,this.treeColumnIndex=!1,this._headerText="",this._field="",this.treegrid=e}La.prototype.add=function(e){for(var t=0;t<e;t++){this.internalColumns.push(new Ua(this.treegrid));for(var i=0;i<this.treegrid.rows.count;i++){var n=this.treegrid.rows.getRow(i),a=new va;a.value="",n.cells.add(a)}}},Object.defineProperty(La.prototype,"count",{get:function(){return this.internalColumns.length},enumerable:!0,configurable:!0}),Object.defineProperty(La.prototype,"width",{get:function(){return 0===this.columnWidth&&(this.columnWidth=this.measureColumnsWidth()),this.columnWidth},enumerable:!0,configurable:!0}),Object.defineProperty(La.prototype,"columns",{get:function(){return this.internalColumns},enumerable:!0,configurable:!0}),La.prototype.getColumn=function(e){if(0<=e&&e<=this.columns.length)return this.columns[e];throw Error("can not get the column from the index: "+e)},La.prototype.measureColumnsWidth=function(){var e=0;this.treegrid.measureColumnsWidth();for(var t=0,i=this.internalColumns.length;t<i;t++)e+=this.internalColumns[t].width;return e},La.prototype.getDefaultWidths=function(e){for(var t=[],i=this.count,n=0;n<this.count;n++)t[n]=this.internalColumns[n].width,0<this.internalColumns[n].width?(e-=this.internalColumns[n].width,i--):t[n]=0;for(n=0;n<this.count;n++)t[n]<=0&&(t[n]=e/i);return t};var Na=La;function La(e){this.internalColumns=[],this.columnWidth=0,this.treegrid=e,this.internalColumns=[]}var Va=function(){return(Va=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var a in t=arguments[i])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},Ba=(E.prototype.processToFit=function(){this.beforeSinglePageExport.zoomingProjectStartDate=this.parent.zoomingProjectStartDate,this.beforeSinglePageExport.zoomingProjectEndDate=this.parent.zoomingProjectEndDate,this.beforeSinglePageExport.cloneProjectStartDate=this.parent.cloneProjectStartDate,this.beforeSinglePageExport.cloneProjectEndDate=this.parent.cloneProjectEndDate,this.beforeSinglePageExport.customTimelineSettings=oe.extend({},this.parent.timelineModule.customTimelineSettings,null,!0),this.beforeSinglePageExport.isTimelineRoundOff=this.parent.isTimelineRoundOff,this.beforeSinglePageExport.topTier=this.parent.timelineModule.topTier,this.beforeSinglePageExport.topTierCellWidth=this.parent.timelineModule.topTierCellWidth,this.beforeSinglePageExport.topTierCollection=this.parent.timelineModule.topTierCollection,this.beforeSinglePageExport.bottomTier=this.parent.timelineModule.bottomTier,this.beforeSinglePageExport.bottomTierCellWidth=this.parent.timelineModule.bottomTierCellWidth,this.beforeSinglePageExport.bottomTierCollection=this.parent.timelineModule.bottomTierCollection,this.beforeSinglePageExport.totalTimelineWidth=this.parent.timelineModule.totalTimelineWidth,this.beforeSinglePageExport.timelineStartDate=this.parent.timelineModule.timelineStartDate,this.beforeSinglePageExport.timelineEndDate=this.parent.timelineModule.timelineEndDate,this.beforeSinglePageExport.timelineRoundOffEndDate=this.parent.timelineModule.timelineRoundOffEndDate,this.beforeSinglePageExport.perDayWidth=this.parent.perDayWidth,this.beforeSinglePageExport.updatedConnectorLineCollection=oe.extend([],this.parent.updatedConnectorLineCollection,null,!0),this.parent.timelineModule.isZoomToFit=!0,this.parent.timelineModule.isZooming=!1,this.parent.zoomingProjectStartDate||(this.parent.zoomingProjectStartDate=this.parent.cloneProjectStartDate,this.parent.zoomingProjectEndDate=this.parent.cloneProjectEndDate),this.parent.zoomingProjectStartDate>this.parent.cloneProjectStartDate&&(this.parent.cloneProjectStartDate=new Date(this.parent.allowUnscheduledTasks?this.parent.zoomingProjectStartDate:this.parent.cloneProjectStartDate)),this.parent.dataOperation.calculateProjectDates();var e,t,i,n=(this.parent.cloneProjectEndDate.getTime()-this.parent.cloneProjectStartDate.getTime())/864e5,a=(this.exportProps.fitToWidthSettings.gridWidth&&(a=parseInt(this.exportProps.fitToWidthSettings.gridWidth.split("%")[0],10)),this.exportProps.fitToWidthSettings.chartWidth?parseInt(this.exportProps.fitToWidthSettings.chartWidth.split("%")[0],10):this.exportProps.fitToWidthSettings.gridWidth?100-a:70),a=this.parent.pdfExportModule.pdfPageDimensions.width*a/100,r=a/n,s=this.parent.zoomingLevels.slice().sort(function(e,t){return e.perDayWidth||t.perDayWidth?e.perDayWidth<t.perDayWidth?1:-1:0});if(0!=r){for(var o=0;o<s.length;o++){if(t=s[o],o===s.length-1){e=s[o];break}if(i=s[o+1],r>=t.perDayWidth){e=s[o];break}if(r<t.perDayWidth&&r>i.perDayWidth){e=s[o+1];break}}var n=oe.extend({},{},e,!0),l=(this.parent.timelineModule.roundOffDateToZoom(this.parent.cloneProjectStartDate,!0,r,n.bottomTier.unit,e),this.parent.timelineModule.roundOffDateToZoom(this.parent.cloneProjectEndDate,!1,r,n.bottomTier.unit,e),this.parent.timelineModule.calculateNumberOfTimelineCells(n)),d=this.parent.pdfExportModule.pdfPageDimensions.height;n.timelineUnitSize=Math.abs(a-(d<=0?0:17))/l,this.parent.timelineModule.changeTimelineSettings(n),this.parent.timelineModule.isZoomToFit=!1,this.parent.timelineModule.isZooming=!1}},E.prototype.processGridExport=function(e,t,i){this.flatData=e,this.gantt=t,this.exportValueFormatter=new Aa(this.parent.locale),this.exportProps=i,this.rowIndex=0,this.colIndex=0,this.columns=this.parent.treeGrid.columns,this.gantt.treeColumnIndex=this.parent.treeColumnIndex,this.gantt.rowHeight=de(this.parent.rowHeight),this.gantt.style.cellPadding.left=0,this.gantt.style.cellPadding.right=0,this.ganttStyle=this.gantt.ganttStyle,this.gantt.borderColor=this.ganttStyle.chartGridLineColor,this.parent.pdfExportModule.isPdfExport=!0,this.exportProps.fitToWidthSettings&&this.exportProps.fitToWidthSettings.isFitToWidth&&this.processToFit(),this.processHeaderContent(),this.processGanttContent(),this.processTimeline(),this.processTaskbar(),this.processPredecessor(),this.parent.pdfExportModule.isPdfExport=!1},E.prototype.processHeaderContent=function(){var t=this,i=(this.rowIndex++,this.row=this.gantt.rows.addRow(),0);this.columns.forEach(function(e){t.isColumnVisible(e)&&(t.processColumnHeader(e,i),i++)})},E.prototype.processColumnHeader=function(e,t){this.gantt.columns.add(1);var i=this.gantt.columns.getColumn(t),n=(this.columns[this.parent.treeColumnIndex].field===e.field&&(i.isTreeColumn=!0),parseInt(e.width,10)),n=(i.width=de(n),this.totalColumnWidth+=i.width,i.headerText=e.headerText,i.field=e.field,this.row.cells.getCell(t)),i=(n.value=e.headerText,n.isHeaderCell=!0,this.ganttStyle&&this.ganttStyle.columnHeader&&!oe.isNullOrUndefined(this.ganttStyle.columnHeader.fontBrush)&&(n.style.fontBrush=new le.PdfColor(this.ganttStyle.columnHeader.fontBrush)),this.parent.timelineModule.isSingleTier?45:60),t=(this.copyStyles(this.ganttStyle.columnHeader,n,!1),this.row.height=de(i),e.headerTextAlign&&(n.style.format.alignment=le.PdfTextAlignment[e.headerTextAlign]),n.fontStyle={fontSize:9},{cell:n,style:n.style,value:n.value,column:e,image:null,headerTemplate:{image:null,value:null,fontStyle:{fontBrush:null}}});this.parent.pdfColumnHeaderQueryCellInfo&&this.parent.trigger("pdfColumnHeaderQueryCellInfo",t),t.headerTemplate.image&&t.headerTemplate.value?(t.image=new le.PdfBitmap(t.headerTemplate.image[0].base64),t.image.height=t.headerTemplate.image[0].height||t.image.height,t.image.width=t.headerTemplate.image[0].width||t.image.width,n.image=t.image,n.value=t.headerTemplate.value,n.fontStyle.fontSize=t.headerTemplate.fontStyle.fontSize,n.fontStyle.fontFamily=t.headerTemplate.fontStyle.fontFamily,n.fontStyle.fontBrush=t.headerTemplate.fontStyle.fontColor):n.value=t.value},E.prototype.isColumnVisible=function(e){return e.visible||this.exportProps.includeHiddenColumn},E.prototype.processGanttContent=function(){var t=this;0===this.flatData.length?this.renderEmptyGantt():this.flatData.forEach(function(e){t.row=t.gantt.rows.addRow(),e.hasChildRecords&&(t.gantt.rows.getRow(t.rowIndex).isParentRow=!0),t.processRecordRow(e),t.rowIndex++})},E.prototype.processTimeline=function(){this.parent.enableTimelineVirtualization&&(this.parent.timelineModule.pdfExportTopTierCollection=[],this.parent.timelineModule.pdfExportBottomTierCollection=[],this.parent.timelineModule.createTimelineSeries());var e,t=this.parent.timelineModule;this.gantt.chartHeader.topTierHeight=this.gantt.chartHeader.bottomTierHeight=this.parent.timelineModule.isSingleTier?45:30,this.gantt.chartHeader.topTierCellWidth=t.topTierCellWidth,this.gantt.chartHeader.bottomTierCellWidth=t.bottomTierCellWidth,this.gantt.chartHeader.topTier=oe.extend([],[],this.parent.enableTimelineVirtualization?t.pdfExportTopTierCollection:t.topTierCollection,!0),this.gantt.chartHeader.bottomTier=oe.extend([],[],this.parent.enableTimelineVirtualization?t.pdfExportBottomTierCollection:t.bottomTierCollection,!0),this.exportProps&&this.exportProps.fitToWidthSettings&&this.exportProps.fitToWidthSettings.isFitToWidth&&this.parent.enableTimelineVirtualization?(e="None"===t.topTier?"bottomTier":"topTier",this.gantt.chartHeader.width=t.calculateWidthBetweenTwoDate(e,t.timelineStartDate,t.timelineEndDate)):this.gantt.chartHeader.width=this.parent.enableTimelineVirtualization?this.parent.timelineModule.wholeTimelineWidth:t.totalTimelineWidth,this.gantt.chartHeader.height=oe.isNullOrUndefined(this.gantt.rows.getRow(0).height)?65:this.gantt.rows.getRow(0).height,this.gantt.timelineStartDate=new Date(t.timelineStartDate.getTime())},E.prototype.processPredecessor=function(){var i=this;(oe.isNullOrUndefined(this.exportProps.showPredecessorLines)||this.exportProps.showPredecessorLines)&&(this.parent.pdfExportModule.isPdfExport=!0,this.parent.predecessorModule.createConnectorLinesCollection(this.flatData),this.parent.updatedConnectorLineCollection.forEach(function(e){var t=i.gantt.predecessor.add();t.parentLeft=e.parentLeft,t.childLeft=e.childLeft,t.parentWidth=e.parentWidth,t.childWidth=e.childWidth,t.parentIndex=i.findIndexUsingParent(i.flatData,e.parentIndex),t.childIndex=i.findIndexUsingParent(i.flatData,e.childIndex),t.rowHeight=e.rowHeight,t.type=e.type,t.milestoneParent=e.milestoneParent,t.milestoneChild=e.milestoneChild,t.parentEndPoint=e.parentEndPoint,t.lineWidth=5<i.parent.connectorLineWidth?de(5):de(i.parent.connectorLineWidth),e.isCritical?t.connectorLineColor=i.ganttStyle.criticalConnectorLineColor:t.connectorLineColor=i.ganttStyle.connectorLineColor,i.gantt.predecessorCollection.push(t)}),this.parent.pdfExportModule.isPdfExport=!1)},E.prototype.findIndexUsingParent=function(e,t){return e.findIndex(function(e){return e.index===t})},E.prototype.processRecordRow=function(t){var i=this;this.colIndex=0,this.row.level=t.level,this.columns.forEach(function(e){i.isColumnVisible(e)&&(i.processRecordCell(t,e,i.row),i.colIndex++)})},E.prototype.processRecordCell=function(e,t,i){var n=i.cells.getCell(this.colIndex),a=this.parent.taskFields,r=e.ganttProperties;"datepickeredit"===t.editType||"datetimepickeredit"===t.editType?n.value=e[t.field]:t.field===a.duration?n.value=this.parent.getDurationString(r.duration,r.durationUnit):t.field===a.resourceInfo?n.value=r.resourceNames:t.field===a.work?n.value=this.parent.getWorkString(r.work,r.workUnit):n.value=oe.isNullOrUndefined(e[t.field])?"":e[t.field].toString();var a=oe.isNullOrUndefined(n.value)?"":n.value.toString(),r=oe.isNullOrUndefined(a)?"":a,a=(n.isHeaderCell=!1,n.style.padding=new aa,this.copyStyles(this.ganttStyle.cell,n,i.isParentRow),t.index!==this.parent.treeColumnIndex?n.style.format.alignment=le.PdfTextAlignment[t.textAlign]:n.style.format.paragraphIndent=10*n.row.level,{data:e,value:r,column:t,style:n.style,cell:n});a.value=this.exportValueFormatter.formatCellValue(a),this.parent.pdfQueryCellInfo&&(this.parent.trigger("pdfQueryCellInfo",a),a.style.backgroundColor&&(n.style.backgroundColor=a.style.backgroundColor),a.style.borderColor&&(n.style.borderColor=a.style.borderColor),a.style.fontBrush&&(n.style.fontBrush=a.style.fontBrush),a.style.fontColor&&(n.style.fontColor=a.style.fontColor),a.style.fontFamily?(i=a.style.fontFamily,e=this.getFontFamily(i),n.style.fontFamily=e):n.style.fontFamily=this.ganttStyle.fontFamily,a.style.fontSize&&(n.style.fontSize=a.style.fontSize),a.style.fontStyle?(r=a.style.fontStyle,t=this.getFontStyle(r),n.style.fontStyle=t):n.style.fontStyle=this.ganttStyle.footer.fontStyle,a.style.format&&(n.style.format=a.style.format),a.style.padding)&&(n.style.padding=a.style.padding),oe.isNullOrUndefined(a.image)||oe.isNullOrUndefined(a.image.base64)||(i=oe.extend({},a.image,null,!0),a.image=new le.PdfBitmap(a.image.base64),a.image.height=i.height||a.image.height,a.image.width=i.width||a.image.width,n.image=a.image),n.value=a.value,oe.isNullOrUndefined(a.hyperLink)||oe.isNullOrUndefined(a.hyperLink.displayText)&&oe.isNullOrUndefined(a.hyperLink.target)||(n.value=this.setHyperLink(a))},E.prototype.setHyperLink=function(e){var t=new le.PdfTextWebLink;return t.url=e.hyperLink.target,t.text=e.hyperLink.displayText||e.hyperLink.target,t.font=new le.PdfStandardFont(le.PdfFontFamily.Helvetica,9.75),t.brush=new le.PdfSolidBrush(new le.PdfColor(51,102,187)),t},E.prototype.processTaskbar=function(){var c=this;this.flatData.forEach(function(e){var r=c.gantt.taskbar.add(),t=e.ganttProperties,i=(r.left=t.left,r.width=t.width,r.left<0&&(r.width=r.width+r.left,r.left=0),r.progress=t.progress,r.isScheduledTask=H(t),oe.isNullOrUndefined(t.endDate)&&oe.isNullOrUndefined(t.duration)?r.unscheduledTaskBy="startDate":oe.isNullOrUndefined(t.startDate)&&oe.isNullOrUndefined(t.duration)?r.unscheduledTaskBy="endDate":(r.unscheduledTaskBy="duration",r.unscheduleStarteDate=c.parent.dateValidationModule.getValidStartDate(e.ganttProperties),r.unscheduleEndDate=c.parent.dateValidationModule.getValidEndDate(e.ganttProperties)),r.startDate=t.startDate,r.endDate=t.endDate,r.height=c.parent.chartRowsModule.taskBarHeight,r.indicators=t.indicators,r.autoStartDate=t.autoStartDate,r.autoEndDate=t.autoEndDate,r.isAutoSchedule=t.isAutoSchedule,r.autoWidth=t.autoWidth,r.autoLeft=t.autoLeft,r.segment=t.segments,r.isSpliterTask=!oe.isNullOrUndefined(t.segments)&&0!==t.segments.length,r.isSpliterTask&&(r.segmentCollection=r.segment.map(function(e){return Va({},e)})),r.baselineTop=c.parent.chartRowsModule.baselineTop,r.isMilestone=t.isMilestone,r.baselineStartDate=t.baselineStartDate,r.baselineEndDate=t.baselineEndDate,r.baselineLeft=t.baselineLeft,r.baselineWidth=t.baselineWidth,r.baselineLeft<0&&(r.baselineWidth=r.baselineWidth+r.baselineLeft,r.baselineLeft=0),r.milestoneColor=new le.PdfColor(c.ganttStyle.taskbar.milestoneColor),r.isParentTask=e.hasChildRecords,t.isMilestone&&(r.height=t.width),e[c.parent.labelSettings.leftLabel]&&(r.leftTaskLabel.value=e[c.parent.labelSettings.leftLabel].toString()),e[c.parent.labelSettings.rightLabel]&&(r.rightTaskLabel.value=e[c.parent.labelSettings.rightLabel].toString()),oe.isNullOrUndefined(e[c.parent.labelSettings.taskLabel])||(r.taskLabel=e[c.parent.labelSettings.taskLabel].toString()),t.isMilestone?Math.floor(c.parent.chartRowsModule.taskBarHeight/2)+33:33),n=!(e.hasChildRecords&&!e.ganttProperties.isAutoSchedule),a=n?t.left:t.autoLeft,n=n?t.width:t.autoWidth,a=(r.rightTaskLabel.left=a+n+i,r.fontFamily=c.ganttStyle.fontFamily,r.progressWidth=t.progressWidth,r.labelColor=new le.PdfColor(c.ganttStyle.label.fontColor),r.progressFontColor=new le.PdfColor(c.ganttStyle.taskbar.progressFontColor),r.isParentTask?(r.taskColor=new le.PdfColor(c.ganttStyle.taskbar.parentTaskColor),r.taskBorderColor=new le.PdfColor(c.ganttStyle.taskbar.parentTaskBorderColor),r.progressColor=new le.PdfColor(c.ganttStyle.taskbar.parentProgressColor)):e.isCritical?(r.taskColor=new le.PdfColor(c.ganttStyle.taskbar.criticalTaskColor),r.progressColor=new le.PdfColor(c.ganttStyle.taskbar.criticalProgressColor),r.taskBorderColor=new le.PdfColor(c.ganttStyle.taskbar.criticalTaskBorderColor),r.milestoneColor=new le.PdfColor(c.ganttStyle.taskbar.criticalTaskColor)):(r.taskColor=new le.PdfColor(c.ganttStyle.taskbar.taskColor),r.progressColor=new le.PdfColor(c.ganttStyle.taskbar.progressColor),r.taskBorderColor=new le.PdfColor(c.ganttStyle.taskbar.taskBorderColor)),r.manualParentBorder=new le.PdfColor(c.ganttStyle.taskbar.manualParentBorder),r.manualChildBorder=new le.PdfColor(c.ganttStyle.taskbar.manualChildBorder),r.manuallineColor=new le.PdfColor(c.ganttStyle.taskbar.manualLineColor),r.unscheduledTaskBarColor=new le.PdfColor(c.ganttStyle.taskbar.unscheduledTaskBarColor),r.manualParentBackground=new le.PdfColor(c.ganttStyle.taskbar.manualParentBackground),r.manualParentProgress=new le.PdfColor(c.ganttStyle.taskbar.manualParentProgress),r.manualChildBackground=new le.PdfColor(c.ganttStyle.taskbar.manualChildBackground),r.manualChildProgress=new le.PdfColor(c.ganttStyle.taskbar.manualChildProgress),r.splitLineBackground=new le.PdfColor(c.ganttStyle.taskbar.splitLineBackground),r.baselineColor=new le.PdfColor(c.ganttStyle.taskbar.baselineColor),r.baselineBorderColor=new le.PdfColor(c.ganttStyle.taskbar.baselineBorderColor),r.gridLineColor=new le.PdfColor(c.ganttStyle.chartGridLineColor),{}),n=(a.leftLabel={value:null,image:null,fontStyle:{fontBrush:null}},a.rightLabel={value:null,image:null,fontStyle:{fontBrush:null}},a.taskLabel={value:null,image:null,fontStyle:{fontBrush:null}},r.labelSettings=a,{value:null,image:null,fontStyle:{fontBrush:null}}),i=(r.taskbarTemplate=n,c.gantt.taskbarCollection.push(r),{}),s=(i.progressFontColor=r.progressFontColor,i.taskColor=r.taskColor,i.taskBorderColor=r.taskBorderColor,i.progressColor=r.progressColor,i.milestoneColor=r.milestoneColor,i.baselineColor=r.baselineColor,i.baselineBorderColor=r.baselineBorderColor,{taskbar:i,data:e,indicators:e.ganttProperties.indicators,labelSettings:a,taskbarTemplate:n});if(c.parent.pdfQueryTaskbarInfo){var o=[];if(s.taskbar.taskSegmentStyles=null,s.data.ganttProperties.segments){for(var l=0;l<s.data.ganttProperties.segments.length;l++){var d={taskColor:s.taskbar.taskColor,taskBorderColor:s.taskbar.taskBorderColor,progressColor:s.taskbar.progressColor};o.push(d)}s.taskbar.taskSegmentStyles=o}c.parent.trigger("pdfQueryTaskbarInfo",s),r.taskSegmentStyles=s.taskbar.taskSegmentStyles,r.progressFontColor=s.taskbar.progressFontColor,r.taskColor=s.taskbar.taskColor,r.taskBorderColor=s.taskbar.taskBorderColor,r.progressColor=s.taskbar.progressColor,r.milestoneColor=s.taskbar.milestoneColor,r.baselineColor=s.taskbar.baselineColor,r.baselineBorderColor=s.taskbar.baselineBorderColor,r.indicators=s.indicators,r.labelSettings.leftLabel.value=s.labelSettings.leftLabel.value;var h=s.labelSettings.leftLabel.image,p=(r.labelSettings.rightLabel.value=s.labelSettings.rightLabel.value,s.labelSettings.rightLabel.image);if(oe.isNullOrUndefined(s.labelSettings.taskLabel.value)||(r.taskLabel=s.labelSettings.taskLabel.value),!oe.isNullOrUndefined(s.labelSettings.leftLabel.image)&&Array.isArray(s.labelSettings.leftLabel.image[0].base64)&&0<s.labelSettings.leftLabel.image[0].base64.length){var u=s.labelSettings.leftLabel.image[0].base64.length;r.labelSettings.leftLabel.image=[];for(l=0;l<u;l++)r.labelSettings.leftLabel.image.push({base64:h[0].base64[l],width:h[0].width,height:h[0].height})}else oe.isNullOrUndefined(s.labelSettings.leftLabel.image)||(r.labelSettings.leftLabel.image=s.labelSettings.leftLabel.image);if(!oe.isNullOrUndefined(s.labelSettings.rightLabel.image)&&Array.isArray(s.labelSettings.rightLabel.image[0].base64)&&0<s.labelSettings.rightLabel.image[0].base64.length){u=s.labelSettings.rightLabel.image[0].base64.length;r.labelSettings.rightLabel.image=[];for(l=0;l<u;l++)r.labelSettings.rightLabel.image.push({base64:p[0].base64[l],width:p[0].width,height:p[0].height})}else oe.isNullOrUndefined(s.labelSettings.rightLabel.image)||(r.labelSettings.rightLabel.image=s.labelSettings.rightLabel.image);t=function(e,t){var i,n,a;e.progressFontColor=t.taskbar.progressFontColor,e.taskColor=new le.PdfColor(t.taskbar.taskColor),e.taskBorderColor=t.taskbar.taskBorderColor,e.progressColor=t.taskbar.progressColor,e.milestoneColor=t.taskbar.milestoneColor,oe.isNullOrUndefined(t.taskbarTemplate.image)||oe.isNullOrUndefined(t.taskbarTemplate.image[0].base64)||(i=t.taskbarTemplate.image[0].width,a=r.isMilestone&&t.taskbarTemplate.image[0].height<.7*c.parent.chartRowsModule.taskBarHeight?t.taskbarTemplate.image[0].height:.7*c.parent.chartRowsModule.taskBarHeight-2,n=!oe.isNullOrUndefined(t.taskbarTemplate.image[0].height)&&t.taskbarTemplate.image[0].height<r.height?t.taskbarTemplate.image[0].height:r.height-2,a=r.isMilestone?a:n,e.taskbarTemplate.image=t.taskbarTemplate.image,e.taskbarTemplate.image[0].width=i,e.taskbarTemplate.image[0].height=a),oe.isNullOrUndefined(t.taskbarTemplate.value)||(e.taskbarTemplate.value=t.taskbarTemplate.value,e.taskbarTemplate.value=t.taskbarTemplate.value,e.taskbarTemplate.fontStyle.fontColor=t.taskbarTemplate.fontStyle.fontColor,e.taskbarTemplate.fontStyle.fontSize=t.taskbarTemplate.fontStyle.fontSize,e.taskbarTemplate.fontStyle.fontFamily=t.taskbarTemplate.fontStyle.fontFamily,e.taskbarTemplate.fontStyle.fontStyle=t.taskbarTemplate.fontStyle.fontStyle,e.taskbarTemplate.fontStyle.fontBrush=t.taskbarTemplate.fontStyle.fontBrush)};(!s.data.hasChildRecords&&0!==s.data.ganttProperties.duration||s.data.hasChildRecords&&0!==s.data.ganttProperties.duration||0===s.data.ganttProperties.duration)&&t(r,s)}})},E.prototype.getHorizontalAlignment=function(e,t){switch(void 0===t&&(t=new le.PdfStringFormat),e){case"Right":t.alignment=le.PdfTextAlignment.Right;break;case"Center":t.alignment=le.PdfTextAlignment.Center;break;case"Justify":t.alignment=le.PdfTextAlignment.Justify;break;case"Left":t.alignment=le.PdfTextAlignment.Left}return t},E.prototype.getVerticalAlignment=function(e,t,i){switch(void 0===t&&(t=new le.PdfStringFormat,t=this.getHorizontalAlignment(i,t)),e){case"Bottom":t.lineAlignment=le.PdfVerticalAlignment.Bottom;break;case"Middle":t.lineAlignment=le.PdfVerticalAlignment.Middle;break;case"Top":t.lineAlignment=le.PdfVerticalAlignment.Top}return t},E.prototype.getFontFamily=function(e){switch(e){case"TimesRoman":return 2;case"Courier":return 1;case"Symbol":return 3;case"ZapfDingbats":return 4;default:return 0}},E.prototype.getFontStyle=function(e){switch(e){case"Strikeout":return 8;case"Underline":return 4;case"Italic":return 2;case"Bold":return 1;default:return 0}},E.prototype.getFont=function(e){var t,i;return e.font||(i=this.exportProps.ganttStyle&&this.exportProps.ganttStyle.fontFamily?this.exportProps.ganttStyle.fontFamily:le.PdfFontFamily.TimesRoman,t=oe.isNullOrUndefined(e.style.fontSize)?9.75:.75*e.style.fontSize,i=oe.isNullOrUndefined(e.style.fontFamily)?i:this.getFontFamily(e.style.fontFamily),e=le.PdfFontStyle.Regular,new le.PdfStandardFont(i,t,e))},E.prototype.renderEmptyGantt=function(){var e=this.gantt.rows.addRow(),t=(0===e.cells.count&&e.cells.add(),e.cells.getCell(0).isHeaderCell=!1,e.height=de(this.parent.rowHeight),this.copyStyles(this.ganttStyle.columnHeader,e.cells.getCell(0),e.isParentRow),this.columns.length);e.cells.getCell(0).value=this.parent.localeObj.getConstant("emptyRecord"),this.mergeCells(1,0,t)},E.prototype.mergeCells=function(e,t,i){this.gantt.rows.getRow(e).cells.getCell(t).columnSpan=i},E.prototype.copyStyles=function(e,t,i){t.style.fontColor=new le.PdfColor(e.fontColor),t.style.backgroundColor=new le.PdfColor(e.backgroundColor),t.style.borderColor=new le.PdfColor(e.borderColor),t.style.fontSize=e.fontSize,t.style.fontStyle=e.fontStyle,t.style.format=Object.assign(new le.PdfStringFormat,e.format),t.style.borders=new ia,t.style.borders.all=new le.PdfPen(t.style.borderColor),t.style.padding=new aa;var n=0,n=t.isHeaderCell?this.parent.timelineModule.isSingleTier?22.5:30:this.parent.rowHeight/2;t.style.padding.top=0<n-e.fontSize?n-e.fontSize:n,t.style.padding.bottom=0<n-e.fontSize?n-e.fontSize:0,t.style.padding.left=10,t.style.padding.right=10,e.padding&&(t.style.padding=e.padding),e.borders&&(t.style.borders=e.borders)},E.prototype.initializePdf=function(e){this.pdfDoc=e;var t=[],i=this.pdfDoc.pageSettings.width-82;if(this.exportProps&&this.exportProps.fitToWidthSettings&&this.exportProps.fitToWidthSettings.isFitToWidth){var n=void 0;n=this.exportProps.fitToWidthSettings.gridWidth?parseInt(this.exportProps.fitToWidthSettings.gridWidth.split("%")[0],10):this.exportProps.fitToWidthSettings.chartWidth?100-parseInt(this.exportProps.fitToWidthSettings.chartWidth.split("%")[0],10):30;for(var a=this.parent.pdfExportModule.pdfPageDimensions.width*n/100/this.gantt.columns.columns.length,r=0;r<this.gantt.columns.columns.length;r++)this.gantt.columns.getColumn(r).width=a}var s,o,l,d,h,n=this.parent.pdfExportModule.pdfPage,p=(this.totalColumnWidth>this.pdfDoc.pageSettings.width-82&&this.totalColumnWidth<n.getClientSize().width?this.gantt.style.allowHorizontalOverflow=!0:i/this.columns.length<t[0]&&(this.gantt.columns.getColumn(0).width=t[0]),(this.exportProps.enableFooter||oe.isNullOrUndefined(this.exportProps.enableFooter))&&(i=this.parent.pdfExportModule.getPageSize(this.exportProps.pageSize),h=new le.RectangleF(0,0,i.width,35),t=new le.PdfPen(this.ganttStyle.footer.borderColor),o=new le.PdfPageTemplateElement(h),p=new le.PdfSolidBrush(this.ganttStyle.footer.backgroundColor),o.graphics.drawRectangle(t,p,0,0,i.width,35),t=new le.PdfStandardFont(this.ganttStyle.fontFamily,this.ganttStyle.footer.fontSize,this.ganttStyle.footer.fontStyle),this.ganttStyle.font&&(t=this.ganttStyle.font),p=new le.PdfSolidBrush(this.ganttStyle.footer.fontColor),i=new le.PdfPageNumberField(t),s=new le.PdfPageCountField(t,p),(t=new le.PdfCompositeField(t,p,"Page {0}",i,s)).stringFormat=this.ganttStyle.footer.format,t.bounds=h,t.draw(o.graphics,new le.PointF(0,0)),e.template.bottom=o),n.size),i=oe.isNullOrUndefined(p)?this.pdfDoc.pageSettings.size:p;oe.isNullOrUndefined(this.exportProps.header)||(s=this.exportProps.header,l=new le.PointF(0,s.fromTop),d=new le.SizeF(1.1*i.width,s&&s.height?.75*s.height:50),h=new le.RectangleF(l,d),e.template.top=this.drawPageTemplate(new le.PdfPageTemplateElement(h),s)),this.exportProps.enableFooter||oe.isNullOrUndefined(this.exportProps.footer)||(o=this.exportProps.footer,l=new le.PointF(0,i.width-80-(o&&o.fromBottom?.75*o.fromBottom:0)),d=new le.SizeF(1.1*i.width,o&&o.height?.75*o.height:50),h=new le.RectangleF(l,d),this.pdfDoc.template.bottom=this.drawPageTemplate(new le.PdfPageTemplateElement(h),o))},E.prototype.drawPageTemplate=function(e,t){for(var i=0,n=t.contents;i<n.length;i++){var a=n[i];switch(a.type){case"Text":if(""===a.value||void 0===a.value||null===a.value||"string"!=typeof a.value)throw new Error("please enter the valid input value in text content...");this.drawText(e,a);break;case"PageNumber":this.drawPageNumber(e,a);break;case"Image":if(void 0===a.src||null===a.src||""===a.src)throw new Error("please enter the valid base64 string in image content...");this.drawImage(e,a);break;case"Line":this.drawLine(e,a);break;default:throw new Error("Please set valid content type...")}}return e},E.prototype.drawText=function(e,t){var i=this.getFont(t),n=(this.ganttStyle.font&&(i=this.ganttStyle.font),this.getBrushFromContent(t)),a=null,r=(oe.isNullOrUndefined(t.style.textPenColor)||(r=this.hexToRgb(t.style.textPenColor),a=new le.PdfPen(new le.PdfColor(r.r,r.g,r.b))),null===n&&null===a&&(n=new le.PdfSolidBrush(new le.PdfColor(0,0,0))),t.value.toString()),s=.75*t.position.x,o=.75*t.position.y,l=new le.PdfStringFormat,t=(oe.isNullOrUndefined(t.style.stringFormat)||(l.alignment=t.style.stringFormat.alignment),this.setContentFormat(t,l));null===t||oe.isNullOrUndefined(t.format)||oe.isNullOrUndefined(t.size)?e.graphics.drawString(r,i,a,n,s,o,l):e.graphics.drawString(r,i,a,n,s,o,t.size.width,t.size.height,t.format)},E.prototype.drawPageNumber=function(e,t){var i,n,a,r=this.getFont(t),s=null,o=(s=oe.isNullOrUndefined(t.style.textBrushColor)?new le.PdfSolidBrush(new le.PdfColor(0,0,0)):(o=this.hexToRgb(t.style.textBrushColor),new le.PdfSolidBrush(new le.PdfColor(o.r,o.g,o.b))),new le.PdfPageNumberField(r,s)),o=(o.numberStyle=this.getPageNumberStyle(t.pageNumberType),a=oe.isNullOrUndefined(t.format)?new le.PdfCompositeField(r,s,n="{0}",o):(a="$current",-1!==t.format.indexOf(l="$total")&&-1!==t.format.indexOf(a)?((i=new le.PdfPageCountField(r)).numberStyle=this.getPageNumberStyle(t.pageNumberType),n=t.format.indexOf(l)>t.format.indexOf(a)?(n=t.format.replace(a,"0")).replace(l,"1"):(n=t.format.replace(a,"1")).replace(l,"0"),new le.PdfCompositeField(r,s,n,o,i)):-1!==t.format.indexOf(a)&&-1===t.format.indexOf(l)?(n=t.format.replace(a,"0"),new le.PdfCompositeField(r,s,n,o)):(i=new le.PdfPageCountField(r),n=t.format.replace(l,"0"),new le.PdfCompositeField(r,s,n,i))),.75*t.position.x),l=.75*t.position.y,r=this.setContentFormat(t,a.stringFormat);null===r||oe.isNullOrUndefined(r.format)||oe.isNullOrUndefined(r.size)||(a.stringFormat=r.format,a.bounds=new le.RectangleF(o,l,r.size.width,r.size.height)),a.draw(e.graphics,o,l)},E.prototype.drawImage=function(e,t){var i=.75*t.position.x,n=.75*t.position.y,a=oe.isNullOrUndefined(t.size)||oe.isNullOrUndefined(t.size.width)?void 0:.5*t.size.width,r=oe.isNullOrUndefined(t.size)||oe.isNullOrUndefined(t.size.height)?void 0:.75*t.size.height,t=new le.PdfBitmap(t.src);oe.isNullOrUndefined(a)?e.graphics.drawImage(t,i,n):e.graphics.drawImage(t,i,n,a,r)},E.prototype.drawLine=function(e,t){var i=.75*t.points.x1,n=.75*t.points.y1,a=.75*t.points.x2,r=.75*t.points.y2,s=this.getPenFromContent(t);oe.isNullOrUndefined(t.style)||(oe.isNullOrUndefined(t.style.penSize)||"number"!=typeof t.style.penSize||(s.width=.75*t.style.penSize),s.dashStyle=this.getDashStyle(t.style.dashStyle)),e.graphics.drawLine(s,i,n,a,r)},E.prototype.getPenFromContent=function(e){var t=new le.PdfPen(new le.PdfColor(0,0,0));return oe.isNullOrUndefined(e.style)||null===e.style||oe.isNullOrUndefined(e.style.penColor)||(e=this.hexToRgb(e.style.penColor),t=new le.PdfPen(new le.PdfColor(e.r,e.g,e.b))),t},E.prototype.getDashStyle=function(e){switch(e){case"Dash":return 1;case"Dot":return 2;case"DashDot":return 3;case"DashDotDot":return 4;default:return 0}},E.prototype.getBrushFromContent=function(e){var t=null;return oe.isNullOrUndefined(e.style.textBrushColor)||(e=this.hexToRgb(e.style.textBrushColor),t=new le.PdfSolidBrush(new le.PdfColor(e.r,e.g,e.b))),t},E.prototype.hexToRgb=function(e){if(null===e||""===e||7!==e.length)throw new Error("please set valid hex value for color...");e=e.substring(1);e=parseInt(e,16);return{r:e>>16&255,g:e>>8&255,b:255&e}},E.prototype.setContentFormat=function(e,t){var i=e.size?.75*e.size.width:this.pdfDoc.pageSettings.size.width,n=e.size?.75*e.size.height:oe.isNullOrUndefined(this.exportProps.footer)?0:.5*this.exportProps.footer.height;if(t=new le.PdfStringFormat(le.PdfTextAlignment.Left,le.PdfVerticalAlignment.Middle),!oe.isNullOrUndefined(e.style.hAlign))switch(e.style.hAlign){case"Right":t.alignment=le.PdfTextAlignment.Right;break;case"Center":t.alignment=le.PdfTextAlignment.Center;break;case"Justify":t.alignment=le.PdfTextAlignment.Justify;break;default:t.alignment=le.PdfTextAlignment.Left}return{format:t=oe.isNullOrUndefined(e.style.vAlign)?t:this.getVerticalAlignment(e.style.vAlign,t),size:new le.SizeF(i,n)}},E.prototype.getPageNumberStyle=function(e){switch(e){case"LowerLatin":return 2;case"LowerRoman":return 3;case"UpperLatin":return 4;case"UpperRoman":return 5;default:return 1}},E);function E(e){this.totalColumnWidth=0,this.beforeSinglePageExport={},this.baselineHeight=8,this.parent=e}Wa.prototype.returnFormattedValue=function(e,t){return!oe.isNullOrUndefined(e.value)&&e.value?this.valueFormatter.getFormatFunction(t)(e.value):""},Wa.prototype.formatCellValue=function(e){var t;return e.isForeignKey&&(e.value=oe.getValue(e.column.foreignKeyValue,b.getForeignData(e.column,{},e.value)[0])),"number"===e.column.type&&void 0!==e.column.format&&""!==e.column.format?e.value?this.internationalization.getNumberFormat({format:e.column.format})(e.value):"":"boolean"===e.column.type?e.value?"true":"false":"date"!==e.column.type&&"datetime"!==e.column.type&&"time"!==e.column.type||void 0===e.column.format?(oe.isNullOrUndefined(e.column.type)||oe.isNullOrUndefined(e.value))&&oe.isNullOrUndefined(e.value)?"":e.value.toString():("string"==typeof e.value&&(e.value=new Date(e.value)),"string"==typeof e.column.format?(t=void 0,t="date"===e.column.type?{type:"date",format:e.column.format}:"time"===e.column.type?{type:"time",format:e.column.format}:{type:"dateTime",format:e.column.format},this.returnFormattedValue(e,t)):e.column.format instanceof Object&&void 0===e.column.format.type?e.value.toString():(t=void 0,t="date"===e.column.type?{type:e.column.format.type,format:e.column.format.format,skeleton:e.column.format.skeleton}:"time"===e.column.type?{type:"time",format:e.column.format.format,skeleton:e.column.format.skeleton}:{type:"dateTime",format:e.column.format.format,skeleton:e.column.format.skeleton},this.returnFormattedValue(e,t)))};var Aa=Wa;function Wa(e){this.valueFormatter=new b.ValueFormatter(e),this.internationalization=new oe.Internationalization(e)}var Ha=function(){return(Ha=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var a in t=arguments[i])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},ja=(Ga.prototype.add=function(){return new Ga(this.parent)},Ga.prototype.GetNextPage=function(e){var t=e.section,e=t.indexOf(e);return e===t.count-1?t.add():t.getPages()[e+1]},Ga.prototype.isAutoFit=function(){return!!(this.parent.pdfExportModule&&this.parent.pdfExportModule.helper.exportProps&&this.parent.pdfExportModule.helper.exportProps.fitToWidthSettings&&this.parent.pdfExportModule.helper.exportProps.fitToWidthSettings.isFitToWidth||this.parent.timelineModule.isZoomedToFit)},Ga.prototype.drawTaskbar=function(r,s,o,l,L,d,V,B){var h,p,e,t,u,c,i,A,W,n,H,a,j,G,z,q,g,f,m,_,X,y,Z,Y,K,Q,D,J,$,ee,te,k,w,b,T,ie,v,P,S,C,R=this,M=r.graphics,ne=!1,x=r.getClientSize(),ae=(s.y+L>x.height&&((r=this.GetNextPage(r)).contentWidth=this.isAutoFit()?he(o.endPoint-o.startPoint):o.endPoint-o.startPoint,M=r.graphics,s.y=0,this.parent.pdfExportModule.gantt.currentPage=this.parent.pdfExportModule.gantt.currentPage+1,this.parent.pdfExportModule.gantt.eventMarker.renderHeight=this.parent.pdfExportModule.gantt.layouter.pageHeightCollection[this.parent.pdfExportModule.gantt.currentPage].totalHeight,this.parent.pdfExportModule.gantt.enableHeader&&(this.parent.pdfExportModule.gantt.chartHeader.drawPageTimeline(r,s,o,this.parent.pdfExportModule.gantt.currentPage),s.y=de(this.parent.timelineModule.isSingleTier?45:60)),ne=!0),this.drawLeftLabel(r,s,o,l,d),new le.PdfStandardFont(this.fontFamily,9,le.PdfFontStyle.Regular)),x=null,O=new le.PdfSolidBrush(this.progressFontColor),I=ae,E=(!oe.isNullOrUndefined(d.taskbarTemplate.value)&&d.taskbarTemplate.fontStyle&&d.taskbarTemplate.fontStyle.fontFamily&&d.taskbarTemplate.fontStyle.fontSize&&(I=new le.PdfStandardFont(d.taskbarTemplate.fontStyle.fontFamily,d.taskbarTemplate.fontStyle.fontSize,d.taskbarTemplate.fontStyle.fontStyle)),h=!oe.isNullOrUndefined(d.taskbarTemplate.value)&&d.taskbarTemplate.fontStyle&&d.taskbarTemplate.fontStyle.fontColor?new le.PdfSolidBrush(d.taskbarTemplate.fontStyle.fontColor):O,p=!oe.isNullOrUndefined(d.taskbarTemplate.value)&&d.taskbarTemplate.fontStyle&&d.taskbarTemplate.fontStyle.fontBrush?new le.PdfPen(d.taskbarTemplate.fontStyle.fontBrush):x,!oe.isNullOrUndefined(this.parent.pdfExportModule.helper.exportProps.ganttStyle)&&this.parent.pdfExportModule.helper.exportProps.ganttStyle.font&&(ae=this.parent.pdfExportModule.helper.exportProps.ganttStyle.font),this.parent.pdfExportModule.helper.exportProps.ganttStyle),U=(d.labelSettings.taskLabel.fontStyle.fontSize?t=new le.PdfStandardFont(d.labelSettings.taskLabel.fontStyle.fontFamily,d.labelSettings.taskLabel.fontStyle.fontSize,d.labelSettings.taskLabel.fontStyle.fontStyle):E&&E.label&&E.label.fontBrush?e=new le.PdfSolidBrush(E.label.fontBrush):t=ae,e=d.labelSettings.taskLabel.fontStyle.fontColor?new le.PdfSolidBrush(d.labelSettings.taskLabel.fontStyle.fontColor):E&&E.label&&E.label.fontColor?new le.PdfSolidBrush(E.label.fontColor):O,oe.isNullOrUndefined(E)||oe.isNullOrUndefined(E.label)||oe.isNullOrUndefined(E.label.fontBrush)||(x=new le.PdfPen(E.label.fontBrush)),oe.isNullOrUndefined(E)||oe.isNullOrUndefined(E.label)||oe.isNullOrUndefined(E.label.fontSize)&&oe.isNullOrUndefined(E.label.fontStyle)&&oe.isNullOrUndefined(E.label.fontFamily)||(t=this.getPdfFont(E)),new le.PdfStringFormat),O=(U.lineAlignment=le.PdfVerticalAlignment.Middle,U.alignment=le.PdfTextAlignment.Right,!1),F=(oe.isNullOrUndefined(this.taskLabel)||!/^[a-zA-Z0-9]/.test(this.taskLabel)||"0"!==this.taskLabel&&"0%"!==this.taskLabel||(D=this.width,U.alignment=le.PdfTextAlignment.Left),(oe.isNullOrUndefined(this.taskLabel)||!/^[a-zA-Z]/.test(this.taskLabel))&&oe.isNullOrUndefined(d.taskbarTemplate.value)||(O=!0,U.alignment=le.PdfTextAlignment.Left),oe.isNullOrUndefined(E)||oe.isNullOrUndefined(E.label)||oe.isNullOrUndefined(E.label.format)||(U=E.label.format),{left:0,right:0,top:0,bottom:0}),E=(oe.isNullOrUndefined(E)||oe.isNullOrUndefined(E.label)||oe.isNullOrUndefined(E.label.padding)||(F=E.label.padding),-1),re=new le.PdfPen(d.baselineBorderColor),se=new le.PdfSolidBrush(d.baselineColor),N=d.taskbarTemplate;return d.isMilestone?(this.drawMilestone(r,s,o,l,d,!1),this.parent.renderBaseline&&d.baselineStartDate&&d.baselineEndDate&&this.drawMilestone(r,s,o,l,d,!0)):(u=new le.PdfPen(d.taskBorderColor),c=new le.PdfSolidBrush(d.taskColor),i=new le.PdfPen(d.manualParentBorder),A=new le.PdfPen(d.manualChildBorder),W=new le.PdfPen(d.manuallineColor),new le.PdfPen(d.manualParentProgress),n=new le.PdfPen(d.manuallineColor),H=new le.PdfSolidBrush(d.manuallineColor),a=new le.PdfPen(d.splitLineBackground),j=new le.PdfSolidBrush(d.manualParentBackground),G=new le.PdfSolidBrush(d.manualChildBackground),z=new le.PdfSolidBrush(d.manualChildProgress),q=new le.PdfSolidBrush(d.manualParentProgress),g=new le.PdfPen(d.progressColor),f=new le.PdfSolidBrush(d.progressColor),X=de((this.parent.rowHeight-this.height)/2),_=de((this.parent.rowHeight-this.height)/4.5),m=this.parent.renderBaseline?_:X,E=r.section.indexOf(r),_=oe.isNullOrUndefined(this.unscheduleStarteDate)?this.startDate:this.unscheduleStarteDate,X=oe.isNullOrUndefined(this.unscheduleEndDate)?this.endDate:this.unscheduleEndDate,o.startDate<=_&&X<=o.endDate?(this.isStartPoint||(this.taskStartPoint=Ha({},s),this.isStartPoint=!0),this.isScheduledTask||"duration"!==this.unscheduledTaskBy?(this.isScheduledTask||"endDate"!==this.unscheduledTaskBy)&&(this.isScheduledTask||"duration"===this.unscheduledTaskBy)?(d.isSpliterTask?(a.dashStyle=le.PdfDashStyle.Dot,this.isAutoFit()?M.drawLine(a,new le.PointF(s.x+(this.left-l)+.5,s.y+m+de(d.height/2)),new le.PointF(d.width+s.x+(this.left-l)+.5,s.y+m+de(d.height/2))):M.drawLine(a,new le.PointF(s.x+de(this.left-l)+.5,s.y+m+de(d.height/2)),new le.PointF(de(d.width)+s.x+de(this.left-l)+.5,s.y+m+de(d.height/2))),d.segment.map(function(e,t){var i,n,a=oe.isNullOrUndefined(R.taskSegmentStyles)?u:new le.PdfPen(R.taskSegmentStyles[t].taskBorderColor),t=oe.isNullOrUndefined(R.taskSegmentStyles)?c:new le.PdfSolidBrush(R.taskSegmentStyles[t].taskColor);R.isAutoFit()?(M.drawRectangle(a,t,s.x+(R.left+e.left-l)+.5,s.y+m,e.width,de(d.height)),(N.image||N.value)&&(i=void 0,oe.isNullOrUndefined(d.taskbarTemplate.image)?i=0:(i=d.taskbarTemplate.image[0].width,n=new le.PdfBitmap(d.taskbarTemplate.image[0].base64),M.drawImage(n,s.x+(R.left+e.left-l)+.5,s.y+m,de(d.taskbarTemplate.image[0].width),de(d.taskbarTemplate.image[0].height))),oe.isNullOrUndefined(d.taskbarTemplate.value)||M.drawString(d.taskbarTemplate.value,I,p,h,s.x+(R.left+e.left-l)+.5+i,s.y+m,de(e.width),de(d.height),U))):(M.drawRectangle(a,t,s.x+de(R.left+e.left-l)+.5,s.y+m,de(e.width),de(d.height)),(N.image||N.value)&&(i=void 0,oe.isNullOrUndefined(d.taskbarTemplate.image)?i=0:(i=d.taskbarTemplate.image[0].width,n=new le.PdfBitmap(d.taskbarTemplate.image[0].base64),M.drawImage(n,s.x+de(R.left+e.left-l)+.5,s.y+m,de(d.taskbarTemplate.image[0].width),de(d.taskbarTemplate.image[0].height))),oe.isNullOrUndefined(d.taskbarTemplate.value)||M.drawString(d.taskbarTemplate.value,I,p,h,s.x+de(R.left+e.left-l)+.5+i,s.y+m,de(e.width),de(d.height),U)))})):!d.isAutoSchedule&&d.isParentTask?(M.save(),($=new le.PdfPath).addEllipse(0,0,5,5),this.isAutoFit()?M.translateTransform(s.x+(this.left-l)+.5,s.y+m-2):M.translateTransform(s.x+de(this.left-l)+.5,s.y+m-2),M.drawPath(W,H,$),M.restore(),(J=new le.PdfPath).addEllipse(0,0,5,5),M.save(),this.isAutoFit()?M.translateTransform(s.x+(this.left-l)+.5+this.width,s.y+m-2):M.translateTransform(s.x+de(this.left-l)+.5+de(this.width),s.y+m-2),M.drawPath(W,H,J),M.restore(),n.dashStyle=le.PdfDashStyle.Solid,this.isAutoFit()?M.drawLine(n,new le.PointF(s.x+(this.left-l)+.5,s.y+m),new le.PointF(d.width+s.x+(this.left-l)+.5,s.y+m)):M.drawLine(n,new le.PointF(s.x+de(this.left-l)+.5,s.y+m),new le.PointF(de(d.width)+s.x+de(this.left-l)+.5,s.y+m))):d.isAutoSchedule||d.isParentTask?this.isAutoFit()?oe.isNullOrUndefined(N.value)&&oe.isNullOrUndefined(N.image)?M.drawRectangle(u,c,s.x+(this.left-l)+.5,s.y+m,d.width,de(d.height)):(M.drawRectangle(u,c,s.x+(this.left-l)+.5,s.y+m,d.width,de(d.height)),b=void 0,oe.isNullOrUndefined(d.taskbarTemplate.image)?b=0:(b=d.taskbarTemplate.image[0].width/2,T=new le.PdfBitmap(d.taskbarTemplate.image[0].base64),M.drawImage(T,s.x+(this.left-l)+.5,s.y+m+(d.height-d.taskbarTemplate.image[0].height)/2,d.taskbarTemplate.image[0].width/2,d.taskbarTemplate.image[0].height/2)),d.taskbarTemplate.value&&(O&&(D=this.width),M.drawString(d.taskbarTemplate.value,I,p,h,s.x+(this.left-l)+b,s.y+m,D,de(this.height),U))):oe.isNullOrUndefined(N.value)&&oe.isNullOrUndefined(N.image)?M.drawRectangle(u,c,s.x+de(this.left-l)+.5,s.y+m,de(d.width),de(d.height)):(M.drawRectangle(u,c,s.x+de(this.left-l)+.5,s.y+m,de(d.width),de(d.height)),b=void 0,oe.isNullOrUndefined(d.taskbarTemplate.image)?b=0:(b=d.taskbarTemplate.image[0].width,T=new le.PdfBitmap(d.taskbarTemplate.image[0].base64),M.drawImage(T,s.x+de(this.left-l)+1,s.y+m+1+de((d.height-d.taskbarTemplate.image[0].height)/2),de(d.taskbarTemplate.image[0].width),de(d.taskbarTemplate.image[0].height))),oe.isNullOrUndefined(d.taskbarTemplate.value)||M.drawString(d.taskbarTemplate.value,I,p,h,s.x+de(this.left-l)+b,s.y+m,de(D),de(this.height),U)):(M.save(),M.setTransparency(.87),this.isAutoFit()?M.drawRectangle(A,G,s.x+(this.left-l)+.5,s.y+m,d.width,de(d.height)):M.drawRectangle(A,G,s.x+de(this.left-l)+.5,s.y+m,de(d.width),de(d.height)),M.restore(),this.isAutoFit()?M.drawRectangle(null,z,s.x+(this.left-l)+.5,s.y+m,d.progressWidth,de(this.height)):M.drawRectangle(null,z,s.x+de(this.left-l)+.5,s.y+m,de(d.progressWidth),de(this.height))),this.isScheduledTask&&!d.isSpliterTask?oe.isNullOrUndefined(N.image)&&oe.isNullOrUndefined(N.value)&&(this.isAutoFit()&&d.isAutoSchedule?M.drawRectangle(g,f,s.x+(this.left-l)+.5,s.y+m,d.progressWidth,de(d.height)):d.isAutoSchedule&&M.drawRectangle(g,f,s.x+de(this.left-l)+.5,s.y+m,de(d.progressWidth),de(d.height)),oe.isNullOrUndefined(this.parent.labelSettings.taskLabel)||oe.isNullOrUndefined(this.taskLabel)||("0"!==this.taskLabel&&"0%"!==this.taskLabel&&(D=this.progressWidth),O&&(D=this.width),this.isAutoFit()?M.drawString(this.taskLabel.toString(),t,x,e,s.x+(this.left-l)-(F.left+F.right),s.y+m-(F.top+F.bottom),D,de(this.height),U):M.drawString(this.taskLabel.toString(),t,x,e,s.x+de(this.left-l)-(F.left+F.right),s.y+m-(F.top+F.bottom),de(D),de(this.height),U))):d.isSpliterTask&&d.segment.map(function(e,t){var i=oe.isNullOrUndefined(R.taskSegmentStyles)?g:new le.PdfPen(R.taskSegmentStyles[t].progressColor),t=oe.isNullOrUndefined(R.taskSegmentStyles)?f:new le.PdfSolidBrush(R.taskSegmentStyles[t].progressColor);R.isAutoFit()?M.drawRectangle(i,t,s.x+(R.left+e.left-l)+.5,s.y+m,e.progressWidth,de(d.height)):M.drawRectangle(i,t,s.x+de(R.left+e.left-l)+.5,s.y+m,de(e.progressWidth),de(d.height))})):this.drawUnscheduledTask(M,s,l,m):(w=k=void 0,this.isAutoFit()?(k=new le.PdfLinearGradientBrush(new le.PointF(s.x+(this.left-l)+.5+d.width/2,0),new le.PointF(s.x+(this.left-l),0),new le.PdfColor(d.unscheduledTaskBarColor),new le.PdfColor(255,255,255)),M.drawRectangle(k,s.x+(this.left-l)+.5,s.y+m,d.width,de(d.height)),w=new le.PdfLinearGradientBrush(new le.PointF(s.x+(this.left-l)+.5+d.width,0),new le.PointF(s.x+(this.left-l)+d.width/2,0),new le.PdfColor(255,255,255),new le.PdfColor(d.unscheduledTaskBarColor)),M.drawRectangle(w,s.x+(this.left-l)+.5+d.width/2,s.y+m,d.width/2,de(d.height)),(N.image||N.value)&&(b=void 0,oe.isNullOrUndefined(d.taskbarTemplate.image)?b=0:(b=d.taskbarTemplate.image[0].width,T=new le.PdfBitmap(d.taskbarTemplate.image[0].base64),M.drawImage(T,s.x+(this.left-l)+.5,s.y+m,de(d.taskbarTemplate.image[0].width),de(d.taskbarTemplate.image[0].height))),oe.isNullOrUndefined(d.taskbarTemplate.value)||M.drawString(d.taskbarTemplate.value,I,p,h,s.x+(this.left-l)+.5+b,s.y+m,de(d.width),de(this.height),U))):(k=new le.PdfLinearGradientBrush(new le.PointF(s.x+de(this.left-l)+.5+de(d.width)/2,0),new le.PointF(s.x+de(this.left-l),0),new le.PdfColor(d.unscheduledTaskBarColor),new le.PdfColor(255,255,255)),M.drawRectangle(k,s.x+de(this.left-l)+.5,s.y+m,de(d.width),de(d.height)),w=new le.PdfLinearGradientBrush(new le.PointF(s.x+de(this.left-l)+.5+de(d.width),0),new le.PointF(s.x+de(this.left-l)+de(d.width)/2,0),new le.PdfColor(255,255,255),new le.PdfColor(d.unscheduledTaskBarColor)),M.drawRectangle(w,s.x+de(this.left-l)+.5+de(d.width)/2,s.y+m,de(d.width)/2,de(d.height)),(N.image||N.value)&&(b=void 0,oe.isNullOrUndefined(d.taskbarTemplate.image)?b=0:(b=d.taskbarTemplate.image[0].width,T=new le.PdfBitmap(d.taskbarTemplate.image[0].base64),M.drawImage(T,s.x+de(this.left-l)+.5,s.y+m,de(d.taskbarTemplate.image[0].width),de(d.taskbarTemplate.image[0].height))),oe.isNullOrUndefined(d.taskbarTemplate.value)||M.drawString(d.taskbarTemplate.value,I,p,h,s.x+de(this.left-l)+.5+b,s.y+m,de(d.width),de(this.height),U)))),this.isCompleted=!0,this.startPage=E,this.endPage=E):o.startDate<=_&&o.endDate>=_&&X>=o.endDate?(this.isStartPoint||(this.taskStartPoint=Ha({},s),this.isStartPoint=!0),ie=this.width,Z=P=y=0,this.width=this.width-(o.totalWidth-(this.left-l)),y=o.totalWidth-(this.left-l),P=o.totalWidth-(this.left-l),Z=y=ie<y?ie:y,this.isScheduledTask||"duration"!==this.unscheduledTaskBy?this.isScheduledTask||"duration"===this.unscheduledTaskBy?!d.isAutoSchedule&&d.isParentTask?(M.save(),($=new le.PdfPath).addEllipse(0,0,5,5),this.isAutoFit()?M.translateTransform(s.x+(this.left-l)+.5,s.y+m-2):M.translateTransform(s.x+de(this.left-l)+.5,s.y+m-2),M.drawPath(W,H,$),M.restore(),n.dashStyle=le.PdfDashStyle.Solid,this.isAutoFit()?M.drawLine(n,new le.PointF(s.x+(this.left-l)+.5,s.y+m),new le.PointF(y+s.x+(this.left-l)+.5,s.y+m)):M.drawLine(n,new le.PointF(s.x+de(this.left-l)+.5,s.y+m),new le.PointF(de(y)+s.x+de(this.left-l)+.5,s.y+m))):d.isAutoSchedule||d.isParentTask?(this.isScheduledTask||"duration"===this.unscheduledTaskBy)&&(this.isScheduledTask||"endDate"!==this.unscheduledTaskBy)?(d.isSpliterTask?(K=!(Y=0),Q=0,d.segment.map(function(e){Q=e.left+e.width}),a.dashStyle=le.PdfDashStyle.Dot,this.isAutoFit()?M.drawLine(a,new le.PointF(s.x+(this.left-l)+.5,s.y+m+de(d.height/2)),new le.PointF(Q+(this.left-l)+s.x,s.y+m+de(d.height/2))):M.drawLine(a,new le.PointF(s.x+de(this.left-l)+.5,s.y+m+de(d.height/2)),new le.PointF(de(Q)+de(this.left-l)+s.x,s.y+m+de(d.height/2))),d.segment.map(function(e,t){var i,n,a=oe.isNullOrUndefined(R.taskSegmentStyles)?u:new le.PdfPen(R.taskSegmentStyles[t].taskBorderColor),r=oe.isNullOrUndefined(R.taskSegmentStyles)?c:new le.PdfSolidBrush(R.taskSegmentStyles[t].taskColor);R.isAutoFit()?(M.drawRectangle(a,r,s.x+(R.left-l)+.5+e.left,s.y+m,e.width,de(d.height)),(N.image||N.value)&&(i=void 0,oe.isNullOrUndefined(d.taskbarTemplate.image)?i=0:(i=d.taskbarTemplate.image[0].width,n=new le.PdfBitmap(d.taskbarTemplate.image[0].base64),M.drawImage(n,s.x+(R.left-l)+.5+e.left,s.y+m,d.taskbarTemplate.image[0].width,d.taskbarTemplate.image[0].height)),oe.isNullOrUndefined(d.taskbarTemplate.value)||M.drawString(d.taskbarTemplate.value,I,p,h,s.x+(R.left-l)+.5+e.left+i,s.y+m,e.width,d.height,U))):(M.drawRectangle(a,r,s.x+de(R.left-l)+.5+de(e.left),s.y+m,de(e.width),de(d.height)),(N.image||N.value)&&(i=void 0,oe.isNullOrUndefined(d.taskbarTemplate.image)?i=0:(i=d.taskbarTemplate.image[0].width,n=new le.PdfBitmap(d.taskbarTemplate.image[0].base64),M.drawImage(n,s.x+de(R.left-l)+.5+de(e.left),s.y+m,de(d.taskbarTemplate.image[0].width),de(d.taskbarTemplate.image[0].height))),oe.isNullOrUndefined(d.taskbarTemplate.value)||M.drawString(d.taskbarTemplate.value,I,p,h,s.x+de(R.left-l)+.5+de(e.left)+i,s.y+m,de(e.width),de(d.height),U))),(Y=e.left+e.width)<=y?(R.segmentCollection[parseInt(t.toString(),10)].width=0,R.segmentCollection[parseInt(t.toString(),10)].left=0):(y>=Y-e.width?R.segmentCollection[parseInt(t.toString(),10)].left=0:R.segmentCollection[parseInt(t.toString(),10)].left=Z-e.left,Y<=y?R.segmentCollection[parseInt(t.toString(),10)].width=0:K&&(R.segmentCollection[parseInt(t.toString(),10)].width=Y-y,K=!1)),Z=Z+e.width+e.left})):(this.isAutoFit()?oe.isNullOrUndefined(N.value)&&oe.isNullOrUndefined(N.image)?M.drawRectangle(u,c,s.x+(this.left-l)+.5,s.y+m,y,de(d.height)):(M.drawRectangle(u,c,s.x+(this.left-l)+.5,s.y+m,y,de(d.height)),oe.isNullOrUndefined(d.taskbarTemplate.image)||(T=new le.PdfBitmap(d.taskbarTemplate.image[0].base64),M.drawImage(T,s.x+(this.left-l)+.5,s.y+m+de((d.height-d.taskbarTemplate.image[0].height)/.5),d.taskbarTemplate.image[0].width/2,d.taskbarTemplate.image[0].height/2)),oe.isNullOrUndefined(d.taskbarTemplate.value)||(b=oe.isNullOrUndefined(d.taskbarTemplate.image)?0:d.taskbarTemplate.image[0].width,M.drawString(d.taskbarTemplate.value,I,p,h,s.x+(this.left-l)+b,s.y+m,de(D),de(this.height),U))):oe.isNullOrUndefined(N.value)&&oe.isNullOrUndefined(N.image)?M.drawRectangle(u,c,s.x+de(this.left-l)+.5,s.y+m,de(y),de(d.height)):(M.drawRectangle(u,c,s.x+de(this.left-l)+.5,s.y+m,de(y),de(d.height)),b=void 0,oe.isNullOrUndefined(d.taskbarTemplate.image)?b=0:(b=d.taskbarTemplate.image[0].width,T=new le.PdfBitmap(d.taskbarTemplate.image[0].base64),M.drawImage(T,s.x+de(this.left-l)+1,s.y+m+1+de((d.height-d.taskbarTemplate.image[0].height)/2),de(d.taskbarTemplate.image[0].width),de(d.taskbarTemplate.image[0].height))),oe.isNullOrUndefined(d.taskbarTemplate.value)||(this.stringLeft=de(this.left),S=this.getWidth(d.taskbarTemplate.value,o.endPoint-this.stringLeft,15),M.drawString(S.lines[0].text,I,p,h,s.x+de(this.left-l)+b,s.y+m,de(D),de(this.height),U),oe.isNullOrUndefined(S.remainder))||(this.remainString=S.remainder,this.stringLeft=o.endPoint)),d.isAutoSchedule&&!d.isSpliterTask&&(C=0,C=this.progressWidth<=y?this.progressWidth:y,oe.isNullOrUndefined(N.image)&&oe.isNullOrUndefined(N.value)&&(this.isAutoFit()?M.drawRectangle(g,f,s.x+(this.left-l)+.5,s.y+m,C,de(d.height)):M.drawRectangle(g,f,s.x+de(this.left-l)+.5,s.y+m,de(C),de(d.height))),this.progressWidth-=C,this.parent.labelSettings.taskLabel)&&!oe.isNullOrUndefined(this.taskLabel)&&(D=O?y:C,this.stringLeft=this.left,oe.isNullOrUndefined(d.taskbarTemplate.value)?(S=this.getWidth(this.taskLabel.toString(),o.endPoint-this.stringLeft,15),M.drawString(S.lines[0].text,t,x,e,s.x+de(this.left-l),s.y+m,de(D),de(this.height),U),oe.isNullOrUndefined(S.remainder)||(this.remainString=S.remainder,this.stringLeft=o.endPoint)):this.isAutoFit()?M.drawString(this.taskLabel.toString(),t,x,e,s.x+(this.left-l)-(F.left+F.right),s.y+m-(F.top+F.bottom),D,de(this.height),U):M.drawString(this.taskLabel.toString(),t,x,e,s.x+de(this.left-l)-(F.left+F.right),s.y+m-(F.top+F.bottom),de(D),de(this.height),U))),d.isSpliterTask&&d.segment.map(function(e,t){var i=oe.isNullOrUndefined(R.taskSegmentStyles)?g:new le.PdfPen(R.taskSegmentStyles[t].progressColor),n=oe.isNullOrUndefined(R.taskSegmentStyles)?f:new le.PdfSolidBrush(R.taskSegmentStyles[t].progressColor);R.isAutoFit()?M.drawRectangle(i,n,s.x+(R.left+e.left-l)+.5,s.y+m,e.progressWidth,de(d.height)):M.drawRectangle(i,n,s.x+de(R.left+e.left-l)+.5,s.y+m,de(e.progressWidth),de(d.height)),0===R.segmentCollection[parseInt(t.toString(),10)].width?R.segmentCollection[parseInt(t.toString(),10)].progressWidth=0:e.width-R.segmentCollection[parseInt(t.toString(),10)].width<e.progressWidth&&e.width!==R.segmentCollection[t].width&&(R.segmentCollection[parseInt(t.toString(),10)].progressWidth=e.progressWidth-(e.width-R.segmentCollection[t].width))})):this.drawUnscheduledTask(M,s,l,m):(this.isAutoFit()?M.drawRectangle(A,null,s.x+(this.left-l)+.5,s.y+m,y,de(d.height)):M.drawRectangle(A,null,s.x+de(this.left-l)+.5,s.y+m,de(y),de(d.height)),M.save(),M.setTransparency(.87),this.isAutoFit()?M.drawRectangle(null,G,s.x+(this.left-l)+.5,s.y+m,y,de(d.height)):M.drawRectangle(null,G,s.x+de(this.left-l)+.5,s.y+m,de(y),de(d.height)),M.restore(),this.isAutoFit()?M.drawRectangle(null,z,s.x+(this.left-l)+.5,s.y+m,P,de(d.height)):M.drawRectangle(null,z,s.x+de(this.left-l)+.5,s.y+m,de(P),de(d.height)),d.progressWidth=d.progressWidth-P):this.drawUnscheduledTask(M,s,l,m):(w=k=void 0,this.isAutoFit()?(k=new le.PdfLinearGradientBrush(new le.PointF(s.x+(this.left-l)+.5+y/2,0),new le.PointF(s.x+(this.left-l),0),new le.PdfColor(d.unscheduledTaskBarColor),new le.PdfColor(255,255,255)),M.drawRectangle(k,s.x+(this.left-l)+.5,s.y+m,y,de(d.height)),w=new le.PdfLinearGradientBrush(new le.PointF(s.x+(this.left-l)+.5+y,0),new le.PointF(s.x+(this.left-l)+y/2,0),new le.PdfColor(255,255,255),new le.PdfColor(d.unscheduledTaskBarColor)),M.drawRectangle(w,s.x+(this.left-l)+.5+y/2,s.y+m,y/2,de(d.height)),(N.image||N.value)&&(b=void 0,oe.isNullOrUndefined(d.taskbarTemplate.image)?b=0:(b=d.taskbarTemplate.image[0].width,T=new le.PdfBitmap(d.taskbarTemplate.image[0].base64),M.drawImage(T,s.x+(this.left-l)+.5,s.y+m,de(d.taskbarTemplate.image[0].width),de(d.taskbarTemplate.image[0].height))),oe.isNullOrUndefined(d.taskbarTemplate.value)||M.drawString(d.taskbarTemplate.value,I,p,h,s.x+(this.left-l)+.5+b,s.y+m,de(d.width),de(this.height),U))):(k=new le.PdfLinearGradientBrush(new le.PointF(s.x+de(this.left-l)+.5+de(y)/2,0),new le.PointF(s.x+de(this.left-l),0),new le.PdfColor(d.unscheduledTaskBarColor),new le.PdfColor(255,255,255)),M.drawRectangle(k,s.x+de(this.left-l)+.5,s.y+m,de(y),de(d.height)),w=new le.PdfLinearGradientBrush(new le.PointF(s.x+de(this.left-l)+.5+de(y),0),new le.PointF(s.x+de(this.left-l)+de(y)/2,0),new le.PdfColor(255,255,255),new le.PdfColor(d.unscheduledTaskBarColor)),M.drawRectangle(w,s.x+de(this.left-l)+.5+de(y)/2,s.y+m,de(y)/2,de(d.height)),(N.image||N.value)&&(b=void 0,oe.isNullOrUndefined(d.taskbarTemplate.image)?b=0:(b=d.taskbarTemplate.image[0].width,T=new le.PdfBitmap(d.taskbarTemplate.image[0].base64),M.drawImage(T,s.x+de(this.left-l)+.5,s.y+m,de(d.taskbarTemplate.image[0].width),de(d.taskbarTemplate.image[0].height))),oe.isNullOrUndefined(d.taskbarTemplate.value)||M.drawString(d.taskbarTemplate.value,I,p,h,s.x+de(this.left-l)+.5+b,s.y+m,de(d.width),de(this.height),U)))),this.left=0,this.isCompleted=!1,this.startPage=E):X<=o.endDate&&o.startDate<=X&&!this.isCompleted?(this.isStartPoint||(this.taskStartPoint=Ha({},s),this.isStartPoint=!0),this.isScheduledTask||"duration"!==this.unscheduledTaskBy?!d.isAutoSchedule&&d.isParentTask?((J=new le.PdfPath).addEllipse(0,0,5,5),M.save(),$=s.x+de(this.left+.5),ee=de(d.width)+$-5,te=s.y+m,M.drawLine(n,$,te,ee,te),M.translateTransform(ee,te-2),M.drawPath(W,H,J),M.restore(),n.dashStyle=le.PdfDashStyle.Solid):d.isAutoSchedule||d.isParentTask?this.isScheduledTask||"endDate"!==this.unscheduledTaskBy?d.isSpliterTask?(a.dashStyle=le.PdfDashStyle.Dot,M.drawLine(a,new le.PointF(s.x+de(this.left)+.5,s.y+m+de(d.height/2)),new le.PointF(de(d.width)+s.x+de(this.left),s.y+m+de(d.height/2))),d.segmentCollection.map(function(e,t){var i=oe.isNullOrUndefined(R.taskSegmentStyles)?u:new le.PdfPen(R.taskSegmentStyles[t].taskBorderColor),t=oe.isNullOrUndefined(R.taskSegmentStyles)?c:new le.PdfSolidBrush(R.taskSegmentStyles[t].taskColor);0!==e.width&&(M.drawRectangle(i,t,s.x+de(d.left+.5+e.left),s.y+m,de(e.width),de(d.height)),N.image||N.value)&&(i=void 0,oe.isNullOrUndefined(d.taskbarTemplate.image)?i=0:(i=d.taskbarTemplate.image[0].width,t=new le.PdfBitmap(d.taskbarTemplate.image[0].base64),M.drawImage(t,s.x+de(d.left+.5+e.left),s.y+m,de(d.taskbarTemplate.image[0].width),de(d.taskbarTemplate.image[0].height))),oe.isNullOrUndefined(d.taskbarTemplate.value)||M.drawString(d.taskbarTemplate.value,I,p,h,s.x+de(d.left+.5+e.left)+i,s.y+m,de(e.width),de(d.height),U))})):M.drawRectangle(u,c,s.x+de(d.left+.5),s.y+m,de(d.width),de(d.height)):this.drawUnscheduledTask(M,s,l,m):(M.drawRectangle(A,null,s.x+de(this.left+.5),s.y+m,de(d.width),de(d.height)),M.save(),M.setTransparency(.87),M.drawRectangle(null,G,s.x+de(this.left+.5),s.y+m,de(d.width),de(d.height)),M.restore(),M.drawRectangle(null,z,s.x+de(this.left+.5),s.y+m,de(d.progressWidth),de(d.height))):(w=k=void 0,k=new le.PdfLinearGradientBrush(new le.PointF(s.x+de(d.left+.5)+de(d.width)/2,0),new le.PointF(s.x+de(d.left+.5),0),new le.PdfColor(d.unscheduledTaskBarColor),new le.PdfColor(255,255,255)),M.drawRectangle(k,s.x+de(d.left+.5),s.y+m,de(d.width),de(d.height)),w=new le.PdfLinearGradientBrush(new le.PointF(s.x+de(d.left+.5)+de(d.width),0),new le.PointF(s.x+de(d.left+.5)+de(d.width)/2,0),new le.PdfColor(255,255,255),new le.PdfColor(d.unscheduledTaskBarColor)),M.drawRectangle(w,s.x+de(d.left+.5)+de(d.width)/2,s.y+m,de(d.width)/2,de(d.height)),(N.image||N.value)&&(b=void 0,oe.isNullOrUndefined(d.taskbarTemplate.image)?b=0:(b=d.taskbarTemplate.image[0].width,T=new le.PdfBitmap(d.taskbarTemplate.image[0].base64),M.drawImage(T,s.x+de(d.left+.5),s.y+m,de(d.taskbarTemplate.image[0].width),de(d.taskbarTemplate.image[0].height))),oe.isNullOrUndefined(d.taskbarTemplate.value)||M.drawString(d.taskbarTemplate.value,I,p,h,s.x+de(d.left+.5)+b,s.y+m,de(d.width),de(this.height),U))),this.isScheduledTask&&!d.isSpliterTask?(oe.isNullOrUndefined(N.image)&&oe.isNullOrUndefined(N.value)&&d.isAutoSchedule&&M.drawRectangle(g,f,s.x+de(d.left+.5),s.y+m,de(d.progressWidth),de(d.height)),oe.isNullOrUndefined(this.taskLabel)||(D=this.progressWidth,O&&(D=this.width),O&&oe.isNullOrUndefined(d.taskbarTemplate.value)?oe.isNullOrUndefined(this.remainString)||(S=this.getWidth(this.remainString,o.endPoint-this.stringLeft,15),M.drawString(S.lines[0].text,t,x,e,s.x+de(this.left)-(F.left+F.right),s.y+m-(F.top+F.bottom),de(D),de(this.height),U)):oe.isNullOrUndefined(this.taskLabel)||O||(D=this.progressWidth,O&&(D=this.width),M.drawString(this.taskLabel.toString(),t,x,e,s.x+de(this.left)-(F.left+F.right),s.y+m-(F.top+F.bottom),de(D),de(this.height),U)))):d.isSpliterTask&&d.segmentCollection.map(function(e,t){var i=oe.isNullOrUndefined(R.taskSegmentStyles)?g:new le.PdfPen(R.taskSegmentStyles[t].progressColor),t=oe.isNullOrUndefined(R.taskSegmentStyles)?f:new le.PdfSolidBrush(R.taskSegmentStyles[t].progressColor);M.drawRectangle(i,t,s.x+de(d.left+.5+e.left),s.y+m,de(e.progressWidth),de(d.height))}),this.isCompleted=!0,this.endPage=E):_<o.startDate&&X>o.endDate&&(this.isStartPoint||(this.taskStartPoint=Ha({},s),this.isStartPoint=!0),this.isScheduledTask||"duration"!==this.unscheduledTaskBy?this.isScheduledTask||"endDate"!==this.unscheduledTaskBy?d.isAutoSchedule||d.isParentTask?!d.isAutoSchedule&&d.isParentTask?(n.dashStyle=le.PdfDashStyle.Solid,M.drawLine(n,s.x+de(d.left)+.5,s.y+m,de(o.totalWidth),s.y+m)):(M.drawRectangle(u,c,s.x+de(d.left)+.5,s.y+m,de(o.totalWidth),de(d.height)),oe.isNullOrUndefined(d.taskbarTemplate.value)||oe.isNullOrUndefined(this.remainString)||(S=this.getWidth(this.remainString,o.endPoint-this.stringLeft,15),M.drawString(S.lines[0].text,I,p,h,s.x+de(d.left)+.5,s.y+m,de(o.totalWidth),de(this.height),U)),this.isScheduledTask&&!d.isParentTask&&(C=0,C=this.progressWidth<=o.totalWidth?this.progressWidth:o.totalWidth,oe.isNullOrUndefined(N.image)&&oe.isNullOrUndefined(N.value)&&M.drawRectangle(g,f,s.x+de(d.left)+.5,s.y+m,de(C),de(d.height)),this.progressWidth-=C,oe.isNullOrUndefined(this.taskLabel)||(D=C,O&&(D=this.width),M.drawString(this.taskLabel.toString(),t,x,e,s.x+de(this.left)-(F.left+F.right),s.y+m-(F.top+F.bottom),de(D),de(this.height),U)))):(M.drawRectangle(A,null,s.x+de(d.left)+.5,s.y+m,de(o.totalWidth),de(d.height)),M.save(),M.setTransparency(.87),M.drawRectangle(null,G,s.x+de(d.left)+.5,s.y+m,de(o.totalWidth),de(d.height)),M.restore(),C=0,C=this.progressWidth<=o.totalWidth?this.progressWidth:o.totalWidth,oe.isNullOrUndefined(N.image)&&oe.isNullOrUndefined(N.value)&&M.drawRectangle(g,f,s.x+de(d.left)+.5,s.y+m,de(C),de(d.height)),this.progressWidth-=C,M.drawRectangle(null,z,s.x+de(d.left)+.5,s.y+m,de(C),de(d.height))):this.drawUnscheduledTask(M,s,l,m):(w=k=void 0,k=new le.PdfLinearGradientBrush(new le.PointF(s.x+de(d.left)+.5+de(o.totalWidth)/2,0),new le.PointF(s.x+de(d.left),0),new le.PdfColor(d.unscheduledTaskBarColor),new le.PdfColor(255,255,255)),M.drawRectangle(k,s.x+de(d.left)+.5,s.y+m,de(o.totalWidth),de(d.height)),w=new le.PdfLinearGradientBrush(new le.PointF(s.x+de(d.left)+.5+de(o.totalWidth),0),new le.PointF(s.x+de(d.left)+de(o.totalWidth)/2,0),new le.PdfColor(255,255,255),new le.PdfColor(d.unscheduledTaskBarColor)),M.drawRectangle(w,s.x+de(d.left)+.5+de(o.totalWidth)/2,s.y+m,de(o.totalWidth)/2,de(d.height)),(N.image||N.value)&&(b=void 0,oe.isNullOrUndefined(d.taskbarTemplate.image)?b=0:(b=d.taskbarTemplate.image[0].width,T=new le.PdfBitmap(d.taskbarTemplate.image[0].base64),M.drawImage(T,s.x+de(d.left)+.5,s.y+m,de(d.taskbarTemplate.image[0].width),de(d.taskbarTemplate.image[0].height))),oe.isNullOrUndefined(d.taskbarTemplate.value)||M.drawString(d.taskbarTemplate.value,I,p,h,s.x+de(d.left+.5)+b,s.y+m,de(d.width),de(this.height),U))),this.isCompleted=!1,this.width-=o.totalWidth),this.parent.renderBaseline&&d.baselineStartDate&&d.baselineEndDate&&(o.startDate<=d.baselineStartDate&&d.baselineEndDate<=o.endDate?(this.isStartPoint||(this.taskStartPoint=Ha({},s),this.isStartPoint=!0),this.parent.renderBaseline&&d.baselineStartDate&&d.baselineEndDate&&(this.isAutoFit()?M.drawRectangle(re,se,s.x+(d.baselineLeft-l)+.5,s.y+m+de(d.height+3),d.baselineWidth,de(this.baselineHeight)):M.drawRectangle(re,se,s.x+de(d.baselineLeft-l)+.5,s.y+m+de(d.height+3),de(d.baselineWidth),de(this.baselineHeight))),this.isCompletedBaseline=!0,this.startPage=E,this.endPage=E):o.startDate<=d.baselineStartDate&&o.endDate>=d.baselineStartDate&&d.baselineEndDate>=o.endDate?(this.isStartPoint||(this.taskStartPoint=Ha({},s),this.isStartPoint=!0),v=0,(ie=this.baselineWidth)<(v=o.totalWidth-(d.baselineLeft-l))&&(v=ie),this.parent.renderBaseline&&d.baselineStartDate&&d.baselineEndDate&&(this.isAutoFit()?M.drawRectangle(re,se,s.x+(d.baselineLeft-l)+.5,s.y+m+de(d.height+3),v,de(this.baselineHeight)):M.drawRectangle(re,se,s.x+de(d.baselineLeft-l)+.5,s.y+m+de(d.height+3),de(v),de(this.baselineHeight))),d.baselineWidth=d.baselineWidth-v,this.baselineLeft=0,this.isCompletedBaseline=!1,this.startPage=E):d.baselineEndDate<=o.endDate&&o.startDate<=d.baselineEndDate&&!this.isCompletedBaseline?(this.parent.renderBaseline&&d.baselineStartDate&&d.baselineEndDate&&(this.isAutoFit()?M.drawRectangle(re,se,s.x+(d.baselineLeft+.5),s.y+m+de(d.height+3),d.baselineWidth,de(this.baselineHeight)):M.drawRectangle(re,se,s.x+de(d.baselineLeft+.5),s.y+m+de(d.height+3),de(d.baselineWidth),de(this.baselineHeight))),this.isCompletedBaseline=!0,this.endPage=E):d.baselineStartDate<o.startDate&&d.baselineEndDate>o.endDate&&(this.parent.renderBaseline&&d.baselineStartDate&&d.baselineEndDate&&(this.isAutoFit()?M.drawRectangle(re,se,s.x+d.baselineLeft+.5,s.y+m+de(d.height+3),o.totalWidth,de(d.baselineHeight)):M.drawRectangle(re,se,s.x+de(d.baselineLeft)+.5,s.y+m+de(d.height+3),de(o.totalWidth),de(d.baselineHeight))),this.isCompletedBaseline=!1,this.baselineWidth-=o.totalWidth)),!this.isAutoSchedule&&d.isParentTask&&(o.startDate<=d.autoStartDate&&d.autoEndDate<=o.endDate?(this.isStartPoint||(this.taskStartPoint=Ha({},s),this.isStartPoint=!0),!d.isAutoSchedule&&d.isParentTask&&(this.isAutoFit()?M.drawRectangle(i,null,s.x+(this.autoLeft-l)+.5,s.y+m+10,this.autoWidth,de(12)):M.drawRectangle(i,null,s.x+de(this.autoLeft-l)+.5,s.y+m+10,de(this.autoWidth),de(12)),M.save(),M.setTransparency(.87),this.isAutoFit()?M.drawRectangle(null,j,s.x+(this.autoLeft-l)+.5,s.y+m+10,this.autoWidth,de(12)):M.drawRectangle(null,j,s.x+de(this.autoLeft-l)+.5,s.y+m+10,de(this.autoWidth),de(12)),M.restore(),this.isAutoFit()?M.drawRectangle(null,q,s.x+(this.autoLeft-l)+.5,s.y+m+10,d.progressWidth,de(12)):M.drawRectangle(null,q,s.x+de(this.autoLeft-l)+.5,s.y+m+10,de(d.progressWidth),de(12))),oe.isNullOrUndefined(this.taskLabel)||(this.isAutoFit()?M.drawString(this.taskLabel.toString(),t,x,e,s.x+(this.autoLeft-l)+.5-(F.left+F.right),s.y+m+8-(F.top+F.bottom),this.autoWidth,de(this.height),U):M.drawString(this.taskLabel.toString(),t,x,e,s.x+de(this.autoLeft-l)+.5-(F.left+F.right),s.y+m+8-(F.top+F.bottom),de(this.autoWidth),de(this.height),U)),this.isCompletedAutotask=!0,this.startPage=E,this.endPage=E):o.startDate<=d.autoStartDate&&o.endDate>=d.autoStartDate&&d.autoEndDate>=o.endDate?(this.isStartPoint||(this.taskStartPoint=Ha({},s),this.isStartPoint=!0),P=v=0,v=o.totalWidth-(this.autoLeft-l),P=o.totalWidth-(this.autoLeft-l),!d.isAutoSchedule&&d.isParentTask&&(this.isAutoFit()?M.drawRectangle(i,null,s.x+(this.autoLeft-l)+.5,s.y+m+10,v,de(12)):M.drawRectangle(i,null,s.x+de(this.autoLeft-l)+.5,s.y+m+10,de(v),de(12)),M.save(),M.setTransparency(.87),this.isAutoFit()?M.drawRectangle(null,j,s.x+(this.autoLeft-l)+.5,s.y+m+10,v,de(12)):M.drawRectangle(null,j,s.x+de(this.autoLeft-l)+.5,s.y+m+10,de(v),de(12)),M.restore(),this.isAutoFit()?M.drawRectangle(null,q,s.x+(this.autoLeft-l)+.5,s.y+m+10,d.progressWidth,de(12)):M.drawRectangle(null,q,s.x+de(this.autoLeft-l)+.5,s.y+m+10,de(P),de(12)),d.autoWidth=d.autoWidth-v,d.progressWidth=d.progressWidth-P),this.parent.labelSettings.taskLabel&&!oe.isNullOrUndefined(this.taskLabel)&&(this.stringLeft=this.autoLeft,oe.isNullOrUndefined(d.taskbarTemplate.value)?(S=this.getWidth(this.taskLabel.toString(),o.endPoint-this.stringLeft,15),M.drawString(S.lines[0].text,t,x,e,s.x+de(this.autoLeft-l)+.5,s.y+m+10,de(d.progressWidth),de(this.height),U),oe.isNullOrUndefined(S.remainder)||(this.remainString=S.remainder,this.stringLeft=o.endPoint)):this.isAutoFit()?M.drawString(this.taskLabel.toString(),t,x,e,s.x+(this.autoLeft-l)+.5-(F.left+F.right),s.y+m+8-(F.top+F.bottom),d.progressWidth,de(this.height),U):M.drawString(this.taskLabel.toString(),t,x,e,s.x+de(this.autoLeft-l)+.5-(F.left+F.right),s.y+m+8-(F.top+F.bottom),de(d.progressWidth),de(this.height),U)),this.autoLeft=0,this.isCompletedAutotask=!1,this.startPage=E):d.autoEndDate<=o.endDate&&o.startDate<=d.autoEndDate&&!this.isCompletedAutotask?(this.isStartPoint?!d.isAutoSchedule&&d.isParentTask&&(M.drawRectangle(i,null,s.x+de(this.autoLeft+.5),s.y+m+10,de(d.autoWidth),de(12)),M.save(),M.setTransparency(.87),M.drawRectangle(j,s.x+de(this.autoLeft+.5),s.y+m+10,de(d.autoWidth),de(12)),M.restore(),M.drawRectangle(null,q,s.x+de(this.autoLeft+.5),s.y+m+10,de(d.progressWidth),de(12))):(this.taskStartPoint=Ha({},s),this.isStartPoint=!0),oe.isNullOrUndefined(this.taskLabel)||(O&&oe.isNullOrUndefined(d.taskbarTemplate.value)?oe.isNullOrUndefined(this.remainString)||(S=this.getWidth(this.remainString,o.endPoint-this.stringLeft,15),M.drawString(S.lines[0].text,t,x,e,s.x+de(this.autoLeft+.5)-(F.left+F.right),s.y+m+8-(F.top+F.bottom),de(d.progressWidth),de(this.height),U)):oe.isNullOrUndefined(this.taskLabel)||O||M.drawString(this.taskLabel.toString(),t,x,e,s.x+de(this.autoLeft+.5)-(F.left+F.right),s.y+m+8-(F.top+F.bottom),de(d.progressWidth),de(this.height),U)),this.isCompletedAutotask=!0,this.endPage=E):d.autoStartDate<o.startDate&&d.autoEndDate>o.endDate&&(this.isStartPoint||(this.taskStartPoint=Ha({},s),this.isStartPoint=!0),!d.isAutoSchedule&&d.isParentTask&&(C=0,C=this.progressWidth<=o.totalWidth?this.progressWidth:o.totalWidth,this.isAutoFit()?M.drawRectangle(null,q,s.x+(this.autoLeft+.5),s.y+m+10,C,de(12)):0!==d.progressWidth&&M.drawRectangle(null,q,s.x+de(this.autoLeft+.5),s.y+m+10,de(C),de(12)),this.progressWidth-=C,this.isAutoFit()?M.drawRectangle(i,null,s.x+this.autoLeft+.5,s.y+m+10,o.totalWidth,de(12)):M.drawRectangle(i,null,s.x+de(this.autoLeft)+.5,s.y+m+10,de(o.totalWidth),de(12)),M.save(),M.setTransparency(.87),this.isAutoFit()?M.drawRectangle(null,j,s.x+(this.autoLeft-l)+.5,s.y+m+10,o.totalWidth,de(12)):M.drawRectangle(null,j,s.x+de(this.autoLeft)+.5,s.y+m+10,de(o.totalWidth),de(12)),M.restore()),this.isCompletedAutotask=!1,this.autoWidth-=o.totalWidth)),!oe.isNullOrUndefined(d.indicators)&&0<d.indicators.length&&d.indicators.map(function(e,t){var i,n,a=R.parent.dateValidationModule.getDateFromFormat(e.date,!0);o.startDate<=a&&a<=o.endDate&&(a=R.parent.chartRowsModule.getIndicatorleft(e.date),oe.isNullOrUndefined(e.base64)||(i=new le.PdfBitmap(e.base64),R.isAutoFit()?(M.drawImage(i,s.x+(a-l)+.5+10-R.parent.perDayWidth/2,s.y+m,10,10),n=M.save(),M.setClip(new le.RectangleF(s.x,s.y,r.contentWidth,L)),M.drawString(e.name,ae,null,le.PdfBrushes.Black,s.x+(a-l)+.5+15+10-R.parent.perDayWidth/2,s.y+m,null)):(M.drawImage(i,s.x+de(a-l)+.5+10,s.y+m,10,10),n=M.save(),M.setClip(new le.RectangleF(s.x,s.y,r.contentWidth,L)),M.drawString(e.name,ae,null,le.PdfBrushes.Black,s.x+de(a-l)+.5+15+10,s.y+m,null)),M.restore(n)))})),this.drawRightLabel(r,s,o,l),ne},Ga.prototype.getPdfFont=function(e){var t,i,n;return e&&e.label&&(e.label.fontSize||e.label.fontStyle||e.label.fontFamily)&&(t=e.label.fontSize||9,i=e.label.fontFamily,i=e.label.fontFamily?i:this.fontFamily,n=e.label.fontStyle,e=e.label.fontStyle?this.parent.pdfExportModule.helper.getFontStyle(n):le.PdfFontStyle.Regular,n=new le.PdfStandardFont(i,t,e)),n},Ga.prototype.drawRightLabel=function(e,t,i,n){var a=e.graphics;if(oe.isNullOrUndefined(this.rightTaskLabel.value))if(oe.isNullOrUndefined(this.labelSettings.rightLabel.image))this.labelSettings.rightLabel.value&&this.drawRightLabelValue(e,t,i,n,this.labelSettings.rightLabel.value);else{this.previousWidthofRightImage=0;for(var r,s=this.previousWidthofRightValue=0;s<this.labelSettings.rightLabel.image.length;s++)this.drawRigthlabelImage(e,t,i,n,this.labelSettings.rightLabel.image[s]),this.labelSettings.rightLabel.value&&(r=this.labelSettings.rightLabel.value.split(","))&&(this.rightTaskLabel.isCompleted=!1,this.drawRightLabelValue(e,t,i,n-this.spaceBetweenImageAndValue,r[s]))}else{var o,l,d,h,p,u,c,g=this.rightTaskLabel.isLeftCalculated||this.isAutoFit()?this.rightTaskLabel.left:de(this.rightTaskLabel.left),f=void 0,f=this.isAutoFit()?g-n+t.x:g-de(n)+t.x,g=this.isAutoFit()?de(g):g;i.startPoint<=g&&g<i.endPoint&&!oe.isNullOrUndefined(this.rightTaskLabel.value)&&!this.rightTaskLabel.isCompleted&&(g=this.getWidth(this.rightTaskLabel.value,i.endPoint-g,15),o=new le.PdfStandardFont(this.fontFamily,9),l=void 0,c=this.parent.pdfExportModule.helper.exportProps.ganttStyle,oe.isNullOrUndefined(c)||oe.isNullOrUndefined(c.label)||oe.isNullOrUndefined(c.label.fontSize)&&oe.isNullOrUndefined(c.label.fontStyle)&&oe.isNullOrUndefined(c.label.fontFamily)||(l=this.getPdfFont(c)),oe.isNullOrUndefined(l)||(o=l),l={left:0,right:0,top:0,bottom:0},oe.isNullOrUndefined(c)||oe.isNullOrUndefined(c.label)||oe.isNullOrUndefined(c.label.padding)||(l=c.label.padding),!oe.isNullOrUndefined(this.parent.pdfExportModule.helper.exportProps.ganttStyle)&&this.parent.pdfExportModule.helper.exportProps.ganttStyle.font&&(o=this.parent.pdfExportModule.helper.exportProps.ganttStyle.font),d=(de(this.parent.rowHeight)-g.actualSize.height)/2,d=new le.PointF(f+l.left,t.y+d+l.top),f=new le.SizeF(e.contentWidth-f-(l.left+l.right),g.actualSize.height-(l.top+l.bottom)),l=new le.RectangleF(d,f),(d=new le.PdfStringFormat).alignment=le.PdfTextAlignment.Left,d.lineAlignment=le.PdfVerticalAlignment.Middle,oe.isNullOrUndefined(c)||oe.isNullOrUndefined(c.label)||oe.isNullOrUndefined(c.label.format)||oe.isNullOrUndefined(c.label.format.alignment)||(d.alignment=c.label.format.alignment),0<g.actualSize.width?(c=this.parent.pdfExportModule.helper.exportProps.ganttStyle,h=new le.PdfSolidBrush(c&&c.label&&c.label.fontBrush?c.label.fontBrush:this.labelColor),p=null,oe.isNullOrUndefined(c)||oe.isNullOrUndefined(c.label)||oe.isNullOrUndefined(c.label.backgroundColor)||(p=new le.PdfSolidBrush(c.label.backgroundColor)),u=null,oe.isNullOrUndefined(c)||oe.isNullOrUndefined(c.label)||oe.isNullOrUndefined(c.label.borderColor)||(u=new le.PdfPen(c.label.borderColor)),c=o.measureString(g.lines[0].text),a.drawRectangle(u,p,l.x-3,l.y,c.width+6,c.height),a.drawString(g.lines[0].text,o,null,h,l.x,l.y,f.width,f.height,d),null!==g.remainder?(this.rightTaskLabel.value=g.remainder,this.rightTaskLabel.left=i.endPoint,this.rightTaskLabel.isLeftCalculated=!0):this.rightTaskLabel.isCompleted=!0):this.rightTaskLabel.left=i.endPoint)}},Ga.prototype.drawRigthlabelImage=function(e,t,i,n,a){var r,s,e=e.graphics;oe.isNullOrUndefined(this.labelSettings.rightLabel)||oe.isNullOrUndefined(this.labelSettings.rightLabel.image)||(s=void(this.labelSettings.isLeftCalculated?r=this.rightTaskLabel.left:this.isAutoFit()?1<this.labelSettings.rightLabel.image.length?(r=this.rightTaskLabel.left+ +this.previousWidthofRightValue,this.previousWidthofRightImage=a.width):r=this.rightTaskLabel.left:(s=void 0,oe.isNullOrUndefined(this.labelSettings.rightLabel.value)||(s=this.labelSettings.rightLabel.value.split(",")),1<this.labelSettings.rightLabel.image.length&&1<s.length?(r=de(this.rightTaskLabel.left)+this.previousWidthofRightValue,this.previousWidthofRightImage=a.width):1<this.labelSettings.rightLabel.image.length?(r=de(this.rightTaskLabel.left)+this.previousWidthofRightImage,this.previousWidthofRightImage=a.width):r=de(this.rightTaskLabel.left))),s=this.isAutoFit()?r-n+t.x:r-de(n)+t.x,n=this.isAutoFit()?de(r):r,i.startPoint<=n&&n<i.endPoint&&!oe.isNullOrUndefined(this.labelSettings.rightLabel)&&!this.rightTaskLabel.isCompleted&&(r=new le.SizeF(a.width,a.height),n=(de(this.parent.rowHeight)-r.height)/2,s=new le.PointF(s,t.y+n),t=new le.SizeF(r.width,r.height),n=new le.RectangleF(s,t),s=new le.PdfBitmap(a.base64),0<r.width?(e.drawImage(s,n.x,n.y,r.width,r.height),null!==this.labelSettings.rightLabel.value?this.rightTaskLabel.isLeftCalculated=!0:oe.isNullOrUndefined(this.labelSettings.rightLabel.value)&&(this.rightTaskLabel.isCompleted=!0)):this.rightTaskLabel.left=i.endPoint))},Ga.prototype.drawRightLabelValue=function(e,t,i,n,a){var r,s,o,e=e.graphics;oe.isNullOrUndefined(this.labelSettings.rightLabel.value)||(s=void(this.labelSettings.isLeftCalculated?o=this.rightTaskLabel.left:this.isAutoFit()?this.labelSettings.rightLabel.image?1<this.labelSettings.rightLabel.image.length?(o=this.rightTaskLabel.left+this.previousWidthofRightImage+this.previousWidthofRightValue,oe.isNullOrUndefined(a)||(r=this.getWidthofrightLabel(a,i.endPoint-o,15),this.previousWidthofRightValue+=r.actualSize.width+this.previousWidthofRightImage)):o=this.rightTaskLabel.left+this.labelSettings.rightLabel.image[0].width:o=this.rightTaskLabel.left:this.labelSettings.rightLabel.image?1<this.labelSettings.rightLabel.image.length?(o=de(this.rightTaskLabel.left)+this.previousWidthofRightImage+this.previousWidthofRightValue,oe.isNullOrUndefined(a)||(r=this.getWidthofrightLabel(a,i.endPoint-o,15),this.previousWidthofRightValue+=r.actualSize.width+this.previousWidthofRightImage)):o=de(this.rightTaskLabel.left)+this.labelSettings.rightLabel.image[0].width:o=de(this.rightTaskLabel.left)),s=this.isAutoFit()?o-n+t.x:o-de(n)+t.x,n=this.isAutoFit()?de(o):o,i.startPoint<=n&&n<i.endPoint&&!oe.isNullOrUndefined(a)&&!this.rightTaskLabel.isCompleted&&(r=this.getWidthofrightLabel(a,i.endPoint-n,15),o=new le.PdfStandardFont(this.fontFamily,9),!oe.isNullOrUndefined(this.parent.pdfExportModule.helper.exportProps.ganttStyle)&&this.parent.pdfExportModule.helper.exportProps.ganttStyle.font&&(o=this.parent.pdfExportModule.helper.exportProps.ganttStyle.font),n=(de(this.parent.rowHeight)-r.actualSize.height)/2,s=new le.PointF(s,t.y+n),t=new le.SizeF(r.actualSize.width,r.actualSize.height),n=new le.RectangleF(s,t),(s=new le.PdfStringFormat).alignment=le.PdfTextAlignment.Right,s.lineAlignment=le.PdfVerticalAlignment.Middle,0<r.actualSize.width?(t=new le.PdfSolidBrush(this.labelColor),o=this.labelSettings.rightLabel.fontStyle.fontSize?new le.PdfStandardFont(this.labelSettings.rightLabel.fontStyle.fontFamily,this.labelSettings.rightLabel.fontStyle.fontSize,this.labelSettings.rightLabel.fontStyle.fontStyle):o,t=this.labelSettings.rightLabel.fontStyle.fontColor?new le.PdfSolidBrush(this.labelSettings.rightLabel.fontStyle.fontColor):t,e.drawString(a,o,null,t,n.x,n.y,r.actualSize.width,r.actualSize.height,s),oe.isNullOrUndefined(r.remainder)||null===r.remainder?oe.isNullOrUndefined(this.labelSettings.rightLabel.value)&&(this.rightTaskLabel.isCompleted=!0):(this.rightTaskLabel.value=r.remainder,this.rightTaskLabel.left=i.endPoint,this.rightTaskLabel.isLeftCalculated=!0)):this.rightTaskLabel.left=i.endPoint))},Ga.prototype.drawLeftLabel=function(e,t,i,n,a){var r=e.graphics;if(oe.isNullOrUndefined(this.leftTaskLabel.value))if(oe.isNullOrUndefined(this.labelSettings.leftLabel)||oe.isNullOrUndefined(this.labelSettings.leftLabel.image))oe.isNullOrUndefined(this.labelSettings.leftLabel)||oe.isNullOrUndefined(this.labelSettings.leftLabel.value)||this.drawLeftLabelValue(e,t,i,n,this.labelSettings.leftLabel.value);else{this.previousWidthofLeftImage=0,this.previousWidthofLeftValue=0;for(var s=this.totalLeftWidth=0;s<this.labelSettings.leftLabel.image.length;s++){var o=void 0,l=void 0,d=(oe.isNullOrUndefined(this.labelSettings.leftLabel.value)||(o=this.labelSettings.leftLabel.value.split(","),l=this.getWidth(o[s],Number.MAX_VALUE,15)),oe.isNullOrUndefined(l)?0:l.actualSize.width);this.totalLeftWidth+=this.labelSettings.leftLabel.image[s].width+d}for(s=0;s<this.labelSettings.leftLabel.image.length;s++)this.drawLeftLabelImage(e,t,i,n,this.labelSettings.leftLabel.image[s]),this.labelSettings.leftLabel.value&&(o=this.labelSettings.leftLabel.value.split(","))&&this.drawLeftLabelValue(e,t,i,n-this.spaceBetweenImageAndValue,o[s])}else{var l,h,p,u,c,g,f=this.left,f=(this.leftTaskLabel.isLeftCalculated?p=this.leftTaskLabel.left:(l=this.getWidth(this.leftTaskLabel.value,Number.MAX_VALUE,15),h=this.isMilestone?Math.floor(this.parent.chartRowsModule.taskBarHeight/2)+33:33,p=this.isAutoFit()?f-h-l.actualSize.width:de(f-h)-l.actualSize.width,this.leftTaskLabel.left=p,this.leftTaskLabel.isLeftCalculated=!0),void 0);this.isAutoFit()?(f=p-de(n)+t.x,!a.isAutoSchedule&&a.isParentTask&&(g=a.left-a.autoLeft,f=a.left<a.autoLeft?p-n+t.x:p-n+t.x-g)):(f=p-de(n)+t.x,!a.isAutoSchedule&&a.isParentTask&&(g=de(a.left)-de(a.autoLeft),f=a.left<a.autoLeft?p-de(n)+t.x:p-de(n)+t.x-g)),i.startPoint<=p&&p<i.endPoint&&!oe.isNullOrUndefined(this.leftTaskLabel.value)&&!this.leftTaskLabel.isCompleted&&(l=this.getWidth(this.leftTaskLabel.value,i.endPoint-p,15),h=new le.PdfStandardFont(this.fontFamily,9),a=void 0,g=this.parent.pdfExportModule.helper.exportProps.ganttStyle,oe.isNullOrUndefined(g)||oe.isNullOrUndefined(g.label)||oe.isNullOrUndefined(g.label.fontSize)&&oe.isNullOrUndefined(g.label.fontStyle)&&oe.isNullOrUndefined(g.label.fontFamily)||(a=this.getPdfFont(g)),oe.isNullOrUndefined(a)||(h=a),!oe.isNullOrUndefined(this.parent.pdfExportModule.helper.exportProps.ganttStyle)&&this.parent.pdfExportModule.helper.exportProps.ganttStyle.font&&(h=this.parent.pdfExportModule.helper.exportProps.ganttStyle.font),p={left:0,right:0,top:0,bottom:0},oe.isNullOrUndefined(g)||oe.isNullOrUndefined(g.label)||oe.isNullOrUndefined(g.label.padding)||(p=g.label.padding),a=(de(this.parent.rowHeight)-l.actualSize.height)/2,f=new le.PointF(f+p.left,t.y+a+p.top),a=new le.SizeF(l.actualSize.width-(p.left+p.right),l.actualSize.height-(p.top+p.bottom)),p=new le.RectangleF(f,a),(f=new le.PdfStringFormat).alignment=le.PdfTextAlignment.Right,f.lineAlignment=le.PdfVerticalAlignment.Middle,0<l.actualSize.width?(a=new le.PdfSolidBrush(g&&g.label&&g.label.fontBrush?g.label.fontBrush:this.labelColor),u=null,oe.isNullOrUndefined(g)||oe.isNullOrUndefined(g.label)||oe.isNullOrUndefined(g.label.backgroundColor)||(u=new le.PdfSolidBrush(g.label.backgroundColor)),c=null,oe.isNullOrUndefined(g)||oe.isNullOrUndefined(g.label)||oe.isNullOrUndefined(g.label.borderColor)||(c=new le.PdfPen(g.label.borderColor)),g=h.measureString(l.lines[0].text),r.drawRectangle(c,u,p.x-3,p.y,g.width+6,g.height),r.drawString(l.lines[0].text,h,null,a,p.x,p.y,l.actualSize.width,l.actualSize.height,f),null!==l.remainder?(this.leftTaskLabel.value=l.remainder,this.leftTaskLabel.left=i.endPoint):this.leftTaskLabel.isCompleted=!0):this.leftTaskLabel.left=i.endPoint)}},Ga.prototype.drawLeftLabelImage=function(e,t,i,n,a){var r,s,o,l,e=e.graphics,d=this.left;oe.isNullOrUndefined(this.labelSettings.leftLabel)||oe.isNullOrUndefined(this.labelSettings.leftLabel.image)||(l=void(this.leftTaskLabel.isLeftCalculated?o=1<this.labelSettings.leftLabel.image.length?this.leftTaskLabel.left+this.previousWidthofLeftValue:this.leftTaskLabel.left:(r=new le.SizeF(a.width,a.height),s=this.isMilestone?Math.floor(this.parent.chartRowsModule.taskBarHeight/2)+33:33,l=this.labelSettings.leftLabel.value.split(","),this.isAutoFit()?0<this.labelSettings.leftLabel.image.length&&0<l.length?(o=d-this.totalLeftWidth-r.width,this.previousWidthofLeftImage+=r.width):o=d-s-r.width:0<this.labelSettings.leftLabel.image.length&&0<l.length?(o=de(d)-this.totalLeftWidth-r.width,this.previousWidthofLeftImage+=r.width):o=de(d-s)-r.width,this.leftTaskLabel.left=o,this.leftTaskLabel.isLeftCalculated=!0)),this.isAutoFit(),l=o-de(n)+t.x,i.startPoint<=o&&o<i.endPoint&&!oe.isNullOrUndefined(a)&&!this.leftTaskLabel.isCompleted&&(r=new le.SizeF(a.width,a.height),d=(de(this.parent.rowHeight)-r.height)/2,s=new le.PointF(l,t.y+d),n=new le.SizeF(r.width,r.height),o=new le.RectangleF(s,n),l=new le.PdfBitmap(a.base64),0<r.width?(e.drawImage(l,o.x,o.y,r.width,r.height),this.totalLeftWidth=this.totalLeftWidth-r.width):this.leftTaskLabel.left=i.endPoint))},Ga.prototype.drawLeftLabelValue=function(e,t,i,n,a){var r,s,o,l,d,h,p,u,c,e=e.graphics;oe.isNullOrUndefined(a)||(l=0,l=this.left,u=void(this.leftTaskLabel.isLeftCalculated?1===(c=this.labelSettings.leftLabel.value.split(",")).length?(h=this.leftTaskLabel.left+(this.previousWidthofLeftImage||0),this.labelSettings.left=h,r=this.getWidthofLeftLabel(a,Number.MAX_VALUE,15),this.previousWidthofLeftValue+=this.previousWidthofLeftImage+r.actualSize.width):1<c.length?(s=0!==this.previousWidthofLeftValue?this.previousWidthofLeftValue+this.previousWidthofLeftImage:this.previousWidthofLeftImage,h=this.leftTaskLabel.left+s,this.labelSettings.left=h,r=this.getWidthofLeftLabel(a,Number.MAX_VALUE,15),this.previousWidthofLeftValue+=this.previousWidthofLeftImage+r.actualSize.width):h=this.leftTaskLabel.left:(r=this.getWidthofLeftLabel(a,Number.MAX_VALUE,15),d=this.isMilestone?Math.floor(this.parent.chartRowsModule.taskBarHeight/2)+33:33,c=this.labelSettings.leftLabel.value.split(","),this.isAutoFit()?(p=(u=!oe.isNullOrUndefined(this.labelSettings.leftLabel.image))?this.labelSettings.leftLabel.image.length:0,1===c.length&&u&&1===p?(h=this.leftTaskLabel.left+this.previousWidthofLeftImage,this.labelSettings.left=h,o=this.getWidthofLeftLabel(a,Number.MAX_VALUE,15),this.previousWidthofLeftValue+=this.previousWidthofLeftImage+o.actualSize.width):1<c.length&&u&&1<p?(s=0!==this.previousWidthofLeftValue?this.previousWidthofLeftValue+this.previousWidthofLeftImage:this.previousWidthofLeftImage,h=this.leftTaskLabel.left+s,this.labelSettings.left=h,o=this.getWidthofLeftLabel(a,Number.MAX_VALUE,15),this.previousWidthofLeftValue+=this.previousWidthofLeftImage+o.actualSize.width):h=l-d-r.actualSize.width):h=de(l-d)-r.actualSize.width,this.leftTaskLabel.left=h,this.leftTaskLabel.isLeftCalculated=!0)),this.isAutoFit(),u=h-de(n)+t.x,p=this.isAutoFit()?de(h):h,i.startPoint<=p&&p<i.endPoint&&!oe.isNullOrUndefined(a)&&!this.leftTaskLabel.isCompleted&&(r=this.getWidthofLeftLabel(a,i.endPoint-p,15),s=new le.PdfStandardFont(this.fontFamily,9),!oe.isNullOrUndefined(this.parent.pdfExportModule.helper.exportProps.ganttStyle)&&this.parent.pdfExportModule.helper.exportProps.ganttStyle.font&&(s=this.parent.pdfExportModule.helper.exportProps.ganttStyle.font),o=(de(this.parent.rowHeight)-r.actualSize.height)/2,l=new le.PointF(u,t.y+o),d=new le.SizeF(r.actualSize.width,r.actualSize.height),n=new le.RectangleF(l,d),(h=new le.PdfStringFormat).alignment=le.PdfTextAlignment.Right,h.lineAlignment=le.PdfVerticalAlignment.Middle,0<r.actualSize.width?(p=new le.PdfSolidBrush(this.labelColor),u=this.labelSettings.leftLabel.fontStyle.fontSize?new le.PdfStandardFont(this.labelSettings.leftLabel.fontStyle.fontFamily,this.labelSettings.leftLabel.fontStyle.fontSize,this.labelSettings.leftLabel.fontStyle.fontStyle):s,t=this.labelSettings.leftLabel.fontStyle.fontColor?new le.PdfSolidBrush(this.labelSettings.leftLabel.fontStyle.fontColor):p,e.drawString(a,u,null,t,n.x,n.y,r.actualSize.width,r.actualSize.height,h),c=this.labelSettings.leftLabel.value.split(","),oe.isNullOrUndefined(r.remainder)||null===r.remainder?oe.isNullOrUndefined(this.labelSettings.leftLabel.image)||1!==this.labelSettings.leftLabel.image.length||1!==c.length||(this.leftTaskLabel.isCompleted=!0):(this.leftTaskLabel.value=r.remainder,this.leftTaskLabel.left=i.endPoint)):this.leftTaskLabel.left=i.endPoint))},Ga.prototype.getWidth=function(e,t,i){var n=new le.PdfStandardFont(this.fontFamily,9),a=this.parent.pdfExportModule.helper.exportProps.ganttStyle,a=(oe.isNullOrUndefined(a)||oe.isNullOrUndefined(a.label)||oe.isNullOrUndefined(a.label.fontSize)&&oe.isNullOrUndefined(a.label.fontStyle)&&oe.isNullOrUndefined(a.label.fontFamily)||(i=(n=this.getPdfFont(a)).height),!oe.isNullOrUndefined(a)&&a.font&&(i=(n=a.font).height),new le.PdfStringLayouter),r=new le.PdfStringFormat;return r.alignment=le.PdfTextAlignment.Left,r.wordWrap=le.PdfWordWrapType.Character,r.lineAlignment=le.PdfVerticalAlignment.Middle,a.layout(e,n,r,new le.SizeF(t,i),!1,new le.SizeF(t,i))},Ga.prototype.getWidthofLeftLabel=function(e,t,i){var n=new le.PdfStandardFont(this.labelSettings.leftLabel.fontStyle.fontFamily,this.labelSettings.leftLabel.fontStyle.fontSize),n=this.labelSettings.leftLabel.fontStyle.fontSize?n:new le.PdfStandardFont(this.fontFamily,9),a=(!oe.isNullOrUndefined(this.parent.pdfExportModule.helper.exportProps.ganttStyle)&&this.parent.pdfExportModule.helper.exportProps.ganttStyle.font&&(n=this.parent.pdfExportModule.helper.exportProps.ganttStyle.font),new le.PdfStringLayouter),r=new le.PdfStringFormat;return r.alignment=le.PdfTextAlignment.Left,r.wordWrap=le.PdfWordWrapType.Character,r.lineAlignment=le.PdfVerticalAlignment.Middle,a.layout(e,n,r,new le.SizeF(t,i),!1,new le.SizeF(t,i))},Ga.prototype.getWidthofrightLabel=function(e,t,i){var n=new le.PdfStandardFont(this.labelSettings.rightLabel.fontStyle.fontFamily,this.labelSettings.rightLabel.fontStyle.fontSize),n=this.labelSettings.rightLabel.fontStyle.fontSize?n:new le.PdfStandardFont(this.fontFamily,9),a=(!oe.isNullOrUndefined(this.parent.pdfExportModule.helper.exportProps.ganttStyle)&&this.parent.pdfExportModule.helper.exportProps.ganttStyle.font&&(n=this.parent.pdfExportModule.helper.exportProps.ganttStyle.font),new le.PdfStringLayouter),r=new le.PdfStringFormat;return r.alignment=le.PdfTextAlignment.Left,r.wordWrap=le.PdfWordWrapType.Character,r.lineAlignment=le.PdfVerticalAlignment.Middle,a.layout(e,n,r,new le.SizeF(t,i),!1,new le.SizeF(t,i))},Ga.prototype.drawUnscheduledTask=function(e,t,i,n){var a=new le.PdfSolidBrush(this.taskColor);this.isAutoFit()?e.drawRectangle(a,t.x+(this.left-i),t.y+n,de(3),de(this.height)):e.drawRectangle(a,t.x+de(this.left-i),t.y+n,de(3),de(this.height))},Ga.prototype.drawMilestone=function(e,t,i,n,a,r){var s,o,l,d,h,p,u,c;i.startDate<=this.startDate&&this.startDate<=i.endDate&&(i=e.graphics,e=e.section.indexOf(e),this.taskStartPoint=Ha({},t),s=new le.PdfPen(this.milestoneColor),o=de((this.parent.rowHeight-this.height)/3),l=de((this.parent.rowHeight-this.height)/2),o=this.parent.renderBaseline?o:l,l=new le.PdfSolidBrush(this.milestoneColor),h=new le.PdfPen(this.baselineBorderColor),p=new le.PdfSolidBrush(this.baselineColor),i.save(),d=Math.floor(.8*this.parent.chartRowsModule.taskBarHeight),r||(this.isAutoFit()?i.translateTransform(t.x+(this.left-n),t.y+o-.7*this.parent.chartRowsModule.taskBarHeight/2):i.translateTransform(t.x+de(this.left-n),t.y+o-.7*this.parent.chartRowsModule.taskBarHeight/2)),r&&(this.isAutoFit()?i.translateTransform(t.x+(a.baselineLeft-n),t.y+o-.7*this.parent.chartRowsModule.taskBarHeight/2):i.translateTransform(t.x+de(a.baselineLeft-n),t.y+o-.7*this.parent.chartRowsModule.taskBarHeight/2)),i.rotateTransform(45),this.parent.renderBaseline&&this.baselineStartDate&&this.baselineEndDate&&r&&i.drawRectangle(h,p,2,2,de(d),de(d)),r||i.drawRectangle(s,l,0,0,de(d),de(d)),i.restore(),this.isAutoFit()?oe.isNullOrUndefined(a.taskbarTemplate.image)||(u=new le.PdfBitmap(a.taskbarTemplate.image[0].base64),c=t.x+(this.left-n)-.7*this.parent.chartRowsModule.taskBarHeight/2+(.7*this.parent.chartRowsModule.taskBarHeight-a.taskbarTemplate.image[0].height),h=a.taskbarTemplate.image[0].width/2,p=a.taskbarTemplate.image[0].height/2,i.drawImage(u,c,t.y+o-.7*this.parent.chartRowsModule.taskBarHeight/2+(.7*this.parent.chartRowsModule.taskBarHeight-a.taskbarTemplate.image[0].height)/.5,h,p)):oe.isNullOrUndefined(a.taskbarTemplate.image)||(u=new le.PdfBitmap(a.taskbarTemplate.image[0].base64),c=t.x+de(this.left-n)-.7*this.parent.chartRowsModule.taskBarHeight/2+ +de(.7*this.parent.chartRowsModule.taskBarHeight-a.taskbarTemplate.image[0].height),i.drawImage(u,c,t.y+o-.7*this.parent.chartRowsModule.taskBarHeight/2+de((.7*this.parent.chartRowsModule.taskBarHeight-a.taskbarTemplate.image[0].height)/.5),de(a.taskbarTemplate.image[0].width),de(a.taskbarTemplate.image[0].height-2))),this.endPage=this.startPage=e)},Ga);function Ga(e){this.baselineHeight=8,this.segment=[],this.segmentCollection=[],this.leftTaskLabel={},this.rightTaskLabel={},this.startPage=-1,this.endPage=-1,this.spaceBetweenImageAndValue=8,this.parent=e}qa.prototype.drawTimeline=function(e,t,i,n){this.detailsTimeline=i,this.pageIndex=n,this.timelineHeight=this.gantt.layouter.headerHeight;var a=this.parent.pdfExportModule.gantt.taskbar.isAutoFit()?he(Math.floor(i.totalWidth)):Math.round(i.totalWidth),r=0;for(this.topTierPoint.x=t.x,this.topTierPoint.y=t.y,this.prevTopTierIndex=this.topTierIndex,this.prevBottomTierIndex=this.bottomTierIndex;0<a;){var s,o=this.topTier[this.topTierIndex];this.topTier.length>this.topTierIndex?(l=!1,this.topTier[this.topTierIndex].isFinished||(a>=o.width?(r=o.width,o.isFinished=!0,o.completedWidth=r,l=!0):(r=a,o.isFinished=l=!1,o.width=o.width-a,o.completedWidth=r)),s=this.parent.pdfExportModule.gantt.taskbar.isAutoFit()?r:de(r),this.triggerQueryTimelinecell(e,this.topTierPoint.x,this.topTierPoint.y,this.topTierHeight,s,o.value,!0,this.parent.timelineModule.isSingleTier&&"Day"===this.parent.timelineSettings.topTier.unit?o.startDate:null),this.topTierPoint.x+=s,a-=r,l&&this.topTierIndex++):a=0}a=Math.round(i.totalWidth),n=this.parent.timelineModule.isSingleTier?0:this.topTierHeight;for(this.bottomTierPoint=new le.PointF(t.x,de(t.y+n));0<a;){var l,d,h=this.bottomTier[this.bottomTierIndex];this.bottomTier.length>this.bottomTierIndex?(l=!0,a<(d=h.width)&&(d=a,l=!1,h.completedWidth=d),this.triggerQueryTimelinecell(e,this.bottomTierPoint.x,this.bottomTierPoint.y,this.bottomTierHeight,this.parent.pdfExportModule.gantt.taskbar.isAutoFit()?d:de(d),h.value,!1,h.startDate),this.bottomTierPoint.x=this.parent.pdfExportModule.gantt.taskbar.isAutoFit()?this.bottomTierPoint.x+d:this.bottomTierPoint.x+de(d),a-=d,h.completedWidth=d,this.bottomTierIndex++,0<a&&a<d&&(a=h.width-1)):a=0}this.timelineWidth=this.lastWidth},qa.prototype.drawPageTimeline=function(e,t,i,n){this.pageIndex=n,this.timelineHeight=0,this.topTierPoint=oe.extend({},{},t,!0);for(var a,r=this.prevTopTierIndex;r<=this.topTierIndex;r++)this.topTier.length>r&&0<(a=this.topTier[r]).completedWidth&&(this.triggerQueryTimelinecell(e,this.topTierPoint.x,this.topTierPoint.y,this.topTierHeight,this.parent.pdfExportModule.gantt.taskbar.isAutoFit()?a.completedWidth:de(a.completedWidth),a.value,!0,this.parent.timelineModule.isSingleTier&&"Day"===this.parent.timelineSettings.topTier.unit?a.startDate:null),this.topTierPoint.x+=this.parent.pdfExportModule.gantt.taskbar.isAutoFit()?a.completedWidth:de(a.completedWidth));this.bottomTierPoint.x=t.x,this.bottomTierPoint.y=de(t.y+this.topTierHeight);for(var s,r=this.prevBottomTierIndex;r<=this.bottomTierIndex;r++)this.bottomTier.length>r&&0<(s=this.bottomTier[r]).completedWidth&&(this.triggerQueryTimelinecell(e,this.bottomTierPoint.x,this.bottomTierPoint.y,this.bottomTierHeight,this.parent.pdfExportModule.gantt.taskbar.isAutoFit()?s.width:de(s.width),s.value,!1,s.startDate),this.bottomTierPoint.x=this.parent.pdfExportModule.gantt.taskbar.isAutoFit()?this.bottomTierPoint.x+s.width:this.bottomTierPoint.x+de(s.width))},qa.prototype.triggerQueryTimelinecell=function(e,a,t,i,r,n,s,o){var l,d,h=this,p=new Date(o).getDay(),e=e.graphics,u={},c=this.gantt.ganttStyle,g=(u.borderColor=new le.PdfColor(c.timeline.borderColor),u.fontColor=new le.PdfColor(c.timeline.fontColor),u.fontSize=c.timeline.fontSize,u.fontStyle=c.timeline.fontStyle,u.backgroundColor=new le.PdfColor(c.timeline.backgroundColor),c.timeline.padding&&(u.padding=c.timeline.padding),this.initializePdfStringFormat(c,s)),g=(u.format=g,{timelineCell:u,value:n}),u=(this.parent.pdfQueryTimelineCellInfo&&this.parent.trigger("pdfQueryTimelineCellInfo",g),g.timelineCell),f=new le.PdfSolidBrush(g.timelineCell.backgroundColor),n=this.parent.nonWorkingDayIndex,m=!1,y=new le.PdfSolidBrush(c.holiday.backgroundColor),n=(this.parent.highlightWeekends&&-1!==n.indexOf(p)&&("Day"===this.parent.timelineModule.bottomTier||"None"===this.parent.timelineModule.bottomTier&&"Day"===this.parent.timelineModule.topTier)&&(f=y,m=!0),this.parent.holidays.map(function(t){var i=new Date(t.from),e=new Date(t.to),n=new Date(o);i<=n&&n<=e&&("Day"===h.parent.timelineModule.bottomTier||"None"===h.parent.timelineModule.bottomTier&&"Day"===h.parent.timelineModule.topTier)?(f=y,i.getTime()===n.getTime()&&(h.holidayWidth=a),e.getTime()===n.getTime()&&(h.holidayLabel=t.label,(e=new Date(t.to)).setDate(e.getDate()+1),n=h.parent.dataOperation.getTaskWidth(i,e),h.holidayNumberOfDays=de(n)/r,h.holidayCompleted=!0),m=!0):"Day"!==h.parent.timelineModule.bottomTier&&h.detailsTimeline.startDate<=i&&h.detailsTimeline.endDate>=i&&h.parent.timelineModule.bottomTierCollection.map(function(e){e.startDate<=i&&e.endDate>=i&&e.startDate===o&&(h.fitHolidayCompleted=!0,h.fromDataHoliday=t.from,h.holidayLabel=t.label)})}),m&&c.holiday&&c.holiday.borders?c.holiday.borders.left:m&&c.holiday&&c.holiday.borderColor?new le.PdfPen(c.holiday.borderColor):new le.PdfPen(g.timelineCell.borderColor)),p=(this.parent.pdfExportModule.gantt.taskbar.isAutoFit()||(this.lastWidth=a+r),m&&(c.holiday.borderColor||c.holiday.borders)?r-2:r),D=(e.drawRectangle(n,f,a,t,p,de(i)),s||"Both"!==this.parent.gridLines&&"Vertical"!==this.parent.gridLines?null:new le.PdfPen(c.chartGridLineColor)),n=m&&(c.holiday.borderColor||c.holiday.borders)?n:D,D=(e.drawRectangle(n,f,a,t+de(i),p,this.gantt.layouter.pageHeightCollection[this.pageIndex].totalHeight-this.timelineHeight),new le.PdfStandardFont(c.fontFamily,u.fontSize,u.fontStyle)),p=(c.font&&(D=c.font),this.getPdfFont(c)),p=(oe.isNullOrUndefined(p)||(D=p),c.holiday&&c.holiday.fontColor?new le.PdfSolidBrush(c.holiday.fontColor):new le.PdfSolidBrush(new le.PdfColor(0,0,0))),k=c.holiday&&c.holiday.fontBrush?new le.PdfPen(new le.PdfColor(c.holiday.fontBrush)):null,w=(new le.PdfStringFormat,c.holiday&&c.holiday.format?c.holiday.format:null),b={left:0,right:0,top:0,bottom:0},T=(oe.isNullOrUndefined(c)||oe.isNullOrUndefined(c.holiday)||oe.isNullOrUndefined(c.holiday.padding)||(b=c.holiday.padding),oe.isNullOrUndefined(this.holidayLabel)||(l=D.measureString(this.holidayLabel)),this.holidayCompleted&&(P=(this.gantt.layouter.pageHeightCollection[this.pageIndex].totalHeight-this.timelineHeight)/2,T=e.save(),d=D.height,v=D.size,e.translateTransform(this.holidayWidth+r-v/2*this.holidayNumberOfDays-d+d/2+r*this.holidayNumberOfDays/2,40),e.rotateTransform(-90),e.translateTransform(-P,-((this.holidayWidth+r+v)/((this.holidayWidth+r)/r))),l.width+10<P&&e.drawString(this.holidayLabel,D,k,p,5-(b.left+b.right),5-(b.top+b.bottom),l.width+10,l.height+10,w),e.restore(T),this.holidayCompleted=!1),this.fitHolidayCompleted&&(P=(this.gantt.layouter.pageHeightCollection[this.pageIndex].totalHeight-this.timelineHeight)/2,v=D.size,e.drawRectangle(n,y,a+r/2-v,t+de(i),v,2*P),d=e.save(),e.translateTransform(a+r+r/2-v,40),e.rotateTransform(-90),e.translateTransform(-P,-((this.holidayWidth+r+v)/((this.holidayWidth+r)/r))),l.width+10<P&&e.drawString(this.holidayLabel,D,k,p,5-(b.left+b.right),5-(b.top+b.bottom),l.width+10,l.height+10,w),e.restore(d),this.fitHolidayCompleted=!1),new le.PdfStandardFont(c.fontFamily,u.fontSize,u.fontStyle)),n=(c.font&&(T=c.font),new le.PdfSolidBrush(oe.isNullOrUndefined(c.timeline.fontBrush)?g.timelineCell.fontColor:c.timeline.fontBrush)),v=c.timeline.padding?g.timelineCell.padding.left:0,P=c.timeline.padding?g.timelineCell.padding.top:0,D=e.save();e.setClip(new le.RectangleF(a,t,r,de(i))),s?a=a+v+this.topTierValueLeftPadding:a+=v,e.drawString(g.value,T,null,n,a,t+P,de(r),de(i),u.format),e.restore(D)},qa.prototype.initializePdfStringFormat=function(e,t){var i=new le.PdfStringFormat;return oe.isNullOrUndefined(e.timeline.format)?t?(i.lineAlignment=le.PdfVerticalAlignment.Middle,i.alignment=le.PdfTextAlignment.Left):(i.lineAlignment=le.PdfVerticalAlignment.Middle,i.alignment=le.PdfTextAlignment.Center,i.wordWrap=le.PdfWordWrapType.Character):i=e.timeline.format,i},qa.prototype.getPdfFont=function(e){var t,i;return e&&e.holiday&&(e.holiday.fontSize||e.holiday.fontStyle||e.holiday.fontFamily)&&(t=e.holiday.fontSize||9,i=e.holiday.fontFamily||this.fontFamily,e=e.holiday.fontStyle||le.PdfFontStyle.Regular,i=new le.PdfStandardFont(i,t,e)),i};var za=qa;function qa(e){this.holidayCompleted=!1,this.holidayWidth=0,this.fitHolidayCompleted=!1,this.timelineWidth=0,this.lastWidth=0,this.topTierValueLeftPadding=8,this.timelineHeight=0,this.width=0,this.gantt=e,this.parent=e.parent,this.topTierPoint=new le.PointF,this.bottomTierPoint=new le.PointF,this.topTierIndex=0,this.bottomTierIndex=0,this.prevTopTierIndex=0,this.prevBottomTierIndex=0}Xa.prototype.add=function(){return new Xa(this.parent)},Xa.prototype.drawPredecessor=function(e){var t,i,n=(this.pdfGantt=e).result.page.section.getPages(),a=e.taskbarCollection[this.parentIndex],r=e.taskbarCollection[this.childIndex],s=new le.PdfPage,o=new le.PdfPage,l="";if(r&&a){switch(this.type){case"FS":if(!(-1<r.startPage&&-1<a.endPage))return;s=n[a.endPage],o=n[r.startPage],t=e.pdfPageDetail[a.endPage-e.chartPageIndex],i=e.pdfPageDetail[r.startPage-e.chartPageIndex],l=this.parentIndex<this.childIndex?this.parentLeft<this.childLeft&&this.childLeft>this.parentLeft+this.parentWidth+25?"FSType1":"FSType2":this.parentLeft<this.childLeft&&this.childLeft>this.parentLeft+this.parentWidth+25?"FSType3":"FSType4";break;case"SF":if(!(-1<r.endPage&&-1<a.startPage))return;s=n[a.startPage],o=n[r.endPage],t=e.pdfPageDetail[a.endPage-e.chartPageIndex],i=e.pdfPageDetail[r.startPage-e.chartPageIndex],l=this.parentIndex<this.childIndex?this.parentLeft>this.childLeft+this.childWidth?"SFType1":"SFType2":this.parentLeft>this.childLeft+this.childWidth?"SFType3":"SFType4";break;case"FF":if(!(-1<r.endPage&&-1<a.endPage))return;s=n[a.endPage],o=n[r.endPage],t=e.pdfPageDetail[a.endPage-e.chartPageIndex],i=e.pdfPageDetail[r.endPage-e.chartPageIndex],l=this.parentIndex<this.childIndex?this.childLeft+this.childWidth>=this.parentLeft+this.parentWidth?"FFType1":"FFType2":this.childLeft+this.childWidth>=this.parentLeft+this.parentWidth?"FFType3":"FFType4";break;case"SS":if(!(-1<r.startPage&&-1<a.startPage))return;s=n[a.startPage],o=n[r.startPage],t=e.pdfPageDetail[a.startPage-e.chartPageIndex],i=e.pdfPageDetail[r.startPage-e.chartPageIndex],l=this.parentIndex<this.childIndex?this.parentLeft>=this.childLeft?"SSType1":"SSType2":this.parentLeft>=this.childLeft?"SSType3":"SSType4"}var d=Math.round((this.parent.rowHeight-15)/2),h=Math.round((this.parent.rowHeight-1)/2),p=Math.round((this.parent.rowHeight-10)/2),u=de(this.parent.renderBaseline?p:!a.isAutoSchedule&&a.isParentTask||!r.isAutoSchedule&&r.isParentTask?d:h),c=void 0,g=void 0,f=void 0,m=void 0,y=void 0,D=void 0,c=g=f=m=y=D=new le.PointF,p=(a.taskStartPoint.x,a.taskStartPoint.y),d=(r.taskStartPoint.x,r.taskStartPoint.y),k=p+t.startPoint.y,w=d+i.startPoint.y,b=void 0,T=void 0,v=void 0,P=void 0,S=void 0,S=this.parent.pdfExportModule.gantt.taskbar.isAutoFit()?(b=new le.PointF(this.parentLeft+this.parentWidth,k+u),T=new le.PointF(this.parentLeft-1,k+u),v=new le.PointF(this.childLeft-20,w+u),P=new le.PointF(this.childLeft-6-this.lineWidth-1,w+u),new le.PointF(this.childLeft+this.childWidth+6+this.lineWidth+1,w+u)):(b=new le.PointF(de(this.parentLeft+this.parentWidth),k+u),T=new le.PointF(de(this.parentLeft)-1,k+u),v=new le.PointF(de(this.childLeft-20),w+u),P=new le.PointF(de(this.childLeft-6-this.lineWidth)-1,w+u),new le.PointF(de(this.childLeft+this.childWidth+6+this.lineWidth)+1,w+u));switch(l){case"FSType1":case"FSType3":c=b,g=this.parent.pdfExportModule.gantt.taskbar.isAutoFit()?new le.PointF(this.childLeft-20,k+u):new le.PointF(de(this.childLeft-20),k+u),f=v,m=P,this.connectLines(s,o,c,g,f,m,r,u);break;case"FSType2":c=b,g=new le.PointF(c.x+10,k+u),f=new le.PointF(c.x+10,w+2),m=this.parent.pdfExportModule.gantt.taskbar.isAutoFit()?new le.PointF(this.childLeft-20,w+2):new le.PointF(de(this.childLeft-20),w+2),y=v,D=P,this.connectLines(s,o,c,g,f,m,r,u,y,D);break;case"FSType4":c=b,g=new le.PointF(c.x+10,k+u),f=new le.PointF(c.x+10,k+2),m=this.parent.pdfExportModule.gantt.taskbar.isAutoFit()?new le.PointF(this.childLeft-20,k+2):new le.PointF(de(this.childLeft-20),k+2),y=v,D=P,this.connectLines(s,o,c,g,f,m,r,u,y,D);break;case"FFType1":case"FFType3":g=this.parent.pdfExportModule.gantt.taskbar.isAutoFit()?(c=new le.PointF(this.parentLeft+this.parentWidth+1,k+u),new le.PointF(this.childLeft+this.childWidth+20,k+u)):(c=new le.PointF(de(this.parentLeft+this.parentWidth)+1,k+u),new le.PointF(de(this.childLeft+this.childWidth+20),k+u)),f=new le.PointF(g.x,w+u),m=S,this.connectLines(s,o,c,g,f,m,r,u);break;case"FFType2":case"FFType4":g=this.parent.pdfExportModule.gantt.taskbar.isAutoFit()?(c=new le.PointF(this.parentLeft+this.parentWidth+1,k+u),new le.PointF(this.parentLeft+this.parentWidth+20,k+u)):(c=new le.PointF(de(this.parentLeft+this.parentWidth)+1,k+u),new le.PointF(de(this.parentLeft+this.parentWidth+20),k+u)),f=new le.PointF(g.x,w+u),m=S,this.connectLines(s,o,c,g,f,m,r,u);break;case"SSType1":case"SSType3":c=T,g=this.parent.pdfExportModule.gantt.taskbar.isAutoFit()?new le.PointF(this.childLeft-20,k+u):new le.PointF(de(this.childLeft-20),k+u),f=new le.PointF(g.x,w+u),m=P,this.connectLines(s,o,c,g,f,m,r,u);break;case"SSType2":case"SSType4":c=T,g=this.parent.pdfExportModule.gantt.taskbar.isAutoFit()?new le.PointF(this.parentLeft-20,k+u):new le.PointF(de(this.parentLeft-20),k+u),f=new le.PointF(g.x,w+u),m=P,this.connectLines(s,o,c,g,f,m,r,u);break;case"SFType1":case"SFType3":c=T,g=this.parent.pdfExportModule.gantt.taskbar.isAutoFit()?new le.PointF(this.childLeft+this.childWidth+20,k+u):new le.PointF(de(this.childLeft+this.childWidth+20),k+u),f=new le.PointF(g.x,w+u),m=S,this.connectLines(s,o,c,g,f,m,r,u);break;case"SFType2":c=T,m=this.parent.pdfExportModule.gantt.taskbar.isAutoFit()?(g=new le.PointF(this.parentLeft-20,k+u),new le.PointF(this.childLeft+this.childWidth+20,w+2)):(g=new le.PointF(de(this.parentLeft-20),k+u),new le.PointF(de(this.childLeft+this.childWidth+20),w+2)),f=new le.PointF(g.x,w+2),y=new le.PointF(m.x,w+u),D=S,this.connectLines(s,o,c,g,f,m,r,u,y,D);break;case"SFType4":c=T,m=this.parent.pdfExportModule.gantt.taskbar.isAutoFit()?(g=new le.PointF(this.parentLeft-20,k+u),new le.PointF(this.childLeft+this.childWidth+20,k+2)):(g=new le.PointF(de(this.parentLeft-20),k+u),new le.PointF(de(this.childLeft+this.childWidth+20),k+2)),f=new le.PointF(g.x,k+2),y=new le.PointF(m.x,w+u),D=S,this.connectLines(s,o,c,g,f,m,r,u,y,D)}}},Xa.prototype.connectLines=function(e,t,i,n,a,r,s,o,l,d){this.drawLine(e,i,n),this.drawLine(e,n,a),this.drawLine(e,a,r),oe.isNullOrUndefined(l)||oe.isNullOrUndefined(d)||(this.drawLine(e,r,l),this.drawLine(e,l,d)),this.drawArrow(t,s,o)},Xa.prototype.contains=function(e,t,i){return e.x<=t&&t<e.x+e.width&&e.y<=i&&i<e.y+e.height},Xa.prototype.findPageIndex=function(e){for(var t=-1,i=0;i<this.pdfGantt.pdfPageDetail.length;i++){var n=this.pdfGantt.pdfPageDetail[i],n=new le.RectangleF(n.startPoint.x,n.startPoint.y,n.width,n.height);if(this.contains(n,e.x,e.y)){t=i;break}}return t},Xa.prototype.drawLine=function(e,t,i){var n,a,r=this.pdfGantt.result.page.section.getPages(),s=e.graphics,o={x:i.x,y:i.y},l={x:i.x,y:i.y},d={x:i.x,y:i.y},e=this.pdfGantt.pdfPageDetail[e.section.indexOf(e)-this.pdfGantt.chartPageIndex],h=new le.RectangleF(e.startPoint.x,e.startPoint.y,e.width,e.height),p=this.contains(h,t.x,t.y),u=this.contains(h,i.x,i.y),c=-1;t=new le.PointF(t.x,t.y),i=new le.PointF(i.x,i.y),!p&&!u||u&&!p?-1<(c=this.findPageIndex(t))&&(e=this.pdfGantt.pdfPageDetail[c],l=t,o=i,this.drawLine(r[c+this.pdfGantt.chartPageIndex],l,o)):!u&&p&&(u=h.x,a=h.x+h.width,n=h.y+h.height,h=h.y,u>i.x?(d.x=i.x=u-1,l.x=u-1):a<i.x?(d.x=i.x=a,l.x=a,d.x+=1):n<i.y?(d.y=i.y=n,l.y=n,d.y+=1,this.pdfGantt.enableHeader&&(l.y+=this.parent.timelineModule.isSingleTier?de(45):de(62))):h>i.y&&(l.y=d.y=h-1,i.y=h,this.pdfGantt.enableHeader)&&(d.y+=this.parent.timelineModule.isSingleTier?de(45):de(62),i.y+=this.parent.timelineModule.isSingleTier?de(45):de(62)),-1!==(c=this.findPageIndex(d)))&&this.drawLine(r[c+this.pdfGantt.chartPageIndex],l,o),p&&(t=new le.PointF(t.x,t.y),i=new le.PointF(i.x,i.y),t.x=t.x+e.pageStartX-e.startPoint.x,t.y=t.y-e.startPoint.y,i.x=i.x+e.pageStartX-e.startPoint.x,i.y=i.y-e.startPoint.y,u=new le.PdfSolidBrush(this.connectorLineColor),a=new le.PdfPen(u,de(this.lineWidth)),s.drawLine(a,t,i))},Xa.prototype.drawArrow=function(e,t,i){var n,a=this.pdfGantt.pdfPageDetail[e.section.indexOf(e)-this.pdfGantt.chartPageIndex],r=new le.RectangleF(new le.PointF(a.startPoint.x,a.startPoint.y),new le.SizeF(a.width,a.height)),s=new le.PointF,o=e.section.getPages(),l=6+this.lineWidth,s=this.parent.pdfExportModule.gantt.taskbar.isAutoFit()?"FS"===this.type||"SS"===this.type?new le.PointF(this.childLeft-1,t.taskStartPoint.y+a.startPoint.y):new le.PointF(this.childLeft+this.childWidth+1,t.taskStartPoint.y+a.startPoint.y):"FS"===this.type||"SS"===this.type?new le.PointF(de(this.childLeft)-1,t.taskStartPoint.y+a.startPoint.y):new le.PointF(de(this.childLeft+this.childWidth)+1,t.taskStartPoint.y+a.startPoint.y),r=(this.contains(r,s.x,s.y)||-1<(t=this.findPageIndex(s))&&(a=this.pdfGantt.pdfPageDetail[t],e=o[t+this.pdfGantt.chartPageIndex]),e.graphics),o=(s.x=s.x-a.startPoint.x+a.pageStartX,s.y=s.y-a.startPoint.y,new le.PointF(s.x,s.y+i)),t=this.parent.pdfExportModule.gantt.taskbar.isAutoFit()?"FS"===this.type||"SS"===this.type?new le.PointF(o.x-l,o.y-l):new le.PointF(o.x+l,o.y-l):"FS"===this.type||"SS"===this.type?new le.PointF(o.x-de(l),o.y-de(l)):new le.PointF(o.x+de(l),o.y-de(l)),e=new le.PdfSolidBrush(this.connectorLineColor),a=this.parent.pdfExportModule.gantt.taskbar.isAutoFit()?(n=new le.PointF(t.x,t.y+2*l),new le.PdfPen(e,this.lineWidth)):(n=new le.PointF(t.x,t.y+de(2*l)),new le.PdfPen(e,de(this.lineWidth)));r.drawLine(a,o,t),r.drawLine(a,t,n),r.drawLine(a,n,o)};var _a=Xa;function Xa(e,t){this.parent=e,this.pdfGantt=t}Ya.prototype.drawEventMarker=function(e,t,i,n,a,r,s){var o,l,d,h,p,u,c=e.graphics,e=(e.getClientSize(),new le.PdfStandardFont(le.PdfFontFamily.Helvetica,10)),g=(!oe.isNullOrUndefined(this.parent.pdfExportModule.helper.exportProps.ganttStyle)&&this.parent.pdfExportModule.helper.exportProps.ganttStyle.font&&(e=this.parent.pdfExportModule.helper.exportProps.ganttStyle.font),oe.isNullOrUndefined(a.label)||(o=e.measureString(a.label)),s.eventMarker.lineStyle);g.dashStyle=s.eventMarker.lineStyle.dashStyle,n.startDate<=a.date&&a.date<=n.endDate&&((n=new le.PdfStringFormat).alignment=le.PdfTextAlignment.Center,n=oe.isNullOrUndefined(s.eventMarker.label.format)?n:s.eventMarker.label.format,l=new le.PdfSolidBrush(s.eventMarker.label.backgroundColor),d=s.eventMarker.label&&s.eventMarker.label.fontColor?new le.PdfSolidBrush(s.eventMarker.label.fontColor):null,h=this.getPdfFont(s),oe.isNullOrUndefined(h)&&(h=e),e=s.eventMarker.label.borders||null,s.eventMarker.label.borderColor&&((p=new ia).all=new le.PdfPen(new le.PdfColor(s.eventMarker.label.borderColor)),e=p),p=oe.isNullOrUndefined(e)||oe.isNullOrUndefined(e.left)?null:e.left,e={left:0,right:0,top:0,bottom:0},oe.isNullOrUndefined(s)||oe.isNullOrUndefined(s.eventMarker)||oe.isNullOrUndefined(s.eventMarker.label)||oe.isNullOrUndefined(s.eventMarker.label.padding)||(e=s.eventMarker.label.padding),s=oe.isNullOrUndefined(s.eventMarker.label.fontBrush)?null:new le.PdfPen(s.eventMarker.label.fontBrush),u=this.parent.dataOperation.getTaskLeft(this.parent.dateValidationModule.getDateFromFormat(a.date,!0),!1,!0),this.parent.pdfExportModule.gantt.taskbar.isAutoFit()?(c.drawLine(g,new le.PointF(t.x+(u-i)+10,r),new le.PointF(t.x+(u-i)+10,this.renderHeight)),!oe.isNullOrUndefined(a.label)&&0<a.label.length&&r+de(50)+2*o.height<this.renderHeight&&(c.save(),c.translateTransform(t.x+(u-i)+7+10,r+de(50)+o.height/2),c.rotateTransform(45),c.drawRectangle(p,l,0,0,8,8),c.restore(),c.drawRectangle(p,l,t.x+(u-i)+7+10,r+de(50),o.width+10,2*o.height),c.drawString(a.label,h,s,d,t.x+(u-i)+12+10-(e.left+e.right),r+de(50)+de(o.height/2)-(e.top+e.bottom),o.width,o.height,n))):(c.drawLine(g,new le.PointF(t.x+de(u-i)+10,r),new le.PointF(t.x+de(u-i)+10,this.renderHeight)),!oe.isNullOrUndefined(a.label)&&0<a.label.length&&r+de(50)+2*o.height<this.renderHeight&&(c.save(),c.translateTransform(t.x+de(u-i)+7+10,r+de(50)+o.height/2),c.rotateTransform(45),c.drawRectangle(p,l,0,0,8,8),c.restore(),c.drawRectangle(p,l,t.x+de(u-i)+7+10,r+de(50),o.width+10,2*o.height),c.drawString(a.label,h,s,d,t.x+de(u-i)+12+10-(e.left+e.right),r+de(50)+de(o.height/2)-(e.top+e.bottom),o.width,o.height,n))))},Ya.prototype.getPdfFont=function(e){var t,i;return e&&e.eventMarker&&e.eventMarker.label&&(e.eventMarker.label.fontSize||e.eventMarker.label.fontStyle||e.eventMarker.label.fontFamily)&&(t=e.eventMarker.label.fontSize||9,i=e.eventMarker.label.fontFamily||this.fontFamily,e=e.eventMarker.label.fontStyle||le.PdfFontStyle.Regular,i=new le.PdfStandardFont(i,t,e)),i};var Za=Ya;function Ya(e){this.renderHeight=0,this.parent=e}Ka=function(e,t){return(Ka=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])}))(e,t)};var Ka,Qa,Ja=function(){return(Ja=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var a in t=arguments[i])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},$a=(function(e,t){function i(){this.constructor=e}Ka(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}(er,Qa=ba),Object.defineProperty(er.prototype,"taskbar",{get:function(){return oe.isNullOrUndefined(this.taskbars)&&(this.taskbars=new ja(this.parent)),this.taskbars},enumerable:!0,configurable:!0}),er.prototype.drawChart=function(e){this.result=e,this.totalPages=this.result.page.section.count,this.perColumnPages=this.totalPages/this.layouter.columnRanges.length,this.calculateRange(),this.drawGantttChart(),this.drawPageBorder()},er.prototype.calculateRange=function(){for(var e=this.layouter.columnRanges[this.layouter.columnRanges.length-1],t=0,i=!0,n=0,a=0,r=0,s=de(this.chartHeader.width),o=this.parent.timelineModule,l=e[0];l<=e[1];l++)t+=this.layouter.treegrid.columns.getColumn(l).width;for((t+=.5)+100<this.result.page.getClientSize().width?(a=this.result.page.getClientSize().width-t,this.chartPageIndex=this.startPageIndex=this.totalPages-this.perColumnPages,i=!1,this.startPoint=new le.PointF(t,0)):(this.result.page.section.add(),this.chartPageIndex=this.startPageIndex=this.totalPages,i=!0,this.startPoint=new le.PointF(r,0));Math.round(r)<Math.round(s);){i?n=this.result.page.getClientSize().width:(n=a,i=!0);var d={},h=[],p=de(this.chartHeader.bottomTierCellWidth),u=0,c=(0!==this.chartHeader.bottomTierCellWidth&&(u=Math.floor(n/p)*p),s-(h[0]=r)<=u?d.totalWidth=he((h[1]=s)-r):(h[1]=r+u,d.totalWidth=he(u)),d.startPoint=h[0],d.endPoint=h[1],0===this.parent.cloneProjectStartDate.getHours()&&0===this.parent.cloneProjectStartDate.getMinutes()&&0===this.parent.cloneProjectStartDate.getSeconds()&&(this.changeCloneProjectDates=!0,this.parent.cloneProjectStartDate.setHours(8)),this.parent.dataOperation.getDateFromFormat(this.parent.timelineModule.timelineStartDate)),g=(oe.isNullOrUndefined(o.customTimelineSettings.bottomTier.count)?o.customTimelineSettings.topTier:o.customTimelineSettings.bottomTier).count;switch(("None"===o.customTimelineSettings.bottomTier.unit?o.customTimelineSettings.topTier:o.customTimelineSettings.bottomTier).unit){case"Minutes":d.startDate=new Date(c.getTime());var f=Math.floor(he(d.startPoint)/this.chartHeader.bottomTierCellWidth),f=(d.startDate.setMinutes(d.startDate.getMinutes()+f*g),d.startDate.setSeconds(d.startDate.getSeconds()+1),d.endDate=new Date(d.startDate.getTime()),Math.floor(he(d.endPoint-d.startPoint)/this.chartHeader.bottomTierCellWidth));d.endDate.setMinutes(d.endDate.getMinutes()+f*g);break;case"Hour":d.startDate=new Date(c.getTime());var f=Math.floor(he(d.startPoint)/this.chartHeader.bottomTierCellWidth),m=new Date(d.startDate.getTime()),y=(this.parent.timelineSettings.showWeekend?(d.startDate.setHours(d.startDate.getHours()+f*g),d.startDate.setMinutes(d.startDate.getMinutes()+1)):(m=this.calculateHoursWithoutNonworkingDays(m,f,g),d.startDate=new Date(m.getTime())),Math.floor((d.endPoint-d.startPoint)/he(this.chartHeader.bottomTierCellWidth)));m=new Date(d.startDate.getTime()),this.parent.timelineSettings.showWeekend?m.setHours(m.getHours()+y*g):m=this.calculateHoursWithoutNonworkingDays(m,y,g),d.endDate=new Date(m.getTime());break;case"Day":d.startDate=new Date(c.getTime());var y=Math.round(d.startPoint/de(this.chartHeader.bottomTierCellWidth)),m=new Date(d.startDate.getTime()),D=(this.parent.timelineSettings.showWeekend?d.startDate.setDate(d.startDate.getDate()+y*g):m=this.calculateDaysWithoutNonworkingDays(m,y,g),Math.round((d.endPoint-d.startPoint)/de(this.chartHeader.bottomTierCellWidth))-1);m=new Date(d.startDate.getTime()),this.parent.timelineSettings.showWeekend?m.setDate(m.getDate()+D*g):m=this.calculateDaysWithoutNonworkingDays(m,D,g);d.startDate.setHours(0,0,0,0);D=1e3*this.parent.workingTimeRanges[0].to;d.endDate=new Date(m.getTime()),d.endDate.setTime(d.endDate.getTime()+D);break;case"Week":d.startDate=new Date(c.getTime());var D=d.startPoint/de(this.chartHeader.bottomTierCellWidth)*7,k=(d.startDate.setDate(d.startDate.getDate()+D*g),7*Math.round((d.endPoint-d.startPoint)/de(this.chartHeader.bottomTierCellWidth))-1);d.endDate=new Date(d.startDate.getTime()),d.endDate.setDate(d.startDate.getDate()+k*g);break;case"Month":d.startDate=new Date(c.getTime());var k=d.startPoint/de(this.chartHeader.bottomTierCellWidth)*31,w=(d.startDate.setDate(d.startDate.getDate()+k*g),31*Math.round((d.endPoint-d.startPoint)/de(this.chartHeader.bottomTierCellWidth))-1);d.endDate=new Date(d.startDate.getTime()),d.endDate.setDate(d.startDate.getDate()+w*g);break;case"Year":d.startDate=new Date(c.getTime());var w=d.startPoint/de(this.chartHeader.bottomTierCellWidth)*365,b=(d.startDate.setDate(d.startDate.getDate()+w*g),365*Math.round((d.endPoint-d.startPoint)/de(this.chartHeader.bottomTierCellWidth))-1);d.endDate=new Date(d.startDate.getTime()),d.endDate.setDate(d.startDate.getDate()+b*g)}this.headerDetails.push(d),r+=u}},er.prototype.calculateHoursWithoutNonworkingDays=function(e,t,i){for(var n=0;n<t*i;)e.setHours(e.getHours()+1),-1===this.parent.nonWorkingDayIndex.indexOf(e.getDay())&&n++,-1!==this.parent.nonWorkingDayIndex.indexOf(e.getDay())&&e.setHours(24,0,0,0);return e},er.prototype.calculateDaysWithoutNonworkingDays=function(e,t,i){var n=0,a=Math.floor(t*i/(7-this.parent.nonWorkingDayIndex.length)),r=t*i%(7-this.parent.nonWorkingDayIndex.length);n+=7*a;for(var s=0;s<r;s++)e.setDate(e.getDate()+1),-1===this.parent.nonWorkingDayIndex.indexOf(e.getDay())&&n++;return e.setDate(e.getDate()+n),e},er.prototype.drawPageBorder=function(){for(var e=this.result.page.section.getPages(),t=0;t<e.length;t++){var i=e[t],n=i.graphics,i=i.getClientSize(),a=new le.PdfPen(new le.PdfColor(this.ganttStyle.chartGridLineColor));n.drawRectangle(a,0,0,i.width,i.height)}},er.prototype.drawGantttChart=function(){var h,p,u=this,c=this.startPoint,g=new le.PointF,f=0,m=0;this.headerDetails.forEach(function(n,e){u.currentPage=0;var t=u.result.page.section.getPages()[u.startPageIndex];t.contentWidth=u.parent.pdfExportModule.gantt.taskbar.isAutoFit()?he(u.headerDetails[e].endPoint-u.headerDetails[e].startPoint):u.headerDetails[e].endPoint-u.headerDetails[e].startPoint,u.chartHeader.drawTimeline(t,u.startPoint,n,0),c.y=c.y+de(u.parent.timelineModule.isSingleTier?45:60),h=c.x,m=de(u.parent.timelineModule.isSingleTier?45:60),u.headerDetails[u.headerDetails.indexOf(n)].startIndex=u.startPageIndex,u.headerDetails[u.headerDetails.indexOf(n)].pageStartPoint=c;for(var i=0;i<u.taskbarCollection.length;i++){var a=u.taskbarCollection[i],r=u.rows.getRow(i+1).height,s=u.result.page.section.getPages()[u.startPageIndex],o=s.graphics,l=new le.PdfPen(new le.PdfColor(u.ganttStyle.chartGridLineColor)),d=void 0;!t.contentWidth||"Both"!==u.parent.gridLines&&"Horizontal"!==u.parent.gridLines||(d=u.chartHeader.timelineWidth,o.drawRectangle(l,h,c.y,t.contentWidth+.5,r)),a.drawTaskbar(s,c,n,f,r,u.taskbarCollection[parseInt(i.toString(),10)],d,e)&&(u.enableHeader?c.y=de(u.parent.timelineModule.isSingleTier?45:60):c.y=0,u.startPageIndex++,(p={}).height=m,p.pageStartX=h,p.startPoint=Ja({},g),u.parent.pdfExportModule.gantt.taskbar.isAutoFit(),p.width=n.totalWidth,u.pdfPageDetail.push(p),g.y+=p.height,m=u.enableHeader?u.chartHeader.height:c.y=0),c.y+=r,m+=r,u.eventMarker.renderHeight=u.layouter.pageHeightCollection[u.currentPage].totalHeight,u.parent.eventMarkerColloction.map(function(e){var t=de(u.parent.timelineModule.isSingleTier?45:60),i=(0!==u.currentPage&&(u.eventMarker.renderHeight=u.layouter.pageHeightCollection[u.currentPage].totalHeight+t),u.result.page.section.getPages()[u.startPageIndex]);u.eventMarker.drawEventMarker(i,c,f,n,e,t,u.ganttStyle)})}u.headerDetails[e].endIndex=u.startPageIndex,f+=n.totalWidth,(p={}).height=m,p.pageStartX=h,p.startPoint=Ja({},g),u.parent.pdfExportModule.gantt.taskbar.isAutoFit()?p.width=n.totalWidth:p.width=de(n.totalWidth),u.pdfPageDetail.push(p),g.x+=p.width,g.y=0,u.enableHeader?m=u.chartHeader.height:c.y=0,u.headerDetails.indexOf(n)!==u.headerDetails.length-1&&(u.result.page.section.add(),u.startPageIndex=u.result.page.section.count-1,c=u.startPoint=new le.PointF(0,0))});for(var e=0;e<this.predecessorCollection.length;e++)this.predecessorCollection[e].drawPredecessor(this)},er);function er(e){var t=Qa.call(this)||this;return t.exportProps={},t.changeCloneProjectDates=!1,t.currentPage=0,t.parent=e,t.chartHeader=new za(t),t.eventMarker=new Za(e),t.predecessor=new _a(e,t),t.headerDetails=[],t.pdfPageDetail=[],t.taskbarCollection=[],t.predecessorCollection=[],t}tr.prototype.getModuleName=function(){return"pdfExport"},tr.prototype.destroy=function(){},tr.prototype.initGantt=function(){this.pdfDocument=void 0,this.gantt=new $a(this.parent)},tr.prototype.export=function(i,n,a,e){var r=this,e=(this.isBlob=e,{requestType:"beforePdfExport",ganttObject:this.parent,cancel:!1});return this.parent.trigger("beforePdfExport",e),oe.getValue("cancel",e)?new Promise(function(e,t){return e()}):(oe.isNullOrUndefined(this.parent.loadingIndicator)||"Shimmer"!==this.parent.loadingIndicator.indicatorType?this.parent.showSpinner():this.parent.showMaskRow(),new Promise(function(e,t){r.exportWithData(a,e,i,n)}))},tr.prototype.exportWithData=function(e,t,i,n){var a=this,r=[],s=this.parent.getExpandedRecords(this.parent.updatedRecords),r=(i=oe.isNullOrUndefined(i)?{}:i).fitToWidthSettings&&i.fitToWidthSettings.isFitToWidth?("CurrentViewData"===i.exportType?this.helper.beforeSinglePageExport.cloneFlatData=oe.extend([],this.parent.currentViewData,null,!0):"AllData"===i.exportType?this.helper.beforeSinglePageExport.cloneFlatData=oe.extend([],this.parent.flatData,null,!0):this.helper.beforeSinglePageExport.cloneFlatData=oe.extend([],s,null,!0),this.helper.beforeSinglePageExport.cloneCurrentViewData=oe.extend([],this.parent.currentViewData,null,!0),this.helper.beforeSinglePageExport.cloneFlatData):oe.isNullOrUndefined(i.exportType)?s:"CurrentViewData"===i.exportType?this.parent.currentViewData:this.parent.flatData;this.initGantt(),oe.isNullOrUndefined(e)?this.pdfDocument=new le.PdfDocument:this.pdfDocument=e,this.processExport(r,i,n).then(function(){a.parent.trigger("pdfExportComplete",a.isBlob?{promise:a.blobPromise}:{}),oe.isNullOrUndefined(a.parent.loadingIndicator)||"Shimmer"!==a.parent.loadingIndicator.indicatorType?a.parent.hideSpinner():a.parent.hideMaskRow(),t(a.pdfDocument)})},tr.prototype.processExport=function(i,n,t){var a=this,e=this.pdfDocument.sections.add();return this.processSectionExportProperties(e,n),this.pdfPage=e.pages.add(),this.pdfPageDimensions=this.pdfPage.getClientSize(),new Promise(function(e,t){a.helper.processGridExport(i,a.gantt,n),a.helper.initializePdf(a.pdfDocument),e()}).then(function(){var e=new ya,e=(e.break=le.PdfLayoutBreakType.FitElement,a.gantt.drawGrid(a.pdfPage,0,0,e));return a.gantt.drawChart(e),a.helper.exportProps&&a.helper.exportProps.fitToWidthSettings&&a.helper.exportProps.fitToWidthSettings.isFitToWidth&&(a.parent.zoomingProjectStartDate=a.helper.beforeSinglePageExport.zoomingProjectStartDate,a.parent.zoomingProjectEndDate=a.helper.beforeSinglePageExport.zoomingProjectEndDate,a.parent.cloneProjectStartDate=a.helper.beforeSinglePageExport.cloneProjectStartDate,a.parent.cloneProjectEndDate=a.helper.beforeSinglePageExport.cloneProjectEndDate,a.parent.timelineModule.customTimelineSettings=a.helper.beforeSinglePageExport.customTimelineSettings,a.parent.isTimelineRoundOff=a.helper.beforeSinglePageExport.isTimelineRoundOff,a.parent.timelineModule.topTier=a.helper.beforeSinglePageExport.topTier,a.parent.timelineModule.topTierCellWidth=a.helper.beforeSinglePageExport.topTierCellWidth,a.parent.timelineModule.topTierCollection=a.helper.beforeSinglePageExport.topTierCollection,a.parent.timelineModule.bottomTier=a.helper.beforeSinglePageExport.bottomTier,a.parent.timelineModule.bottomTierCellWidth=a.helper.beforeSinglePageExport.bottomTierCellWidth,a.parent.timelineModule.bottomTierCollection=a.helper.beforeSinglePageExport.bottomTierCollection,a.parent.timelineModule.totalTimelineWidth=a.helper.beforeSinglePageExport.totalTimelineWidth,a.parent.timelineModule.timelineStartDate=a.helper.beforeSinglePageExport.timelineStartDate,a.parent.timelineModule.timelineEndDate=a.helper.beforeSinglePageExport.timelineEndDate,a.parent.timelineModule.timelineRoundOffEndDate=a.helper.beforeSinglePageExport.timelineRoundOffEndDate,a.parent.perDayWidth=a.helper.beforeSinglePageExport.perDayWidth,a.parent.updatedConnectorLineCollection=a.helper.beforeSinglePageExport.updatedConnectorLineCollection),a.gantt.changeCloneProjectDates&&(a.parent.cloneProjectStartDate.setHours(0),a.gantt.changeCloneProjectDates=!1),t||(a.isBlob?a.blobPromise=a.pdfDocument.save():!oe.isNullOrUndefined(n)&&n.fileName?a.pdfDocument.save(n.fileName):a.pdfDocument.save("Export.pdf"),a.pdfDocument.destroy()),a.pdfDocument})},tr.prototype.processSectionExportProperties=function(e,t){var i;oe.isNullOrUndefined(t)||(i=new le.PdfPageSettings,oe.isNullOrUndefined(t.pageOrientation)||"Portrait"!==t.pageOrientation?i.orientation=le.PdfPageOrientation.Landscape:i.orientation=le.PdfPageOrientation.Portrait,oe.isNullOrUndefined(t.pageSize)||(i.size=this.getPageSize(t.pageSize)),e.setPageSettings(i),oe.isNullOrUndefined(t.ganttStyle))?this.gantt.ganttStyle=new Jn(t.theme).style:(e=new Jn(t.theme).style,this.gantt.ganttStyle=oe.extend({},e,t.ganttStyle,!0))},tr.prototype.getPageSize=function(e){switch(e){case"Letter":return new le.SizeF(612,792);case"Note":return new le.SizeF(540,720);case"Legal":return new le.SizeF(612,1008);case"A0":return new le.SizeF(2380,3368);case"A1":return new le.SizeF(1684,2380);case"A2":return new le.SizeF(1190,1684);case"A3":return new le.SizeF(842,1190);case"A5":return new le.SizeF(421,595);case"A6":return new le.SizeF(297,421);case"A7":return new le.SizeF(210,297);case"A8":return new le.SizeF(148,210);case"A9":return new le.SizeF(105,148);case"B0":return new le.SizeF(2836,4008);case"B1":return new le.SizeF(2004,2836);case"B2":return new le.SizeF(1418,2004);case"B3":return new le.SizeF(1002,1418);case"B4":return new le.SizeF(709,1002);case"B5":return new le.SizeF(501,709);case"Archa":return new le.SizeF(648,864);case"Archb":return new le.SizeF(864,1296);case"Archc":return new le.SizeF(1296,1728);case"Archd":return new le.SizeF(1728,2592);case"Arche":return new le.SizeF(2592,3456);case"Flsa":return new le.SizeF(612,936);case"HalfLetter":return new le.SizeF(396,612);case"Letter11x17":return new le.SizeF(792,1224);case"Ledger":return new le.SizeF(1224,792);default:return new le.SizeF(595,842)}};ha=tr;function tr(e){this.isPdfExport=!1,this.parent=e,this.helper=new Ba(this.parent),this.pdfDocument=void 0}nr.prototype.getModuleName=function(){return"virtualScroll"},nr.prototype.bindTreeGridProperties=function(){this.parent.treeGrid.enableVirtualization=this.parent.enableVirtualization,T.TreeGrid.Inject(T.VirtualScroll)},nr.prototype.getTopPosition=function(){var e=this.parent.ganttChartModule.scrollElement.querySelector(".e-virtualtable"),t=e.style.transform.split(",");return e=1<t.length?t[1].trim().split(")")[0]:(t=e.style.transform).substring(t.lastIndexOf("(")+1,t.lastIndexOf(")")),parseFloat(e)},nr.prototype.destroy=function(){};var ir=nr;function nr(e){this.parent=e,this.bindTreeGridProperties()}k.AddDialogFieldSettings=Et,k.Column=Rt,k.ColumnMenu=Yn,k.ContextMenu=_n,k.CriticalPath=Hn,k.DayMarkers=An,k.DayWorkingTime=It,k.Dependency=tn,k.Edit=g,k.EditDialogFieldSettings=Lt,k.EditSettings=Wt,k.EventMarker=zt,k.ExcelExport=Xn,k.Filter=On,k.FilterSettings=Zt,k.Gantt=Ki,k.Holiday=ii,k.LabelSettings=si,k.LoadingIndicator=ji,k.PdfBorders=ia,k.PdfExport=ha,k.PdfGanttTheme=Jn,k.PdfPaddings=aa,k.PdfTreeGridCell=va,k.PdfTreeGridCellCollection=Sa,k.PdfTreeGridColumn=Ua,k.PdfTreeGridColumnCollection=Na,k.PdfTreeGridHeaderCollection=Ia,k.PdfTreeGridLayoutFormat=ya,k.PdfTreeGridLayoutResult=ga,k.PdfTreeGridLayouter=pa,k.PdfTreeGridRow=Ra,k.PdfTreeGridRowCollection=xa,k.PdfTreeGridStyle=da,k.PdfTreeGridStyleBase=sa,k.Reorder=Sn,k.Resize=Mn,k.ResourceFields=Ni,k.RowDD=Qn,k.SearchSettings=Jt,k.Selection=Un,k.SelectionSettings=hi,k.Sort=In,k.SortDescriptor=Li,k.SortSettings=Ii,k.SplitterSettings=gi,k.TaskFields=Di,k.TemporaryDictionary=ea,k.TimelineSettings=s,k.TimelineTierSettings=Si,k.Toolbar=Fn,k.TooltipSettings=Pi,k.UndoRedo=zn,k.VirtualScroll=ir,k.WeekWorkingTime=_i,k.formatString=Y,k.getIndex=K,k.getSwapKey=G,k.getTaskData=X,k.getUid=J,k.getUniversalTime=q,k.isCountRequired=j,k.isEmptyObject=z,k.isRemoteData=_,k.isScheduledTask=H,k.keyPressed="key-pressed",k.load="load",k.parentsUntil=P,k.pixelToPoint=de,k.pointToPixel=he,k.queryCellInfo="queryCellInfo",k.rowDataBound="rowDataBound",k.toolbarClick=un,k.updateDates=Z,Object.defineProperty(k,"__esModule",{value:!0})});
//# sourceMappingURL=ej2-gantt.umd.min.js.map
